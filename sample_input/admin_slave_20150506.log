# Time: 150427  2:30:57
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 302.115452  Lock_time: 0.000046 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430069457;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2010727h1822857';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 180.106550  Lock_time: 0.000113 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430069457;
SELECT d.product_nm
              ,b.start_de
              ,b.end_de 
        FROM tz_purchase_student a 
            ,tz_student  b
            ,tz_purchase c
            ,tz_product  d
        WHERE a.temp_student_no = b.student_no
          AND c.PRODUCT_NO      = d.PRODUCT_NO
          AND a.PURCHASE_NO     = c.PURCHASE_NO
          AND b.student_no = '272749';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 205.183205  Lock_time: 0.001318 Rows_sent: 12  Rows_examined: 408
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 201.565217  Lock_time: 0.001598 Rows_sent: 12  Rows_examined: 408
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 188.606317  Lock_time: 0.001918 Rows_sent: 12  Rows_examined: 408
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 195.519621  Lock_time: 0.002049 Rows_sent: 12  Rows_examined: 408
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 210.853331  Lock_time: 0.001335 Rows_sent: 12  Rows_examined: 408
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 196.063784  Lock_time: 0.002682 Rows_sent: 12  Rows_examined: 408
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 197.349127  Lock_time: 0.001689 Rows_sent: 20  Rows_examined: 900
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.13'
            AND pln.plan_de <= '2015.04.19'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.13'
            AND a.plan_de <= '2015.04.19'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.13'
            AND lpt.plan_de <= '2015.04.19'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 184.845731  Lock_time: 0.001593 Rows_sent: 20  Rows_examined: 900
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.13'
            AND pln.plan_de <= '2015.04.19'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.13'
            AND a.plan_de <= '2015.04.19'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.13'
            AND lpt.plan_de <= '2015.04.19'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 199.122559  Lock_time: 0.001518 Rows_sent: 20  Rows_examined: 900
SET timestamp=1430069457;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '272749'
            AND pln.plan_de >= '2015.04.13'
            AND pln.plan_de <= '2015.04.19'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '272749'
            AND a.plan_de >= '2015.04.13'
            AND a.plan_de <= '2015.04.19'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '272749'
            AND lpt.plan_de >= '2015.04.13'
            AND lpt.plan_de <= '2015.04.19'
        ORDER BY plan_de;
# Time: 150427  2:32:32
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 418.544940  Lock_time: 0.001370 Rows_sent: 27059  Rows_examined: 252656
SET timestamp=1430069552;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150427  2:37:43
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 299.813367  Lock_time: 0.000104 Rows_sent: 1  Rows_examined: 7329
SET timestamp=1430069863;
SELECT concat(sk.subj_knd_nm_short, ' ', bp.start_page, '~', bp.end_page) as result
					 FROM ishomedb.tz_lcms_book_page bp
					 INNER JOIN ishomedb.tz_lcms_subj_knd sk
					 ON sk.subj_knd_no = bp.subj_knd_no
					 WHERE EXISTS (
								 SELECT 1
								 FROM ishomedb.tz_lcms_study_lesson l
								 INNER JOIN ishomedb.tz_lcms_subj s
								 ON l.subj_no = s.subj_no
								 WHERE l.subj_lesson_no = bp.subj_lesson_no
								 and l.subj_no = 25
								 and l.subj_lesson_no = 1414
							 );
# Time: 150427  2:37:57
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 320.325074  Lock_time: 0.001295 Rows_sent: 4360  Rows_examined: 72088
SET timestamp=1430069877;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150427  2:43:07
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.968508  Lock_time: 0.000043 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430070187;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5627309';
# Time: 150427  2:43:23
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 322.494332  Lock_time: 0.000675 Rows_sent: 6245  Rows_examined: 58901
SET timestamp=1430070203;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150427  2:44:06
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 37.315899  Lock_time: 0.000123 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430070246;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150427  2:44:41
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 31.828116  Lock_time: 0.000135 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430070281;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150427  2:47:02
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.438351  Lock_time: 0.002527 Rows_sent: 2  Rows_examined: 9833958
SET timestamp=1430070422;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150427  2:52:30
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 300.732065  Lock_time: 0.000049 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430070750;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2081103w5309796';
# Time: 150427  2:52:41
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 318.270449  Lock_time: 0.001301 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430070761;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150427  2:53:44
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 59.732959  Lock_time: 0.001747 Rows_sent: 8116  Rows_examined: 1689738
SET timestamp=1430070824;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150427  2:54:06
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.118848  Lock_time: 0.000215 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430070846;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:54:35
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.296727  Lock_time: 0.000253 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430070875;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:54:48
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.256552  Lock_time: 0.000217 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430070888;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:54:58
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.042090  Lock_time: 0.000213 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430070898;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:55:08
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.851336  Lock_time: 0.000246 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430070908;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:55:25
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.503995  Lock_time: 0.000221 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430070925;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:55:39
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.202269  Lock_time: 0.000272 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430070939;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:55:50
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.397285  Lock_time: 0.000217 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430070950;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:56:04
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.882939  Lock_time: 0.000218 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430070964;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:56:27
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.117333  Lock_time: 0.000212 Rows_sent: 64476  Rows_examined: 211316
SET timestamp=1430070987;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150427  2:56:42
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.641335  Lock_time: 0.000160 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430071002;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150427  2:58:09
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 85.638852  Lock_time: 0.000239 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430071089;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150427  2:59:22
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.773839  Lock_time: 0.001830 Rows_sent: 1538  Rows_examined: 1630336
SET timestamp=1430071162;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150427  3:00:17
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 49.954456  Lock_time: 0.002505 Rows_sent: 5788  Rows_examined: 19721
SET timestamp=1430071217;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150427  8:54:05
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 26.415878  Lock_time: 0.000119 Rows_sent: 2  Rows_examined: 41939956
SET timestamp=1430092445;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150427  8:54:39
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 26.300663  Lock_time: 0.000139 Rows_sent: 1  Rows_examined: 41939956
SET timestamp=1430092479;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150427  8:55:26
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.184682  Lock_time: 0.000086 Rows_sent: 0  Rows_examined: 41939957
SET timestamp=1430092526;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150427  8:56:37
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.479371  Lock_time: 0.000524 Rows_sent: 49509  Rows_examined: 5219922
SET timestamp=1430092597;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
   ,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-03-31 23:59:59'
    AND pur.purchase_dt >= '2015-01-01 00:00:00';
# Time: 150427  8:56:46
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.353032  Lock_time: 0.000684 Rows_sent: 49509  Rows_examined: 5219922
SET timestamp=1430092606;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
   ,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-03-31 23:59:59'
    AND pur.purchase_dt >= '2015-01-01 00:00:00';
# Time: 150427  8:57:00
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.462814  Lock_time: 0.000336 Rows_sent: 49509  Rows_examined: 5219922
SET timestamp=1430092620;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
   ,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-03-31 23:59:59'
    AND pur.purchase_dt >= '2015-01-01 00:00:00';
# Time: 150427  9:12:20
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 11.080280  Lock_time: 0.000462 Rows_sent: 30  Rows_examined: 5834628
SET timestamp=1430093540;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150427  9:27:44
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.263592  Lock_time: 0.000502 Rows_sent: 30  Rows_examined: 5834652
SET timestamp=1430094464;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150427  9:37:12
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 26.674060  Lock_time: 0.000158 Rows_sent: 2  Rows_examined: 41940118
SET timestamp=1430095032;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150427 14:54:31
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.419357  Lock_time: 0.000186 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114071;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:32
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.584848  Lock_time: 0.000215 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114072;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:33
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.339305  Lock_time: 0.000317 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114073;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:34
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.978504  Lock_time: 0.000240 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114074;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:35
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.153466  Lock_time: 0.000295 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114075;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.645408  Lock_time: 0.000292 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114075;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:36
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.697962  Lock_time: 0.000297 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114076;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.458699  Lock_time: 0.000298 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114076;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.805145  Lock_time: 0.000287 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114076;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.547178  Lock_time: 0.000216 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114076;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.960818  Lock_time: 0.000289 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114076;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.674164  Lock_time: 0.000285 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114076;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 11.014048  Lock_time: 0.000337 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114076;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:37
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.973629  Lock_time: 0.000335 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114077;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.846537  Lock_time: 0.000347 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114077;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.571425  Lock_time: 0.000371 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114077;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.947710  Lock_time: 0.000317 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114077;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.715343  Lock_time: 0.000379 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114077;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.530743  Lock_time: 0.000313 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114077;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.715658  Lock_time: 0.000779 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114077;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:39
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.517338  Lock_time: 0.000218 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114079;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.447967  Lock_time: 0.000376 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114079;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 14:54:40
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.315417  Lock_time: 0.000258 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114080;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.821702  Lock_time: 0.000341 Rows_sent: 4  Rows_examined: 987767
SET timestamp=1430114080;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('민은홍', '%') OR nb.nm_kor LIKE CONCAT('민은홍', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 16:22:54
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.600787  Lock_time: 0.000289 Rows_sent: 8  Rows_examined: 2118638
SET timestamp=1430119374;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('eungu5656'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150427 16:27:13
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.340575  Lock_time: 0.000303 Rows_sent: 16  Rows_examined: 2118959
SET timestamp=1430119633;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('tototo'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150427 16:28:05
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.514393  Lock_time: 0.000305 Rows_sent: 13  Rows_examined: 2119043
SET timestamp=1430119685;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('jun0710'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150427 16:28:42
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.544649  Lock_time: 0.000408 Rows_sent: 13  Rows_examined: 2119078
SET timestamp=1430119722;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('jun0710'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150427 16:29:55
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.477827  Lock_time: 0.000189 Rows_sent: 13  Rows_examined: 2119175
SET timestamp=1430119795;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('jun0710'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150427 18:03:37
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.431765  Lock_time: 0.000544 Rows_sent: 14762  Rows_examined: 2941185
SET timestamp=1430125417;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.27', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.27', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150427 20:40:53
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.236079  Lock_time: 0.000229 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134853;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 20:40:54
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.242425  Lock_time: 0.000257 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134854;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.486485  Lock_time: 0.000253 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134854;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.312281  Lock_time: 0.000387 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134854;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.322309  Lock_time: 0.000658 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134854;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.490935  Lock_time: 0.000599 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134854;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.239809  Lock_time: 0.000710 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134854;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 20:40:55
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.298110  Lock_time: 0.000256 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134855;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.179926  Lock_time: 0.000378 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134855;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.023674  Lock_time: 0.000315 Rows_sent: 8  Rows_examined: 988770
SET timestamp=1430134855;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('김병현', '%') OR nb.nm_kor LIKE CONCAT('김병현', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150427 21:33:12
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.713711  Lock_time: 0.000574 Rows_sent: 14843  Rows_examined: 2956061
SET timestamp=1430137992;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.27', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.27', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150427 21:34:05
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.503848  Lock_time: 0.000524 Rows_sent: 14844  Rows_examined: 2956077
SET timestamp=1430138045;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.27', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.27', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150428  2:31:15
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 302.610538  Lock_time: 0.000048 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430155875;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2010727w1822316';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 290.267644  Lock_time: 0.000066 Rows_sent: 3  Rows_examined: 6
SET timestamp=1430155875;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '148'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 282.443927  Lock_time: 0.000076 Rows_sent: 5  Rows_examined: 10
SET timestamp=1430155875;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '21'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 277.470319  Lock_time: 0.000067 Rows_sent: 5  Rows_examined: 10
SET timestamp=1430155875;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '21'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 272.412019  Lock_time: 0.000067 Rows_sent: 5  Rows_examined: 10
SET timestamp=1430155875;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '87'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 267.014052  Lock_time: 0.000067 Rows_sent: 45  Rows_examined: 90
SET timestamp=1430155875;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '117'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 32.768684  Lock_time: 0.000209 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430155875;
SELECT COUNT(a.f_stu_test_id) AS cnt
        FROM (
            SELECT st.f_stu_test_id
            FROM edubasestudydb.t_student_test st
            INNER JOIN ishomedb.tz_student s
            ON st.f_user_cd = s.student_no
            INNER JOIN ishomedb.tz_purchase_student ps
            ON s.student_no = ps.temp_student_no
            INNER JOIN ishomedb.tz_purchase p
            ON ps.purchase_no = p.purchase_no
            AND IFNULL(p.status_gbn, 10001) != 10010
            WHERE DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
                AND s.teacher_id = 417992
                AND st.f_ischeckpoint = 'N'
            GROUP BY st.f_test_id, st.f_user_cd
        ) a;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 291.639077  Lock_time: 0.001137 Rows_sent: 31  Rows_examined: 44744
SET timestamp=1430155875;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '189'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.01.28', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.04.28', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '189'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.01.28', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.04.28', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 30
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 32.869002  Lock_time: 0.001185 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430155875;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150428  2:32:42
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 425.316956  Lock_time: 0.001347 Rows_sent: 27059  Rows_examined: 252656
SET timestamp=1430155962;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150428  2:37:58
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 303.285953  Lock_time: 0.000047 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430156278;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5620824';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 215.379996  Lock_time: 0.000180 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430156278;
SELECT COUNT(a.manager_id) AS cnt  
        FROM   ishomedb.tz_manager a
         
        INNER  JOIN ( SELECT  code_no
                             ,code_nm
                      FROM   ishomedb.tz_code
                      WHERE  code_gbn = 10001
                    ) b
        ON      b.code_no = a.auth_gbn
        
        WHERE   a.manager_id = 147
          AND   a.auth_gbn = 10010;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 159.696842  Lock_time: 0.000215 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430156278;
SELECT COUNT(a.manager_id) AS cnt  
        FROM   ishomedb.tz_manager a
         
        INNER  JOIN ( SELECT  code_no
                             ,code_nm
                      FROM   ishomedb.tz_code
                      WHERE  code_gbn = 10001
                    ) b
        ON      b.code_no = a.auth_gbn
        
        WHERE   a.manager_id = 147
          AND   a.auth_gbn = 10010;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 155.290530  Lock_time: 0.000120 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430156278;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 417992;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 140.786141  Lock_time: 0.000169 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430156278;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 417992;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 157.607840  Lock_time: 0.000132 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430156278;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 417992;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 127.322099  Lock_time: 0.000132 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430156278;
SELECT COUNT(a.manager_id) AS cnt  
        FROM   ishomedb.tz_manager a
         
        INNER  JOIN ( SELECT  code_no
                             ,code_nm
                      FROM   ishomedb.tz_code
                      WHERE  code_gbn = 10001
                    ) b
        ON      b.code_no = a.auth_gbn
        
        WHERE   a.manager_id = 147
          AND   a.auth_gbn = 10010;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 34.587498  Lock_time: 0.000146 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430156278;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 417992;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 90.512774  Lock_time: 0.000141 Rows_sent: 1  Rows_examined: 158
SET timestamp=1430156278;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 417992
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 25.606328  Lock_time: 0.000202 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430156278;
SELECT COUNT(a.manager_id) AS cnt  
        FROM   ishomedb.tz_manager a
         
        INNER  JOIN ( SELECT  code_no
                             ,code_nm
                      FROM   ishomedb.tz_code
                      WHERE  code_gbn = 10001
                    ) b
        ON      b.code_no = a.auth_gbn
        
        WHERE   a.manager_id = 147
          AND   a.auth_gbn = 10010;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 177.454501  Lock_time: 0.000904 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972318412
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 178.994028  Lock_time: 0.000927 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972318412
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 295.709061  Lock_time: 0.000998 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972343717
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 212.434502  Lock_time: 0.000920 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972323177
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 225.014674  Lock_time: 0.000997 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972318412
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 170.398238  Lock_time: 0.000936 Rows_sent: 4  Rows_examined: 29
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972353686
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 274.069567  Lock_time: 0.000833 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972323177
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 287.251678  Lock_time: 0.000861 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972343717
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 183.436931  Lock_time: 0.000934 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972323177
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 275.835365  Lock_time: 0.000909 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972323177
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 241.460585  Lock_time: 0.000824 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972323177
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 298.126609  Lock_time: 0.000201 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430156278;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972343717'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 302.205133  Lock_time: 0.000179 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430156278;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972343717'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 290.742537  Lock_time: 0.000194 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430156278;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972343717'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 253.904619  Lock_time: 0.000208 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430156278;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972343717'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 279.481571  Lock_time: 0.000221 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430156278;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972343717'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 282.044383  Lock_time: 0.000272 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156278;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2643';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 200.479723  Lock_time: 0.001043 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156278;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2813';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 157.144875  Lock_time: 0.000814 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156278;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2813';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 285.785313  Lock_time: 0.000858 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972343717
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 256.674861  Lock_time: 0.000881 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156278;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2813';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 127.817774  Lock_time: 0.001109 Rows_sent: 4  Rows_examined: 29
SET timestamp=1430156278;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972390894
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 70.910491  Lock_time: 0.001755 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156278;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 119.681416  Lock_time: 0.001601 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156278;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 122.343881  Lock_time: 0.001652 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156278;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 67.714257  Lock_time: 0.001593 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156278;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 70.851564  Lock_time: 0.001318 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156278;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 91.058476  Lock_time: 0.001013 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156278;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 67.564793  Lock_time: 0.001401 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156278;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 70.910564  Lock_time: 0.001275 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156278;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150428  2:37:59
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 67.612148  Lock_time: 0.001382 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 91.141463  Lock_time: 0.001159 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 248.384641  Lock_time: 0.001012 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 248.415712  Lock_time: 0.001102 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 128.632223  Lock_time: 0.001088 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 128.319247  Lock_time: 0.001051 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 192.770436  Lock_time: 0.001122 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 63.966187  Lock_time: 0.001542 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 96.223923  Lock_time: 0.001220 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 26.656030  Lock_time: 0.001643 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 64.052419  Lock_time: 0.001354 Rows_sent: 361  Rows_examined: 8438
SET timestamp=1430156279;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 147
		AND    mag.auth_gbn = '10001'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# Time: 150428  2:38:12
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 325.378241  Lock_time: 0.000960 Rows_sent: 4360  Rows_examined: 72088
SET timestamp=1430156292;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150428  2:43:20
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 302.513984  Lock_time: 0.000061 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430156600;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5627309';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 265.634965  Lock_time: 0.000126 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430156600;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 417992;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 37.102183  Lock_time: 0.000122 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430156600;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 417992;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 199.022020  Lock_time: 0.000131 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430156600;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 417992;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 300.223949  Lock_time: 0.000980 Rows_sent: 0  Rows_examined: 25
SET timestamp=1430156600;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972318412
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 248.816022  Lock_time: 0.000577 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156600;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2647';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 273.979995  Lock_time: 0.000859 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156600;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972296480
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 279.541870  Lock_time: 0.000329 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430156600;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972398568
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 299.217629  Lock_time: 0.000267 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156600;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2643';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 288.061110  Lock_time: 0.000667 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156600;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2643';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 100.200243  Lock_time: 0.000598 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156600;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2644';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 110.211152  Lock_time: 0.000635 Rows_sent: 1  Rows_examined: 109
SET timestamp=1430156600;
SELECT CONCAT(m.nm_kor, '(', m.login_id, ')') as answerInfo
            ,date_format(q.f_reg_dt, '%Y.%m.%d') f_reg_dt
            ,(CASE WHEN q.f_answer_state = 'N' THEN
                '답변중'
            ELSE
                '답변완료'
            END) answer_state
            ,q.f_answer_state
            ,edubasestudydb.tCodeRefNm(f_subject_cd) AS f_subject_nm
            ,CONCAT(edubasestudydb.tCodeRefNm(q.f_kind_cd), 
            (CASE WHEN f_no=1 THEN 
                '(기본)'
                WHEN f_no=2 THEN
                '(심화)'
                WHEN f_no=3 THEN
                '(보충)'
               END)
            ) f_test_nm
            ,CONCAT(q.f_grade_cd, '학년 ', q.f_term_cd, '학기') f_grade_term
            ,q.f_sg_qna_path
            ,q.f_txt_answer
            ,q.f_answer
            ,q.file_seq
            ,qf.save_file_nm
        FROM edubasestudydb.t_math_qna q
        LEFT OUTER JOIN edubasestudydb.t_math_qna_file_seq qf
        ON q.file_seq = qf.upload_seq
        LEFT OUTER JOIN ishomedb.tz_student s
        ON s.student_no = q.f_user_cd
        LEFT OUTER JOIN ishomedb.tz_member m
        ON s.student_id = m.user_id
        WHERE q.f_math_id = '2812';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 302.274425  Lock_time: 0.000636 Rows_sent: 20  Rows_examined: 78099
SET timestamp=1430156600;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 417992
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
            
              AND a.f_ischeckpoint = 'N'
           
           
           
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 262.565717  Lock_time: 0.001636 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156600;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 69.967920  Lock_time: 0.001313 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156600;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 262.420243  Lock_time: 0.001108 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156600;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 33.920226  Lock_time: 0.001753 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156600;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 69.799204  Lock_time: 0.001009 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156600;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 231.995833  Lock_time: 0.001790 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430156600;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 231.786448  Lock_time: 0.001033 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156600;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 33.773880  Lock_time: 0.001024 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156600;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 69.847276  Lock_time: 0.001102 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156600;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 231.810779  Lock_time: 0.001037 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156600;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 262.510840  Lock_time: 0.001049 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430156600;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150428  2:43:35
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 319.938024  Lock_time: 0.000326 Rows_sent: 6245  Rows_examined: 58901
SET timestamp=1430156615;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150428  2:44:19
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 37.984863  Lock_time: 0.000122 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430156659;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150428  2:44:54
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 32.998211  Lock_time: 0.000138 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430156694;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150428  2:47:19
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.389244  Lock_time: 0.002517 Rows_sent: 2  Rows_examined: 9833958
SET timestamp=1430156839;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150428  2:52:51
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.373859  Lock_time: 0.000050 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430157171;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2081103w5309796';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 277.458179  Lock_time: 0.000180 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430157171;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972344287'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 279.971962  Lock_time: 0.000233 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430157171;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972344287'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 204.018546  Lock_time: 0.000314 Rows_sent: 5  Rows_examined: 30
SET timestamp=1430157171;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972344287
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 273.357718  Lock_time: 0.000323 Rows_sent: 5  Rows_examined: 30
SET timestamp=1430157171;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972344287
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 191.923844  Lock_time: 0.000344 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430157171;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150428  2:52:52
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 69.200614  Lock_time: 0.001043 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430157172;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 192.171515  Lock_time: 0.001339 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430157172;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 37.021370  Lock_time: 0.001116 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430157172;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 191.993469  Lock_time: 0.001078 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430157172;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 417992
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 69.588829  Lock_time: 0.001779 Rows_sent: 104  Rows_examined: 156898
SET timestamp=1430157172;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 417992
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# Time: 150428  2:53:02
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 322.025466  Lock_time: 0.001290 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430157182;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150428  2:54:06
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 60.502662  Lock_time: 0.001709 Rows_sent: 8116  Rows_examined: 1689738
SET timestamp=1430157246;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150428  2:54:28
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.370442  Lock_time: 0.000219 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430157268;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:54:57
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.626790  Lock_time: 0.000217 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430157297;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:55:10
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 9.804749  Lock_time: 0.000215 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430157310;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:55:20
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.670676  Lock_time: 0.000232 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430157320;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:55:30
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.839603  Lock_time: 0.000215 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430157330;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:55:47
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.561086  Lock_time: 0.000247 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430157347;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:56:01
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.232017  Lock_time: 0.000218 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430157361;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:56:12
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.149806  Lock_time: 0.000253 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430157372;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:56:25
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.727767  Lock_time: 0.000235 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430157385;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:56:49
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.316343  Lock_time: 0.000195 Rows_sent: 64476  Rows_examined: 211316
SET timestamp=1430157409;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150428  2:57:03
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.505983  Lock_time: 0.000157 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430157423;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150428  2:58:33
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 87.465826  Lock_time: 0.000235 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430157513;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150428  2:59:46
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.413838  Lock_time: 0.001830 Rows_sent: 1538  Rows_examined: 1630336
SET timestamp=1430157586;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150428  3:00:43
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 51.140943  Lock_time: 0.002343 Rows_sent: 5788  Rows_examined: 19721
SET timestamp=1430157643;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150428  8:53:32
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 26.617224  Lock_time: 0.000176 Rows_sent: 2  Rows_examined: 42115060
SET timestamp=1430178812;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150428  8:54:01
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 26.890172  Lock_time: 0.000087 Rows_sent: 1  Rows_examined: 42115061
SET timestamp=1430178841;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150428  8:54:54
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.093675  Lock_time: 0.000108 Rows_sent: 0  Rows_examined: 42115062
SET timestamp=1430178894;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150428  9:04:28
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 26.240487  Lock_time: 0.000680 Rows_sent: 2  Rows_examined: 42115107
SET timestamp=1430179468;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150428 10:23:12
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 77.606931  Lock_time: 0.000439 Rows_sent: 10  Rows_examined: 2839124
SET timestamp=1430184192;
SELECT a.purchase_no /* 주문번호 */
		      ,a.delivery_invoice_no /* 운송장 번호 */
		      ,i.serial_no /* 시리얼 번호 */
		      ,i.status_gbn AS device_status_gbn /* 단말기상태코드 */
		      ,d.code_nm AS status /* 구매상태 */
		      ,z.code_nm AS device_status /* 단말기상태값 */
		      ,j.code_nm AS ship_use /* 출하용도 */
		      ,g.code_nm AS payhow /* 결제방법 */
		      ,no_mem.member_no AS no_member_no /* 직접입력 고객번호 */  
		      ,no_mem.nm_kor AS no_nm_kor     /* 직접입력 고객이름 */
		      ,no_mem.ticket_number AS ticket_number /* 수강권번호 */
		      ,DATE_FORMAT(a.ship_req_dt, '%Y.%m.%d') AS ship_req_dt /* 출하요청일 */
		      ,CONCAT(e.nm_kor, ' (', e.login_id, ')') AS purchase_nm /* 주문자(아이디) */
		      ,CONCAT(c.product_nm, IF(a.model_code IS NULL, '', CONCAT(' / ', a.model_code))) AS product_model /* 상품코드/모델코드 */
		      ,DATE_FORMAT(a.purchase_dt,'%Y.%m.%d %H:%i') AS purchase_dt /* 주문일시 */
		      ,IFNULL((SELECT paid_yn FROM ishomedb.tz_experience WHERE parent_id = a.purchase_id LIMIT 1),'N') AS paid_yn /* 유료확정여부 */
		      ,(SELECT nm_kor FROM ishomedb.tz_member WHERE user_id = a.student_id) AS s_name /* 학생명 */
		      ,(SELECT login_id FROM ishomedb.tz_member WHERE user_id = a.student_id) AS s_login_id /* 학생아이디 */ 
		      ,e.addr1 AS purchase_addr /* 구매자지역 */
		      ,a.status_gbn AS purchase_status_gbn /* 구매상태 */
		      ,a.withdraw_dt AS purchase_withdraw_dt /* 회수일 */  
		      ,a.product_no /* 상품번호 */
		      ,a.purchase_device_gbn /* 구매단말기 구분*/
		      ,uf_code_nm(10218,a.purchase_device_gbn) AS purchase_device_gbn_nm
		      ,a.ipshar_yn /* 공유기 유무 */
		      ,y.code_nm as device_area /* 처리장소 */
		      ,tdm.model_gbn as model_gbn /* 기기구분 */
		      ,uf_code_nm(10230,tdm.model_gbn) as model_gbn_nm /* 기기구분명 */
		      ,ishomedb.uf_purchase_side_delivery_info(a.purchase_no) as side_info
		      ,a.purchase_device_dt /* 기기선택일자 */            		      
		FROM ishomedb.tz_purchase a
		/* 상품 정보 */
		INNER JOIN ishomedb.tz_product c
		ON a.product_no = c.product_no
		AND c.use_yn = 'Y'
		AND c.service_com_yn = 'Y'
		/* 구매 상태  10118 */
		LEFT OUTER JOIN ishomedb.tz_code d
		ON d.code_gbn = 10118
		AND d.use_yn = 'Y'
		AND a.status_gbn = d.code_no
		/* 주문자 정보 */
		LEFT OUTER JOIN ishomedb.tz_member e
		ON a.purchase_id = e.user_id
		/* 직접등록 주문자정보 */
		LEFT OUTER JOIN ishomedb.tz_member_no_join no_mem
		ON a.purchase_no = no_mem.purchase_no
		/* 결제 방법 10117 */
		LEFT OUTER JOIN ishomedb.tz_code g
		ON g.code_gbn = 10117
		AND g.use_yn = 'Y'
		AND a.payhow_gbn = g.code_no
		/* 단말기 정보 */
		LEFT OUTER JOIN ishomedb.tz_device i
		ON a.purchase_no = i.purchase_no		
		/* 단말기 상태  10200 */
		LEFT OUTER JOIN ishomedb.tz_code z
		ON z.code_gbn = 10200
		AND z.use_yn = 'Y'
		AND i.status_gbn = z.code_no
		/* 출하 용도  10142 */
		LEFT OUTER JOIN ishomedb.tz_code j
		ON a.ship_use = j.code_no
		AND j.use_yn = 'Y'
		AND j.code_gbn = 10142
		/* 출하 구분  10144 */
		LEFT OUTER JOIN ishomedb.tz_code l
		ON a.ship_gbn = l.code_no
		AND l.use_yn = 'Y'
		AND l.code_gbn = 10144
		/* 모델구분 */
        LEFT OUTER JOIN ishomedb.tz_device_model tdm
        ON i.model_code = tdm.model_code
        /* 처리장소 */
        LEFT OUTER JOIN ishomedb.tz_code y
        ON i.stock_lt = y.code_no
        AND y.code_gbn = 10141
         
         WHERE  a.student_id is not null AND a.student_id != ''
        AND a.product_no != '263' /* 학교배포용 학습기 제외 */ 
     
         
        ORDER BY a.purchase_dt DESC
                 
        LIMIT 0, 10;
# Time: 150428 10:28:34
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.318430  Lock_time: 0.000320 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430184514;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('이은숙', '%')  
     
        ) a;
# Time: 150428 10:28:39
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.956861  Lock_time: 0.000242 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430184519;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('이은숙', '%')  
     
        ) a;
# Time: 150428 11:13:11
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.865286  Lock_time: 0.000797 Rows_sent: 14613  Rows_examined: 2912190
SET timestamp=1430187191;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.28', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150428 13:39:20
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.421695  Lock_time: 0.000353 Rows_sent: 100  Rows_examined: 1269103
SET timestamp=1430195960;
SELECT stu.student_no
              ,stu.student_id
              ,stu.grade_gbn
              ,(SELECT product_nm FROM ishomedb.tz_product WHERE product_no = pur.product_no) as product_nm
              ,stu.group_no
              ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
              ,mem.user_id
              ,mem.nm_kor
              ,mem.login_id
              ,mem.parent_id
              ,mem.recom_teacher
              ,prn.nm_kor AS parent_nm
              ,stu.end_de AS service_end_de
              ,prn.login_id AS parent_login
              ,pch.first_start_de AS service_start_de
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT content
                FROM ishomedb.tz_lms_consult lc1
                WHERE lc1.student_no = stu.student_no
                    AND lc1.content IS NOT NULL
                    AND lc1.consult_no = (
                        SELECT MAX(consult_no)
                        FROM ishomedb.tz_lms_consult lc2
                        WHERE lc2.student_no = stu.student_no
                            AND lc2.content IS NOT NULL
                    )
              ) AS consult_content
              ,IFNULL(stu.web_start_de, '') as web_service_start_de
              ,IFNULL(stu.web_end_de, '') as web_service_end_de
        FROM ishomedb.tz_student stu
        INNER JOIN ishomedb.tz_purchase_student pch
        ON stu.student_no = pch.temp_student_no
        INNER JOIN ishomedb.tz_purchase pur
        ON pch.purchase_no = pur.purchase_no
        INNER JOIN ishomedb.tz_member mem
        ON stu.student_id = mem.user_id
        INNER JOIN ishomedb.tz_member prn
        ON mem.parent_id = prn.user_id
        WHERE pur.status_gbn != 10010
            AND pur.product_no != '263' /* 학교배포용 학습기 제외 */
        
         
            AND IFNULL(stu.teacher_id, 0) = 0
            AND (stu.end_de  >=  DATE_FORMAT(NOW(), '%Y-%m-%d') OR stu.end_de IS NULL)
         
         
         
         
         
         
            AND pur.product_no IN (SELECT product_no FROM tz_product WHERE service_experience_yn = 'Y' and service_com_yn = 'N')
             
         
         
         
         
         
         
         
         
         
          ORDER BY service_start_de DESC 
        LIMIT  0, 100;
# Time: 150428 13:39:24
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.800339  Lock_time: 0.000200 Rows_sent: 100  Rows_examined: 1269103
SET timestamp=1430195964;
SELECT stu.student_no
              ,stu.student_id
              ,stu.grade_gbn
              ,(SELECT product_nm FROM ishomedb.tz_product WHERE product_no = pur.product_no) as product_nm
              ,stu.group_no
              ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
              ,mem.user_id
              ,mem.nm_kor
              ,mem.login_id
              ,mem.parent_id
              ,mem.recom_teacher
              ,prn.nm_kor AS parent_nm
              ,stu.end_de AS service_end_de
              ,prn.login_id AS parent_login
              ,pch.first_start_de AS service_start_de
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT content
                FROM ishomedb.tz_lms_consult lc1
                WHERE lc1.student_no = stu.student_no
                    AND lc1.content IS NOT NULL
                    AND lc1.consult_no = (
                        SELECT MAX(consult_no)
                        FROM ishomedb.tz_lms_consult lc2
                        WHERE lc2.student_no = stu.student_no
                            AND lc2.content IS NOT NULL
                    )
              ) AS consult_content
              ,IFNULL(stu.web_start_de, '') as web_service_start_de
              ,IFNULL(stu.web_end_de, '') as web_service_end_de
        FROM ishomedb.tz_student stu
        INNER JOIN ishomedb.tz_purchase_student pch
        ON stu.student_no = pch.temp_student_no
        INNER JOIN ishomedb.tz_purchase pur
        ON pch.purchase_no = pur.purchase_no
        INNER JOIN ishomedb.tz_member mem
        ON stu.student_id = mem.user_id
        INNER JOIN ishomedb.tz_member prn
        ON mem.parent_id = prn.user_id
        WHERE pur.status_gbn != 10010
            AND pur.product_no != '263' /* 학교배포용 학습기 제외 */
        
         
            AND IFNULL(stu.teacher_id, 0) = 0
            AND (stu.end_de  >=  DATE_FORMAT(NOW(), '%Y-%m-%d') OR stu.end_de IS NULL)
         
         
         
         
         
         
            AND pur.product_no IN (SELECT product_no FROM tz_product WHERE service_experience_yn = 'Y' and service_com_yn = 'N')
             
         
         
         
         
         
         
         
         
         
          ORDER BY service_start_de DESC 
        LIMIT  0, 100;
# Time: 150428 15:39:07
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.715897  Lock_time: 0.000195 Rows_sent: 19  Rows_examined: 2156009
SET timestamp=1430203147;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('rlarusdn'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 15:39:29
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.804641  Lock_time: 0.000233 Rows_sent: 19  Rows_examined: 2156040
SET timestamp=1430203169;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('rlarusdn'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 17:36:18
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.616585  Lock_time: 0.000197 Rows_sent: 0  Rows_examined: 2165861
SET timestamp=1430210178;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.nm_kor LIKE CONCAT('%', LOWER('andy3070'), '%')
			
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 17:36:33
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.823074  Lock_time: 0.000291 Rows_sent: 27  Rows_examined: 2165896
SET timestamp=1430210193;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  tm1.login_id LIKE CONCAT('%', LOWER('andy3070'), '%')
			
			
			
			
			
			
			
			
			
			
				AND thci.record_dt  >= CONCAT('2015-01-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 18:18:11
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.098295  Lock_time: 0.000358 Rows_sent: 100  Rows_examined: 1269224
SET timestamp=1430212691;
SELECT stu.student_no
              ,stu.student_id
              ,stu.grade_gbn
              ,(SELECT product_nm FROM ishomedb.tz_product WHERE product_no = pur.product_no) as product_nm
              ,stu.group_no
              ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
              ,mem.user_id
              ,mem.nm_kor
              ,mem.login_id
              ,mem.parent_id
              ,mem.recom_teacher
              ,prn.nm_kor AS parent_nm
              ,stu.end_de AS service_end_de
              ,prn.login_id AS parent_login
              ,pch.first_start_de AS service_start_de
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT content
                FROM ishomedb.tz_lms_consult lc1
                WHERE lc1.student_no = stu.student_no
                    AND lc1.content IS NOT NULL
                    AND lc1.consult_no = (
                        SELECT MAX(consult_no)
                        FROM ishomedb.tz_lms_consult lc2
                        WHERE lc2.student_no = stu.student_no
                            AND lc2.content IS NOT NULL
                    )
              ) AS consult_content
              ,IFNULL(stu.web_start_de, '') as web_service_start_de
              ,IFNULL(stu.web_end_de, '') as web_service_end_de
        FROM ishomedb.tz_student stu
        INNER JOIN ishomedb.tz_purchase_student pch
        ON stu.student_no = pch.temp_student_no
        INNER JOIN ishomedb.tz_purchase pur
        ON pch.purchase_no = pur.purchase_no
        INNER JOIN ishomedb.tz_member mem
        ON stu.student_id = mem.user_id
        INNER JOIN ishomedb.tz_member prn
        ON mem.parent_id = prn.user_id
        WHERE pur.status_gbn != 10010
            AND pur.product_no != '263' /* 학교배포용 학습기 제외 */
        
         
            AND IFNULL(stu.teacher_id, 0) = 0
            AND (stu.end_de  >=  DATE_FORMAT(NOW(), '%Y-%m-%d') OR stu.end_de IS NULL)
         
         
         
         
         
         
            AND pur.product_no IN (SELECT product_no FROM tz_product WHERE service_experience_yn = 'Y' and service_com_yn = 'N')
             
         
         
         
         
         
         
         
         
         
          ORDER BY service_start_de DESC 
        LIMIT  0, 100;
# Time: 150428 18:18:43
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.088341  Lock_time: 0.000390 Rows_sent: 100  Rows_examined: 1269227
SET timestamp=1430212723;
SELECT stu.student_no
              ,stu.student_id
              ,stu.grade_gbn
              ,(SELECT product_nm FROM ishomedb.tz_product WHERE product_no = pur.product_no) as product_nm
              ,stu.group_no
              ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
              ,mem.user_id
              ,mem.nm_kor
              ,mem.login_id
              ,mem.parent_id
              ,mem.recom_teacher
              ,prn.nm_kor AS parent_nm
              ,stu.end_de AS service_end_de
              ,prn.login_id AS parent_login
              ,pch.first_start_de AS service_start_de
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT content
                FROM ishomedb.tz_lms_consult lc1
                WHERE lc1.student_no = stu.student_no
                    AND lc1.content IS NOT NULL
                    AND lc1.consult_no = (
                        SELECT MAX(consult_no)
                        FROM ishomedb.tz_lms_consult lc2
                        WHERE lc2.student_no = stu.student_no
                            AND lc2.content IS NOT NULL
                    )
              ) AS consult_content
              ,IFNULL(stu.web_start_de, '') as web_service_start_de
              ,IFNULL(stu.web_end_de, '') as web_service_end_de
        FROM ishomedb.tz_student stu
        INNER JOIN ishomedb.tz_purchase_student pch
        ON stu.student_no = pch.temp_student_no
        INNER JOIN ishomedb.tz_purchase pur
        ON pch.purchase_no = pur.purchase_no
        INNER JOIN ishomedb.tz_member mem
        ON stu.student_id = mem.user_id
        INNER JOIN ishomedb.tz_member prn
        ON mem.parent_id = prn.user_id
        WHERE pur.status_gbn != 10010
            AND pur.product_no != '263' /* 학교배포용 학습기 제외 */
        
         
            AND IFNULL(stu.teacher_id, 0) = 0
            AND (stu.end_de  >=  DATE_FORMAT(NOW(), '%Y-%m-%d') OR stu.end_de IS NULL)
         
         
         
         
         
         
            AND pur.product_no IN (SELECT product_no FROM tz_product WHERE service_experience_yn = 'Y' and service_com_yn = 'N')
             
         
         
         
         
         
         
         
         
         
          ORDER BY service_start_de DESC 
        LIMIT  0, 100;
# Time: 150428 18:18:50
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.426935  Lock_time: 0.000258 Rows_sent: 100  Rows_examined: 1269227
SET timestamp=1430212730;
SELECT stu.student_no
              ,stu.student_id
              ,stu.grade_gbn
              ,(SELECT product_nm FROM ishomedb.tz_product WHERE product_no = pur.product_no) as product_nm
              ,stu.group_no
              ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
              ,mem.user_id
              ,mem.nm_kor
              ,mem.login_id
              ,mem.parent_id
              ,mem.recom_teacher
              ,prn.nm_kor AS parent_nm
              ,stu.end_de AS service_end_de
              ,prn.login_id AS parent_login
              ,pch.first_start_de AS service_start_de
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT content
                FROM ishomedb.tz_lms_consult lc1
                WHERE lc1.student_no = stu.student_no
                    AND lc1.content IS NOT NULL
                    AND lc1.consult_no = (
                        SELECT MAX(consult_no)
                        FROM ishomedb.tz_lms_consult lc2
                        WHERE lc2.student_no = stu.student_no
                            AND lc2.content IS NOT NULL
                    )
              ) AS consult_content
              ,IFNULL(stu.web_start_de, '') as web_service_start_de
              ,IFNULL(stu.web_end_de, '') as web_service_end_de
        FROM ishomedb.tz_student stu
        INNER JOIN ishomedb.tz_purchase_student pch
        ON stu.student_no = pch.temp_student_no
        INNER JOIN ishomedb.tz_purchase pur
        ON pch.purchase_no = pur.purchase_no
        INNER JOIN ishomedb.tz_member mem
        ON stu.student_id = mem.user_id
        INNER JOIN ishomedb.tz_member prn
        ON mem.parent_id = prn.user_id
        WHERE pur.status_gbn != 10010
            AND pur.product_no != '263' /* 학교배포용 학습기 제외 */
        
         
            AND IFNULL(stu.teacher_id, 0) = 0
            AND (stu.end_de  >=  DATE_FORMAT(NOW(), '%Y-%m-%d') OR stu.end_de IS NULL)
         
         
         
         
         
         
            AND pur.product_no IN (SELECT product_no FROM tz_product WHERE service_experience_yn = 'Y' and service_com_yn = 'N')
             
         
         
         
         
         
         
         
         
         
          ORDER BY service_start_de DESC 
        LIMIT  0, 100;
# Time: 150428 18:19:18
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.103545  Lock_time: 0.000340 Rows_sent: 100  Rows_examined: 1269227
SET timestamp=1430212758;
SELECT stu.student_no
              ,stu.student_id
              ,stu.grade_gbn
              ,(SELECT product_nm FROM ishomedb.tz_product WHERE product_no = pur.product_no) as product_nm
              ,stu.group_no
              ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
              ,mem.user_id
              ,mem.nm_kor
              ,mem.login_id
              ,mem.parent_id
              ,mem.recom_teacher
              ,prn.nm_kor AS parent_nm
              ,stu.end_de AS service_end_de
              ,prn.login_id AS parent_login
              ,pch.first_start_de AS service_start_de
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT MAX(consult_dt) 
                FROM ishomedb.tz_lms_consult 
                WHERE student_no = stu.student_no 
                    AND content IS NOT NULL
              ) AS consult_time
              ,(SELECT content
                FROM ishomedb.tz_lms_consult lc1
                WHERE lc1.student_no = stu.student_no
                    AND lc1.content IS NOT NULL
                    AND lc1.consult_no = (
                        SELECT MAX(consult_no)
                        FROM ishomedb.tz_lms_consult lc2
                        WHERE lc2.student_no = stu.student_no
                            AND lc2.content IS NOT NULL
                    )
              ) AS consult_content
              ,IFNULL(stu.web_start_de, '') as web_service_start_de
              ,IFNULL(stu.web_end_de, '') as web_service_end_de
        FROM ishomedb.tz_student stu
        INNER JOIN ishomedb.tz_purchase_student pch
        ON stu.student_no = pch.temp_student_no
        INNER JOIN ishomedb.tz_purchase pur
        ON pch.purchase_no = pur.purchase_no
        INNER JOIN ishomedb.tz_member mem
        ON stu.student_id = mem.user_id
        INNER JOIN ishomedb.tz_member prn
        ON mem.parent_id = prn.user_id
        WHERE pur.status_gbn != 10010
            AND pur.product_no != '263' /* 학교배포용 학습기 제외 */
        
         
            AND IFNULL(stu.teacher_id, 0) = 0
            AND (stu.end_de  >=  DATE_FORMAT(NOW(), '%Y-%m-%d') OR stu.end_de IS NULL)
         
         
         
         
         
         
            AND pur.product_no IN (SELECT product_no FROM tz_product WHERE service_experience_yn = 'Y' and service_com_yn = 'N')
             
         
         
         
         
         
         
         
         
         
          ORDER BY service_start_de DESC 
        LIMIT  0, 100;
# Time: 150428 19:22:39
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.363572  Lock_time: 0.000247 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430216559;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('김윤희', '%')  
     
        ) a;
# Time: 150428 19:22:42
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.510132  Lock_time: 0.000334 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430216562;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('김윤희', '%')  
     
        ) a;
# Time: 150428 19:22:45
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.550403  Lock_time: 0.000296 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430216565;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('김윤희', '%')  
     
        ) a;
# Time: 150428 20:35:12
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 18.323565  Lock_time: 0.000175 Rows_sent: 15  Rows_examined: 3081863
SET timestamp=1430220912;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150428 20:50:35
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.687192  Lock_time: 0.000189 Rows_sent: 30  Rows_examined: 1298464
SET timestamp=1430221835;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:50:51
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.481872  Lock_time: 0.000263 Rows_sent: 30  Rows_examined: 1298500
SET timestamp=1430221851;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:50:52
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.184798  Lock_time: 0.000263 Rows_sent: 30  Rows_examined: 1298500
SET timestamp=1430221852;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:50:53
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.490497  Lock_time: 0.000185 Rows_sent: 30  Rows_examined: 1298503
SET timestamp=1430221853;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:51:11
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.358146  Lock_time: 0.000186 Rows_sent: 30  Rows_examined: 1298535
SET timestamp=1430221871;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:51:15
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.442820  Lock_time: 0.000222 Rows_sent: 30  Rows_examined: 1298541
SET timestamp=1430221875;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:51:20
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.577174  Lock_time: 0.000179 Rows_sent: 30  Rows_examined: 1298545
SET timestamp=1430221880;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.377682  Lock_time: 0.000187 Rows_sent: 30  Rows_examined: 1298545
SET timestamp=1430221880;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:51:28
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.871273  Lock_time: 0.000193 Rows_sent: 30  Rows_examined: 1298561
SET timestamp=1430221888;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:51:30
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.468012  Lock_time: 0.000178 Rows_sent: 30  Rows_examined: 1298567
SET timestamp=1430221890;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.571923  Lock_time: 0.000274 Rows_sent: 30  Rows_examined: 1298567
SET timestamp=1430221890;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.965543  Lock_time: 0.000328 Rows_sent: 30  Rows_examined: 1298567
SET timestamp=1430221890;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:52:36
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.422436  Lock_time: 0.000167 Rows_sent: 30  Rows_examined: 1298695
SET timestamp=1430221956;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:55:38
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.173332  Lock_time: 0.000245 Rows_sent: 30  Rows_examined: 1299009
SET timestamp=1430222138;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 20:55:45
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.337478  Lock_time: 0.000182 Rows_sent: 30  Rows_examined: 1299017
SET timestamp=1430222145;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150428 21:07:53
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.062718  Lock_time: 0.000175 Rows_sent: 30  Rows_examined: 1300229
SET timestamp=1430222873;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429  2:31:14
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 108.834143  Lock_time: 0.000099 Rows_sent: 1  Rows_examined: 201
SET timestamp=1430242274;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 332802
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 303.579995  Lock_time: 0.000087 Rows_sent: 1  Rows_examined: 7329
SET timestamp=1430242274;
SELECT concat(sk.subj_knd_nm_short, ' ', bp.start_page, '~', bp.end_page) as result
					 FROM ishomedb.tz_lcms_book_page bp
					 INNER JOIN ishomedb.tz_lcms_subj_knd sk
					 ON sk.subj_knd_no = bp.subj_knd_no
					 WHERE EXISTS (
								 SELECT 1
								 FROM ishomedb.tz_lcms_study_lesson l
								 INNER JOIN ishomedb.tz_lcms_subj s
								 ON l.subj_no = s.subj_no
								 WHERE l.subj_lesson_no = bp.subj_lesson_no
								 and l.subj_no = 27
								 and l.subj_lesson_no = 125
							 );
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 131.612350  Lock_time: 0.001878 Rows_sent: 1  Rows_examined: 5433
SET timestamp=1430242274;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 332802
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('이준희', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 142.252987  Lock_time: 0.001667 Rows_sent: 1  Rows_examined: 5433
SET timestamp=1430242274;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 332802
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('이준희', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 135.240462  Lock_time: 0.001694 Rows_sent: 1  Rows_examined: 5433
SET timestamp=1430242274;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 332802
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('이준희', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 143.044777  Lock_time: 0.001351 Rows_sent: 1  Rows_examined: 5433
SET timestamp=1430242274;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 332802
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('이준희', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 108.486525  Lock_time: 0.000764 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430242274;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 332802
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 108.501882  Lock_time: 0.001094 Rows_sent: 114  Rows_examined: 8151
SET timestamp=1430242274;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 332802
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150429  2:31:15
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 126.243170  Lock_time: 0.001611 Rows_sent: 138  Rows_examined: 230886
SET timestamp=1430242275;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 332802
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# Time: 150429  2:32:45
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 424.078803  Lock_time: 0.001293 Rows_sent: 27059  Rows_examined: 252656
SET timestamp=1430242365;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150429  2:38:01
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 305.343109  Lock_time: 0.000062 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430242681;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5620230';
# Time: 150429  2:38:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 327.661734  Lock_time: 0.001300 Rows_sent: 4360  Rows_examined: 72088
SET timestamp=1430242696;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150429  2:43:28
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 306.674241  Lock_time: 0.000061 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430243008;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5627309';
# Time: 150429  2:43:44
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 324.548458  Lock_time: 0.000668 Rows_sent: 6245  Rows_examined: 58901
SET timestamp=1430243024;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150429  2:44:28
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 37.815620  Lock_time: 0.000127 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430243068;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150429  2:45:03
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 32.361979  Lock_time: 0.000136 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430243103;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150429  2:47:27
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.419121  Lock_time: 0.002518 Rows_sent: 2  Rows_examined: 9833958
SET timestamp=1430243247;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150429  2:52:56
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 302.314146  Lock_time: 0.000060 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430243576;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2081103w5309796';
# Time: 150429  2:53:07
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 320.860498  Lock_time: 0.001310 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430243587;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150429  2:54:11
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 59.937013  Lock_time: 0.001723 Rows_sent: 8116  Rows_examined: 1689738
SET timestamp=1430243651;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150429  2:54:32
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.205642  Lock_time: 0.000220 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430243672;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:55:01
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.804365  Lock_time: 0.000260 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430243701;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:55:14
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.194977  Lock_time: 0.000246 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430243714;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:55:24
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.665830  Lock_time: 0.000219 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430243724;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:55:34
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.831862  Lock_time: 0.000276 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430243734;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:55:51
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.423607  Lock_time: 0.000249 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430243751;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:56:05
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.308925  Lock_time: 0.000219 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430243765;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:56:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.508397  Lock_time: 0.000224 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430243776;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:56:30
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.748401  Lock_time: 0.000251 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430243790;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:56:54
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.283260  Lock_time: 0.000216 Rows_sent: 64476  Rows_examined: 211316
SET timestamp=1430243814;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150429  2:57:08
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.360420  Lock_time: 0.000164 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430243828;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150429  2:58:36
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 86.019112  Lock_time: 0.000246 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430243916;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150429  2:59:48
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.395128  Lock_time: 0.001836 Rows_sent: 1538  Rows_examined: 1630336
SET timestamp=1430243988;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150429  3:00:44
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 50.243614  Lock_time: 0.002354 Rows_sent: 5788  Rows_examined: 19721
SET timestamp=1430244044;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150429 10:08:40
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.415466  Lock_time: 0.000098 Rows_sent: 323  Rows_examined: 981407
SET timestamp=1430269720;
SELECT  contents_no
               ,objectname_kor
               ,headline
               ,pic_src_memo
               ,pic_srcname
        FROM   ishomedb.tz_cms_contents
        WHERE  media_type   = 'MOV'
        AND    (contents_no = '사회'
               OR objectname_kor LIKE CONCAT('%', '사회', '%'));
# Time: 150429 10:42:59
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 18.833081  Lock_time: 0.000409 Rows_sent: 13689  Rows_examined: 59314181
SET timestamp=1430271779;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150429 11:54:04
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.263130  Lock_time: 0.000362 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276044;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:05
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.469610  Lock_time: 0.000215 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276045;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.256024  Lock_time: 0.000440 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276045;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.344711  Lock_time: 0.000546 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276045;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.280727  Lock_time: 0.000336 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276045;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:06
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.297580  Lock_time: 0.000328 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276046;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.186202  Lock_time: 0.000340 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276046;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.222697  Lock_time: 0.000327 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276046;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:07
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.970052  Lock_time: 0.000226 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276047;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.870325  Lock_time: 0.000218 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276047;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:08
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.898955  Lock_time: 0.000223 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276048;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:11
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.186693  Lock_time: 0.000207 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276051;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.200028  Lock_time: 0.000227 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276051;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:12
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.252461  Lock_time: 0.000240 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276052;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.320190  Lock_time: 0.000229 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276052;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.190904  Lock_time: 0.000222 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276052;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:29
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.171171  Lock_time: 0.000229 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276069;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:31
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.401597  Lock_time: 0.000245 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276071;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.360833  Lock_time: 0.000214 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276071;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.377280  Lock_time: 0.000228 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276071;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 11:54:32
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.475206  Lock_time: 0.000341 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276072;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.299472  Lock_time: 0.000217 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276072;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.277287  Lock_time: 0.000334 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276072;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.263743  Lock_time: 0.000353 Rows_sent: 7  Rows_examined: 990823
SET timestamp=1430276072;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('정효성', '%') OR nb.nm_kor LIKE CONCAT('정효성', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150429 14:41:12
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.143446  Lock_time: 0.000163 Rows_sent: 30  Rows_examined: 1305584
SET timestamp=1430286072;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:41:26
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.246129  Lock_time: 0.000232 Rows_sent: 30  Rows_examined: 1305599
SET timestamp=1430286086;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:41:32
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.283137  Lock_time: 0.000259 Rows_sent: 30  Rows_examined: 1305611
SET timestamp=1430286092;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:41:45
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.434749  Lock_time: 0.000274 Rows_sent: 30  Rows_examined: 1305624
SET timestamp=1430286105;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:41:49
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.093337  Lock_time: 0.000191 Rows_sent: 30  Rows_examined: 1305624
SET timestamp=1430286109;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:43:07
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.214239  Lock_time: 0.000245 Rows_sent: 30  Rows_examined: 1305668
SET timestamp=1430286187;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:43:08
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.010955  Lock_time: 0.000319 Rows_sent: 30  Rows_examined: 1305668
SET timestamp=1430286188;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:43:46
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.028119  Lock_time: 0.000315 Rows_sent: 30  Rows_examined: 1305700
SET timestamp=1430286226;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:44:06
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.546870  Lock_time: 0.000193 Rows_sent: 30  Rows_examined: 1305704
SET timestamp=1430286246;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:44:09
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.124836  Lock_time: 0.000190 Rows_sent: 30  Rows_examined: 1305707
SET timestamp=1430286249;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 14:44:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.710490  Lock_time: 0.000323 Rows_sent: 30  Rows_examined: 1305711
SET timestamp=1430286255;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 15:05:40
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 30.495590  Lock_time: 0.000586 Rows_sent: 2  Rows_examined: 42286878
SET timestamp=1430287540;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150429 15:06:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 30.530482  Lock_time: 0.000087 Rows_sent: 2  Rows_examined: 42286958
SET timestamp=1430287575;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150429 15:08:06
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.476355  Lock_time: 0.000169 Rows_sent: 30  Rows_examined: 1306904
SET timestamp=1430287686;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 15:23:19
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 30.637965  Lock_time: 0.000475 Rows_sent: 2  Rows_examined: 42289509
SET timestamp=1430288599;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150429 16:19:23
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 13.284019  Lock_time: 0.000500 Rows_sent: 30  Rows_examined: 5877607
SET timestamp=1430291963;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150429 16:19:26
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 14.291620  Lock_time: 0.000500 Rows_sent: 30  Rows_examined: 5877607
SET timestamp=1430291966;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150429 16:44:38
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.618921  Lock_time: 0.000399 Rows_sent: 14906  Rows_examined: 2951589
SET timestamp=1430293478;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.29', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150429 16:45:17
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.564713  Lock_time: 0.000387 Rows_sent: 11416  Rows_examined: 8544769
SET timestamp=1430293517;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 516196
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
            
              AND a.f_ischeckpoint = 'Y'
           
           
           
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# Time: 150429 17:17:07
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.475016  Lock_time: 0.000263 Rows_sent: 30  Rows_examined: 1303813
SET timestamp=1430295427;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:01:05
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.776464  Lock_time: 0.000172 Rows_sent: 30  Rows_examined: 1322656
SET timestamp=1430305265;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:01:09
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.888063  Lock_time: 0.000197 Rows_sent: 30  Rows_examined: 1322669
SET timestamp=1430305269;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:01:16
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.706725  Lock_time: 0.000210 Rows_sent: 30  Rows_examined: 1322680
SET timestamp=1430305276;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:01:22
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.850875  Lock_time: 0.000198 Rows_sent: 30  Rows_examined: 1322688
SET timestamp=1430305282;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:01:23
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.685700  Lock_time: 0.000255 Rows_sent: 30  Rows_examined: 1322691
SET timestamp=1430305283;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:18:44
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.845391  Lock_time: 0.000326 Rows_sent: 30  Rows_examined: 1324856
SET timestamp=1430306324;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:18:46
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.680579  Lock_time: 0.000204 Rows_sent: 30  Rows_examined: 1324865
SET timestamp=1430306326;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:18:47
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.674098  Lock_time: 0.000176 Rows_sent: 30  Rows_examined: 1324865
SET timestamp=1430306327;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:31:22
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 17.095140  Lock_time: 0.000180 Rows_sent: 15  Rows_examined: 3084855
SET timestamp=1430307082;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150429 20:33:53
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.143107  Lock_time: 0.000184 Rows_sent: 30  Rows_examined: 1326629
SET timestamp=1430307233;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:35:40
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.303175  Lock_time: 0.000179 Rows_sent: 30  Rows_examined: 1326875
SET timestamp=1430307340;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.405250  Lock_time: 0.000201 Rows_sent: 30  Rows_examined: 1326875
SET timestamp=1430307340;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:35:47
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.730815  Lock_time: 0.000271 Rows_sent: 30  Rows_examined: 1326890
SET timestamp=1430307347;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.919275  Lock_time: 0.000362 Rows_sent: 30  Rows_examined: 1326890
SET timestamp=1430307347;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150429 20:52:37
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.439307  Lock_time: 0.000194 Rows_sent: 30  Rows_examined: 1329190
SET timestamp=1430308357;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430  2:31:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 300.712068  Lock_time: 0.000048 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430328676;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2001221j3134347';
# Time: 150430  2:32:45
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 420.578864  Lock_time: 0.001177 Rows_sent: 27059  Rows_examined: 252656
SET timestamp=1430328765;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150430  2:38:00
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.362872  Lock_time: 0.000048 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430329080;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070801m2935338';
# Time: 150430  2:38:14
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 325.700752  Lock_time: 0.001263 Rows_sent: 4360  Rows_examined: 72088
SET timestamp=1430329094;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150430  2:43:26
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.718692  Lock_time: 0.000045 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430329406;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070801m2933646';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 293.533692  Lock_time: 0.001841 Rows_sent: 1  Rows_examined: 247
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('채영은', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 282.694588  Lock_time: 0.001621 Rows_sent: 1  Rows_examined: 247
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('채영은', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 285.451609  Lock_time: 0.001638 Rows_sent: 1  Rows_examined: 247
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('채영은', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 287.730716  Lock_time: 0.001604 Rows_sent: 1  Rows_examined: 247
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('채영은', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 295.728723  Lock_time: 0.001849 Rows_sent: 1  Rows_examined: 247
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('채영은', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 290.671793  Lock_time: 0.001661 Rows_sent: 1  Rows_examined: 247
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('채영은', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 279.607594  Lock_time: 0.001230 Rows_sent: 60  Rows_examined: 51413
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 281.147412  Lock_time: 0.001610 Rows_sent: 60  Rows_examined: 51413
SET timestamp=1430329406;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 620141
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# Time: 150430  2:43:38
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 319.839975  Lock_time: 0.000666 Rows_sent: 6245  Rows_examined: 58948
SET timestamp=1430329418;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150430  2:44:22
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 37.681011  Lock_time: 0.000122 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430329462;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150430  2:44:56
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 32.563782  Lock_time: 0.000136 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430329496;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150430  2:47:22
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.362550  Lock_time: 0.002341 Rows_sent: 2  Rows_examined: 9834052
SET timestamp=1430329642;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150430  2:52:52
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 303.110111  Lock_time: 0.000114 Rows_sent: 2  Rows_examined: 7331
SET timestamp=1430329972;
SELECT concat(sk.subj_knd_nm_short, ' ', bp.start_page, '쪽~', bp.end_page,'쪽') as result
					 FROM ishomedb.tz_lcms_book_page bp
					 INNER JOIN ishomedb.tz_lcms_subj_knd sk
					 ON sk.subj_knd_no = bp.subj_knd_no
					 WHERE EXISTS (
								 SELECT 1
								 FROM ishomedb.tz_lcms_study_lesson l
								 INNER JOIN ishomedb.tz_lcms_subj s
								 ON l.subj_no = s.subj_no
								 WHERE l.subj_lesson_no = bp.subj_lesson_no
								 and l.subj_no = 27
								 and l.subj_lesson_no = 118
							 );
# Time: 150430  2:53:03
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 320.668067  Lock_time: 0.001265 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430329983;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150430  2:54:06
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 59.912005  Lock_time: 0.001727 Rows_sent: 8116  Rows_examined: 1689738
SET timestamp=1430330046;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150430  2:54:28
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.187860  Lock_time: 0.000218 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430330068;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:54:57
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.952438  Lock_time: 0.000221 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430330097;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:55:10
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.122512  Lock_time: 0.000221 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430330110;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:55:20
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.509420  Lock_time: 0.000216 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430330120;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:55:30
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.993374  Lock_time: 0.000268 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430330130;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:55:47
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.284829  Lock_time: 0.000247 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430330147;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:56:01
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.409921  Lock_time: 0.000219 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430330161;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:56:12
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.167038  Lock_time: 0.000249 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430330172;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:56:26
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.361029  Lock_time: 0.000215 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430330186;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:56:50
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.403728  Lock_time: 0.000197 Rows_sent: 64476  Rows_examined: 211319
SET timestamp=1430330210;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150430  2:57:04
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.534638  Lock_time: 0.000158 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430330224;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150430  2:58:32
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 86.177025  Lock_time: 0.000239 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430330312;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150430  2:59:41
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.085402  Lock_time: 0.001801 Rows_sent: 1397  Rows_examined: 1628926
SET timestamp=1430330381;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150430  3:00:34
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 46.791197  Lock_time: 0.001528 Rows_sent: 5467  Rows_examined: 18563
SET timestamp=1430330434;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150430  9:04:54
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.192731  Lock_time: 0.000192 Rows_sent: 2  Rows_examined: 42445720
SET timestamp=1430352294;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150430  9:05:31
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.096869  Lock_time: 0.000350 Rows_sent: 1  Rows_examined: 42445722
SET timestamp=1430352331;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150430  9:06:00
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.511580  Lock_time: 0.000088 Rows_sent: 0  Rows_examined: 42445722
SET timestamp=1430352360;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150430  9:07:34
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 19.909677  Lock_time: 0.000428 Rows_sent: 14152  Rows_examined: 62432984
SET timestamp=1430352454;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150430  9:07:59
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 20.166354  Lock_time: 0.000377 Rows_sent: 14152  Rows_examined: 62432984
SET timestamp=1430352479;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150430  9:08:20
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.596045  Lock_time: 0.000416 Rows_sent: 14152  Rows_examined: 62432984
SET timestamp=1430352500;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150430  9:08:41
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.303747  Lock_time: 0.000375 Rows_sent: 14152  Rows_examined: 62432984
SET timestamp=1430352521;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150430  9:12:33
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.425299  Lock_time: 0.000561 Rows_sent: 30  Rows_examined: 5891294
SET timestamp=1430352753;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150430  9:12:34
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.736777  Lock_time: 0.000357 Rows_sent: 30  Rows_examined: 5891294
SET timestamp=1430352754;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150430  9:16:19
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.274112  Lock_time: 0.000154 Rows_sent: 2  Rows_examined: 42445769
SET timestamp=1430352979;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150430  9:27:57
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.598246  Lock_time: 0.000508 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353677;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.687047  Lock_time: 0.000770 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353677;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150430  9:30:42
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 15.337442  Lock_time: 0.000587 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353842;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 15.634101  Lock_time: 0.000638 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353842;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150430  9:30:49
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 16.719603  Lock_time: 0.000595 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353849;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 16.731279  Lock_time: 0.000778 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353849;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150430  9:30:51
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 16.124342  Lock_time: 0.000788 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353851;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 16.140501  Lock_time: 0.000679 Rows_sent: 30  Rows_examined: 5891312
SET timestamp=1430353851;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150430  9:49:47
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 13.052010  Lock_time: 0.000446 Rows_sent: 13917  Rows_examined: 10431461
SET timestamp=1430354987;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 366200
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
           
           
           
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 14.336253  Lock_time: 0.000569 Rows_sent: 13917  Rows_examined: 10431461
SET timestamp=1430354987;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 366200
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
           
           
           
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.170818  Lock_time: 0.000668 Rows_sent: 13917  Rows_examined: 10431461
SET timestamp=1430354987;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 366200
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
           
           
           
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# Time: 150430 11:01:36
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.116505  Lock_time: 0.000376 Rows_sent: 14206  Rows_examined: 62765516
SET timestamp=1430359296;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150430 11:19:17
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.352482  Lock_time: 0.000228 Rows_sent: 10  Rows_examined: 16006126
SET timestamp=1430360357;
SELECT  a.history_no    /* seq 번호 */
               ,a.student_no    /* 학생등록번호 */
               ,a.student_id    /* 학생회원ID */
               ,b.nm_kor
               ,b.login_id
               ,a.point_gbn     /* 콘 구분 코드 */
               ,CASE a.point_gbn
                    WHEN '10131' THEN '수행콘'
                    WHEN '10132' THEN '성과콘'
                    WHEN '10133' THEN '이벤트콘'
                END as gbn_nm
               ,a.point_grp    /* 콘 분류 */
               ,ishomedb.uf_code_nm(a.point_gbn, a.point_grp) grp_nm   /* 콘 구분 코드명 */
               ,CASE a.point_type          /* 적립/소멸 */ 
                 WHEN 1 THEN '적립'
                 WHEN 2 THEN '소멸'
                 ELSE '-'
                END 
                as point_type
               ,ishomedb.uf_point_nm(a.point_gbn, a.point_grp, a.guide_no) point_nm   /* 콘 명칭 */
               ,CONCAT(
                CASE a.point_type          /* 적립/소멸 */ 
                 WHEN 2 THEN '-'
                 ELSE ''
                END , a.point) as point         /* 적립포인트 */
               ,a.reg_id        /* 등록 ID */
               ,a.reg_dt        /* 등록일 */
               ,a.reg_ip        /* 등록 IP */
               ,a.upd_id        /* 수정 ID */
               ,a.upd_dt        /* 수정일 */
               ,a.upd_ip        /* 수정 IP */
        FROM   tz_point_history a, tz_member b
         
         WHERE a.student_id = b.user_id
            AND a.guide_no = '127'     
     
        ORDER  BY a.history_no DESC
        LIMIT  20, 10;
# Time: 150430 12:12:41
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.846093  Lock_time: 0.000561 Rows_sent: 15636  Rows_examined: 3224668
SET timestamp=1430363561;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.01', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')
                        
                        
            
            
            
            
                AND code.code_no IN (10003,10004,10008)  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150430 15:10:21
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.044850  Lock_time: 0.000264 Rows_sent: 30  Rows_examined: 1336949
SET timestamp=1430374221;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 16:21:04
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 11.254663  Lock_time: 0.000334 Rows_sent: 15138  Rows_examined: 2995672
SET timestamp=1430378464;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150430 16:32:13
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.257257  Lock_time: 0.000279 Rows_sent: 30  Rows_examined: 1342989
SET timestamp=1430379133;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 16:33:11
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.915322  Lock_time: 0.000278 Rows_sent: 30  Rows_examined: 1343063
SET timestamp=1430379191;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 17:18:27
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.765208  Lock_time: 0.000270 Rows_sent: 30  Rows_examined: 1347298
SET timestamp=1430381907;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 17:18:30
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.122617  Lock_time: 0.000209 Rows_sent: 30  Rows_examined: 1347299
SET timestamp=1430381910;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 17:18:39
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.100539  Lock_time: 0.000173 Rows_sent: 30  Rows_examined: 1347323
SET timestamp=1430381919;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 17:40:11
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.089144  Lock_time: 0.000170 Rows_sent: 30  Rows_examined: 1349579
SET timestamp=1430383211;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 17:40:18
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.137165  Lock_time: 0.000242 Rows_sent: 30  Rows_examined: 1349590
SET timestamp=1430383218;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 17:40:23
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.117192  Lock_time: 0.000256 Rows_sent: 30  Rows_examined: 1349599
SET timestamp=1430383223;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 17:40:27
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 6.042659  Lock_time: 0.000267 Rows_sent: 30  Rows_examined: 1349602
SET timestamp=1430383227;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 18:16:14
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.292494  Lock_time: 0.000253 Rows_sent: 30  Rows_examined: 1353819
SET timestamp=1430385374;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 18:17:26
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.067228  Lock_time: 0.000257 Rows_sent: 30  Rows_examined: 1353948
SET timestamp=1430385446;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 18:48:43
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.921001  Lock_time: 0.000247 Rows_sent: 30  Rows_examined: 1358107
SET timestamp=1430387323;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 19:31:24
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.383738  Lock_time: 0.000257 Rows_sent: 2  Rows_examined: 993781
SET timestamp=1430389884;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('설신애', '%') OR nb.nm_kor LIKE CONCAT('설신애', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150430 20:02:17
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.432418  Lock_time: 0.000413 Rows_sent: 11588  Rows_examined: 2439530
SET timestamp=1430391737;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')
                        
                        
            
            
            
            
                AND code.code_no IN (10004)  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150430 20:04:06
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.171010  Lock_time: 0.000341 Rows_sent: 15237  Rows_examined: 3010607
SET timestamp=1430391846;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150430 20:04:21
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 10.520814  Lock_time: 0.000393 Rows_sent: 15237  Rows_examined: 3010740
SET timestamp=1430391861;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150430 20:05:38
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.238602  Lock_time: 0.000425 Rows_sent: 6867  Rows_examined: 1457974
SET timestamp=1430391938;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.03.01', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')
                        
                        
            
            
            
            
                AND code.code_no IN (10004)  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150430 22:06:31
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.935750  Lock_time: 0.000192 Rows_sent: 30  Rows_examined: 1380415
SET timestamp=1430399191;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:06:34
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.302693  Lock_time: 0.000215 Rows_sent: 30  Rows_examined: 1380415
SET timestamp=1430399194;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:12:13
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.047940  Lock_time: 0.000421 Rows_sent: 30  Rows_examined: 1380472
SET timestamp=1430399533;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:12:17
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.750507  Lock_time: 0.000176 Rows_sent: 30  Rows_examined: 1380472
SET timestamp=1430399537;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:12:21
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.380210  Lock_time: 0.000180 Rows_sent: 30  Rows_examined: 1380472
SET timestamp=1430399541;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:12:28
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.883263  Lock_time: 0.000288 Rows_sent: 30  Rows_examined: 1380472
SET timestamp=1430399548;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:12:50
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.190436  Lock_time: 0.000198 Rows_sent: 30  Rows_examined: 1380475
SET timestamp=1430399570;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:18:26
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.242705  Lock_time: 0.000272 Rows_sent: 30  Rows_examined: 1380514
SET timestamp=1430399906;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 22:44:34
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.285949  Lock_time: 0.000587 Rows_sent: 15290  Rows_examined: 3018418
SET timestamp=1430401474;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150430 23:12:14
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.116075  Lock_time: 0.000275 Rows_sent: 30  Rows_examined: 1380641
SET timestamp=1430403134;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-04-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-04-30', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150430 23:48:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.090786  Lock_time: 0.000397 Rows_sent: 15296  Rows_examined: 3019822
SET timestamp=1430405295;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150501  0:02:27
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.244886  Lock_time: 0.000426 Rows_sent: 15297  Rows_examined: 3019975
SET timestamp=1430406147;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.01.28', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.04.30', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150501  2:30:57
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 301.552041  Lock_time: 0.000048 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2010727w1821217';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 265.830245  Lock_time: 0.000124 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '148100';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 272.847499  Lock_time: 0.000128 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 540485;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 261.079432  Lock_time: 0.000090 Rows_sent: 1  Rows_examined: 7
SET timestamp=1430415057;
SELECT  category_no AS code
               ,category_nm AS label
        FROM    ishomedb.tz_lcms_theme_category
        
        WHERE   /* use_yn = 'Y' */ 1=1
        
         
            AND  upper_no = '1'
         
        
         
            AND  category_no NOT IN ( 3, 26, 29, 18457, 15825, 18587 )
         
        
        ORDER   BY category_no;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 265.417419  Lock_time: 0.000097 Rows_sent: 1  Rows_examined: 7
SET timestamp=1430415057;
SELECT  category_no AS code
               ,category_nm AS label
        FROM    ishomedb.tz_lcms_theme_category
        
        WHERE   /* use_yn = 'Y' */ 1=1
        
         
            AND  upper_no = '1'
         
        
         
            AND  category_no NOT IN ( 3, 26, 29, 18457, 15825, 18587 )
         
        
        ORDER   BY category_no;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 247.975835  Lock_time: 0.000134 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '148100';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 240.722465  Lock_time: 0.000107 Rows_sent: 1  Rows_examined: 7
SET timestamp=1430415057;
SELECT  category_no AS code
               ,category_nm AS label
        FROM    ishomedb.tz_lcms_theme_category
        
        WHERE   /* use_yn = 'Y' */ 1=1
        
         
            AND  upper_no = '1'
         
        
         
            AND  category_no NOT IN ( 3, 26, 29, 18457, 15825, 18587 )
         
        
        ORDER   BY category_no;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 228.627542  Lock_time: 0.000099 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430415057;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 540485;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 261.150357  Lock_time: 0.000099 Rows_sent: 1  Rows_examined: 191
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 540485
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 198.819988  Lock_time: 0.000136 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 123491;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 194.841401  Lock_time: 0.000122 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 194.764473  Lock_time: 0.000116 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate() - INTERVAL 1 DAY
                   AND attend_dt >= curdate() - INTERVAL 1 DAY
            
                        
            AND teacher_id = 123491;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 191.186055  Lock_time: 0.000093 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '84059af4fe1e449ab446d0e435bbc48a';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 191.385071  Lock_time: 0.000121 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 213.924994  Lock_time: 0.000092 Rows_sent: 1  Rows_examined: 201
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555386
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 181.362615  Lock_time: 0.000100 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430415057;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 555386;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 182.379415  Lock_time: 0.000077 Rows_sent: 1  Rows_examined: 191
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 540485
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 164.164584  Lock_time: 0.000125 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 163.426528  Lock_time: 0.000116 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 162.947471  Lock_time: 0.000147 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 162.664101  Lock_time: 0.000116 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 162.430046  Lock_time: 0.000118 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 162.049940  Lock_time: 0.000116 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 162.228397  Lock_time: 0.000119 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 304654;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 68.570731  Lock_time: 0.000206 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430415057;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 555386;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 149.865093  Lock_time: 0.000210 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430415057;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 540485;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 87.838754  Lock_time: 0.000125 Rows_sent: 1  Rows_examined: 191
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 540485
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 100.986478  Lock_time: 0.000110 Rows_sent: 1  Rows_examined: 201
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555386
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 14.347441  Lock_time: 0.000179 Rows_sent: 1  Rows_examined: 453
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 392415
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 36.711816  Lock_time: 0.000092 Rows_sent: 1  Rows_examined: 453
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 392415
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 230.655430  Lock_time: 0.000423 Rows_sent: 1  Rows_examined: 184
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '267703';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 55.058154  Lock_time: 0.000145 Rows_sent: 1  Rows_examined: 453
SET timestamp=1430415057;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 392415
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 222.986132  Lock_time: 0.000903 Rows_sent: 1  Rows_examined: 184
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '267703';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 225.901990  Lock_time: 0.000909 Rows_sent: 1  Rows_examined: 184
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '267703';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 301.090995  Lock_time: 0.000277 Rows_sent: 4  Rows_examined: 392
SET timestamp=1430415057;
SELECT   act.grade_gbn, act.subj_gbn                                           /* 과목코드 */
                ,uf_code_nm('10101',act.subj_gbn ) as code_nm
                ,act.total_cnt                                          /* 전체 */
                ,act.act_cnt                                            /* 시작된 학습 */
                ,act.clear_cnt                                          /* 예복습완료 + 평가제출 = 완료 학습 */
                ,(act.act_cnt - clear_cnt) AS unclear_cnt               /* 미완료 */
                ,(act.total_cnt - act.act_cnt) AS befor_study_cnt       /* 학습 전 */
                ,100*(act.clear_cnt/act.total_cnt) AS act_rate
        FROM    (SELECT  act.grade_gbn, act.subj_gbn
                         ,COUNT(act.module_no) AS total_cnt
                         ,SUM(act.act_dt) AS act_cnt
                         ,SUM(act.clear_dt) AS clear_cnt
                 FROM    (SELECT  sbj.grade_gbn, sbj.subj_gbn
                                 ,modu.module_no
                                 ,CASE WHEN act.act_dt IS NULL THEN 0 ELSE 1 END AS act_dt
                                 ,CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END AS clear_dt
                         FROM    ishomedb.tz_lms_plan_module pln
                         INNER   JOIN ishomedb.tz_lms_module modu
                         ON      pln.module_no = modu.module_no
				         LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
				         ON      pln.student_no = act.student_no
				         AND     pln.plan_de = act.plan_de
				         AND     pln.module_no = act.module_no
				         INNER   JOIN ishomedb.tz_lcms_study_lesson les
                         ON      modu.subj_lesson_no = les.subj_lesson_no
                         AND     les.use_yn = 'Y'           /* 2013-10-04 JHSUN 추가 */
				         INNER   JOIN ishomedb.tz_lms_course cou
				         ON      modu.course_no = cou.course_no
				         INNER   JOIN ishomedb.tz_lcms_subj sbj
				         ON      cou.subj_no = sbj.subj_no
                        /* AND     sbj.use_yn = 'Y'         2013-10-04 JHSUN 주석처리 */
                         
				         WHERE   pln.student_no = '156886'
				         AND     pln.plan_de >= '2015.05.01'
				         AND     pln.plan_de <= '2015.05.31') act
                 GROUP   BY act.grade_gbn, act.subj_gbn) act
                 ORDER BY act.grade_gbn, act.subj_gbn;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 227.612346  Lock_time: 0.000927 Rows_sent: 1  Rows_examined: 184
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '267703';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 269.015739  Lock_time: 0.000472 Rows_sent: 1  Rows_examined: 1226
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '156886';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 213.936170  Lock_time: 0.000540 Rows_sent: 1  Rows_examined: 1226
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '156886';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 183.194728  Lock_time: 0.000410 Rows_sent: 1  Rows_examined: 2605
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.elementary_yn = 'Y' THEN '초등학생'
                ELSE '초등학생아님' END AS elementary_yn
               ,b.gender                
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,b.tel1
               ,b.tel2
               ,b.tel3
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.mobile1
               ,b.mobile2
               ,b.mobile3
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,b.blacklist_yn
               ,a.group_no
               ,a.grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,b.parent_id
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_no = a.student_no) as point
               ,b.start_sms_yn
               ,b.end_sms_yn
               ,b.search_yn
               ,IFNULL(b.movie_limit_yn, 'N') as movie_limit_yn
               ,IFNULL(b.movie_global_limit_yn, 'N') as movie_global_limit_yn
               ,lpad(c.recom_id,4,'0') as recom_id
               ,c.recom_teacher_nm
          FROM  ishomedb.tz_student a 
          LEFT OUTER JOIN tz_member b ON a.student_id = b.user_id
          LEFT OUTER JOIN (SELECT tzt.recom_id as recom_id, 
                tzm.nm_kor AS recom_teacher_nm
                FROM tz_teacher tzt
                LEFT JOIN tz_member tzm ON tzt.teacher_id = tzm.user_id) c ON b.recom_teacher = c.recom_id
          where  a.student_no = '248206';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 300.593120  Lock_time: 0.000065 Rows_sent: 32  Rows_examined: 249
SET timestamp=1430415057;
SELECT  s.student_no     /* 학생 번호 */
               ,s.student_id     /* 학생ID */
               ,concat(m.nm_kor, '(', s.student_id, ')') AS user
        FROM   ishomedb.tz_student s
        LEFT OUTER JOIN ishomedb.tz_member m
        ON     s.student_id = m.user_id
        WHERE  teacher_id  = 304654
        AND    group_no = 6084;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 206.674408  Lock_time: 0.001189 Rows_sent: 1  Rows_examined: 1809
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '148100';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 233.796407  Lock_time: 0.000416 Rows_sent: 1  Rows_examined: 184
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '267703';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 176.645630  Lock_time: 0.000410 Rows_sent: 1  Rows_examined: 2605
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.elementary_yn = 'Y' THEN '초등학생'
                ELSE '초등학생아님' END AS elementary_yn
               ,b.gender                
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,b.tel1
               ,b.tel2
               ,b.tel3
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.mobile1
               ,b.mobile2
               ,b.mobile3
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,b.blacklist_yn
               ,a.group_no
               ,a.grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,b.parent_id
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_no = a.student_no) as point
               ,b.start_sms_yn
               ,b.end_sms_yn
               ,b.search_yn
               ,IFNULL(b.movie_limit_yn, 'N') as movie_limit_yn
               ,IFNULL(b.movie_global_limit_yn, 'N') as movie_global_limit_yn
               ,lpad(c.recom_id,4,'0') as recom_id
               ,c.recom_teacher_nm
          FROM  ishomedb.tz_student a 
          LEFT OUTER JOIN tz_member b ON a.student_id = b.user_id
          LEFT OUTER JOIN (SELECT tzt.recom_id as recom_id, 
                tzm.nm_kor AS recom_teacher_nm
                FROM tz_teacher tzt
                LEFT JOIN tz_member tzm ON tzt.teacher_id = tzm.user_id) c ON b.recom_teacher = c.recom_id
          where  a.student_no = '248206';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 279.341985  Lock_time: 0.000413 Rows_sent: 1  Rows_examined: 605
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '234414';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 284.928440  Lock_time: 0.000333 Rows_sent: 1  Rows_examined: 605
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '234414';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 257.566353  Lock_time: 0.000146 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430415057;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 235.306600  Lock_time: 0.000473 Rows_sent: 1  Rows_examined: 1226
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '156886';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 243.658264  Lock_time: 0.000925 Rows_sent: 1  Rows_examined: 1809
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '148100';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 276.501935  Lock_time: 0.000201 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430415057;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 172.171724  Lock_time: 0.000479 Rows_sent: 1  Rows_examined: 2605
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.elementary_yn = 'Y' THEN '초등학생'
                ELSE '초등학생아님' END AS elementary_yn
               ,b.gender                
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,b.tel1
               ,b.tel2
               ,b.tel3
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.mobile1
               ,b.mobile2
               ,b.mobile3
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,b.blacklist_yn
               ,a.group_no
               ,a.grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,b.parent_id
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_no = a.student_no) as point
               ,b.start_sms_yn
               ,b.end_sms_yn
               ,b.search_yn
               ,IFNULL(b.movie_limit_yn, 'N') as movie_limit_yn
               ,IFNULL(b.movie_global_limit_yn, 'N') as movie_global_limit_yn
               ,lpad(c.recom_id,4,'0') as recom_id
               ,c.recom_teacher_nm
          FROM  ishomedb.tz_student a 
          LEFT OUTER JOIN tz_member b ON a.student_id = b.user_id
          LEFT OUTER JOIN (SELECT tzt.recom_id as recom_id, 
                tzm.nm_kor AS recom_teacher_nm
                FROM tz_teacher tzt
                LEFT JOIN tz_member tzm ON tzt.teacher_id = tzm.user_id) c ON b.recom_teacher = c.recom_id
          where  a.student_no = '248206';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 164.941199  Lock_time: 0.000382 Rows_sent: 1  Rows_examined: 2574
SET timestamp=1430415057;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.elementary_yn = 'Y' THEN '초등학생'
                ELSE '초등학생아님' END AS elementary_yn
               ,b.gender                
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,b.tel1
               ,b.tel2
               ,b.tel3
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.mobile1
               ,b.mobile2
               ,b.mobile3
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,b.blacklist_yn
               ,a.group_no
               ,a.grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,b.parent_id
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_no = a.student_no) as point
               ,b.start_sms_yn
               ,b.end_sms_yn
               ,b.search_yn
               ,IFNULL(b.movie_limit_yn, 'N') as movie_limit_yn
               ,IFNULL(b.movie_global_limit_yn, 'N') as movie_global_limit_yn
               ,lpad(c.recom_id,4,'0') as recom_id
               ,c.recom_teacher_nm
          FROM  ishomedb.tz_student a 
          LEFT OUTER JOIN tz_member b ON a.student_id = b.user_id
          LEFT OUTER JOIN (SELECT tzt.recom_id as recom_id, 
                tzm.nm_kor AS recom_teacher_nm
                FROM tz_teacher tzt
                LEFT JOIN tz_member tzm ON tzt.teacher_id = tzm.user_id) c ON b.recom_teacher = c.recom_id
          where  a.student_no = '277053';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 274.844978  Lock_time: 0.000323 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430415057;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 288.913931  Lock_time: 0.000449 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430415057;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 266.817128  Lock_time: 0.000146 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430415057;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 255.218968  Lock_time: 0.001680 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김시우', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 295.648382  Lock_time: 0.000171 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430415057;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 239.714698  Lock_time: 0.001683 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김시우', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 252.517187  Lock_time: 0.001630 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김시우', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 246.356418  Lock_time: 0.001670 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김시우', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 250.930185  Lock_time: 0.001629 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김시우', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 239.500073  Lock_time: 0.001659 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김시우', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 289.991003  Lock_time: 0.000272 Rows_sent: 1  Rows_examined: 23132
SET timestamp=1430415057;
SELECT COUNT(t1.f_ischeckpoint) as totalCnt 
		FROM edubasestudydb.t_student_test t1 
		WHERE t1.f_test_id IN (
		    SELECT tst.f_test_id
		    FROM ishomedb.tz_lms_module modu
		    INNER JOIN ishomedb.tz_lcms_study_lesson les 
		    ON modu.subj_lesson_no = les.subj_lesson_no
		    LEFT OUTER JOIN ishomedb.tz_lms_module lm 
		    ON lm.subj_lesson_no = les.subj_lesson_no
		    AND lm.module_no = modu.module_no AND lm.useq = modu.useq AND lm.head_gbn != '10001'
		    LEFT OUTER JOIN ishomedb.tz_lcms_prepare_test ppe 
		    ON ppe.subj_lesson_no = les.subj_lesson_no AND ppe.useq = lm.useq AND ppe.test_url_gbn = '10001'
		    LEFT OUTER JOIN edubasestudydb.t_test tst
		    ON tst.f_chapter_cd = les.subj_lesson_no AND tst.f_no = ppe.useq
		    AND tst.f_kind_cd IN ('T110', 'T120', 'T130', 'T135') AND tst.f_isopen = 'Y'
		    WHERE modu.upper_no IN (81739,81740,81741,81742,81743,81744,81745,81746,81747,81748,81749,81750,81751,81752,81753,81754,81755,81756,81757,81758,81759,81760,81761,81762,81763,81764,81765,81766,81767,81768,81769)
		) AND f_ischeckpoint = 'Y'
		AND f_user_cd = '148100';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 250.664240  Lock_time: 0.001634 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415057;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김시우', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# Time: 150501  2:30:58
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 248.461802  Lock_time: 0.001661 Rows_sent: 112  Rows_examined: 133866
SET timestamp=1430415058;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 249.973688  Lock_time: 0.001627 Rows_sent: 112  Rows_examined: 133866
SET timestamp=1430415058;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 248.758359  Lock_time: 0.001622 Rows_sent: 112  Rows_examined: 133866
SET timestamp=1430415058;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555386
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 276.178816  Lock_time: 0.001651 Rows_sent: 111  Rows_examined: 182409
SET timestamp=1430415058;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 540485
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 194.427867  Lock_time: 0.001726 Rows_sent: 102  Rows_examined: 280766
SET timestamp=1430415058;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 123491
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 190.420381  Lock_time: 0.001634 Rows_sent: 126  Rows_examined: 225374
SET timestamp=1430415058;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 304654
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 37.658284  Lock_time: 0.001065 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 262.158008  Lock_time: 0.001051 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 540485
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 262.222466  Lock_time: 0.001095 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 540485
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 89.004299  Lock_time: 0.001175 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 540485
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 183.608290  Lock_time: 0.001029 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 540485
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 56.010848  Lock_time: 0.001022 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 183.475649  Lock_time: 0.001046 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 540485
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 56.028612  Lock_time: 0.001164 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 15.336356  Lock_time: 0.001221 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 102.058249  Lock_time: 0.000357 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555386
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 89.027093  Lock_time: 0.001054 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 540485
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 150.611407  Lock_time: 0.001184 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555386
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 214.913948  Lock_time: 0.001056 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555386
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 37.728018  Lock_time: 0.001014 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 15.351888  Lock_time: 0.001280 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415058;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150501  2:32:38
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 410.506832  Lock_time: 0.001206 Rows_sent: 27236  Rows_examined: 254249
SET timestamp=1430415158;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150501  2:37:51
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 301.277861  Lock_time: 0.000043 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415471;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5620824';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 72.917945  Lock_time: 0.000119 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430415471;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 392415;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 272.410881  Lock_time: 0.000125 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415471;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '148100';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 273.562716  Lock_time: 0.000135 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415471;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '148100';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 204.882844  Lock_time: 0.000290 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415471;
SELECT IF(tch.teacher_id != '', 'Y', 'N') AS teacher_yn,    /* 선생님 여부 */
               tch.teacher_id,                                      /* 선생님 아이디 */
               tm.nm_kor,                                           /* 선생님 성명 */               
               tc.corp_no,                                          /* 제휴사 코드 */
               tc.corp_nm,                                          /* 제휴사 명*/
               tc.leader_id AS corp_leader_id,                      /* 제휴사 관리자 아이디 */
               tt.team_no,                                          /* 팀 코드 */
               tt.team_nm,                                          /* 팀 명 */
               tt.leader_id AS team_leader_id,                      /* 팀 관리자 아이디 */
               tp.part_no,                                          /* 파트 코드 */
               tp.part_nm,                                          /* 파트 명 */
               tp.leader_id AS part_leader_id                       /* 파트 관리자 아이디 */
          FROM ishomedb.tz_member tm
               LEFT OUTER JOIN ishomedb.tz_teacher tch
                  ON tch.teacher_id = tm.user_id AND tch.active_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_team_part tp
                  ON tp.part_no = tch.part_no AND tp.use_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_team tt
                  ON tt.team_no = tp.team_no AND tt.use_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_corp tc
                  ON tc.corp_no = tt.corp_no AND tt.use_yn = 'Y'
         WHERE tm.user_id = '392415';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 105.469013  Lock_time: 0.000193 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430415471;
SELECT COUNT(a.f_stu_test_id) AS cnt
        FROM (
            SELECT st.f_stu_test_id
            FROM edubasestudydb.t_student_test st
            INNER JOIN ishomedb.tz_student s
            ON st.f_user_cd = s.student_no
            INNER JOIN ishomedb.tz_purchase_student ps
            ON s.student_no = ps.temp_student_no
            INNER JOIN ishomedb.tz_purchase p
            ON ps.purchase_no = p.purchase_no
            AND IFNULL(p.status_gbn, 10001) != 10010
            WHERE DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
                AND s.teacher_id = 392415
                AND st.f_ischeckpoint = 'N'
            GROUP BY st.f_test_id, st.f_user_cd
        ) a;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.231740  Lock_time: 0.000546 Rows_sent: 1  Rows_examined: 1809
SET timestamp=1430415471;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '148100';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 195.509708  Lock_time: 0.001488 Rows_sent: 10  Rows_examined: 1065
SET timestamp=1430415471;
SELECT paid.split_paid_no
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN 'ⓗ' ELSE '' END AS reg_gbn_nm
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.user_id AS parent_id
              ,s_mem.user_id AS student_id
              ,mng_std.student_no
              ,CONCAT(p_mem.nm_kor, '<br />(' ,p_mem.login_id,')') AS p_mem_info /* 학부모정보 */
              ,CONCAT(s_mem.nm_kor, '<br />(' ,s_mem.login_id,')') AS s_mem_info /* 학습자정보 */
              ,prd.product_no /* 상품명 */
              ,prd.product_nm /* 상품명 */
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN '오프라인'    /* 2013-06-17 JHSUN 홈페이지->오프라인으로 변경 */
                    WHEN paid.reg_gbn = 'online' THEN '온라인'
                    ELSE '오프라인'
               END AS paid_gubun
              ,paid.batch_key /* 결제식별키 */
              ,paid.paid_day /* 청구일 */
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS app_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt /* 최초결제일 */
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt /* 최근승인일 */
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt /* 승인시도횟수 */
              ,pb.result_msg AS last_paid_status /* 최근승인요청결과 */
              ,purchase_code.code_nm AS status_gbn /* 구매상태 */
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor,  '<br />(' , manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,pb.result_code 
              ,CASE WHEN pur_ref.device_return_gbn = 'Y' THEN '기기반납'
                    WHEN pur_ref.device_return_gbn = 'N' THEN '기기양도'
                    WHEN pur_ref.device_return_gbn = 'U' THEN '해당없음'
               END AS device_return_gbn_nm
              ,h.code_nm AS purchase_device_gbn /* 구매단말기구분 */
              ,tdm.model_gbn as model_gbn /* 기기구분 */
              ,uf_code_nm(10230,tdm.model_gbn) as model_gbn_nm /* 기기구분명 */
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              , prd.service_reuse_yn
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
        /* 단말기 반납여부 */
        LEFT JOIN ishomedb.tz_purchase_refund pur_ref
        ON paid.purchase_no = pur_ref.purchase_no
        /* 구매단말기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
        /* 단말기 정보 */
        LEFT OUTER JOIN ishomedb.tz_device i
        ON pur.purchase_no = i.purchase_no
        AND i.status_gbn IN (10002, 10005, 10007)
        /* 모델구분 */
        LEFT OUTER JOIN ishomedb.tz_device_model tdm
        ON i.model_code = tdm.model_code
         
  
           
               
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 276.253558  Lock_time: 0.001225 Rows_sent: 23  Rows_examined: 1063
SET timestamp=1430415471;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '148100'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '148100'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '148100'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 200.030288  Lock_time: 0.000634 Rows_sent: 10  Rows_examined: 1065
SET timestamp=1430415471;
SELECT paid.split_paid_no
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN 'ⓗ' ELSE '' END AS reg_gbn_nm
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.user_id AS parent_id
              ,s_mem.user_id AS student_id
              ,mng_std.student_no
              ,CONCAT(p_mem.nm_kor, '<br />(' ,p_mem.login_id,')') AS p_mem_info /* 학부모정보 */
              ,CONCAT(s_mem.nm_kor, '<br />(' ,s_mem.login_id,')') AS s_mem_info /* 학습자정보 */
              ,prd.product_no /* 상품명 */
              ,prd.product_nm /* 상품명 */
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN '오프라인'    /* 2013-06-17 JHSUN 홈페이지->오프라인으로 변경 */
                    WHEN paid.reg_gbn = 'online' THEN '온라인'
                    ELSE '오프라인'
               END AS paid_gubun
              ,paid.batch_key /* 결제식별키 */
              ,paid.paid_day /* 청구일 */
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS app_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt /* 최초결제일 */
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt /* 최근승인일 */
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt /* 승인시도횟수 */
              ,pb.result_msg AS last_paid_status /* 최근승인요청결과 */
              ,purchase_code.code_nm AS status_gbn /* 구매상태 */
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor,  '<br />(' , manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,pb.result_code 
              ,CASE WHEN pur_ref.device_return_gbn = 'Y' THEN '기기반납'
                    WHEN pur_ref.device_return_gbn = 'N' THEN '기기양도'
                    WHEN pur_ref.device_return_gbn = 'U' THEN '해당없음'
               END AS device_return_gbn_nm
              ,h.code_nm AS purchase_device_gbn /* 구매단말기구분 */
              ,tdm.model_gbn as model_gbn /* 기기구분 */
              ,uf_code_nm(10230,tdm.model_gbn) as model_gbn_nm /* 기기구분명 */
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              , prd.service_reuse_yn
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
        /* 단말기 반납여부 */
        LEFT JOIN ishomedb.tz_purchase_refund pur_ref
        ON paid.purchase_no = pur_ref.purchase_no
        /* 구매단말기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
        /* 단말기 정보 */
        LEFT OUTER JOIN ishomedb.tz_device i
        ON pur.purchase_no = i.purchase_no
        AND i.status_gbn IN (10002, 10005, 10007)
        /* 모델구분 */
        LEFT OUTER JOIN ishomedb.tz_device_model tdm
        ON i.model_code = tdm.model_code
         
  
           
               
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 277.193472  Lock_time: 0.001204 Rows_sent: 23  Rows_examined: 1063
SET timestamp=1430415471;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '148100'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '148100'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '148100'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 288.429013  Lock_time: 0.001321 Rows_sent: 23  Rows_examined: 1063
SET timestamp=1430415471;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '148100'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '148100'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '148100'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 186.313964  Lock_time: 0.001479 Rows_sent: 10  Rows_examined: 1065
SET timestamp=1430415471;
SELECT paid.split_paid_no
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN 'ⓗ' ELSE '' END AS reg_gbn_nm
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.user_id AS parent_id
              ,s_mem.user_id AS student_id
              ,mng_std.student_no
              ,CONCAT(p_mem.nm_kor, '<br />(' ,p_mem.login_id,')') AS p_mem_info /* 학부모정보 */
              ,CONCAT(s_mem.nm_kor, '<br />(' ,s_mem.login_id,')') AS s_mem_info /* 학습자정보 */
              ,prd.product_no /* 상품명 */
              ,prd.product_nm /* 상품명 */
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN '오프라인'    /* 2013-06-17 JHSUN 홈페이지->오프라인으로 변경 */
                    WHEN paid.reg_gbn = 'online' THEN '온라인'
                    ELSE '오프라인'
               END AS paid_gubun
              ,paid.batch_key /* 결제식별키 */
              ,paid.paid_day /* 청구일 */
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS app_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt /* 최초결제일 */
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt /* 최근승인일 */
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt /* 승인시도횟수 */
              ,pb.result_msg AS last_paid_status /* 최근승인요청결과 */
              ,purchase_code.code_nm AS status_gbn /* 구매상태 */
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor,  '<br />(' , manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,pb.result_code 
              ,CASE WHEN pur_ref.device_return_gbn = 'Y' THEN '기기반납'
                    WHEN pur_ref.device_return_gbn = 'N' THEN '기기양도'
                    WHEN pur_ref.device_return_gbn = 'U' THEN '해당없음'
               END AS device_return_gbn_nm
              ,h.code_nm AS purchase_device_gbn /* 구매단말기구분 */
              ,tdm.model_gbn as model_gbn /* 기기구분 */
              ,uf_code_nm(10230,tdm.model_gbn) as model_gbn_nm /* 기기구분명 */
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              , prd.service_reuse_yn
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
        /* 단말기 반납여부 */
        LEFT JOIN ishomedb.tz_purchase_refund pur_ref
        ON paid.purchase_no = pur_ref.purchase_no
        /* 구매단말기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
        /* 단말기 정보 */
        LEFT OUTER JOIN ishomedb.tz_device i
        ON pur.purchase_no = i.purchase_no
        AND i.status_gbn IN (10002, 10005, 10007)
        /* 모델구분 */
        LEFT OUTER JOIN ishomedb.tz_device_model tdm
        ON i.model_code = tdm.model_code
         
  
           
               
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC
        LIMIT 0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 294.778818  Lock_time: 0.001192 Rows_sent: 23  Rows_examined: 1063
SET timestamp=1430415471;
SELECT IFNULL(modu.head_gbn, '') AS head_gbn /*말머리 구분(10129)*/
              ,sbj.grade_gbn
              ,CASE WHEN sbj.semester_gbn = 3 THEN '공통' ELSE sbj.semester_gbn END AS semester_gbn_nm
              ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
              ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(
                    CASE
                        WHEN
                            sbj.subj_gbn = 10021
                        THEN
                            IFNULL(les.chapter_key, 0)
                        ELSE les.sort
                    END
                    , '장. ', les.subj_lesson_nm) /*예복습*/
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)') 
                    WHEN modu.head_gbn = 10005 THEN CONCAT(les.sort, '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*실력평가*/
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
                    WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
                    WHEN modu.head_gbn = 10002 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') /*단원평가*/
                    ELSE CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)') /*중기말*/
               END AS subj_lesson_nm
              ,IF(les.lesson_gbn = 10002 OR les.lesson_gbn = 10003, '', CONCAT(' ', SUBSTRING(les.order_key, 1, 2))) AS unit_no
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '완료'
                    ELSE (SELECT IF(COUNT(1) = 0, '학습전', '학습중')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_txt
              ,CASE WHEN modu.head_gbn = '10001' THEN '0' ELSE '1' END AS lesson_gbn
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'state complete' ELSE 'state imperfective' END AS clear_css                                           /* 완료 여부 표시 css */
              ,CASE WHEN act.clear_dt IS NOT NULL THEN 'end'
                    ELSE (SELECT IF(COUNT(1) = 0, 'st', 'st02')
                          FROM tz_lms_act_element 
                          WHERE student_no = act.student_no
                              AND plan_de = act.plan_de
                              AND module_no = modu.module_no
                         )
               END AS clear_img
              ,CASE WHEN act.clear_dt IS NOT NULL THEN '1' ELSE  '0' END AS start_txt /*실력평가분리 후 clear_txt, clear_img와 동일*/
              ,'' AS f_test_dt
              ,modu.module_no
              ,les.subj_no
              ,les.subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,act.act_dt
              ,act.clear_dt
              ,pln.plan_de
              ,DATE_FORMAT(pln.plan_de,  '%Y') AS yy
              ,DATE_FORMAT(pln.plan_de,  '%m') AS mm
              ,DATE_FORMAT(pln.plan_de,  '%d') AS dd
              ,CASE WHEN DAYNAME(pln.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(pln.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(pln.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(pln.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(pln.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(pln.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(pln.plan_de) = 6 THEN '일'
               END AS ww
              ,les.contents_xml_type
              ,(SELECT IFNULL(SUM(tc.pic_mediatime),0) 
                    FROM tz_lcms_contents tl
                    LEFT OUTER JOIN tz_cms_contents tc ON tc.contents_no = tl.porting_value
                    WHERE tl.contents_no = les.contents_no) AS media_time 
              ,(SELECT IFNULL(SUM(study_time),0)
                    FROM tz_lms_act_element
                    WHERE student_no = pln.student_no
                    AND plan_de = pln.plan_de
                    AND module_no = pln.module_no) AS study_duration
        FROM ishomedb.tz_lms_plan_module pln
            INNER JOIN
        ishomedb.tz_lms_module modu ON pln.module_no = modu.module_no
            LEFT OUTER JOIN
        ishomedb.tz_lms_act_module act ON pln.student_no = act.student_no AND pln.plan_de = act.plan_de AND modu.module_no = act.module_no
            INNER JOIN
        ishomedb.tz_lcms_study_lesson les ON modu.subj_lesson_no = les.subj_lesson_no AND les.use_yn = 'Y'
            INNER JOIN
        ishomedb.tz_lms_course cou ON modu.course_no = cou.course_no
            INNER JOIN
        ishomedb.tz_lcms_subj sbj ON cou.subj_no = sbj.subj_no
        WHERE pln.student_no = '148100'
            AND pln.plan_de >= '2015.04.27'
            AND pln.plan_de <= '2015.05.03'
        
        UNION ALL
                        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(ishomedb.uf_lcms_theme_category_connect_by_path('-', b.upper_no, 14), '마쓰연산', '마쓰'), '-', 3) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'마쓰' AS subj_gbn_nm
              ,b.category_nm AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN '완료' ELSE '학습전' END AS clear_txt  
              ,'' AS lesson_gbn
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(a.clear_dt, '') != '' THEN 'end' ELSE 'st' END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              ,'' AS sort  /*추가 황진우 한자서당 장표시를 위해*/
              ,a.act_dt AS act_dt
              ,a.clear_dt AS clear_dt
              ,a.plan_de
              ,DATE_FORMAT(a.plan_de, '%Y') AS yy
              ,DATE_FORMAT(a.plan_de, '%m') AS mm
              ,DATE_FORMAT(a.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(a.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(a.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(a.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(a.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(a.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(a.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(a.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lcms_plan_math a
        INNER JOIN tz_lcms_theme_category b
        ON a.category_no = b.category_no 
        WHERE a.student_no = '148100'
            AND a.plan_de >= '2015.04.27'
            AND a.plan_de <= '2015.05.03'
        
        UNION ALL
        
        SELECT '' AS head_gbn
              ,SUBSTRING_INDEX(REPLACE(REPLACE(
                  ishomedb.uf_lcms_theme_category_connect_by_path('-', ltm.category_no, 7), '심화특별학습', '심화'), '선사시대 ~ 통일신라', '~통일신라'), '-', 5
               ) AS grade_gbn
              ,'1' AS semester_gbn_nm
              ,'테마자료' AS subj_gbn_nm
              ,ltm.title AS subj_lesson_nm
              ,'' AS unit_no
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN '완료' ELSE IF(lpt.act_dt<>'','학습중','학습전') END AS clear_txt  
              ,'' AS lesson_gbn     /* 학습시작일 */
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'state complete' ELSE 'state imperfective' END AS clear_css  
              ,CASE WHEN IFNULL(lpt.clear_dt, '') != '' THEN 'end' ELSE IF(lpt.act_dt<>'','st02','st') END AS clear_img
              ,'' AS start_txt
              ,'' AS f_test_dt
              ,'' AS module_no
              ,'' AS subj_no
              ,'' AS subj_lesson_no
              , ltm.sort
              ,lpt.act_dt AS act_dt
              ,lpt.clear_dt AS clear_dt
              ,lpt.plan_de
              ,DATE_FORMAT(lpt.plan_de, '%Y') AS yy
              ,DATE_FORMAT(lpt.plan_de, '%m') AS mm
              ,DATE_FORMAT(lpt.plan_de, '%d') AS dd
              ,CASE WHEN DAYNAME(lpt.plan_de) = 0 THEN '월'
                    WHEN DAYNAME(lpt.plan_de) = 1 THEN '화'
                    WHEN DAYNAME(lpt.plan_de) = 2 THEN '수'
                    WHEN DAYNAME(lpt.plan_de) = 3 THEN '목'
                    WHEN DAYNAME(lpt.plan_de) = 4 THEN '금'
                    WHEN DAYNAME(lpt.plan_de) = 5 THEN '토'
                    WHEN DAYNAME(lpt.plan_de) = 6 THEN '일'
               END AS ww
              ,'' AS contents_xml_type
              ,'' AS media_time
              ,'' AS study_duration
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        WHERE lpt.student_no = '148100'
            AND lpt.plan_de >= '2015.04.27'
            AND lpt.plan_de <= '2015.05.03'
        ORDER BY plan_de;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 169.478159  Lock_time: 0.000202 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430415471;
SELECT COUNT(a.f_stu_test_id) AS cnt
        FROM (
            SELECT st.f_stu_test_id
            FROM edubasestudydb.t_student_test st
            INNER JOIN ishomedb.tz_student s
            ON st.f_user_cd = s.student_no
            INNER JOIN ishomedb.tz_purchase_student ps
            ON s.student_no = ps.temp_student_no
            INNER JOIN ishomedb.tz_purchase p
            ON ps.purchase_no = p.purchase_no
            AND IFNULL(p.status_gbn, 10001) != 10010
            WHERE DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
                AND s.teacher_id = 555386
                AND st.f_ischeckpoint = 'N'
            GROUP BY st.f_test_id, st.f_user_cd
        ) a;
# Time: 150501  2:37:52
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 105.309289  Lock_time: 0.001134 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415472;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 168.799887  Lock_time: 0.001232 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415472;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555386
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 168.802792  Lock_time: 0.001216 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415472;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555386
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 105.383925  Lock_time: 0.001139 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430415472;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 392415
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150501  2:38:05
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 323.012295  Lock_time: 0.001211 Rows_sent: 4360  Rows_examined: 72265
SET timestamp=1430415485;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150501  2:43:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 305.411911  Lock_time: 0.000061 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415796;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5627309';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.986891  Lock_time: 0.000165 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415796;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '222079';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 7.085153  Lock_time: 0.000129 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430415796;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '222079';
# Time: 150501  2:43:31
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 322.928093  Lock_time: 0.000650 Rows_sent: 6245  Rows_examined: 58961
SET timestamp=1430415811;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150501  2:44:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 38.717456  Lock_time: 0.000123 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430415856;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150501  2:44:51
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 32.347757  Lock_time: 0.000129 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430415891;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150501  2:47:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.483209  Lock_time: 0.002380 Rows_sent: 2  Rows_examined: 9839272
SET timestamp=1430416036;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150501  2:52:54
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 301.997561  Lock_time: 0.000029 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430416374;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5458676';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 223.193554  Lock_time: 0.000196 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430416374;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '222079';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 291.960489  Lock_time: 0.000101 Rows_sent: 1  Rows_examined: 15
SET timestamp=1430416374;
SELECT   subj_no, COUNT(1)
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
            AND subj_gbn = '10028'
            AND grade_gbn = '5'
            AND semester_gbn = '1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 218.109646  Lock_time: 0.000132 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430416374;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '222079';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 205.472645  Lock_time: 0.000176 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430416374;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 507688;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 269.121377  Lock_time: 0.000081 Rows_sent: 1  Rows_examined: 15
SET timestamp=1430416374;
SELECT   subj_no, COUNT(1)
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
            AND subj_gbn = '10028'
            AND grade_gbn = '5'
            AND semester_gbn = '1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 285.038132  Lock_time: 0.000082 Rows_sent: 1  Rows_examined: 15
SET timestamp=1430416374;
SELECT   subj_no, COUNT(1)
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
            AND subj_gbn = '10028'
            AND grade_gbn = '5'
            AND semester_gbn = '1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 271.055546  Lock_time: 0.000099 Rows_sent: 1  Rows_examined: 15
SET timestamp=1430416374;
SELECT   subj_no, COUNT(1)
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
            AND subj_gbn = '10028'
            AND grade_gbn = '5'
            AND semester_gbn = '1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 209.682683  Lock_time: 0.000107 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430416374;
SELECT d.product_nm
              ,b.start_de
              ,b.end_de 
        FROM tz_purchase_student a 
            ,tz_student  b
            ,tz_purchase c
            ,tz_product  d
        WHERE a.temp_student_no = b.student_no
          AND c.PRODUCT_NO      = d.PRODUCT_NO
          AND a.PURCHASE_NO     = c.PURCHASE_NO
          AND b.student_no = '222079';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 287.515458  Lock_time: 0.000083 Rows_sent: 1  Rows_examined: 15
SET timestamp=1430416374;
SELECT   subj_no, COUNT(1)
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
            AND subj_gbn = '10028'
            AND grade_gbn = '5'
            AND semester_gbn = '1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 281.400880  Lock_time: 0.000084 Rows_sent: 1  Rows_examined: 15
SET timestamp=1430416374;
SELECT   subj_no, COUNT(1)
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
            AND subj_gbn = '10028'
            AND grade_gbn = '5'
            AND semester_gbn = '1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 278.061950  Lock_time: 0.000080 Rows_sent: 1  Rows_examined: 15
SET timestamp=1430416374;
SELECT   subj_no, COUNT(1)
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
            AND subj_gbn = '10028'
            AND grade_gbn = '5'
            AND semester_gbn = '1';
# Time: 150501  2:53:00
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 324.208317  Lock_time: 0.001356 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430416380;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150501  2:54:05
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 61.033776  Lock_time: 0.001834 Rows_sent: 8202  Rows_examined: 1690425
SET timestamp=1430416445;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150501  2:54:26
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.269149  Lock_time: 0.000220 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430416466;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:54:56
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.893385  Lock_time: 0.000257 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430416496;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:55:08
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.153517  Lock_time: 0.000219 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430416508;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:55:19
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.631818  Lock_time: 0.000217 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430416519;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:55:28
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.052009  Lock_time: 0.000219 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430416528;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:55:45
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.499934  Lock_time: 0.000248 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430416545;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:56:00
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.347724  Lock_time: 0.000247 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430416560;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:56:10
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.286839  Lock_time: 0.000250 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430416570;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:56:25
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.329158  Lock_time: 0.000220 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430416585;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:56:49
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.247214  Lock_time: 0.000202 Rows_sent: 64476  Rows_examined: 211319
SET timestamp=1430416609;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150501  2:57:03
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.758141  Lock_time: 0.000163 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430416623;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150501  2:58:33
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 86.960964  Lock_time: 0.000276 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430416713;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150501  2:59:45
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.930388  Lock_time: 0.001881 Rows_sent: 1418  Rows_examined: 1629157
SET timestamp=1430416785;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150501  3:00:38
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 48.173659  Lock_time: 0.002359 Rows_sent: 5572  Rows_examined: 18899
SET timestamp=1430416838;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150501 11:16:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 16.010922  Lock_time: 0.000286 Rows_sent: 15  Rows_examined: 3087937
SET timestamp=1430446575;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150501 11:27:06
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.494846  Lock_time: 0.000429 Rows_sent: 14576  Rows_examined: 65640680
SET timestamp=1430447226;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150501 11:28:55
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.067315  Lock_time: 0.000232 Rows_sent: 14576  Rows_examined: 65640683
SET timestamp=1430447335;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150501 14:30:54
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.402400  Lock_time: 0.000383 Rows_sent: 14596  Rows_examined: 65732314
SET timestamp=1430458254;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150501 19:10:32
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.785943  Lock_time: 0.000392 Rows_sent: 14629  Rows_examined: 65910068
SET timestamp=1430475032;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150501 21:11:06
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.318139  Lock_time: 0.000666 Rows_sent: 14404  Rows_examined: 2839759
SET timestamp=1430482266;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.01', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.01', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150501 21:11:18
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.460169  Lock_time: 0.000586 Rows_sent: 14404  Rows_examined: 2839759
SET timestamp=1430482278;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.01', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.01', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150501 21:11:31
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.152309  Lock_time: 0.000670 Rows_sent: 14404  Rows_examined: 2839759
SET timestamp=1430482291;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.01', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.01', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150501 21:11:46
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.487640  Lock_time: 0.000632 Rows_sent: 14404  Rows_examined: 2839767
SET timestamp=1430482306;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.01', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.01', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150502  2:31:17
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 305.240099  Lock_time: 0.000048 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430501477;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2010727h1822857';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 102.860839  Lock_time: 0.000142 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430501477;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 43.635121  Lock_time: 0.000189 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430501477;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 135.193108  Lock_time: 0.000108 Rows_sent: 1  Rows_examined: 185
SET timestamp=1430501477;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555571
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 75.928325  Lock_time: 0.000136 Rows_sent: 1  Rows_examined: 185
SET timestamp=1430501477;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555571
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 157.479418  Lock_time: 0.000380 Rows_sent: 91  Rows_examined: 703
SET timestamp=1430501477;
SELECT ms.nm_kor
		      ,ms.user_id
		      ,ms.join_de
		      ,ms.blacklist_yn
		      ,s.group_no
		      ,s.student_no
		      ,s.student_id           /* 2013-07-12 JHSUN 메일보내기 문제로 student_id 추가 */
		      ,s.teacher_id
		      ,s.grade_gbn
		      ,s.start_de
		      ,s.end_de
		      ,e.is_info /*체험단 인지 정보*/
		      ,e.app_reason /*체험단 신청 사유*/
		      ,(CASE WHEN ms.sms_yn = 'Y' THEN '허용' ELSE '거부' END) AS sms_yn_nm
		      ,mp.user_id AS parent_id
		      ,mp.login_id AS login_id
		      ,mp.nm_kor AS parent_nm_kor
		      ,CONCAT(mp.mobile1, '-', mp.mobile2, '-', mp.mobile3) AS tel
		      ,CONCAT(DATE_FORMAT(s.start_de, '%Y.%m.%d'), "~", DATE_FORMAT(s.end_de, '%Y.%m.%d')) AS use_de
		      ,(CASE WHEN ms.gender = 'M' THEN '남자' WHEN ms.gender = 'F' THEN '여자' ELSE '' END) AS gender
		      ,p.status_gbn
		      ,pd.product_nm
		      ,IFNULL(gcm.gcm_status, 'N') AS gcm_status /* 학부모앱 설치 유무 */                    
		FROM ishomedb.tz_member mp
		INNER JOIN ishomedb.tz_member ms
		ON mp.user_id = ms.parent_id
		INNER JOIN ishomedb.tz_student s
		ON ms.user_id = s.student_id
		AND s.teacher_id = 555571
		INNER JOIN ishomedb.tz_purchase_student ps
		ON s.student_no = ps.temp_student_no
		INNER JOIN ishomedb.tz_purchase p
		ON ps.purchase_no = p.purchase_no
		AND p.status_gbn != 10010
		INNER JOIN ishomedb.tz_product pd
		ON p.product_no = pd.product_no
		LEFT JOIN ishomedb.tz_experience e
		ON mp.user_id = e.parent_id
		
		LEFT OUTER JOIN ishomedb.tz_android_gcm_parent gcm /* 2013.07.24 학부모앱 정보 이영무 */
		ON mp.user_id = gcm.user_id
		
         
         WHERE  IFNULL(s.end_de, NOW()) >= DATE_FORMAT(NOW(), '%Y-%m-%d')  
     
         
         
         
         
         
         
         ORDER BY s.student_no DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 151.621957  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430501477;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 164.379341  Lock_time: 0.000113 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430501477;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 165.646537  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430501477;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 162.688446  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430501477;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 156.562887  Lock_time: 0.000323 Rows_sent: 91  Rows_examined: 703
SET timestamp=1430501477;
SELECT ms.nm_kor
		      ,ms.user_id
		      ,ms.join_de
		      ,ms.blacklist_yn
		      ,s.group_no
		      ,s.student_no
		      ,s.student_id           /* 2013-07-12 JHSUN 메일보내기 문제로 student_id 추가 */
		      ,s.teacher_id
		      ,s.grade_gbn
		      ,s.start_de
		      ,s.end_de
		      ,e.is_info /*체험단 인지 정보*/
		      ,e.app_reason /*체험단 신청 사유*/
		      ,(CASE WHEN ms.sms_yn = 'Y' THEN '허용' ELSE '거부' END) AS sms_yn_nm
		      ,mp.user_id AS parent_id
		      ,mp.login_id AS login_id
		      ,mp.nm_kor AS parent_nm_kor
		      ,CONCAT(mp.mobile1, '-', mp.mobile2, '-', mp.mobile3) AS tel
		      ,CONCAT(DATE_FORMAT(s.start_de, '%Y.%m.%d'), "~", DATE_FORMAT(s.end_de, '%Y.%m.%d')) AS use_de
		      ,(CASE WHEN ms.gender = 'M' THEN '남자' WHEN ms.gender = 'F' THEN '여자' ELSE '' END) AS gender
		      ,p.status_gbn
		      ,pd.product_nm
		      ,IFNULL(gcm.gcm_status, 'N') AS gcm_status /* 학부모앱 설치 유무 */                    
		FROM ishomedb.tz_member mp
		INNER JOIN ishomedb.tz_member ms
		ON mp.user_id = ms.parent_id
		INNER JOIN ishomedb.tz_student s
		ON ms.user_id = s.student_id
		AND s.teacher_id = 555571
		INNER JOIN ishomedb.tz_purchase_student ps
		ON s.student_no = ps.temp_student_no
		INNER JOIN ishomedb.tz_purchase p
		ON ps.purchase_no = p.purchase_no
		AND p.status_gbn != 10010
		INNER JOIN ishomedb.tz_product pd
		ON p.product_no = pd.product_no
		LEFT JOIN ishomedb.tz_experience e
		ON mp.user_id = e.parent_id
		
		LEFT OUTER JOIN ishomedb.tz_android_gcm_parent gcm /* 2013.07.24 학부모앱 정보 이영무 */
		ON mp.user_id = gcm.user_id
		
         
         WHERE  IFNULL(s.end_de, NOW()) >= DATE_FORMAT(NOW(), '%Y-%m-%d')  
     
         
         
         
         
         
         
         ORDER BY s.student_no DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 169.625455  Lock_time: 0.000361 Rows_sent: 22  Rows_examined: 3179
SET timestamp=1430501477;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 176.923879  Lock_time: 0.000335 Rows_sent: 22  Rows_examined: 3179
SET timestamp=1430501477;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 176.006129  Lock_time: 0.000307 Rows_sent: 22  Rows_examined: 3179
SET timestamp=1430501477;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 168.187462  Lock_time: 0.000308 Rows_sent: 21  Rows_examined: 3376
SET timestamp=1430501477;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-27'
        AND    l.consult_dt   <   date_add('2015-05-27', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 197.424269  Lock_time: 0.000378 Rows_sent: 22  Rows_examined: 3230
SET timestamp=1430501477;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-19'
        AND    l.consult_dt   <   date_add('2015-05-19', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 184.605880  Lock_time: 0.000372 Rows_sent: 22  Rows_examined: 3179
SET timestamp=1430501477;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# Time: 150502  2:31:18
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 135.375151  Lock_time: 0.001151 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501478;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555571
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 76.154026  Lock_time: 0.001075 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501478;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555571
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 151.046318  Lock_time: 0.001751 Rows_sent: 91  Rows_examined: 83147
SET timestamp=1430501478;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555571
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 76.172314  Lock_time: 0.001177 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501478;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555571
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 135.373672  Lock_time: 0.001019 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501478;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555571
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150502  2:32:51
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 419.451542  Lock_time: 0.001223 Rows_sent: 27236  Rows_examined: 254249
SET timestamp=1430501571;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150502  2:38:05
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 301.159562  Lock_time: 0.000043 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430501885;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5620824';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 27.292063  Lock_time: 0.000149 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430501885;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 19.877858  Lock_time: 0.000107 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430501885;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 555507;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 225.606509  Lock_time: 0.000118 Rows_sent: 1  Rows_examined: 185
SET timestamp=1430501885;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555571
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 59.604253  Lock_time: 0.000128 Rows_sent: 1  Rows_examined: 185
SET timestamp=1430501885;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555571
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 179.475869  Lock_time: 0.000123 Rows_sent: 1  Rows_examined: 354
SET timestamp=1430501885;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555507
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 154.568854  Lock_time: 0.000162 Rows_sent: 1  Rows_examined: 354
SET timestamp=1430501885;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555507
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 52.819112  Lock_time: 0.000091 Rows_sent: 1  Rows_examined: 354
SET timestamp=1430501885;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555507
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 63.921223  Lock_time: 0.000618 Rows_sent: 1  Rows_examined: 996
SET timestamp=1430501885;
SELECT
                 qna_group.student_no
                ,qna_group.group_no
                ,prt.nm_kor AS parent_nm
                ,prt.login_id AS parent_login_id
                ,child.nm_kor AS child_nm
                ,child.login_id AS child_login_id
                ,(select nm_kor from ishomedb.tz_member mem where mem.user_id = stu.teacher_id) AS teacher_nm
                ,IFNULL(grp.group_nm, '미지정') AS group_nm
                ,ishomedb.uf_code_grade_nm(stu.grade_gbn) AS grade_gbn
                ,( 
                    SELECT qna_type
                    FROM ishomedb.tz_child_qna_new
                    WHERE student_no = qna_group.student_no 
                        AND group_no = qna_group.group_no
                        AND qna_gbn = 'Q'
                    ORDER BY qna_no DESC LIMIT 1
                 ) AS qna_type
                ,( 
                    SELECT
                    CASE WHEN qna_type = 'T' THEN
                        IF(CHAR_LENGTH(qna_content) > 30, CONCAT(LEFT(qna_content, 30), '...'), qna_content)
                    ELSE
                        qna_content
                    END AS qna_content
                    FROM ishomedb.tz_child_qna_new
                    WHERE student_no = qna_group.student_no 
                        AND group_no = qna_group.group_no
                        AND qna_gbn = 'Q'
                    ORDER BY qna_no DESC LIMIT 1
                 ) AS question_content
                ,(
                    SELECT count(qna_no)
                    FROM ishomedb.tz_child_qna_new 
                    WHERE student_no = qna_group.student_no 
                        AND group_no = qna_group.group_no
                        AND qna_gbn = 'Q'
                ) AS question_count
                ,CONCAT(qna_group.question_date, ' ', qna_group.question_time) AS question_dt
                ,IF(qna_group.answer_yn = 'Y', '답변완료', '답변대기') AS complete_gbn
                ,IF(qna_group.answer_date is null, '', CONCAT(qna_group.answer_date, ' ', qna_group.answer_time)) AS answer_dt
                ,(select nm_kor from ishomedb.tz_member mem where mem.user_id = qna_group.answer_id) AS answer_nm
                ,stu.student_id
        FROM ishomedb.tz_child_qna_group AS qna_group
        
        INNER JOIN ishomedb.tz_student stu /* 학생 */
                ON stu.student_no = qna_group.student_no
                
        INNER JOIN ishomedb.tz_member child /* 자녀 */
                ON child.user_id = stu.student_id
                
        INNER JOIN ishomedb.tz_member prt /* 부모 */
                ON prt.user_id = child.parent_id

        LEFT OUTER JOIN ishomedb.tz_student_group grp /* 자녀그룹 */
                ON stu.group_no = grp.group_no   
        
         
        
        
         
             
        
		 WHERE  qna_group.del_yn = 'N' AND qna_group.is_last = 'Y'
		    
			
			
			 
			     AND qna_group.answer_yn = 'N'
			 
			 
			 
			         AND stu.teacher_id = '555507' 
     
        
        ORDER   BY
        
         
         
          qna_group.question_date DESC, qna_group.question_time DESC  
         
        LIMIT  0, 25;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 65.619300  Lock_time: 0.000774 Rows_sent: 1  Rows_examined: 996
SET timestamp=1430501885;
SELECT
                 qna_group.student_no
                ,qna_group.group_no
                ,prt.nm_kor AS parent_nm
                ,prt.login_id AS parent_login_id
                ,child.nm_kor AS child_nm
                ,child.login_id AS child_login_id
                ,(select nm_kor from ishomedb.tz_member mem where mem.user_id = stu.teacher_id) AS teacher_nm
                ,IFNULL(grp.group_nm, '미지정') AS group_nm
                ,ishomedb.uf_code_grade_nm(stu.grade_gbn) AS grade_gbn
                ,( 
                    SELECT qna_type
                    FROM ishomedb.tz_child_qna_new
                    WHERE student_no = qna_group.student_no 
                        AND group_no = qna_group.group_no
                        AND qna_gbn = 'Q'
                    ORDER BY qna_no DESC LIMIT 1
                 ) AS qna_type
                ,( 
                    SELECT
                    CASE WHEN qna_type = 'T' THEN
                        IF(CHAR_LENGTH(qna_content) > 30, CONCAT(LEFT(qna_content, 30), '...'), qna_content)
                    ELSE
                        qna_content
                    END AS qna_content
                    FROM ishomedb.tz_child_qna_new
                    WHERE student_no = qna_group.student_no 
                        AND group_no = qna_group.group_no
                        AND qna_gbn = 'Q'
                    ORDER BY qna_no DESC LIMIT 1
                 ) AS question_content
                ,(
                    SELECT count(qna_no)
                    FROM ishomedb.tz_child_qna_new 
                    WHERE student_no = qna_group.student_no 
                        AND group_no = qna_group.group_no
                        AND qna_gbn = 'Q'
                ) AS question_count
                ,CONCAT(qna_group.question_date, ' ', qna_group.question_time) AS question_dt
                ,IF(qna_group.answer_yn = 'Y', '답변완료', '답변대기') AS complete_gbn
                ,IF(qna_group.answer_date is null, '', CONCAT(qna_group.answer_date, ' ', qna_group.answer_time)) AS answer_dt
                ,(select nm_kor from ishomedb.tz_member mem where mem.user_id = qna_group.answer_id) AS answer_nm
                ,stu.student_id
        FROM ishomedb.tz_child_qna_group AS qna_group
        
        INNER JOIN ishomedb.tz_student stu /* 학생 */
                ON stu.student_no = qna_group.student_no
                
        INNER JOIN ishomedb.tz_member child /* 자녀 */
                ON child.user_id = stu.student_id
                
        INNER JOIN ishomedb.tz_member prt /* 부모 */
                ON prt.user_id = child.parent_id

        LEFT OUTER JOIN ishomedb.tz_student_group grp /* 자녀그룹 */
                ON stu.group_no = grp.group_no   
        
         
        
        
         
             
        
		 WHERE  qna_group.del_yn = 'N' AND qna_group.is_last = 'Y'
		    
			
			
			 
			     AND qna_group.answer_yn = 'N'
			 
			 
			 
			         AND stu.teacher_id = '555507' 
     
        
        ORDER   BY
        
         
         
          qna_group.question_date DESC, qna_group.question_time DESC  
         
        LIMIT  0, 25;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 86.604089  Lock_time: 0.000075 Rows_sent: 3  Rows_examined: 6
SET timestamp=1430501885;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '180'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 226.157775  Lock_time: 0.000406 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555571
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 179.662084  Lock_time: 0.001158 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 52.998139  Lock_time: 0.001031 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 155.153622  Lock_time: 0.001198 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 53.006580  Lock_time: 0.001035 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 120.135227  Lock_time: 0.001054 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 194.009294  Lock_time: 0.001163 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555571
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 179.473296  Lock_time: 0.001018 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 60.231974  Lock_time: 0.001177 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555571
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 122.671955  Lock_time: 0.001295 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 120.010297  Lock_time: 0.001025 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430501885;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150502  2:38:18
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 322.567289  Lock_time: 0.001278 Rows_sent: 4360  Rows_examined: 72265
SET timestamp=1430501898;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150502  2:43:28
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 305.228340  Lock_time: 0.000061 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430502208;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5627309';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 267.412647  Lock_time: 0.000126 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430502208;
SELECT COUNT(a.manager_id) AS cnt  
        FROM   ishomedb.tz_manager a
         
        INNER  JOIN ( SELECT  code_no
                             ,code_nm
                      FROM   ishomedb.tz_code
                      WHERE  code_gbn = 10001
                    ) b
        ON      b.code_no = a.auth_gbn
        
        WHERE   a.manager_id = 555507
          AND   a.auth_gbn = 10010;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 190.124565  Lock_time: 0.000120 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430502208;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 555507;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 302.273152  Lock_time: 0.000084 Rows_sent: 1  Rows_examined: 354
SET timestamp=1430502208;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555507
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 225.992035  Lock_time: 0.000113 Rows_sent: 1  Rows_examined: 354
SET timestamp=1430502208;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 555507
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 191.109063  Lock_time: 0.000319 Rows_sent: 91  Rows_examined: 703
SET timestamp=1430502208;
SELECT ms.nm_kor
		      ,ms.user_id
		      ,ms.join_de
		      ,ms.blacklist_yn
		      ,s.group_no
		      ,s.student_no
		      ,s.student_id           /* 2013-07-12 JHSUN 메일보내기 문제로 student_id 추가 */
		      ,s.teacher_id
		      ,s.grade_gbn
		      ,s.start_de
		      ,s.end_de
		      ,e.is_info /*체험단 인지 정보*/
		      ,e.app_reason /*체험단 신청 사유*/
		      ,(CASE WHEN ms.sms_yn = 'Y' THEN '허용' ELSE '거부' END) AS sms_yn_nm
		      ,mp.user_id AS parent_id
		      ,mp.login_id AS login_id
		      ,mp.nm_kor AS parent_nm_kor
		      ,CONCAT(mp.mobile1, '-', mp.mobile2, '-', mp.mobile3) AS tel
		      ,CONCAT(DATE_FORMAT(s.start_de, '%Y.%m.%d'), "~", DATE_FORMAT(s.end_de, '%Y.%m.%d')) AS use_de
		      ,(CASE WHEN ms.gender = 'M' THEN '남자' WHEN ms.gender = 'F' THEN '여자' ELSE '' END) AS gender
		      ,p.status_gbn
		      ,pd.product_nm
		      ,IFNULL(gcm.gcm_status, 'N') AS gcm_status /* 학부모앱 설치 유무 */                    
		FROM ishomedb.tz_member mp
		INNER JOIN ishomedb.tz_member ms
		ON mp.user_id = ms.parent_id
		INNER JOIN ishomedb.tz_student s
		ON ms.user_id = s.student_id
		AND s.teacher_id = 555571
		INNER JOIN ishomedb.tz_purchase_student ps
		ON s.student_no = ps.temp_student_no
		INNER JOIN ishomedb.tz_purchase p
		ON ps.purchase_no = p.purchase_no
		AND p.status_gbn != 10010
		INNER JOIN ishomedb.tz_product pd
		ON p.product_no = pd.product_no
		LEFT JOIN ishomedb.tz_experience e
		ON mp.user_id = e.parent_id
		
		LEFT OUTER JOIN ishomedb.tz_android_gcm_parent gcm /* 2013.07.24 학부모앱 정보 이영무 */
		ON mp.user_id = gcm.user_id
		
         
         WHERE  IFNULL(s.end_de, NOW()) >= DATE_FORMAT(NOW(), '%Y-%m-%d')  
     
         
         
         
         
         
         
         ORDER BY s.student_no DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 193.401078  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502208;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 192.007139  Lock_time: 0.000114 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502208;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 190.527334  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502208;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 82.709136  Lock_time: 0.000117 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502208;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 85.473867  Lock_time: 0.000117 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502208;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 197.701736  Lock_time: 0.000117 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502208;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 195.028855  Lock_time: 0.000117 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502208;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# Time: 150502  2:43:29
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 302.368054  Lock_time: 0.000489 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502209;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 239.909387  Lock_time: 0.000399 Rows_sent: 1  Rows_examined: 8033
SET timestamp=1430502209;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 193.172595  Lock_time: 0.001719 Rows_sent: 91  Rows_examined: 83147
SET timestamp=1430502209;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555571
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 84.273441  Lock_time: 0.001774 Rows_sent: 91  Rows_examined: 83147
SET timestamp=1430502209;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day19 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day20 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day21 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day22 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day23 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day24 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day6
        ,  
           (SELECT stat_day25 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day7
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day8
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day9
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day10
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day11
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day12
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day13
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 555571
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 268.374607  Lock_time: 0.000355 Rows_sent: 1  Rows_examined: 8033
SET timestamp=1430502209;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 270.003303  Lock_time: 0.000398 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502209;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 226.437244  Lock_time: 0.001170 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502209;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 194.103684  Lock_time: 0.001108 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502209;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 555507
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150502  2:43:45
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 323.385546  Lock_time: 0.000621 Rows_sent: 6245  Rows_examined: 58961
SET timestamp=1430502225;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150502  2:44:29
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 38.043874  Lock_time: 0.000127 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430502269;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150502  2:45:04
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 32.617154  Lock_time: 0.000143 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430502304;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150502  2:47:29
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.439021  Lock_time: 0.002385 Rows_sent: 2  Rows_examined: 9839272
SET timestamp=1430502449;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150502  2:53:00
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.183954  Lock_time: 0.000052 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430502780;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2081103w5309796';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 253.309514  Lock_time: 0.000114 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430502780;
SELECT d.product_nm
              ,b.start_de
              ,b.end_de 
        FROM tz_purchase_student a 
            ,tz_student  b
            ,tz_purchase c
            ,tz_product  d
        WHERE a.temp_student_no = b.student_no
          AND c.PRODUCT_NO      = d.PRODUCT_NO
          AND a.PURCHASE_NO     = c.PURCHASE_NO
          AND b.student_no = '251655';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 217.514356  Lock_time: 0.000160 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430502780;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 550632;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 246.809293  Lock_time: 0.000134 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430502780;
SELECT    stu.student_no
                 ,stu.student_id
                 ,pst.purchase_no
                 ,stu.start_de
                 ,stu.end_de
                 ,mem.user_id
                 ,mem.nm_kor
                 ,mem.login_id  
                 ,mem.grade_gbn
                 ,stu.device_no     
        FROM     ishomedb.tz_student stu
        INNER    JOIN ishomedb.tz_member mem
        ON       stu.student_id = mem.user_id
        INNER    JOIN ishomedb.tz_purchase_student pst
        ON       stu.student_no = pst.temp_student_no
        WHERE    stu.student_no =  '268655';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 93.935053  Lock_time: 0.000188 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430502780;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 638609;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 126.549420  Lock_time: 0.000104 Rows_sent: 1  Rows_examined: 36
SET timestamp=1430502780;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 638609
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 20.780488  Lock_time: 0.000120 Rows_sent: 1  Rows_examined: 36
SET timestamp=1430502780;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 638609
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 144.729309  Lock_time: 0.000192 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430502780;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 550632;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 177.055081  Lock_time: 0.000110 Rows_sent: 1  Rows_examined: 143
SET timestamp=1430502780;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 550632
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 234.576584  Lock_time: 0.001060 Rows_sent: 1  Rows_examined: 179
SET timestamp=1430502780;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '268655';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 229.069675  Lock_time: 0.000317 Rows_sent: 21  Rows_examined: 3376
SET timestamp=1430502780;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-27'
        AND    l.consult_dt   <   date_add('2015-05-27', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 152.870211  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3497
SET timestamp=1430502780;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 555571;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 227.859079  Lock_time: 0.000301 Rows_sent: 21  Rows_examined: 3376
SET timestamp=1430502780;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-27'
        AND    l.consult_dt   <   date_add('2015-05-27', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 247.193389  Lock_time: 0.000859 Rows_sent: 1  Rows_examined: 60
SET timestamp=1430502780;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '251655';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 228.492631  Lock_time: 0.000302 Rows_sent: 21  Rows_examined: 3376
SET timestamp=1430502780;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-27'
        AND    l.consult_dt   <   date_add('2015-05-27', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 222.948085  Lock_time: 0.000886 Rows_sent: 1  Rows_examined: 179
SET timestamp=1430502780;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '268655';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 252.294673  Lock_time: 0.000299 Rows_sent: 16  Rows_examined: 91
SET timestamp=1430502780;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '4'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 264.733709  Lock_time: 0.000440 Rows_sent: 16  Rows_examined: 91
SET timestamp=1430502780;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '4'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 203.847229  Lock_time: 0.001051 Rows_sent: 1  Rows_examined: 179
SET timestamp=1430502780;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '268655';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 223.442148  Lock_time: 0.000318 Rows_sent: 21  Rows_examined: 3376
SET timestamp=1430502780;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-27'
        AND    l.consult_dt   <   date_add('2015-05-27', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 240.381506  Lock_time: 0.000342 Rows_sent: 21  Rows_examined: 3376
SET timestamp=1430502780;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-27'
        AND    l.consult_dt   <   date_add('2015-05-27', interval +1 day)
        AND    l.teacher_id = 555571
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 261.223533  Lock_time: 0.000343 Rows_sent: 16  Rows_examined: 91
SET timestamp=1430502780;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '4'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 243.560681  Lock_time: 0.000331 Rows_sent: 16  Rows_examined: 91
SET timestamp=1430502780;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '4'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 177.156853  Lock_time: 0.001101 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502780;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 550632
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 270.039849  Lock_time: 0.000419 Rows_sent: 98  Rows_examined: 175819
SET timestamp=1430502780;
SELECT   modu.module_no AS code
                ,modu.course_no
                ,modu.schedule_plan_de
                ,modu.sort
                ,sub.module_no AS sub_no 
                ,sub.subj_lesson_no
                ,sub.head_gbn
                ,(SELECT code_nm FROM ishomedb.tz_code WHERE code_gbn = 10129 AND code_no = sub.head_gbn) AS head_gbn_nm
                ,sub.contents_table
                ,sub.upper_no
                ,sub.sort AS sub_sort
                ,CONCAT('[', (SELECT code_nm FROM ishomedb.tz_code WHERE code_gbn = 10129 AND code_no = sub.head_gbn), ']', 
                    CASE
                    	WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)')  
						WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
						WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)')  
                    	WHEN les.lesson_gbn = 10001 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', sub.useq, '회차)') ELSE
                        CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN CONCAT(les.subj_lesson_nm, ' (', sub.useq, '회차)') ELSE
                        CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) END END) AS label
        FROM    ishomedb.tz_lms_module modu
        INNER   JOIN ishomedb.tz_lms_module sub
        ON      modu.module_no = sub.upper_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      sub.subj_lesson_no = les.subj_lesson_no
        LEFT OUTER JOIN	ishomedb.tz_lcms_study_lesson les1 
        ON les.upper_no = les1.subj_lesson_no
        LEFT OUTER JOIN ishomedb.tz_lcms_subj sbj 
        ON les.subj_no = sbj.subj_no
        /* AND les.use_yn = 'Y' */
        WHERE   modu.course_no = 1628
        ORDER   BY sort ASC, code ASC, sub_sort ASC, sub_no ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 126.539472  Lock_time: 0.001272 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502780;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 638609
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 126.550026  Lock_time: 0.001289 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502780;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 638609
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 177.180484  Lock_time: 0.000370 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502780;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 550632
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 20.809369  Lock_time: 0.001005 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502780;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 638609
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 20.818409  Lock_time: 0.001157 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430502780;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 638609
		AND    mag.auth_gbn = 10007

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 301.287932  Lock_time: 0.000405 Rows_sent: 98  Rows_examined: 175819
SET timestamp=1430502780;
SELECT   modu.module_no AS code
                ,modu.course_no
                ,modu.schedule_plan_de
                ,modu.sort
                ,sub.module_no AS sub_no 
                ,sub.subj_lesson_no
                ,sub.head_gbn
                ,(SELECT code_nm FROM ishomedb.tz_code WHERE code_gbn = 10129 AND code_no = sub.head_gbn) AS head_gbn_nm
                ,sub.contents_table
                ,sub.upper_no
                ,sub.sort AS sub_sort
                ,CONCAT('[', (SELECT code_nm FROM ishomedb.tz_code WHERE code_gbn = 10129 AND code_no = sub.head_gbn), ']', 
                    CASE
                    	WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)')  
						WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
						WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)')  
                    	WHEN les.lesson_gbn = 10001 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', sub.useq, '회차)') ELSE
                        CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN CONCAT(les.subj_lesson_nm, ' (', sub.useq, '회차)') ELSE
                        CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) END END) AS label
        FROM    ishomedb.tz_lms_module modu
        INNER   JOIN ishomedb.tz_lms_module sub
        ON      modu.module_no = sub.upper_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      sub.subj_lesson_no = les.subj_lesson_no
        LEFT OUTER JOIN	ishomedb.tz_lcms_study_lesson les1 
        ON les.upper_no = les1.subj_lesson_no
        LEFT OUTER JOIN ishomedb.tz_lcms_subj sbj 
        ON les.subj_no = sbj.subj_no
        /* AND les.use_yn = 'Y' */
        WHERE   modu.course_no = 1628
        ORDER   BY sort ASC, code ASC, sub_sort ASC, sub_no ASC;
# Time: 150502  2:53:01
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 278.461560  Lock_time: 0.000419 Rows_sent: 98  Rows_examined: 175819
SET timestamp=1430502781;
SELECT   modu.module_no AS code
                ,modu.course_no
                ,modu.schedule_plan_de
                ,modu.sort
                ,sub.module_no AS sub_no 
                ,sub.subj_lesson_no
                ,sub.head_gbn
                ,(SELECT code_nm FROM ishomedb.tz_code WHERE code_gbn = 10129 AND code_no = sub.head_gbn) AS head_gbn_nm
                ,sub.contents_table
                ,sub.upper_no
                ,sub.sort AS sub_sort
                ,CONCAT('[', (SELECT code_nm FROM ishomedb.tz_code WHERE code_gbn = 10129 AND code_no = sub.head_gbn), ']', 
                    CASE
                    	WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)')  
						WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
						WHEN les.lesson_gbn = 10001 AND sbj.subj_gbn = '10023' AND sub.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)')  
                    	WHEN les.lesson_gbn = 10001 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', sub.useq, '회차)') ELSE
                        CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN CONCAT(les.subj_lesson_nm, ' (', sub.useq, '회차)') ELSE
                        CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) END END) AS label
        FROM    ishomedb.tz_lms_module modu
        INNER   JOIN ishomedb.tz_lms_module sub
        ON      modu.module_no = sub.upper_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      sub.subj_lesson_no = les.subj_lesson_no
        LEFT OUTER JOIN	ishomedb.tz_lcms_study_lesson les1 
        ON les.upper_no = les1.subj_lesson_no
        LEFT OUTER JOIN ishomedb.tz_lcms_subj sbj 
        ON les.subj_no = sbj.subj_no
        /* AND les.use_yn = 'Y' */
        WHERE   modu.course_no = 1628
        ORDER   BY sort ASC, code ASC, sub_sort ASC, sub_no ASC;
# Time: 150502  2:53:11
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 322.662641  Lock_time: 0.001238 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430502791;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150502  2:54:15
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 59.792352  Lock_time: 0.001676 Rows_sent: 8202  Rows_examined: 1690425
SET timestamp=1430502855;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150502  2:54:36
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.019897  Lock_time: 0.000220 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430502876;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:55:05
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.741470  Lock_time: 0.000216 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430502905;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:55:18
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 9.955731  Lock_time: 0.000216 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430502918;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:55:28
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.682634  Lock_time: 0.000220 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430502928;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:55:38
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.732141  Lock_time: 0.000216 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430502938;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:55:55
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.453732  Lock_time: 0.000215 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430502955;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:56:09
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.300117  Lock_time: 0.000215 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430502969;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:56:20
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.198815  Lock_time: 0.000258 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430502980;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:56:33
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.824774  Lock_time: 0.000208 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430502993;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:56:57
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.306834  Lock_time: 0.000193 Rows_sent: 64476  Rows_examined: 211319
SET timestamp=1430503017;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150502  2:57:11
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.344959  Lock_time: 0.000160 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430503031;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150502  2:58:38
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 84.794536  Lock_time: 0.000276 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430503118;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150502  2:59:49
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.389759  Lock_time: 0.001653 Rows_sent: 1418  Rows_examined: 1629157
SET timestamp=1430503189;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150502  3:00:43
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 48.121947  Lock_time: 0.002347 Rows_sent: 5572  Rows_examined: 18899
SET timestamp=1430503243;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150502 14:00:33
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.466134  Lock_time: 0.000715 Rows_sent: 14399  Rows_examined: 2840587
SET timestamp=1430542833;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.02', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.02', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150503  2:31:08
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.711287  Lock_time: 0.000047 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430587868;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2010727w1821217';
# Time: 150503  2:32:50
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 414.711317  Lock_time: 0.001231 Rows_sent: 27236  Rows_examined: 254249
SET timestamp=1430587970;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150503  2:38:04
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.325763  Lock_time: 0.000047 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430588284;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2050129p5400127';
# Time: 150503  2:38:18
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 324.681822  Lock_time: 0.001275 Rows_sent: 4360  Rows_examined: 72265
SET timestamp=1430588298;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150503  2:43:26
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 302.519254  Lock_time: 0.000061 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430588606;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5627309';
# Time: 150503  2:43:42
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 320.077730  Lock_time: 0.000630 Rows_sent: 6245  Rows_examined: 58961
SET timestamp=1430588622;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150503  2:44:27
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 38.770221  Lock_time: 0.000123 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430588667;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150503  2:45:03
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 33.596477  Lock_time: 0.000138 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430588703;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150503  2:47:27
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.336752  Lock_time: 0.002506 Rows_sent: 2  Rows_examined: 9839272
SET timestamp=1430588847;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150503  2:53:09
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 306.059323  Lock_time: 0.000036 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430589189;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2080808w4804412';
# Time: 150503  2:53:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 328.731845  Lock_time: 0.001306 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430589196;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150503  2:54:19
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 60.165908  Lock_time: 0.001719 Rows_sent: 8202  Rows_examined: 1690425
SET timestamp=1430589259;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150503  2:54:41
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.243430  Lock_time: 0.000252 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430589281;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:55:11
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.716729  Lock_time: 0.000230 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430589311;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:55:22
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.787279  Lock_time: 0.000227 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430589322;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:55:33
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.867823  Lock_time: 0.000219 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430589333;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:55:42
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.992160  Lock_time: 0.000225 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430589342;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:55:59
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.335858  Lock_time: 0.000225 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430589359;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:56:13
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.198909  Lock_time: 0.000255 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430589373;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:56:24
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.201877  Lock_time: 0.000225 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430589384;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:56:38
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.220153  Lock_time: 0.000273 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430589398;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:57:03
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.544368  Lock_time: 0.000202 Rows_sent: 64476  Rows_examined: 211319
SET timestamp=1430589423;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150503  2:57:18
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.589138  Lock_time: 0.000159 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430589438;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150503  2:58:46
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 86.041056  Lock_time: 0.000238 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430589526;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150503  2:59:55
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.609403  Lock_time: 0.001838 Rows_sent: 1418  Rows_examined: 1629157
SET timestamp=1430589595;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150503  3:00:47
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 47.451234  Lock_time: 0.002397 Rows_sent: 5572  Rows_examined: 18899
SET timestamp=1430589647;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150503  7:46:20
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.068244  Lock_time: 0.000284 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430606780;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503  7:46:25
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.774136  Lock_time: 0.000210 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430606785;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503  7:47:41
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.562260  Lock_time: 0.000237 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430606861;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503  7:47:45
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.088237  Lock_time: 0.000222 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430606865;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503  7:47:53
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.092100  Lock_time: 0.000303 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430606873;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503  7:47:56
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.426301  Lock_time: 0.000208 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430606876;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503  7:59:56
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.920521  Lock_time: 0.000214 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430607596;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('윤혜영', '%')  
     
        ) a;
# Time: 150503  8:00:03
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.434015  Lock_time: 0.000160 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430607603;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('윤혜영', '%')  
     
        ) a;
# Time: 150503  8:00:07
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.832446  Lock_time: 0.000219 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430607607;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('윤혜영', '%')  
     
        ) a;
# Time: 150503 22:03:28
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.290215  Lock_time: 0.001270 Rows_sent: 14116  Rows_examined: 2788022
SET timestamp=1430658208;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.03', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.03', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150503 22:15:03
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.372870  Lock_time: 0.000234 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430658903;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('윤혜영', '%')  
     
        ) a;
# Time: 150503 22:15:06
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.431807  Lock_time: 0.000172 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430658906;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('윤혜영', '%')  
     
        ) a;
# Time: 150503 22:59:44
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.119905  Lock_time: 0.000219 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661584;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503 22:59:46
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.606289  Lock_time: 0.000361 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661586;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503 23:00:00
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 11.673571  Lock_time: 0.000667 Rows_sent: 10  Rows_examined: 10595830
SET timestamp=1430661600;
SELECT paid.split_paid_no
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN 'ⓗ' ELSE '' END AS reg_gbn_nm
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.user_id AS parent_id
              ,s_mem.user_id AS student_id
              ,mng_std.student_no
              ,CONCAT(p_mem.nm_kor, '<br />(' ,p_mem.login_id,')') AS p_mem_info /* 학부모정보 */
              ,CONCAT(s_mem.nm_kor, '<br />(' ,s_mem.login_id,')') AS s_mem_info /* 학습자정보 */
              ,prd.product_no /* 상품명 */
              ,prd.product_nm /* 상품명 */
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN '오프라인'    /* 2013-06-17 JHSUN 홈페이지->오프라인으로 변경 */
                    WHEN paid.reg_gbn = 'online' THEN '온라인'
                    ELSE '오프라인'
               END AS paid_gubun
              ,paid.batch_key /* 결제식별키 */
              ,paid.paid_day /* 청구일 */
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS app_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt /* 최초결제일 */
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt /* 최근승인일 */
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt /* 승인시도횟수 */
              ,pb.result_msg AS last_paid_status /* 최근승인요청결과 */
              ,purchase_code.code_nm AS status_gbn /* 구매상태 */
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor,  '<br />(' , manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,pb.result_code 
              ,CASE WHEN pur_ref.device_return_gbn = 'Y' THEN '기기반납'
                    WHEN pur_ref.device_return_gbn = 'N' THEN '기기양도'
                    WHEN pur_ref.device_return_gbn = 'U' THEN '해당없음'
               END AS device_return_gbn_nm
              ,h.code_nm AS purchase_device_gbn /* 구매단말기구분 */
              ,tdm.model_gbn as model_gbn /* 기기구분 */
              ,uf_code_nm(10230,tdm.model_gbn) as model_gbn_nm /* 기기구분명 */
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              , prd.service_reuse_yn
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
        /* 단말기 반납여부 */
        LEFT JOIN ishomedb.tz_purchase_refund pur_ref
        ON paid.purchase_no = pur_ref.purchase_no
        /* 구매단말기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
        /* 단말기 정보 */
        LEFT OUTER JOIN ishomedb.tz_device i
        ON pur.purchase_no = i.purchase_no
        AND i.status_gbn IN (10002, 10005, 10007)
        /* 모델구분 */
        LEFT OUTER JOIN ishomedb.tz_device_model tdm
        ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
               
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC
        LIMIT 340, 10;
# Time: 150503 23:00:04
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.385321  Lock_time: 0.000228 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661604;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503 23:00:07
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.911713  Lock_time: 0.000222 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661607;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503 23:00:10
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.879469  Lock_time: 0.000225 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661610;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 9.847765  Lock_time: 0.000265 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661610;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503 23:00:14
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.383381  Lock_time: 0.000525 Rows_sent: 10  Rows_examined: 10595830
SET timestamp=1430661614;
SELECT paid.split_paid_no
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN 'ⓗ' ELSE '' END AS reg_gbn_nm
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.user_id AS parent_id
              ,s_mem.user_id AS student_id
              ,mng_std.student_no
              ,CONCAT(p_mem.nm_kor, '<br />(' ,p_mem.login_id,')') AS p_mem_info /* 학부모정보 */
              ,CONCAT(s_mem.nm_kor, '<br />(' ,s_mem.login_id,')') AS s_mem_info /* 학습자정보 */
              ,prd.product_no /* 상품명 */
              ,prd.product_nm /* 상품명 */
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN '오프라인'    /* 2013-06-17 JHSUN 홈페이지->오프라인으로 변경 */
                    WHEN paid.reg_gbn = 'online' THEN '온라인'
                    ELSE '오프라인'
               END AS paid_gubun
              ,paid.batch_key /* 결제식별키 */
              ,paid.paid_day /* 청구일 */
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS app_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt /* 최초결제일 */
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt /* 최근승인일 */
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt /* 승인시도횟수 */
              ,pb.result_msg AS last_paid_status /* 최근승인요청결과 */
              ,purchase_code.code_nm AS status_gbn /* 구매상태 */
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor,  '<br />(' , manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,pb.result_code 
              ,CASE WHEN pur_ref.device_return_gbn = 'Y' THEN '기기반납'
                    WHEN pur_ref.device_return_gbn = 'N' THEN '기기양도'
                    WHEN pur_ref.device_return_gbn = 'U' THEN '해당없음'
               END AS device_return_gbn_nm
              ,h.code_nm AS purchase_device_gbn /* 구매단말기구분 */
              ,tdm.model_gbn as model_gbn /* 기기구분 */
              ,uf_code_nm(10230,tdm.model_gbn) as model_gbn_nm /* 기기구분명 */
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              , prd.service_reuse_yn
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
        /* 단말기 반납여부 */
        LEFT JOIN ishomedb.tz_purchase_refund pur_ref
        ON paid.purchase_no = pur_ref.purchase_no
        /* 구매단말기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
        /* 단말기 정보 */
        LEFT OUTER JOIN ishomedb.tz_device i
        ON pur.purchase_no = i.purchase_no
        AND i.status_gbn IN (10002, 10005, 10007)
        /* 모델구분 */
        LEFT OUTER JOIN ishomedb.tz_device_model tdm
        ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
               
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC
        LIMIT 340, 10;
# Time: 150503 23:00:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.552808  Lock_time: 0.001103 Rows_sent: 10  Rows_examined: 10595830
SET timestamp=1430661615;
SELECT paid.split_paid_no
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN 'ⓗ' ELSE '' END AS reg_gbn_nm
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.user_id AS parent_id
              ,s_mem.user_id AS student_id
              ,mng_std.student_no
              ,CONCAT(p_mem.nm_kor, '<br />(' ,p_mem.login_id,')') AS p_mem_info /* 학부모정보 */
              ,CONCAT(s_mem.nm_kor, '<br />(' ,s_mem.login_id,')') AS s_mem_info /* 학습자정보 */
              ,prd.product_no /* 상품명 */
              ,prd.product_nm /* 상품명 */
              ,CASE WHEN paid.reg_gbn = 'homepage' THEN '오프라인'    /* 2013-06-17 JHSUN 홈페이지->오프라인으로 변경 */
                    WHEN paid.reg_gbn = 'online' THEN '온라인'
                    ELSE '오프라인'
               END AS paid_gubun
              ,paid.batch_key /* 결제식별키 */
              ,paid.paid_day /* 청구일 */
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS app_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt /* 최초결제일 */
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt /* 최근승인일 */
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt /* 승인시도횟수 */
              ,pb.result_msg AS last_paid_status /* 최근승인요청결과 */
              ,purchase_code.code_nm AS status_gbn /* 구매상태 */
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor,  '<br />(' , manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,pb.result_code 
              ,CASE WHEN pur_ref.device_return_gbn = 'Y' THEN '기기반납'
                    WHEN pur_ref.device_return_gbn = 'N' THEN '기기양도'
                    WHEN pur_ref.device_return_gbn = 'U' THEN '해당없음'
               END AS device_return_gbn_nm
              ,h.code_nm AS purchase_device_gbn /* 구매단말기구분 */
              ,tdm.model_gbn as model_gbn /* 기기구분 */
              ,uf_code_nm(10230,tdm.model_gbn) as model_gbn_nm /* 기기구분명 */
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              , prd.service_reuse_yn
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
        /* 단말기 반납여부 */
        LEFT JOIN ishomedb.tz_purchase_refund pur_ref
        ON paid.purchase_no = pur_ref.purchase_no
        /* 구매단말기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
        /* 단말기 정보 */
        LEFT OUTER JOIN ishomedb.tz_device i
        ON pur.purchase_no = i.purchase_no
        AND i.status_gbn IN (10002, 10005, 10007)
        /* 모델구분 */
        LEFT OUTER JOIN ishomedb.tz_device_model tdm
        ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
               
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC
        LIMIT 340, 10;
# Time: 150503 23:00:22
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.990732  Lock_time: 0.000322 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661622;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503 23:00:23
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 8.422846  Lock_time: 0.000258 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430661623;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('박현아', '%')  
     
        ) a;
# Time: 150503 23:20:18
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.814794  Lock_time: 0.000325 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430662818;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('한지연', '%')  
     
        ) a;
# Time: 150503 23:20:20
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 7.848065  Lock_time: 0.000305 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430662820;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('한지연', '%')  
     
        ) a;
# Time: 150503 23:21:11
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.771419  Lock_time: 0.000178 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430662871;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('한지연', '%')  
     
        ) a;
# Time: 150503 23:21:21
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.716583  Lock_time: 0.000180 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430662881;
SELECT
            COUNT(a.split_paid_no)
        FROM
        (
            SELECT DISTINCT paid.split_paid_no
            FROM ishomedb.tz_split_paid paid 
            LEFT OUTER JOIN ishomedb.tz_purchase pur 
            ON paid.purchase_no = pur.purchase_no
            LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
            ON paid.split_paid_no = pb.split_paid_no
            /* 신청자정보 */
            LEFT JOIN ishomedb.tz_member p_mem
            ON paid.parent_id = p_mem.user_id
            /* 학습자정보 */
            LEFT JOIN ishomedb.tz_member s_mem
            ON paid.student_id = s_mem.user_id
            /* 담당자 - 담당선생  */
            LEFT JOIN ishomedb.tz_student mng_std
            ON paid.student_id = mng_std.student_id
            LEFT JOIN ishomedb.tz_member upd_mem
            ON mng_std.teacher_id = upd_mem.user_id
            /* 출하상태  10118 */
            LEFT JOIN ishomedb.tz_code purchase_code
            ON pur.status_gbn = purchase_code.code_no
            AND purchase_code.code_gbn = 10118
            /* 월결제상태  10177 */
            LEFT JOIN ishomedb.tz_code code
            ON paid.paid_status = code.code_no
            AND code.code_gbn = 10177
            LEFT OUTER JOIN ishomedb.tz_teacher tec
            ON tec.teacher_id = upd_mem.user_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = tec.part_no
            /* 담당자 정보 */
            LEFT JOIN ishomedb.tz_member manage_mem
            ON paid.manage_id = manage_mem.user_id
            /* 구매단말기구분  10218 */
            LEFT OUTER JOIN ishomedb.tz_code h 
            ON h.code_no = pur.purchase_device_gbn AND h.use_yn = 'Y' AND h.code_gbn = 10218
            /* 단말기 정보 */
            LEFT OUTER JOIN ishomedb.tz_device i
            ON pur.purchase_no = i.purchase_no
            AND i.status_gbn IN (10002, 10005, 10007)
            /* 모델구분 */
            LEFT OUTER JOIN ishomedb.tz_device_model tdm
            ON i.model_code = tdm.model_code
         
  
         WHERE  manage_mem.nm_kor LIKE CONCAT('한지연', '%')  
     
        ) a;
# Time: 150504  2:31:30
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 221.935092  Lock_time: 0.000087 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430674290;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '8e6a8a1f96b54cc7b5e25734bcd36b19';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 202.835396  Lock_time: 0.001743 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430674290;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.28'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.05'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
            AND IFNULL(stu.end_de, NOW())  >=  DATE_FORMAT(NOW(), '%Y-%m-%d')
             
                         
             
             
             
             
            AND ttt.team_no = '###'
             
             
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
          ORDER BY manage_start_de DESC 
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
        LIMIT   0, 100;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 165.123196  Lock_time: 0.000120 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430674290;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 343645;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 159.850616  Lock_time: 0.000124 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430674290;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 343645;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 131.930598  Lock_time: 0.000116 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430674290;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 236215;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 164.391318  Lock_time: 0.000079 Rows_sent: 1  Rows_examined: 70
SET timestamp=1430674290;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 236215
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 123.032307  Lock_time: 0.000168 Rows_sent: 1  Rows_examined: 70
SET timestamp=1430674290;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 236215
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 201.882143  Lock_time: 0.001764 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430674290;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.28'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.05'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
            AND IFNULL(stu.end_de, NOW())  >=  DATE_FORMAT(NOW(), '%Y-%m-%d')
             
                         
             
             
             
             
            AND ttt.team_no = '###'
             
             
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
          ORDER BY manage_start_de DESC 
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
        LIMIT   0, 100;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 258.691394  Lock_time: 0.000297 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 259.772083  Lock_time: 0.000332 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 257.957292  Lock_time: 0.000321 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 259.428501  Lock_time: 0.000318 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 267.546688  Lock_time: 0.000222 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430674290;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972561870'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 286.278367  Lock_time: 0.000250 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430674290;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972561870'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 281.069813  Lock_time: 0.000202 Rows_sent: 1  Rows_examined: 25
SET timestamp=1430674290;
SELECT DISTINCT 
		         'Y' AS is_finish
		        ,st.f_test_id
		        ,st.f_ischeckpoint
		        ,st.f_stu_test_id
		        ,t.f_problem_cnt
		        ,SUM(IF(stp.f_result='1', 1, 0)) AS f_correct_cnt
		        ,SUM(IF(stp.f_result   <>   '1', 1, 0)) AS f_incorrect_cnt
		        ,st.f_point
		        ,st2.f_test_dt         /* 틀린문제 풀이 날짜 (틀린문제 풀이 유무 판단) */
		FROM edubasestudydb.t_student_test st
		INNER JOIN edubasestudydb.t_test t
		        ON t.f_test_id = st.f_test_id	
		LEFT OUTER JOIN edubasestudydb.t_student_test2 st2
		        ON st2.f_stu_test_id = st.f_stu_test_id AND st2.f_kind_cd = '01'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		        ON stp.f_stu_test_id = st.f_stu_test_id
		WHERE st.f_stu_test_id = '972561870'
		LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 223.243549  Lock_time: 0.000116 Rows_sent: 7  Rows_examined: 6742
SET timestamp=1430674290;
SELECT  group_no AS code
               ,group_nm AS label
        FROM   ishomedb.tz_student_group 
        WHERE  teacher_id = '321941'
        ORDER  BY group_nm ASC;
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 301.788528  Lock_time: 0.000105 Rows_sent: 1  Rows_examined: 7329
SET timestamp=1430674290;
SELECT concat(sk.subj_knd_nm_short, ' ', bp.start_page, '~', bp.end_page) as result
					 FROM ishomedb.tz_lcms_book_page bp
					 INNER JOIN ishomedb.tz_lcms_subj_knd sk
					 ON sk.subj_knd_no = bp.subj_knd_no
					 WHERE EXISTS (
								 SELECT 1
								 FROM ishomedb.tz_lcms_study_lesson l
								 INNER JOIN ishomedb.tz_lcms_subj s
								 ON l.subj_no = s.subj_no
								 WHERE l.subj_lesson_no = bp.subj_lesson_no
								 and l.subj_no = 27
								 and l.subj_lesson_no = 117
							 );
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 259.598414  Lock_time: 0.000342 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 273.359386  Lock_time: 0.000380 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 260.380955  Lock_time: 0.000331 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 268.595962  Lock_time: 0.000358 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 142.298655  Lock_time: 0.000117 Rows_sent: 1  Rows_examined: 3485
SET timestamp=1430674290;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 343645;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 143.913221  Lock_time: 0.000130 Rows_sent: 1  Rows_examined: 3485
SET timestamp=1430674290;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 343645;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 233.520234  Lock_time: 0.000982 Rows_sent: 3  Rows_examined: 28
SET timestamp=1430674290;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972560120
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 244.726831  Lock_time: 0.000940 Rows_sent: 6  Rows_examined: 31
SET timestamp=1430674290;
select
             a.f_stu_test_id
            ,a.f_test_id
            ,a.f_user_cd
            ,c.f_subject_cd /*과목CD */
            ,c.f_grade_cd /*학년CD */
            ,c.f_kind_cd
            ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
            ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all       
            ,m.login_id
            ,m.user_id
            /*명칭*/
            ,m.nm_kor user_nm
            ,m.class_nm
            ,d.f_point
            ,b.f_rpoint
            ,(case when b.f_input_path is null then '' else b.f_input_path end) f_input_path
            ,b.f_result
            ,b.f_num
            ,d.f_problem_id
            ,b.f_advice
            ,b.f_input
            ,'0' re_score
        from
            edubasestudydb.t_student_test a
            inner join ishomedb.tz_student s on a.f_user_cd  = s.student_no
            inner join ishomedb.tz_member  m on s.student_id = m.user_id
           ,edubasestudydb.t_student_test_problem b
           ,edubasestudydb.t_test c
           ,edubasestudydb.t_test_problem d
        where 1=1
          and a.f_stu_test_id  = b.f_stu_test_id
          and a.f_test_id      = c.f_test_id
          and a.f_test_id      = d.f_test_id
          and b.f_num          = d.f_num
          and a.f_stu_test_id = 972561870
           
              and b.f_result = 'A' /* 채점해야할문항만 */
           
           
          order by f_num;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 263.948385  Lock_time: 0.000331 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 266.070787  Lock_time: 0.000353 Rows_sent: 3  Rows_examined: 1568
SET timestamp=1430674290;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-08'
        AND    l.consult_dt   <   date_add('2015-05-08', interval +1 day)
        AND    l.teacher_id = 343645
        
         
                ORDER BY l.consult_dt DESC;
# Time: 150504  2:31:31
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 167.712914  Lock_time: 0.001685 Rows_sent: 111  Rows_examined: 206693
SET timestamp=1430674291;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 343645
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 169.941168  Lock_time: 0.001386 Rows_sent: 111  Rows_examined: 206693
SET timestamp=1430674291;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 343645
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 168.287428  Lock_time: 0.001360 Rows_sent: 111  Rows_examined: 206693
SET timestamp=1430674291;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 343645
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 123.562472  Lock_time: 0.001200 Rows_sent: 159  Rows_examined: 8214
SET timestamp=1430674291;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 236215
		AND    mag.auth_gbn = 10005

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 165.007216  Lock_time: 0.001106 Rows_sent: 159  Rows_examined: 8214
SET timestamp=1430674291;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 236215
		AND    mag.auth_gbn = 10005

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 165.008954  Lock_time: 0.001076 Rows_sent: 159  Rows_examined: 8214
SET timestamp=1430674291;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 236215
		AND    mag.auth_gbn = 10005

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 168.065126  Lock_time: 0.001227 Rows_sent: 111  Rows_examined: 206693
SET timestamp=1430674291;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 343645
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 218.670012  Lock_time: 0.001633 Rows_sent: 120  Rows_examined: 224777
SET timestamp=1430674291;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 309552
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 210.103163  Lock_time: 0.001809 Rows_sent: 100  Rows_examined: 437816
SET timestamp=1430674291;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.28'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.05'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
            AND IFNULL(stu.end_de, NOW())  >=  DATE_FORMAT(NOW(), '%Y-%m-%d')
             
                         
             
             
             
             
            AND ttt.team_no = '48'
             
             
            AND ttp.part_no = '170'
             
             
            AND stu.teacher_id = '321941'
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
          ORDER BY act_rate_month ASC 
        LIMIT   0, 100;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 223.776361  Lock_time: 0.001481 Rows_sent: 100  Rows_examined: 437816
SET timestamp=1430674291;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.28'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.05'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
            AND IFNULL(stu.end_de, NOW())  >=  DATE_FORMAT(NOW(), '%Y-%m-%d')
             
                         
             
             
             
             
            AND ttt.team_no = '48'
             
             
            AND ttp.part_no = '170'
             
             
            AND stu.teacher_id = '321941'
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
          ORDER BY act_rate_month ASC 
        LIMIT   0, 100;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 217.527932  Lock_time: 0.001340 Rows_sent: 100  Rows_examined: 437816
SET timestamp=1430674291;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.28'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.05'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
            AND IFNULL(stu.end_de, NOW())  >=  DATE_FORMAT(NOW(), '%Y-%m-%d')
             
                         
             
             
             
             
            AND ttt.team_no = '48'
             
             
            AND ttp.part_no = '170'
             
             
            AND stu.teacher_id = '321941'
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
          ORDER BY act_rate_month ASC 
        LIMIT   0, 100;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 208.520452  Lock_time: 0.001886 Rows_sent: 100  Rows_examined: 437816
SET timestamp=1430674291;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.28'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.05'
                    AND lpm.plan_de <= '2015.05.04'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           '-' 
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
            AND IFNULL(stu.end_de, NOW())  >=  DATE_FORMAT(NOW(), '%Y-%m-%d')
             
                         
             
             
             
             
            AND ttt.team_no = '48'
             
             
            AND ttp.part_no = '170'
             
             
            AND stu.teacher_id = '321941'
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
          ORDER BY act_rate_month ASC 
        LIMIT   0, 100;
# Time: 150504  2:32:59
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 420.301498  Lock_time: 0.001330 Rows_sent: 27236  Rows_examined: 254249
SET timestamp=1430674379;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150504  2:38:15
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 20.511143  Lock_time: 0.000215 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430674695;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 281360;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 277.109476  Lock_time: 0.000067 Rows_sent: 3  Rows_examined: 6
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '148'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 291.758220  Lock_time: 0.000070 Rows_sent: 4  Rows_examined: 8
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '127'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 275.362994  Lock_time: 0.000067 Rows_sent: 5  Rows_examined: 10
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '136'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 300.446829  Lock_time: 0.000114 Rows_sent: 14  Rows_examined: 28
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '199'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 275.739903  Lock_time: 0.000069 Rows_sent: 5  Rows_examined: 10
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '87'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 271.903318  Lock_time: 0.000072 Rows_sent: 10  Rows_examined: 28
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '207'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 278.519565  Lock_time: 0.000069 Rows_sent: 14  Rows_examined: 28
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '199'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 280.127457  Lock_time: 0.000068 Rows_sent: 14  Rows_examined: 28
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '199'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 306.341854  Lock_time: 0.000048 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430674695;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2050129p5400127';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 165.829838  Lock_time: 0.000221 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430674695;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 309552;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 302.358519  Lock_time: 0.000088 Rows_sent: 14  Rows_examined: 28
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '199'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 289.598808  Lock_time: 0.000545 Rows_sent: 10  Rows_examined: 280208
SET timestamp=1430674695;
SELECT qna.qna_no
              ,mem.nm_kor
              ,mem.login_id
              ,IFNULL(grp.group_nm, '미지정') AS group_nm
              ,ishomedb.uf_code_grade_nm(stu.grade_gbn) AS grade_gbn
              ,(select nm_kor from ishomedb.tz_member mem where mem.user_id = stu.teacher_id) AS teacher_nm_kor
              ,stu.student_no
              ,stu.student_id
              ,qna.question_content
              ,qna.question_dt
              ,qna.answer_dt
              ,qna.toss_id
              ,(select nm_kor from ishomedb.tz_member mem where mem.user_id = qna.toss_id) AS toss_nm_kor  
              ,qna.toss_id
              ,CASE WHEN qna.toss_id IS NOT NULL THEN '0' 
                    ELSE '1'
                    END AS toss_gbn
              ,qna.question_gbn
        FROM ishomedb.tz_student stu
        INNER   JOIN ishomedb.tz_member mem
        ON      stu.student_id = mem.user_id
        INNER JOIN ishomedb.tz_lms_qna qna
        ON stu.student_no = qna.student_no
        LEFT    OUTER JOIN ishomedb.tz_student_group grp
        ON      stu.group_no = grp.group_no
         
        
         
           
     
        
        ORDER   BY
        
         
         
         qna.question_dt DESC      
        
        LIMIT  0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 306.056283  Lock_time: 0.000083 Rows_sent: 14  Rows_examined: 28
SET timestamp=1430674695;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '199'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 270.588597  Lock_time: 0.000255 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430674695;
SELECT IFNULL(COUNT(a.f_errreport_id), 0)
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no 
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt ON ttt.team_no = ttp.team_no        
         
        LEFT JOIN (
            SELECT l.*
            FROM ishomedb.tz_errreport_log l
            LEFT JOIN ishomedb.tz_member m
            ON l.reg_id = m.user_id 
             WHERE  1 = 1 
            GROUP BY l.errreport_id
        ) l
        ON a.f_errreport_id = l.errreport_id
         
       
         
         WHERE  m.login_id = '###'
                 
            
            
                 
                        AND s.teacher_id = 236215;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 20.411136  Lock_time: 0.001209 Rows_sent: 52  Rows_examined: 8094
SET timestamp=1430674695;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 281360
		AND    mag.auth_gbn = 10028

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150504  2:38:17
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 274.030878  Lock_time: 0.001362 Rows_sent: 10  Rows_examined: 1243217
SET timestamp=1430674697;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd  /*과목CD */
		    ,c.f_grade_cd    /*학년CD */
		    ,c.f_kind_cd
		    ,date_format(a.f_test_dt, '%Y.%m.%d %H:%i:%s') f_test_dt /*평가일*/
		    ,ifnull(date_format(a.f_checkpoint_dt, '%Y.%m.%d %H:%i:%s'), '미채점') f_checkpoint_dt /*채점일*/
		    ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
		    ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all
		    ,m.login_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.student_id
		    ,mem.nm_kor as teacher_name   /* 선생님 성함 */
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
		    ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
		    ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
		FROM (
		    SELECT st.*
		        ,ist.student_no
		        ,ist.student_id
		        ,ist.teacher_id
		        ,ist.group_no
		    FROM edubasestudydb.t_student_test st
		    INNER JOIN (
		        SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
		        FROM edubasestudydb.t_student_test st
		        INNER JOIN ishomedb.tz_student s 
		        ON st.f_user_cd = s.student_no
		        INNER JOIN ishomedb.tz_teacher t
		        ON t.teacher_id = s.teacher_id
		        INNER JOIN ishomedb.tz_teacher_team_part ttp
		        ON ttp.part_no = t.part_no
		        WHERE DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
                 
                    AND ttp.team_no = '7'
                 
                 
                 
		        GROUP BY f_test_id, f_user_cd
		    ) ist
		    ON st.f_stu_test_id = ist.f_stu_test_id
		) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id
		LEFT OUTER JOIN ishomedb.tz_member mem
        ON a.teacher_id = mem.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
		WHERE IFNULL(pur.status_gbn, '') != 10010 /* 환불완료 제외 */
         
         
            AND a.f_ischeckpoint = 'N'
         
         
		 
		 
		 
       
		GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no
         
        LIMIT 0, 10;
# Time: 150504  2:38:29
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 326.812853  Lock_time: 0.001389 Rows_sent: 4360  Rows_examined: 72265
SET timestamp=1430674709;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150504  2:43:35
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 300.377181  Lock_time: 0.000062 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5626883';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 206.585763  Lock_time: 0.000083 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '6bf629e7f1fa4b90aaf9b3b456a0baa0';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 206.846342  Lock_time: 0.000083 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '6bf629e7f1fa4b90aaf9b3b456a0baa0';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 207.108000  Lock_time: 0.000083 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '6bf629e7f1fa4b90aaf9b3b456a0baa0';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 111.334276  Lock_time: 0.000146 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430675015;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 281360;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 206.035677  Lock_time: 0.000136 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 281360;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 210.567280  Lock_time: 0.000066 Rows_sent: 4  Rows_examined: 8
SET timestamp=1430675015;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '152'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 205.733318  Lock_time: 0.000105 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 281360;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 212.937479  Lock_time: 0.000178 Rows_sent: 1  Rows_examined: 3
SET timestamp=1430675015;
select  user_id
               ,login_id
               ,nm_kor
               ,jumin_no1
               ,tel1
               ,tel2
               ,tel3
               ,mobile1
               ,mobile2
               ,mobile3
               ,email
               ,zipcode
               ,addr1
               ,addr2
               ,(select reg_dt from ishomedb.tz_teacher where teacher_id = user_id) as reg_dt
               ,(select recom_id from ishomedb.tz_teacher where teacher_id = user_id) as recom_id
          from  ishomedb.tz_member
         where  user_id = 281360;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 218.755397  Lock_time: 0.000202 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT IF(tch.teacher_id != '', 'Y', 'N') AS teacher_yn,    /* 선생님 여부 */
               tch.teacher_id,                                      /* 선생님 아이디 */
               tm.nm_kor,                                           /* 선생님 성명 */               
               tc.corp_no,                                          /* 제휴사 코드 */
               tc.corp_nm,                                          /* 제휴사 명*/
               tc.leader_id AS corp_leader_id,                      /* 제휴사 관리자 아이디 */
               tt.team_no,                                          /* 팀 코드 */
               tt.team_nm,                                          /* 팀 명 */
               tt.leader_id AS team_leader_id,                      /* 팀 관리자 아이디 */
               tp.part_no,                                          /* 파트 코드 */
               tp.part_nm,                                          /* 파트 명 */
               tp.leader_id AS part_leader_id                       /* 파트 관리자 아이디 */
          FROM ishomedb.tz_member tm
               LEFT OUTER JOIN ishomedb.tz_teacher tch
                  ON tch.teacher_id = tm.user_id AND tch.active_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_team_part tp
                  ON tp.part_no = tch.part_no AND tp.use_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_team tt
                  ON tt.team_no = tp.team_no AND tt.use_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_corp tc
                  ON tc.corp_no = tt.corp_no AND tt.use_yn = 'Y'
         WHERE tm.user_id = '281360';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.595581  Lock_time: 0.000210 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT IF(tch.teacher_id != '', 'Y', 'N') AS teacher_yn,    /* 선생님 여부 */
               tch.teacher_id,                                      /* 선생님 아이디 */
               tm.nm_kor,                                           /* 선생님 성명 */               
               tc.corp_no,                                          /* 제휴사 코드 */
               tc.corp_nm,                                          /* 제휴사 명*/
               tc.leader_id AS corp_leader_id,                      /* 제휴사 관리자 아이디 */
               tt.team_no,                                          /* 팀 코드 */
               tt.team_nm,                                          /* 팀 명 */
               tt.leader_id AS team_leader_id,                      /* 팀 관리자 아이디 */
               tp.part_no,                                          /* 파트 코드 */
               tp.part_nm,                                          /* 파트 명 */
               tp.leader_id AS part_leader_id                       /* 파트 관리자 아이디 */
          FROM ishomedb.tz_member tm
               LEFT OUTER JOIN ishomedb.tz_teacher tch
                  ON tch.teacher_id = tm.user_id AND tch.active_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_team_part tp
                  ON tp.part_no = tch.part_no AND tp.use_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_team tt
                  ON tt.team_no = tp.team_no AND tt.use_yn = 'Y'
               LEFT OUTER JOIN ishomedb.tz_teacher_corp tc
                  ON tc.corp_no = tt.corp_no AND tt.use_yn = 'Y'
         WHERE tm.user_id = '281360';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 214.116305  Lock_time: 0.000090 Rows_sent: 571  Rows_examined: 1420
SET timestamp=1430675015;
SELECT  a.teacher_id AS code
               ,par.nm_kor AS label
               
        FROM   ishomedb.tz_teacher a
  
        LEFT OUTER JOIN ishomedb.tz_member par
        ON   a.teacher_id = par.user_id
        
         WHERE  a.active_yn = "Y";
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 211.325488  Lock_time: 0.001114 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675015;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '143'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '143'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '143'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '143'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 15
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 209.853509  Lock_time: 0.000066 Rows_sent: 7  Rows_examined: 16
SET timestamp=1430675015;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '212'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 210.196992  Lock_time: 0.000067 Rows_sent: 5  Rows_examined: 11
SET timestamp=1430675015;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '142'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 254.316541  Lock_time: 0.000550 Rows_sent: 1  Rows_examined: 6
SET timestamp=1430675015;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '265746';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.644682  Lock_time: 0.000659 Rows_sent: 25  Rows_examined: 6298
SET timestamp=1430675015;
SELECT tp.purchase_no                                   /* 주문번호 */
        , CONCAT(prt.nm_kor,'(',prt.login_id,')') as prt_nm     /* 학부모이름(아이디) */
        , CONCAT(stu.nm_kor,'(',stu.login_id,')') as stu_nm     /* 학습자이름(아이디) */
        , tpp.product_nm                                        /* 상품명 */
        , tp.start_de as start_de                               /* 학습기간 시작일 */
        , tp.end_de as end_de                                   /* 학습기간 종료일 */          
        , h.code_nm as status_gbn_nm                               /* 단말기상태 */
        , i.code_nm as device_gbn_nm                               /* 기기구분 */
        , prt.user_id
        , ts.student_no
        , ts.student_id
        , tp.withdraw_invoice_no
        , DATE_FORMAT(tp.withdraw_req_dt, '%Y-%m-%d') AS withdraw_req_dt
        , tp.status_gbn as p_status_gbn
        , td.status_gbn as d_status_gbn
        , uf_code_nm(10118,tp.status_gbn) as p_status_gbn_nm
        FROM ishomedb.tz_student ts
        /* 구매정보 */
        INNER JOIN ishomedb.tz_purchase tp 
        ON tp.student_id = ts.student_id 
        /* 상품정보 */
        INNER JOIN ishomedb.tz_product tpp 
        ON tpp.product_no = tp.product_no
        /* 기기정보 */
        LEFT OUTER JOIN ishomedb.tz_device td 
        ON td.purchase_no = tp.purchase_no
        /* 학생정보 */ 
        INNER JOIN ishomedb.tz_member stu 
        ON stu.user_id = ts.student_id
        /* 학부모정보 */
        INNER JOIN ishomedb.tz_member prt 
        ON prt.user_id = stu.parent_id        
        /* 단말기상태  10200 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = td.status_gbn AND h.code_gbn = 10200
        /* 기기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code i 
        ON i.code_no = td.device_gbn AND i.code_gbn = 10218
        /* 교사정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = ts.teacher_id
        /* 교사팀/파트 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
         
         WHERE  (
            (tp.status_gbn = 10006 and td.status_gbn = 10006)
            OR 
            (
            DATEDIFF(NOW(),tp.ship_dt) > 15 AND tp.end_de is null AND tp.status_gbn != 10016 AND tp.status_gbn != 10014
            )
            
            OR 
            (
            tp.status_gbn = 10016 OR td.status_gbn = 10003 
            )
            
            )
            
            
            
            
            
            
                AND tec.teacher_id = '281360'  
     
        ORDER BY tp.purchase_dt DESC
        LIMIT 0, 25;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 218.807526  Lock_time: 0.000689 Rows_sent: 25  Rows_examined: 6298
SET timestamp=1430675015;
SELECT tp.purchase_no                                   /* 주문번호 */
        , CONCAT(prt.nm_kor,'(',prt.login_id,')') as prt_nm     /* 학부모이름(아이디) */
        , CONCAT(stu.nm_kor,'(',stu.login_id,')') as stu_nm     /* 학습자이름(아이디) */
        , tpp.product_nm                                        /* 상품명 */
        , tp.start_de as start_de                               /* 학습기간 시작일 */
        , tp.end_de as end_de                                   /* 학습기간 종료일 */          
        , h.code_nm as status_gbn_nm                               /* 단말기상태 */
        , i.code_nm as device_gbn_nm                               /* 기기구분 */
        , prt.user_id
        , ts.student_no
        , ts.student_id
        , tp.withdraw_invoice_no
        , DATE_FORMAT(tp.withdraw_req_dt, '%Y-%m-%d') AS withdraw_req_dt
        , tp.status_gbn as p_status_gbn
        , td.status_gbn as d_status_gbn
        , uf_code_nm(10118,tp.status_gbn) as p_status_gbn_nm
        FROM ishomedb.tz_student ts
        /* 구매정보 */
        INNER JOIN ishomedb.tz_purchase tp 
        ON tp.student_id = ts.student_id 
        /* 상품정보 */
        INNER JOIN ishomedb.tz_product tpp 
        ON tpp.product_no = tp.product_no
        /* 기기정보 */
        LEFT OUTER JOIN ishomedb.tz_device td 
        ON td.purchase_no = tp.purchase_no
        /* 학생정보 */ 
        INNER JOIN ishomedb.tz_member stu 
        ON stu.user_id = ts.student_id
        /* 학부모정보 */
        INNER JOIN ishomedb.tz_member prt 
        ON prt.user_id = stu.parent_id        
        /* 단말기상태  10200 */
        LEFT OUTER JOIN ishomedb.tz_code h 
        ON h.code_no = td.status_gbn AND h.code_gbn = 10200
        /* 기기구분  10218 */
        LEFT OUTER JOIN ishomedb.tz_code i 
        ON i.code_no = td.device_gbn AND i.code_gbn = 10218
        /* 교사정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = ts.teacher_id
        /* 교사팀/파트 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
         
         WHERE  (
            (tp.status_gbn = 10006 and td.status_gbn = 10006)
            OR 
            (
            DATEDIFF(NOW(),tp.ship_dt) > 15 AND tp.end_de is null AND tp.status_gbn != 10016 AND tp.status_gbn != 10014
            )
            
            OR 
            (
            tp.status_gbn = 10016 OR td.status_gbn = 10003 
            )
            
            )
            
            
            
            
            
            
                AND tec.teacher_id = '281360'  
     
        ORDER BY tp.purchase_dt DESC
        LIMIT 0, 25;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 209.644430  Lock_time: 0.000983 Rows_sent: 17  Rows_examined: 23844
SET timestamp=1430675015;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '146'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '146'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '146'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '146'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 15
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 207.486174  Lock_time: 0.000988 Rows_sent: 16  Rows_examined: 26556
SET timestamp=1430675015;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '161'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '161'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '161'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '161'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 15
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 207.790781  Lock_time: 0.000990 Rows_sent: 16  Rows_examined: 26556
SET timestamp=1430675015;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '161'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '161'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '161'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '161'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.03', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.04', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 15
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 204.542349  Lock_time: 0.001138 Rows_sent: 52  Rows_examined: 8094
SET timestamp=1430675015;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 281360
		AND    mag.auth_gbn = '10028'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 143.685618  Lock_time: 0.001185 Rows_sent: 52  Rows_examined: 8094
SET timestamp=1430675015;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 281360
		AND    mag.auth_gbn = '10028'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 143.683967  Lock_time: 0.001030 Rows_sent: 52  Rows_examined: 8094
SET timestamp=1430675015;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 281360
		AND    mag.auth_gbn = '10028'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150504  2:43:52
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 319.046485  Lock_time: 0.000640 Rows_sent: 6245  Rows_examined: 58961
SET timestamp=1430675032;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150504  2:44:35
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 37.555312  Lock_time: 0.000128 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430675075;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150504  2:45:11
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 32.723265  Lock_time: 0.000151 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430675111;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150504  2:47:35
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.369897  Lock_time: 0.002143 Rows_sent: 2  Rows_examined: 9839272
SET timestamp=1430675255;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150504  2:53:18
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 306.176587  Lock_time: 0.000051 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430675598;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5458676';
# Time: 150504  2:53:24
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 328.768949  Lock_time: 0.001292 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430675604;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150504  2:54:26
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 58.363687  Lock_time: 0.001820 Rows_sent: 8202  Rows_examined: 1690425
SET timestamp=1430675666;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150504  2:54:47
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.029452  Lock_time: 0.000257 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430675687;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:55:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.208888  Lock_time: 0.000224 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430675716;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:55:29
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.041136  Lock_time: 0.000221 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430675729;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:55:39
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.450422  Lock_time: 0.000278 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430675739;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:55:49
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.144282  Lock_time: 0.000251 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430675749;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:56:05
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 13.937661  Lock_time: 0.000224 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430675765;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:56:20
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.482422  Lock_time: 0.000252 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430675780;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:56:31
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.295916  Lock_time: 0.000146 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430675791;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:56:44
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.966462  Lock_time: 0.000254 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430675804;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  2:57:09
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.609525  Lock_time: 0.000203 Rows_sent: 64476  Rows_examined: 211319
SET timestamp=1430675829;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150504  2:57:23
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.302220  Lock_time: 0.000165 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430675843;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150504  2:58:51
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 86.284890  Lock_time: 0.000238 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430675931;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150504  3:00:00
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.882691  Lock_time: 0.001816 Rows_sent: 1418  Rows_examined: 1629157
SET timestamp=1430676000;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150504  3:00:53
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 47.512878  Lock_time: 0.002415 Rows_sent: 5572  Rows_examined: 18899
SET timestamp=1430676053;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150504  8:45:30
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 22.853267  Lock_time: 0.000707 Rows_sent: 14851  Rows_examined: 66936023
SET timestamp=1430696730;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150504  8:45:57
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 23.773185  Lock_time: 0.000404 Rows_sent: 14851  Rows_examined: 66936026
SET timestamp=1430696757;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150504  8:46:14
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 23.634881  Lock_time: 0.000629 Rows_sent: 14851  Rows_examined: 66936026
SET timestamp=1430696774;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150504 10:26:45
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 6.120451  Lock_time: 0.000592 Rows_sent: 3697  Rows_examined: 2857721
SET timestamp=1430702805;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 3235
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
            
              AND a.f_ischeckpoint = 'Y'
           
           
           
           
              AND c.f_kind_cd = 'T120'
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# Time: 150504 11:11:00
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 21.919742  Lock_time: 0.000379 Rows_sent: 14915  Rows_examined: 67238662
SET timestamp=1430705460;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150504 11:50:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 22.075498  Lock_time: 0.000396 Rows_sent: 14920  Rows_examined: 67275569
SET timestamp=1430707815;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150504 13:38:14
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 11.320220  Lock_time: 0.000508 Rows_sent: 30  Rows_examined: 5927726
SET timestamp=1430714294;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150504 14:03:05
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 16.762281  Lock_time: 0.000278 Rows_sent: 15  Rows_examined: 3091339
SET timestamp=1430715785;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150504 14:57:14
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.049649  Lock_time: 0.000401 Rows_sent: 30  Rows_examined: 5927820
SET timestamp=1430719034;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150504 15:15:51
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 6.119042  Lock_time: 0.000539 Rows_sent: 4039  Rows_examined: 3268295
SET timestamp=1430720151;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 123491
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
            
              AND a.f_ischeckpoint = 'Y'
           
           
           
           
              AND c.f_kind_cd = 'T120'
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# Time: 150504 15:41:10
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.898108  Lock_time: 0.000552 Rows_sent: 13925  Rows_examined: 2747524
SET timestamp=1430721670;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.04', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.04', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150504 17:56:32
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.019489  Lock_time: 0.000223 Rows_sent: 8  Rows_examined: 996449
SET timestamp=1430729792;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150504 17:56:42
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.200954  Lock_time: 0.000368 Rows_sent: 8  Rows_examined: 996449
SET timestamp=1430729802;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150504 17:59:22
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 17.315200  Lock_time: 0.000147 Rows_sent: 15  Rows_examined: 3091650
SET timestamp=1430729962;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150504 17:59:47
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 16.698898  Lock_time: 0.000208 Rows_sent: 15  Rows_examined: 3091650
SET timestamp=1430729987;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150504 21:03:07
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 5.090095  Lock_time: 0.000238 Rows_sent: 8  Rows_examined: 996806
SET timestamp=1430740987;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 0, 10;
# Time: 150505  2:31:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 248.538006  Lock_time: 0.000092 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '3bbdf9a34f5d4ae7a5f997cff8bf664b';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 242.192725  Lock_time: 0.000097 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '3bbdf9a34f5d4ae7a5f997cff8bf664b';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 248.955228  Lock_time: 0.000240 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2015-04';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 247.121231  Lock_time: 0.000268 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2015-03';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 245.097724  Lock_time: 0.000315 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2015-02';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.899789  Lock_time: 0.000292 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2014-12';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.046651  Lock_time: 0.000297 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2014-10';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 236.118773  Lock_time: 0.000296 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2014-11';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 190.293779  Lock_time: 0.000181 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 332802;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.446198  Lock_time: 0.000292 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2014-11';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 173.882273  Lock_time: 0.000111 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430760675;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate()
                   AND attend_dt >= curdate()
                   
                        
            AND teacher_id = 38975;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 248.394552  Lock_time: 0.000094 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = '3bbdf9a34f5d4ae7a5f997cff8bf664b';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 172.402385  Lock_time: 0.000098 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT IFNULL(attend_dt, '-') as attend_dt
              , IFNULL(leave_dt, '-') as leave_dt
        FROM tz_teacher_attend
         WHERE  work_de = curdate() - INTERVAL 1 DAY
                   AND attend_dt >= curdate() - INTERVAL 1 DAY
            
                        
            AND teacher_id = 123491;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 206.360556  Lock_time: 0.000094 Rows_sent: 1  Rows_examined: 232
SET timestamp=1430760675;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 38975
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 245.097489  Lock_time: 0.001485 Rows_sent: 0  Rows_examined: 162
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2015' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '02'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 124.378169  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 232
SET timestamp=1430760675;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 38975
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 238.524634  Lock_time: 0.000315 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430760675;
SELECT 
		IFNULL(plan_day1,'0') as plan_day1
		, IFNULL(plan_day2,'0') as plan_day2
		, IFNULL(plan_day3,'0') as plan_day3
		, IFNULL(plan_day4,'0') as plan_day4
		, IFNULL(plan_day5,'0') as plan_day5
		, IFNULL(plan_day6,'0') as plan_day6
		, IFNULL(plan_day7,'0') as plan_day7
		, IFNULL(plan_day8,'0') as plan_day8
		, IFNULL(plan_day9,'0') as plan_day9
		, IFNULL(plan_day10,'0') as plan_day10
		, IFNULL(plan_day11,'0') as plan_day11
		, IFNULL(plan_day12,'0') as plan_day12
		, IFNULL(plan_day13,'0') as plan_day13
		, IFNULL(plan_day14,'0') as plan_day14
		, IFNULL(plan_day15,'0') as plan_day15
		, IFNULL(plan_day16,'0') as plan_day16
		, IFNULL(plan_day17,'0') as plan_day17
		, IFNULL(plan_day18,'0') as plan_day18
		, IFNULL(plan_day19,'0') as plan_day19
		, IFNULL(plan_day20,'0') as plan_day20
		, IFNULL(plan_day21,'0') as plan_day21
		, IFNULL(plan_day22,'0') as plan_day22
		, IFNULL(plan_day23,'0') as plan_day23
		, IFNULL(plan_day24,'0') as plan_day24
		, IFNULL(plan_day25,'0') as plan_day25
		, IFNULL(plan_day26,'0') as plan_day26
		, IFNULL(plan_day27,'0') as plan_day27
		, IFNULL(plan_day28,'0') as plan_day28
		, IFNULL(plan_day29,'0') as plan_day29
		, IFNULL(plan_day30,'0') as plan_day30
		, IFNULL(plan_day31,'0') as plan_day31
		, COUNT(1)
		FROM tz_stat_lms_plan
		WHERE student_no = '198132'
		and plan_month = '2015-01';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 304.741798  Lock_time: 0.000178 Rows_sent: 2  Rows_examined: 539
SET timestamp=1430760675;
SELECT t1.f_stu_test_id
        FROM edubasestudydb.t_student_test t1 
        WHERE t1.f_test_id IN (
            SELECT tst.f_test_id
            FROM ishomedb.tz_lms_module modu
            INNER JOIN ishomedb.tz_lcms_study_lesson les 
            ON modu.subj_lesson_no = les.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lms_module lm 
            ON lm.subj_lesson_no = les.subj_lesson_no
            AND lm.module_no = modu.module_no AND lm.useq = modu.useq AND lm.head_gbn != '10001'
            LEFT OUTER JOIN ishomedb.tz_lcms_prepare_test ppe 
            ON ppe.subj_lesson_no = les.subj_lesson_no AND ppe.useq = lm.useq AND ppe.test_url_gbn = '10001'
            LEFT OUTER JOIN edubasestudydb.t_test tst
            ON tst.f_chapter_cd = les.subj_lesson_no AND tst.f_no = ppe.useq
            AND tst.f_kind_cd IN ('T110', 'T120', 'T130', 'T135') AND tst.f_isopen = 'Y'
            WHERE modu.upper_no IN (86252,86254)
        ) AND f_ischeckpoint = 'Y'
        AND f_user_cd = '251578';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 292.920044  Lock_time: 0.000337 Rows_sent: 1  Rows_examined: 2649
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.elementary_yn = 'Y' THEN '초등학생'
                ELSE '초등학생아님' END AS elementary_yn
               ,b.gender                
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,b.tel1
               ,b.tel2
               ,b.tel3
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.mobile1
               ,b.mobile2
               ,b.mobile3
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,b.blacklist_yn
               ,a.group_no
               ,a.grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,b.parent_id
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_no = a.student_no) as point
               ,b.start_sms_yn
               ,b.end_sms_yn
               ,b.search_yn
               ,IFNULL(b.movie_limit_yn, 'N') as movie_limit_yn
               ,IFNULL(b.movie_global_limit_yn, 'N') as movie_global_limit_yn
               ,lpad(c.recom_id,4,'0') as recom_id
               ,c.recom_teacher_nm
          FROM  ishomedb.tz_student a 
          LEFT OUTER JOIN tz_member b ON a.student_id = b.user_id
          LEFT OUTER JOIN (SELECT tzt.recom_id as recom_id, 
                tzm.nm_kor AS recom_teacher_nm
                FROM tz_teacher tzt
                LEFT JOIN tz_member tzm ON tzt.teacher_id = tzm.user_id) c ON b.recom_teacher = c.recom_id
          where  a.student_no = '228022';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 265.624953  Lock_time: 0.000363 Rows_sent: 1  Rows_examined: 435
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '251578';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 272.191615  Lock_time: 0.000082 Rows_sent: 4  Rows_examined: 4
SET timestamp=1430760675;
SELECT code_gbn
          ,code_gbn_nm
          ,use_yn
          ,reg_id
          ,reg_dt
          ,reg_ip
          ,upd_id
          ,upd_dt
          ,upd_ip
      FROM ishomedb.tz_code_gbn
    WHERE code_gbn IN ('10131','10132','10133','10136');
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 252.420896  Lock_time: 0.000073 Rows_sent: 3  Rows_examined: 6
SET timestamp=1430760675;
SELECT  category_no     /* 카테고리 번호 */
               ,category_nm     /* 카테고리명 */
        FROM   ishomedb.tz_board_category
        WHERE  master_no = '180'
            AND use_yn = 'Y'
        ORDER  BY  sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 139.159168  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3441
SET timestamp=1430760675;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 298102;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 181.258620  Lock_time: 0.000295 Rows_sent: 22  Rows_examined: 3201
SET timestamp=1430760675;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 298102
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 180.677561  Lock_time: 0.000953 Rows_sent: 1  Rows_examined: 435
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '251578';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 141.646942  Lock_time: 0.000870 Rows_sent: 1  Rows_examined: 435
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '251578';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 221.105480  Lock_time: 0.000372 Rows_sent: 1  Rows_examined: 3871
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.elementary_yn = 'Y' THEN '초등학생'
                ELSE '초등학생아님' END AS elementary_yn
               ,b.gender                
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,b.tel1
               ,b.tel2
               ,b.tel3
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.mobile1
               ,b.mobile2
               ,b.mobile3
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,b.blacklist_yn
               ,a.group_no
               ,a.grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,b.parent_id
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_no = a.student_no) as point
               ,b.start_sms_yn
               ,b.end_sms_yn
               ,b.search_yn
               ,IFNULL(b.movie_limit_yn, 'N') as movie_limit_yn
               ,IFNULL(b.movie_global_limit_yn, 'N') as movie_global_limit_yn
               ,lpad(c.recom_id,4,'0') as recom_id
               ,c.recom_teacher_nm
          FROM  ishomedb.tz_student a 
          LEFT OUTER JOIN tz_member b ON a.student_id = b.user_id
          LEFT OUTER JOIN (SELECT tzt.recom_id as recom_id, 
                tzm.nm_kor AS recom_teacher_nm
                FROM tz_teacher tzt
                LEFT JOIN tz_member tzm ON tzt.teacher_id = tzm.user_id) c ON b.recom_teacher = c.recom_id
          where  a.student_no = '198132';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 196.721583  Lock_time: 0.000889 Rows_sent: 1  Rows_examined: 1328
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '198132';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 179.865970  Lock_time: 0.000115 Rows_sent: 1  Rows_examined: 3441
SET timestamp=1430760675;
SELECT  COUNT(consult_no) as total_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NOT NULL THEN 1 END), 0) as complete_count
            , IFNULL(SUM(CASE WHEN upd_dt IS NULL THEN 1 END), 0) as imperfect_count
        FROM   ishomedb.tz_lms_consult
        WHERE  consult_dt   >=   STR_TO_DATE('2015-05-01','%Y-%m-%d')
        AND    consult_dt   <   date_add(STR_TO_DATE('2015-05-01','%Y-%m-%d'), interval +1 day)
        AND    teacher_id = 298102;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 274.029461  Lock_time: 0.000561 Rows_sent: 6  Rows_examined: 60
SET timestamp=1430760675;
SELECT   sbj.subj_gbn
                ,pln.plan_de
                ,DATE_FORMAT(pln.plan_time, '%H') AS plan_hour
                ,DATE_FORMAT(pln.plan_time, '%i') AS plan_minute
                ,DATE_FORMAT(pln.plan_time, '%H:%i') AS plan_time
                ,modu.module_no
                ,sbj.grade_gbn
                ,sbj.semester_gbn
                ,ishomedb.uf_code_nm(10129, modu.head_gbn) AS head_gbn_nm
                ,les.subj_lesson_no
		        ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) 
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)')
					WHEN modu.head_gbn = 10005 AND sbj.subj_gbn != 10023 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
					WHEN modu.head_gbn = 10002 AND sbj.subj_gbn != 10023 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)')  
		         END AS subj_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 THEN '1'
                                ELSE
                                   CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN '1'
                                        ELSE '0'
                                   END
                           END AS lesson_gbn                      
                ,act.act_dt
                ,act.clear_dt
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
                LEFT OUTER JOIN
            ishomedb.tz_lcms_study_lesson les1 ON les.upper_no = les1.subj_lesson_no
        INNER   JOIN ishomedb.tz_lms_course cou
        ON      modu.course_no = cou.course_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      cou.subj_no = sbj.subj_no
        /* AND     sbj.use_yn = 'Y' 임시제거 (3,4학년 구교과/개정교과 같이 표시) */
        WHERE   pln.student_no = '251578'
        AND     pln.plan_de >= '2015.05.05'
        AND     pln.plan_de <= '2015.08.05'
         
         
        AND  sbj.grade_gbn = '5'
         
         
        AND  sbj.semester_gbn = '1'
         
        ORDER   BY pln.plan_de ASC, sbj.subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 273.325918  Lock_time: 0.000560 Rows_sent: 6  Rows_examined: 60
SET timestamp=1430760675;
SELECT   sbj.subj_gbn
                ,pln.plan_de
                ,DATE_FORMAT(pln.plan_time, '%H') AS plan_hour
                ,DATE_FORMAT(pln.plan_time, '%i') AS plan_minute
                ,DATE_FORMAT(pln.plan_time, '%H:%i') AS plan_time
                ,modu.module_no
                ,sbj.grade_gbn
                ,sbj.semester_gbn
                ,ishomedb.uf_code_nm(10129, modu.head_gbn) AS head_gbn_nm
                ,les.subj_lesson_no
		        ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) 
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)')
					WHEN modu.head_gbn = 10005 AND sbj.subj_gbn != 10023 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
					WHEN modu.head_gbn = 10002 AND sbj.subj_gbn != 10023 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)')  
		         END AS subj_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 THEN '1'
                                ELSE
                                   CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN '1'
                                        ELSE '0'
                                   END
                           END AS lesson_gbn                      
                ,act.act_dt
                ,act.clear_dt
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
                LEFT OUTER JOIN
            ishomedb.tz_lcms_study_lesson les1 ON les.upper_no = les1.subj_lesson_no
        INNER   JOIN ishomedb.tz_lms_course cou
        ON      modu.course_no = cou.course_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      cou.subj_no = sbj.subj_no
        /* AND     sbj.use_yn = 'Y' 임시제거 (3,4학년 구교과/개정교과 같이 표시) */
        WHERE   pln.student_no = '251578'
        AND     pln.plan_de >= '2015.05.05'
        AND     pln.plan_de <= '2015.08.05'
         
         
        AND  sbj.grade_gbn = '5'
         
         
        AND  sbj.semester_gbn = '1'
         
        ORDER   BY pln.plan_de ASC, sbj.subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 250.052885  Lock_time: 0.001013 Rows_sent: 1  Rows_examined: 435
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '251578';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 182.490207  Lock_time: 0.000304 Rows_sent: 22  Rows_examined: 3201
SET timestamp=1430760675;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 298102
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 176.698971  Lock_time: 0.000304 Rows_sent: 22  Rows_examined: 3201
SET timestamp=1430760675;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 298102
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.086909  Lock_time: 0.001708 Rows_sent: 6  Rows_examined: 1382
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2014' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '10'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 305.237714  Lock_time: 0.000120 Rows_sent: 1  Rows_examined: 7329
SET timestamp=1430760675;
SELECT concat(sk.subj_knd_nm_short, ' ', bp.start_page, '~', bp.end_page) as result
					 FROM ishomedb.tz_lcms_book_page bp
					 INNER JOIN ishomedb.tz_lcms_subj_knd sk
					 ON sk.subj_knd_no = bp.subj_knd_no
					 WHERE EXISTS (
								 SELECT 1
								 FROM ishomedb.tz_lcms_study_lesson l
								 INNER JOIN ishomedb.tz_lcms_subj s
								 ON l.subj_no = s.subj_no
								 WHERE l.subj_lesson_no = bp.subj_lesson_no
								 and l.subj_no = 9
								 and l.subj_lesson_no = 887
							 );
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 211.293311  Lock_time: 0.000368 Rows_sent: 22  Rows_examined: 3201
SET timestamp=1430760675;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 298102
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 204.156601  Lock_time: 0.000462 Rows_sent: 1  Rows_examined: 1328
SET timestamp=1430760675;
SELECT  b.user_id
               ,b.nm_kor
               ,b.login_id
               ,b.login_pwd
               ,b.jumin_no1
               ,b.jumin_no2
               ,b.birth_de
               ,CASE WHEN b.gender = 'M' THEN '남'
                WHEN b.gender = 'F' THEN '여'
                ELSE '-'
                END as gender               
               ,( case when b.calendar_gbn = 'S' then '양력' else '음력' end ) as calendar_gbn
               ,(select schoolname from ishomedb.tz_school where school_no = b.school_no) as schoolname
               ,CONCAT(b.tel1, '-', b.tel2, '-', b.tel3) AS tel
               ,CONCAT(b.mobile1, '-', b.mobile2, '-', b.mobile3) AS mobile
               ,b.sms_yn
               ,b.email
               ,b.zipcode
               ,b.addr1
               ,b.addr2
               ,ishomedb.uf_code_grade_nm(a.grade_gbn) as grade_gbn
               ,a.device_no
               ,a.student_no
               ,a.student_id
               ,a.teacher_id
               ,a.start_de
               ,a.end_de
               ,a.grade_gbn as s_grade_gbn
               ,b.parent_id
               ,c.nm_kor as p_nm_kor
               ,c.login_id as p_login_id
               ,CONCAT(c.tel1, '-', c.tel2, '-', c.tel3) AS p_tel
               ,CONCAT(c.mobile1, '-', c.mobile2, '-', c.mobile3) AS p_mobile
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 1) AS exp_info_dir
               ,SUBSTRING_INDEX(ishomedb.uf_experience_info(b.parent_id, a.student_id), '%|%', 2) AS exp_info_reason
               ,(SELECT SUM(point) FROM tz_point_history WHERE student_id = a.student_id) as point
               ,c.dual_work
               ,CASE WHEN b.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = b.user_id), -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,b.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,IFNULL(a.today_feeling, '') AS today_feeling /* 오늘의 기분. 이영무 */
                ,IF(a.today_feeling_dt is null, '', DATE_FORMAT(a.today_feeling_dt,'%Y-%m-%d %H:%i'))  AS today_feeling_dt /*오늘의 기분 설정일*/
		 FROM  ishomedb.tz_student a, ishomedb.tz_member b, ishomedb.tz_member c
		 WHERE  a.student_id = b.user_id
		 AND  b.parent_id  = c.user_id
		 AND  a.student_no = '198132';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 284.756063  Lock_time: 0.000604 Rows_sent: 6  Rows_examined: 60
SET timestamp=1430760675;
SELECT   sbj.subj_gbn
                ,pln.plan_de
                ,DATE_FORMAT(pln.plan_time, '%H') AS plan_hour
                ,DATE_FORMAT(pln.plan_time, '%i') AS plan_minute
                ,DATE_FORMAT(pln.plan_time, '%H:%i') AS plan_time
                ,modu.module_no
                ,sbj.grade_gbn
                ,sbj.semester_gbn
                ,ishomedb.uf_code_nm(10129, modu.head_gbn) AS head_gbn_nm
                ,les.subj_lesson_no
		        ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) 
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)')
					WHEN modu.head_gbn = 10005 AND sbj.subj_gbn != 10023 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
					WHEN modu.head_gbn = 10002 AND sbj.subj_gbn != 10023 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)')  
		         END AS subj_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 THEN '1'
                                ELSE
                                   CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN '1'
                                        ELSE '0'
                                   END
                           END AS lesson_gbn                      
                ,act.act_dt
                ,act.clear_dt
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
                LEFT OUTER JOIN
            ishomedb.tz_lcms_study_lesson les1 ON les.upper_no = les1.subj_lesson_no
        INNER   JOIN ishomedb.tz_lms_course cou
        ON      modu.course_no = cou.course_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      cou.subj_no = sbj.subj_no
        /* AND     sbj.use_yn = 'Y' 임시제거 (3,4학년 구교과/개정교과 같이 표시) */
        WHERE   pln.student_no = '251578'
        AND     pln.plan_de >= '2015.05.05'
        AND     pln.plan_de <= '2015.08.05'
         
         
        AND  sbj.grade_gbn = '5'
         
         
        AND  sbj.semester_gbn = '1'
         
        ORDER   BY pln.plan_de ASC, sbj.subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 283.501646  Lock_time: 0.000595 Rows_sent: 6  Rows_examined: 60
SET timestamp=1430760675;
SELECT   sbj.subj_gbn
                ,pln.plan_de
                ,DATE_FORMAT(pln.plan_time, '%H') AS plan_hour
                ,DATE_FORMAT(pln.plan_time, '%i') AS plan_minute
                ,DATE_FORMAT(pln.plan_time, '%H:%i') AS plan_time
                ,modu.module_no
                ,sbj.grade_gbn
                ,sbj.semester_gbn
                ,ishomedb.uf_code_nm(10129, modu.head_gbn) AS head_gbn_nm
                ,les.subj_lesson_no
		        ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) 
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)')
					WHEN modu.head_gbn = 10005 AND sbj.subj_gbn != 10023 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
					WHEN modu.head_gbn = 10002 AND sbj.subj_gbn != 10023 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)')  
		         END AS subj_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 THEN '1'
                                ELSE
                                   CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN '1'
                                        ELSE '0'
                                   END
                           END AS lesson_gbn                      
                ,act.act_dt
                ,act.clear_dt
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
                LEFT OUTER JOIN
            ishomedb.tz_lcms_study_lesson les1 ON les.upper_no = les1.subj_lesson_no
        INNER   JOIN ishomedb.tz_lms_course cou
        ON      modu.course_no = cou.course_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      cou.subj_no = sbj.subj_no
        /* AND     sbj.use_yn = 'Y' 임시제거 (3,4학년 구교과/개정교과 같이 표시) */
        WHERE   pln.student_no = '251578'
        AND     pln.plan_de >= '2015.05.05'
        AND     pln.plan_de <= '2015.08.05'
         
         
        AND  sbj.grade_gbn = '5'
         
         
        AND  sbj.semester_gbn = '1'
         
        ORDER   BY pln.plan_de ASC, sbj.subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 181.623423  Lock_time: 0.000303 Rows_sent: 22  Rows_examined: 3201
SET timestamp=1430760675;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 298102
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 185.727870  Lock_time: 0.000325 Rows_sent: 22  Rows_examined: 3201
SET timestamp=1430760675;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-26'
        AND    l.consult_dt   <   date_add('2015-05-26', interval +1 day)
        AND    l.teacher_id = 298102
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 293.918568  Lock_time: 0.000360 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430760675;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 238.580301  Lock_time: 0.001477 Rows_sent: 10  Rows_examined: 2949
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2015' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '01'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.515244  Lock_time: 0.001724 Rows_sent: 10  Rows_examined: 3843
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2014' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '11'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 173.008630  Lock_time: 0.000296 Rows_sent: 23  Rows_examined: 4270
SET timestamp=1430760675;
SELECT  l.consult_no     /* 상담 번호 */
               ,l.teacher_id     /* 교사ID */
               ,l.student_no     /* 학생ID */
               ,l.consult_dt     /* 상담일시 */
               ,l.target_id      /* 상담대상ID */
               ,l.tel_gbn        /* 연락처 구분 */
               ,l.tel_no         /* 연락 전화번호 */
               ,l.consult_gbn    /* 상담 구분 (공통코드 : 10130) */
               ,CASE  WHEN l.consult_mat='10211' THEN
                    '첫상담'
               WHEN l.consult_mat='10212' THEN
                    '학습상담'
               WHEN l.consult_mat='10213' THEN
                    '구매상담'
               WHEN l.consult_mat='10214' THEN
                    '첫상담'   
               WHEN l.consult_mat='10215' THEN
                    '학습상담'
               WHEN l.consult_mat='10216' THEN
                    '결제상담'
               END AS consult_mat
               ,l.consult_detail
               ,l.repetition_no
               ,l.upd_dt
               ,c.code_nm
               ,s.student_id
               ,s.grade_gbn
               ,s.group_no
               ,g.group_nm
               ,m.nm_kor
               ,m.login_id
               ,m.user_id
               ,CASE WHEN m.user_gbn_cls = '10004' THEN  
                     'Android'
                     WHEN COALESCE((SELECT DISTINCT user_id FROM ishomedb.tz_connect_session WHERE user_id = m.user_id), -1) > 0 THEN 'ON'
                     ELSE 'OFF'
                END AS status 
        FROM   ishomedb.tz_lms_consult l
        LEFT OUTER JOIN tz_student s
        ON     l.student_no = s.student_no
        LEFT OUTER JOIN ishomedb.tz_connect_session sc
        ON l.target_id = sc.user_id 
        LEFT OUTER JOIN tz_student_group g
        ON     s.group_no = g.group_no
        LEFT OUTER JOIN tz_member m
        ON     s.student_id = m.user_id
        LEFT OUTER JOIN tz_code c
        ON     l.consult_gbn = c.code_no
        AND    c.code_gbn = 10130
        WHERE  l.consult_dt   >=   '2015-05-07'
        AND    l.consult_dt   <   date_add('2015-05-07', interval +1 day)
        AND    l.teacher_id = 298102
        
         
                ORDER BY l.consult_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 291.308242  Lock_time: 0.000775 Rows_sent: 6  Rows_examined: 60
SET timestamp=1430760675;
SELECT   sbj.subj_gbn
                ,pln.plan_de
                ,DATE_FORMAT(pln.plan_time, '%H') AS plan_hour
                ,DATE_FORMAT(pln.plan_time, '%i') AS plan_minute
                ,DATE_FORMAT(pln.plan_time, '%H:%i') AS plan_time
                ,modu.module_no
                ,sbj.grade_gbn
                ,sbj.semester_gbn
                ,ishomedb.uf_code_nm(10129, modu.head_gbn) AS head_gbn_nm
                ,les.subj_lesson_no
		        ,CASE WHEN modu.head_gbn = 10001 THEN CONCAT(CASE
                                WHEN les.subj_no = 174 OR les.subj_no = 175 THEN CONCAT(les.chapter_key, '장. ')
                                ELSE CASE
                                    WHEN
                                        les.use_chapter_key = 'Y'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les.chapter_key, '장. ')
                                    WHEN
                                        les.use_chapter_key = 'N'
                                            AND les.contents_xml_type >= 'C'
                                            AND (les.contents_xml_type != 'O'
                                            AND les.contents_xml_type != 'N')
                                    THEN
                                        CONCAT(les1.sort, '단원. ')
                                    ELSE CONCAT(les.sort, '장. ')
                                END
                            END,
                            les.subj_lesson_nm) 
                    WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력기본)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력중급)')
		            WHEN modu.head_gbn = 10005 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (실력상급)')
					WHEN modu.head_gbn = 10005 AND sbj.subj_gbn != 10023 THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm, ' (', modu.useq, '회차)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 1 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원중급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 2 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원상급)') 
		            WHEN modu.head_gbn = 10002 AND sbj.subj_gbn = 10023 AND modu.useq = 3 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (단원기본)') 
					WHEN modu.head_gbn = 10002 AND sbj.subj_gbn != 10023 THEN CONCAT(les.sort, '. ', les.subj_lesson_nm, ' (', modu.useq, '회차)')  
		         END AS subj_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 THEN '1'
                                ELSE
                                   CASE WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) THEN '1'
                                        ELSE '0'
                                   END
                           END AS lesson_gbn                      
                ,act.act_dt
                ,act.clear_dt
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn) AS subj_gbn_nm
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
                LEFT OUTER JOIN
            ishomedb.tz_lcms_study_lesson les1 ON les.upper_no = les1.subj_lesson_no
        INNER   JOIN ishomedb.tz_lms_course cou
        ON      modu.course_no = cou.course_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      cou.subj_no = sbj.subj_no
        /* AND     sbj.use_yn = 'Y' 임시제거 (3,4학년 구교과/개정교과 같이 표시) */
        WHERE   pln.student_no = '251578'
        AND     pln.plan_de >= '2015.05.05'
        AND     pln.plan_de <= '2015.08.05'
         
         
        AND  sbj.grade_gbn = '5'
         
         
        AND  sbj.semester_gbn = '1'
         
        ORDER   BY pln.plan_de ASC, sbj.subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 298.534958  Lock_time: 0.000137 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430760675;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 149.145522  Lock_time: 0.001950 Rows_sent: 3  Rows_examined: 3708
SET timestamp=1430760675;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 123491
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
                 
            AND c.nm_kor   LIKE CONCAT('김민서', '%')
                 
                 
                 
                 
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 236.199026  Lock_time: 0.002014 Rows_sent: 10  Rows_examined: 3843
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2014' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '11'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 295.255376  Lock_time: 0.000386 Rows_sent: 15  Rows_examined: 60
SET timestamp=1430760675;
SELECT   subj_gbn
                ,ishomedb.uf_code_subj_nm(subj_gbn) AS subj_nm
                ,CASE WHEN subj_gbn = 10004 THEN 11000 
                      WHEN subj_gbn = 10017 THEN 10001
                      ELSE subj_gbn 
                 END AS subj_sort
        FROM    ishomedb.tz_lcms_subj
        WHERE   school_study_yn = 'C'
         
            AND grade_gbn = '5'
         
         
            AND semester_gbn = '1'
         
            /* AND use_yn = 'Y' 2월말까지 임시 제거 */
        GROUP   BY subj_gbn
        ORDER   BY sort, subj_gbn ASC;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 249.064664  Lock_time: 0.001500 Rows_sent: 10  Rows_examined: 7220
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2015' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '04'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 238.032205  Lock_time: 0.001494 Rows_sent: 10  Rows_examined: 5875
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2014' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '12'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 247.313401  Lock_time: 0.001504 Rows_sent: 10  Rows_examined: 8124
SET timestamp=1430760675;
SELECT   stt.f_stu_test_id                                               /* 평가결과 ID */
                ,stt.f_user_cd                                                   /* 사용자 CD */
                ,stt.f_test_id                                                   /* 평가지 ID */
                ,stt.f_ischeckpoint                                              /* 채점완료 YN */
                ,stt.f_isstatic                                                  /* 통계완료 YN */
                ,stt.f_test_time                                                 /* 시험시간 */ 
                ,stt.f_test_dt                                                   /* 응시일 */
                ,sbj.grade_gbn                                                   /* 학년명 */
                ,ishomedb.uf_code_nm(10101, sbj.subj_gbn ) AS subj_gbn_nm        /* 과목명 */
                ,DATE_FORMAT(stt.f_test_dt,  '%m/%d') AS test_date               /* 응시 월/일 */
                ,stt.f_checkpoint_dt                                             /* 채점일 */
                ,stt.f_point                                                     /* 점수 */ 
                ,floor(tsts.f_10avg) as f_10avg                                  /* 상쉬 10%점수 */
                ,tst.f_chapter_cd                                                /* 학습단원 No */
                ,tst.f_no                                                        /* 회차 */
                ,tst.f_kind_cd                                                   /* 평가종류 CD */
                ,edubasestudydb.testNmCreate(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm          /* 평가명 */
                ,edubasestudydb.testNmCreateA(tst.f_grade_cd, tst.f_term_cd, tst.f_test_nm, tst.f_no) f_test_nm_all     /* 평가명 */           
                ,les.subj_lesson_nm                                              /* 목차명 */ 
                ,CASE WHEN sbj.semester_gbn = 3 THEN '공통'
                      ELSE sbj.semester_gbn
                 END AS semester_gbn_nm                                          /* 학기명 */
                ,CASE WHEN tst.f_kind_cd = 'T110' THEN '실력평가'                                                       
                      WHEN tst.f_kind_cd = 'T120' THEN '단원평가'                                                       
                      WHEN tst.f_kind_cd = 'T130' THEN '중간고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T135' THEN '기말고사대비'                                                     
                      WHEN tst.f_kind_cd = 'T140' THEN '수학심화평가'                                                     
                      WHEN tst.f_kind_cd = 'T150' THEN '수학경시대비'                                                     
                END AS f_kind_nm                                                                                    /* 평가 종류명 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt1.contents_no ) AS url1 /* 시험보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt2.contents_no ) AS url2 /* 틀린문제 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt3.contents_no ) AS url3 /* 채점결과/풀이보기 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt4.contents_no ) AS url4 /* 평가분석표 */
                ,(SELECT porting_value FROM ishomedb.tz_lcms_contents WHERE contents_no = pt5.contents_no ) AS url5 /* 틀린문제 다시풀기 */
        
                ,(SELECT COUNT(a.f_test_dt)                                                                         
                  FROM   edubasestudydb.t_student_test a
                        
                  INNER  JOIN edubasestudydb.t_test b
                  ON     a.f_test_id = b.f_test_id
                  
		         
		                AND     b.f_kind_cd IN ('T110','T120','T130','T135','T150') 
		             
                  
                  INNER  JOIN ishomedb.tz_lcms_study_lesson d
                  ON     b.f_chapter_cd = d.subj_lesson_no 

                  INNER  JOIN edubasestudydb.t_static_test c
                  ON     c.f_test_id = b.f_test_id

                  WHERE  a.f_user_cd =  '198132'
                  AND    DATE_FORMAT(a.f_test_dt,  '%m/%d') = DATE_FORMAT(stt.f_test_dt,  '%m/%d')
                  ) AS f_test_dt_cnt           /* 동일 컬럼 수 */
                  
                ,CASE WHEN DAYNAME(stt.f_test_dt) = 0 THEN '월'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 1 THEN '화'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 2 THEN '수'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 3 THEN '목'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 4 THEN '금'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 5 THEN '토'                                                      
                      WHEN DAYNAME(stt.f_test_dt) = 6 THEN '일'                                                      
                 END AS test_week             
                ,tst.f_problem_cnt
                ,SUM(IF(stp.f_result != '1', 0, 1)) AS right_cnt
        FROM    edubasestudydb.t_student_test stt
    
        INNER   JOIN edubasestudydb.t_test tst
        ON      stt.f_test_id = tst.f_test_id
         
                AND     tst.f_kind_cd IN ('T110','T120','T130','T135','T150') 
             
    
        INNER JOIN edubasestudydb.t_student_test_problem stp
        ON stp.f_stu_test_id = stt.f_stu_test_id
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      tst.f_chapter_cd = les.subj_lesson_no 
        
        INNER   JOIN edubasestudydb.t_static_test tsts
        ON      tsts.f_test_id = tst.f_test_id

        LEFT   OUTER JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt1
        ON      pt1.subj_lesson_no = tst.f_chapter_cd
        AND     pt1.useq = tst.f_no
        AND     pt1.test_url_gbn = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt2
        ON      pt2.subj_lesson_no = tst.f_chapter_cd
        AND     pt2.useq = tst.f_no 
        AND     pt2.test_url_gbn = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt3
        ON      pt3.subj_lesson_no = tst.f_chapter_cd
        AND     pt3.useq = tst.f_no 
        AND     pt3.test_url_gbn = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt4
        ON      pt4.subj_lesson_no = tst.f_chapter_cd
        AND     pt4.useq = tst.f_no
        AND     pt4.test_url_gbn = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test pt5
        ON      pt5.subj_lesson_no = tst.f_chapter_cd
        AND     pt5.useq = tst.f_no
        AND     pt5.test_url_gbn = '10005'
        
        WHERE   stt.f_user_cd =  '198132'
        
         
        
         
            AND    DATE_FORMAT(stt.f_test_dt, '%Y') = '2015' 
         
         
            AND    DATE_FORMAT(stt.f_test_dt, '%m') = '03'
         
        GROUP BY f_stu_test_id
        ORDER   BY stt.f_test_dt DESC, tst.f_kind_cd ASC, tst.f_chapter_cd ASC        
        LIMIT   0, 10;
# Time: 150505  2:31:16
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 206.823560  Lock_time: 0.001131 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430760676;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 38975
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 174.729519  Lock_time: 0.001031 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430760676;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 38975
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 139.041653  Lock_time: 0.001694 Rows_sent: 105  Rows_examined: 92183
SET timestamp=1430760676;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 298102
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 167.859993  Lock_time: 0.001646 Rows_sent: 102  Rows_examined: 276868
SET timestamp=1430760676;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 123491
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 168.175282  Lock_time: 0.001862 Rows_sent: 102  Rows_examined: 276868
SET timestamp=1430760676;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 123491
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 168.483533  Lock_time: 0.001520 Rows_sent: 102  Rows_examined: 276868
SET timestamp=1430760676;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 123491
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 170.358778  Lock_time: 0.001577 Rows_sent: 102  Rows_examined: 276868
SET timestamp=1430760676;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 123491
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 232.782347  Lock_time: 0.001625 Rows_sent: 125  Rows_examined: 290201
SET timestamp=1430760676;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 38975
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 262.432843  Lock_time: 0.001594 Rows_sent: 125  Rows_examined: 290201
SET timestamp=1430760676;
SELECT student_no
              ,student_id
              ,parent_id
              ,teacher_id
              ,group_nm
              ,grade_gbn
              ,gender               
              ,user_id
              ,login_id
              ,p_login_id
              ,p_nm_kor
              ,nm_kor
              ,tel
              ,mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,pur_start_de
              ,pur_end_de
              ,product_no
              ,last_dt
              ,student_consult_dt
              ,student_consult_gbn
              ,student_consult_content
              ,parent_consult_dt
              ,parent_consult_gbn
              ,parent_consult_content
              ,product_nm
              ,status
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        FROM (
              SELECT a.student_no
                  ,a.student_id
                  ,c.parent_id
                  ,a.teacher_id
                  ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm
                  ,a.grade_gbn
                  ,CASE WHEN c.gender = 'M' THEN '남'
                        WHEN c.gender = 'F' THEN '여'
                        ELSE '-'
                  END AS gender               
                  ,c.user_id
                  ,c.login_id
                  ,p.login_id AS p_login_id
                  ,p.nm_kor AS p_nm_kor
                  ,c.nm_kor
                  ,CONCAT(c.tel1,'-',c.tel2,'-',c.tel3) AS tel
                  ,CONCAT(c.mobile1,'-',c.mobile2,'-',c.mobile3) AS mobile
                  ,c.blacklist_yn
                  ,IFNULL(a.manage_start_de,'9999.99.99') as manage_start_de
                  ,DATE_FORMAT(a.start_de, '%Y.%m.%d') AS start_de
                  ,DATE_FORMAT(a.end_de, '%Y.%m.%d') AS end_de
                  ,DATE_FORMAT(pur.start_de, '%Y.%m.%d') AS pur_start_de
                  ,DATE_FORMAT(pur.end_de, '%Y.%m.%d') AS pur_end_de
                  ,pur.product_no
                  ,(SELECT MAX(login_dt)   FROM ishomedb.tz_connect_log WHERE user_id = a.student_id) AS last_dt
                  ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=c.user_id 
                    AND content IS NOT NULL) AS student_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=c.user_id 
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=c.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS student_consult_content        
                ,(SELECT MAX(consult_org_dt) FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no 
                    AND target_id=p.user_id  
                    AND content IS NOT NULL) AS parent_consult_dt
                ,(SELECT code.code_nm 
                    FROM ishomedb.tz_lms_consult con
                    LEFT JOIN tz_code code
                    ON con.consult_gbn = code.code_no
                    AND code.code_gbn = '10130'
                    WHERE con.student_no = a.student_no AND target_id=p.user_id
                    AND con.content IS NOT NULL
                    ORDER BY con.consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_gbn
                ,(SELECT substring(content, 1, 30) 
                    FROM ishomedb.tz_lms_consult 
                    WHERE student_no = a.student_no AND target_id=p.user_id
                    AND content IS NOT NULL
                    ORDER BY consult_org_dt DESC
                    LIMIT 1
                 ) AS parent_consult_content
                  ,ishomedb.uf_study_product_nm(a.student_no) as product_nm
                  ,CASE WHEN c.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보 */
                        'Android'
                        WHEN COALESCE(s.user_id, -1) > 0 THEN 'ON' 
                        ELSE 'OFF' 
                   END AS status                   
                  ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                  ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                  ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                  ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                  ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                  ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                  ,tee.app_reason
            FROM ishomedb.tz_student a
            
              
	            INNER JOIN ishomedb.tz_purchase_student pch
	            ON a.student_no = pch.temp_student_no
	            INNER JOIN ishomedb.tz_purchase pur
	            ON pch.purchase_no = pur.purchase_no
	            INNER JOIN tz_product pd
	            ON pur.product_no = pd.product_no
	         
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member c
            ON a.student_id = c.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = c.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON a.teacher_id = d.teacher_id
            LEFT OUTER JOIN ishomedb.tz_connect_session s
            ON a.student_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = a.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
            LEFT OUTER JOIN ishomedb.tz_experience tee 
            ON tee.purchase_no = pur.purchase_no and tee.parent_id = pur.purchase_no and tee.student_id = pur.student_id
             
    
        WHERE


            c.search_yn = 'Y'
            AND a.teacher_id = 38975
            AND IFNULL(c.user_gbn_cls, '10001') != '10002'
                
             
	            
	             
	                AND (
	                    a.end_de is not null
	                    AND
	                    date_format(a.end_de, '%Y%m%d')   >=   date_format(NOW(), '%Y%m%d')
	                ) 
	                 
	            
             
             
             
            
             
            
             
             
            
             
             
             
             
             
             
     
            GROUP BY a.student_no
        ) A
          ORDER BY manage_start_de DESC;
# Time: 150505  2:32:57
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 414.156846  Lock_time: 0.001343 Rows_sent: 27236  Rows_examined: 254249
SET timestamp=1430760777;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150505  2:38:08
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 299.782163  Lock_time: 0.000047 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761088;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5620824';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 238.844840  Lock_time: 0.000099 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761088;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = 'f23a4fd8a1d741419ecfe10880bb37c1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 238.085165  Lock_time: 0.000101 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761088;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = 'f23a4fd8a1d741419ecfe10880bb37c1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 240.205065  Lock_time: 0.000101 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761088;
SELECT  master_no           /* 게시판 번호 */
               ,master_nm           /* 게시판명 */
               ,type_gbn            /* 유형구분코드 */
               ,admin_list_cnt      /* 기본출력갯수(관리자) */
               ,site_list_cnt       /* 기본출력갯수(웹사이트) */
               ,category_yn         /* 카테고리사용여부 */
               ,file_attach_yn      /* 첨부파일기능여부 */
               ,file_limit_mb       /* 총제한용량 */
               ,file_limit_cnt      /* 첨부파일제한갯수 */
               ,reply_yn            /* 답글기능여부 */
               ,description         /* 게시판 설명 */
        FROM   ishomedb.tz_board_master
        WHERE  master_id = 'f23a4fd8a1d741419ecfe10880bb37c1';
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 18.279854  Lock_time: 0.000137 Rows_sent: 1  Rows_examined: 70
SET timestamp=1430761088;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 236215
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 236.794558  Lock_time: 0.001399 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430761088;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.29'
                    AND lpm.plan_de <= '2015.05.05'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.06'
                    AND lpm.plan_de <= '2015.05.05'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           '-' 
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
            AND IFNULL(stu.end_de, NOW())  >=  DATE_FORMAT(NOW(), '%Y-%m-%d')
             
                         
             
             
             
             
            AND ttt.team_no = '###'
             
             
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
          ORDER BY manage_start_de DESC 
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
        LIMIT   0, 100;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 266.509218  Lock_time: 0.001135 Rows_sent: 67  Rows_examined: 4801
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '226'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '226'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 20
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 263.374981  Lock_time: 0.001101 Rows_sent: 67  Rows_examined: 4801
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '226'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '226'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 20
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 257.609898  Lock_time: 0.000956 Rows_sent: 67  Rows_examined: 4801
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '226'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '226'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 20
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 261.362527  Lock_time: 0.000994 Rows_sent: 67  Rows_examined: 4801
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '226'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '226'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 20
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 260.705247  Lock_time: 0.000986 Rows_sent: 67  Rows_examined: 4801
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '226'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '226'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 20
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 257.906443  Lock_time: 0.000996 Rows_sent: 67  Rows_examined: 4801
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '226'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '226'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 20
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 243.442215  Lock_time: 0.001318 Rows_sent: 67  Rows_examined: 4801
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '226'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '226'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '226'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 20
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 250.589871  Lock_time: 0.000994 Rows_sent: 31  Rows_examined: 45652
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '189'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '189'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 30
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 251.666211  Lock_time: 0.000981 Rows_sent: 31  Rows_examined: 45652
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '189'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '189'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 30
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 249.105885  Lock_time: 0.001366 Rows_sent: 31  Rows_examined: 45652
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '189'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '189'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 30
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 249.743587  Lock_time: 0.001002 Rows_sent: 31  Rows_examined: 45652
SET timestamp=1430761088;
SELECT x.board_num
              ,ADDDATE(DATE_FORMAT(x.reg_dt, '%Y%m%d'), x.new_days) - DATE_FORMAT(NOW(), '%Y%m%d') AS new_day
              ,x.nm /* 게시글구분 - 1(공지글), 2(게시글) */
              ,x.master_no
              ,x.board_no
              ,x.category_no
              ,x.upper_no
              ,x.ref_sort /* 답변정렬순서 */
              ,x.ref_lvl /* 답변 레벨 */
              ,x.title
              ,x.content
              ,x.top_yn /* 최상단 표시 여부 */
              ,x.use_yn
              ,x.summary
              ,x.file_attach_cnt
              ,IFNULL(x.read_cnt, 0) AS read_cnt
              ,x.view_gbn /* 공개여부 */
              ,x.reg_id
              ,x.reg_dt
              ,DATE_FORMAT(x.reg_dt, '%Y.%m.%d')as reg_date
              ,x.user_nm
              ,upd.nm_kor as nm_kor_upd
              ,x.main_team
              ,x.status /* 처리상황 */
              ,x.as_status /* AS증상 */
              ,(SELECT category_nm FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS category_nm
              ,(SELECT sort FROM ishomedb.tz_board_category WHERE category_no = x.category_no AND master_no = x.master_no) AS sort
              ,mem.nm_kor
              ,mem.login_id
              ,mem.addr1
              ,x.count_no /* 게시물 답변 갯수 */
              ,x.recom_cnt
              ,x.down_cnt
              ,(SELECT DISTINCT upload_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_upload_seq /* 메인 썸네일 업로드 일련번호 */
              ,(SELECT DISTINCT file_seq FROM ishomedb.tz_education_column_simage_file_seq WHERE upload_seq = x.sub_thumbnail_file_seq) AS sub_thumbnail_file_seq /* 메인 썸네일 파일 일련번호 */
              ,upb.reg_id AS upper_reg_id
              ,x.board_cnt
              ,x.nickname
              ,x.read_auth
              ,x.sub_category_no
              ,DATE_FORMAT(x.upd_dt, '%Y.%m.%d') as upd_date
              ,x.upd_dt
        FROM (
            SELECT 1 AS nm
                  ,NULL AS board_num           
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content 
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,b.view_gbn
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm
                  ,c.code_nm as main_team
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT OUTER JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
            WHERE b.top_yn = 'Y' 
                AND b.master_no = '189'
        
            UNION ALL
        
            (SELECT 2 AS nm  
             
            ,(( 
        SELECT COUNT(b.board_no)
        FROM ishomedb.tz_board b
        LEFT JOIN tz_member m
        ON b.reg_id = m.user_id
        LEFT JOIN tz_member mu
        ON b.upd_id = mu.user_id
        LEFT JOIN tz_code c
        ON b.main_team = c.code_no
        AND c.code_gbn = '10168'
        LEFT JOIN ishomedb.tz_profile p
        ON b.reg_id = p.reg_id
        INNER JOIN tz_board upb
        ON ABS(b.upper_no) = upb.board_no
         
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
     ) - 0 - (@rownum := @rownum + 1)) + 1 AS board_num /*게시글일련번호*/
              
                  ,bm.new_days
                  ,b.master_no
                  ,b.board_no
                  ,b.category_no
                  ,b.upper_no
                  ,b.ref_sort
                  ,b.ref_lvl
                  ,b.title
                  ,b.content     
                  ,b.top_yn
                  ,b.summary
                  ,b.file_seq
                  ,b.file_attach_cnt
                  ,b.sub_thumbnail_file_seq
                  ,b.read_cnt
                  ,IF(ref_lvl >= 1, (
                      SELECT view_gbn FROM ishomedb.tz_board WHERE board_no = ABS(b.upper_no)
                   ), view_gbn) AS view_gbn /* 답변글일 경우 상위 글의 공개 여부를 가져옴 */
                  ,b.use_yn
                  ,b.reg_id
                  ,b.reg_dt
                  ,b.upd_id
                  ,b.user_nm 
                  ,c.code_nm
                  ,b.status
                  ,b.as_status
                  ,b.read_auth
                  ,b.upd_dt
                  ,p.nickname
                  ,(SELECT COUNT(1) FROM tz_board_recommend WHERE board_no = b.board_no) AS recom_cnt
                  ,(SELECT SUM(download_cnt) FROM ishomedb.tz_board_file_seq WHERE upload_seq = b.file_seq) AS down_cnt
                  ,(SELECT COUNT(1) FROM tz_board_comment WHERE board_no = b.board_no) AS board_cnt
                  ,(SELECT COUNT(1) FROM ishomedb.tz_board WHERE upper_no = b.upper_no) AS count_no /* 게시물 답변 갯수 */
                  ,b.sub_category_no
            FROM ishomedb.tz_board b
            LEFT JOIN ishomedb.tz_member m
            ON b.reg_id = m.user_id
            LEFT JOIN ishomedb.tz_member mu
            ON b.upd_id = mu.user_id
            LEFT JOIN ishomedb.tz_code c
            ON b.main_team = c.code_no
            AND c.code_gbn = '10168'
            LEFT JOIN ishomedb.tz_board_master bm
            ON b.master_no = bm.master_no
            AND bm.master_no = '189'
            LEFT JOIN ishomedb.tz_profile p
            ON b.reg_id = p.reg_id
             
            INNER JOIN (SELECT @rownum := 0) rownum
              
            
             
         WHERE  IFNULL(b.top_yn, 'N') = 'N'
            
            
            
            AND b.master_no = '189'
            
            
                   
            
            
             /* 기간  start */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  >=  DATE_FORMAT('2015.02.04', '%Y.%m.%d')
            
             /* 기간  end */
            AND DATE_FORMAT(b.reg_dt,'%Y.%m.%d')  <=  DATE_FORMAT('2015.05.05', '%Y.%m.%d') 
     
             
            ORDER BY b.upper_no, b.ref_sort
               
            LIMIT 0, 30
            )
        ) x
        LEFT OUTER JOIN tz_member mem
        ON x.reg_id = mem.user_id
        LEFT OUTER JOIN tz_member upd
        ON x.upd_id = upd.user_id
        INNER JOIN tz_board upb
        ON ABS(x.upper_no) = upb.board_no
         
            ORDER BY nm, upper_no, ref_sort;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 18.029737  Lock_time: 0.001182 Rows_sent: 159  Rows_examined: 8214
SET timestamp=1430761088;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 236215
		AND    mag.auth_gbn = 10005

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150505  2:38:10
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 237.765436  Lock_time: 0.001266 Rows_sent: 10  Rows_examined: 1244006
SET timestamp=1430761090;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd  /*과목CD */
		    ,c.f_grade_cd    /*학년CD */
		    ,c.f_kind_cd
		    ,date_format(a.f_test_dt, '%Y.%m.%d %H:%i:%s') f_test_dt /*평가일*/
		    ,ifnull(date_format(a.f_checkpoint_dt, '%Y.%m.%d %H:%i:%s'), '미채점') f_checkpoint_dt /*채점일*/
		    ,edubasestudydb.testNmCreate (c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm
		    ,edubasestudydb.testNmCreateA(c.f_grade_cd, c.f_term_cd, c.f_test_nm, c.f_no) f_test_nm_all
		    ,m.login_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.student_id
		    ,mem.nm_kor as teacher_name   /* 선생님 성함 */
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
		    ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
		    ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
		FROM (
		    SELECT st.*
		        ,ist.student_no
		        ,ist.student_id
		        ,ist.teacher_id
		        ,ist.group_no
		    FROM edubasestudydb.t_student_test st
		    INNER JOIN (
		        SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
		        FROM edubasestudydb.t_student_test st
		        INNER JOIN ishomedb.tz_student s 
		        ON st.f_user_cd = s.student_no
		        INNER JOIN ishomedb.tz_teacher t
		        ON t.teacher_id = s.teacher_id
		        INNER JOIN ishomedb.tz_teacher_team_part ttp
		        ON ttp.part_no = t.part_no
		        WHERE DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
                 
                    AND ttp.team_no = '7'
                 
                 
                 
		        GROUP BY f_test_id, f_user_cd
		    ) ist
		    ON st.f_stu_test_id = ist.f_stu_test_id
		) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id
		LEFT OUTER JOIN ishomedb.tz_member mem
        ON a.teacher_id = mem.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
		WHERE IFNULL(pur.status_gbn, '') != 10010 /* 환불완료 제외 */
         
         
            AND a.f_ischeckpoint = 'N'
         
         
		 
		 
		 
       
		GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no
         
        LIMIT 0, 10;
# Time: 150505  2:38:22
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 321.505007  Lock_time: 0.001264 Rows_sent: 4360  Rows_examined: 72265
SET timestamp=1430761102;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150505  2:43:34
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 304.585111  Lock_time: 0.000042 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761414;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5510612';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 288.857530  Lock_time: 0.000112 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761414;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 435316;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 291.293105  Lock_time: 0.000160 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761414;
SELECT ttt.team_nm, COUNT(1) as total_count
        FROM tz_teacher tt
        INNER JOIN tz_teacher_team_part ttp ON tt.part_no = ttp.part_no
        INNER JOIN tz_teacher_team ttt ON ttp.team_no = ttt.team_no
        WHERE tt.teacher_id = 435316;
# Time: 150505  2:43:42
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 316.810706  Lock_time: 0.000632 Rows_sent: 6245  Rows_examined: 58961
SET timestamp=1430761422;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150505  2:44:27
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 38.161777  Lock_time: 0.000122 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430761467;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150505  2:45:02
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 33.462112  Lock_time: 0.000166 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430761502;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150505  2:47:30
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.372150  Lock_time: 0.002533 Rows_sent: 2  Rows_examined: 9839272
SET timestamp=1430761650;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150505  2:52:58
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 301.434992  Lock_time: 0.000050 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761978;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2081103w5309796';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 267.206269  Lock_time: 0.000070 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761978;
SELECT d.product_nm
              ,b.start_de
              ,b.end_de 
        FROM tz_purchase_student a 
            ,tz_student  b
            ,tz_purchase c
            ,tz_product  d
        WHERE a.temp_student_no = b.student_no
          AND c.PRODUCT_NO      = d.PRODUCT_NO
          AND a.PURCHASE_NO     = c.PURCHASE_NO
          AND b.student_no = '200955';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 274.759441  Lock_time: 0.000073 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761978;
SELECT d.product_nm
              ,b.start_de
              ,b.end_de 
        FROM tz_purchase_student a 
            ,tz_student  b
            ,tz_purchase c
            ,tz_product  d
        WHERE a.temp_student_no = b.student_no
          AND c.PRODUCT_NO      = d.PRODUCT_NO
          AND a.PURCHASE_NO     = c.PURCHASE_NO
          AND b.student_no = '200955';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 248.039041  Lock_time: 0.000069 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430761978;
SELECT d.product_nm
              ,b.start_de
              ,b.end_de 
        FROM tz_purchase_student a 
            ,tz_student  b
            ,tz_purchase c
            ,tz_product  d
        WHERE a.temp_student_no = b.student_no
          AND c.PRODUCT_NO      = d.PRODUCT_NO
          AND a.PURCHASE_NO     = c.PURCHASE_NO
          AND b.student_no = '200955';
# Time: 150505  2:53:09
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 319.685222  Lock_time: 0.001258 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430761989;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150505  2:54:13
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 60.103804  Lock_time: 0.001736 Rows_sent: 8202  Rows_examined: 1690425
SET timestamp=1430762053;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150505  2:54:34
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 13.969917  Lock_time: 0.000218 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430762074;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:55:03
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.211593  Lock_time: 0.000217 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430762103;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:55:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.007260  Lock_time: 0.000217 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430762116;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:55:26
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.510457  Lock_time: 0.000247 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430762126;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:55:36
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.067609  Lock_time: 0.000225 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430762136;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:55:53
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.085106  Lock_time: 0.000240 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430762153;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:56:07
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.344184  Lock_time: 0.000237 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430762167;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:56:18
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.978181  Lock_time: 0.000216 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430762178;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:56:31
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.784108  Lock_time: 0.000207 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430762191;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:56:55
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.434382  Lock_time: 0.000227 Rows_sent: 64476  Rows_examined: 211319
SET timestamp=1430762215;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150505  2:57:09
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.177051  Lock_time: 0.000161 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430762229;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150505  2:58:37
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 85.735674  Lock_time: 0.000204 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430762317;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150505  2:59:48
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.265523  Lock_time: 0.001802 Rows_sent: 1418  Rows_examined: 1629157
SET timestamp=1430762388;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150505  3:00:41
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 47.537200  Lock_time: 0.002326 Rows_sent: 5572  Rows_examined: 18899
SET timestamp=1430762441;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150505 11:22:18
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 21.877971  Lock_time: 0.000707 Rows_sent: 15156  Rows_examined: 68757150
SET timestamp=1430792538;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150505 11:22:45
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 23.120536  Lock_time: 0.000405 Rows_sent: 15156  Rows_examined: 68757152
SET timestamp=1430792565;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150505 13:57:21
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 7.439414  Lock_time: 0.000298 Rows_sent: 30  Rows_examined: 1926707
SET timestamp=1430801841;
SELECT 
			thci.seq, 																			 		 /*시퀀스*/
			thci.phone_gbn, 																			 /* 수,발신구분 */
			DATE_FORMAT(thci.record_dt,'%Y-%m-%d')AS record_ymd, 										 /* 통화 일자(Y-m-d) */
            CASE
                WHEN date_add(NOW(), interval - 14 day)  <=  DATE_FORMAT(thci.record_dt,'%Y-%m-%d') THEN 'Y'
                ELSE
                    'N'
            END AS new_yn,                                                                               /* 오늘 날짜 기준으로 통화한지 14일 이전인지 여부 */
			DATE_FORMAT(thci.record_dt,'%H:%i:%s')AS start_record_dt,                           		 /*통화 시작 시간*/
			SUBSTRING(thci.record_dt+ INTERVAL (thci.record_time/1000) second,12,8) AS end_record_dt,	 /*통화 종료 시간*/
			thci.record_time, 																			 /*녹취 파일 시간 */
			SEC_TO_TIME(thci.record_time/ 1000)as hms,                      						     /*통화 시:분:초 */
			CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_no
	        ELSE thci.receive_no
	        END as target_no,																			 /*대상자번호*/
	        CASE
	    	WHEN thci.phone_gbn = 'R' then thci.send_uid
	        ELSE thci.receive_uid
	        END as target_uid,   																		 /*uid검색*/
	        floor(record_time/1000)as timeSecond,														 /*통화시간 초*/
	        thci.teacher_id, 																			 /* 관리교사 아이디 */
			tm.nm_kor as teacher_name, 																	 /* 관리교사 한글 이름 */
			tm.login_id, 																				 /*로그인 아이디 */
			tm.nm_kor as send_name, 																	 /*발신자 이름*/
			tm.login_id as send_loginid ,																 /*발신자 아이디 */
			thci.send_no, 																				 /* 발신 번호 */
			thci.receive_uid, 																   		  	 /* 수신자 아이디 */
			tm1.nm_kor as receive_name, 																 /* 수신자 이름*/
			tm1.login_id as receive_loginid, 												  			 /*수신자 아이디*/
			CASE
	    	WHEN thci.phone_gbn = 'S' and receive_uid is not null
	    		then tm1.nm_kor
	    	WHEN thci.phone_gbn = 'R'  and send_uid is not null
	    		then tm.nm_kor
	        ELSE "-"
	        END as target_user,
			thci.receive_no, 																			 /* 수신 번호 */
			thm.mdn, 																					 /*홈런폰 사용자 번호*/
			thci.record_file,																			 /*녹취 파일 */
			thci.uuid 																						 /*단말기와 일치시켜주기 위한 id */
		FROM tz_hpm_call_info thci
		INNER JOIN tz_hpm_member thm
		ON thm.teacher_id = thci.teacher_id
		INNER JOIN tz_member tm
		ON tm.user_id = thci.teacher_id
		LEFT OUTER JOIN tz_member tm1
		ON tm1.user_id = thci.receive_uid
		 
		 WHERE  thci.record_dt  >= CONCAT('2015-03-01', ' 00:00:00')
			
				AND thci.record_dt  <= CONCAT('2015-05-31', ' 23:59:59') 
	 
		  ORDER BY thci.reg_dt DESC 
         
		LIMIT 0, 30;
# Time: 150505 21:48:06
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 6.319920  Lock_time: 0.000444 Rows_sent: 4087  Rows_examined: 3344531
SET timestamp=1430830086;
SELECT a.f_stu_test_id
		    ,a.f_test_id
		    ,a.f_user_cd
		    ,a.f_point
		    ,a.f_ischeckpoint
		    ,c.f_subject_cd /*과목CD */
		    ,c.f_grade_cd /*학년CD */
		    ,c.f_kind_cd
		    ,DATE_FORMAT(a.f_test_dt, '%Y.%m.%d') f_test_dt /*평가일*/
		    ,IFNULL(DATE_FORMAT(a.f_checkpoint_dt, '%Y.%m.%d'), '미채점') f_checkpoint_dt /*채점일*/
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, 
	            CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN c.f_test_nm
	                 WHEN CHAR_LENGTH(c.f_test_nm) > 12 THEN CONCAT(SUBSTRING(c.f_test_nm, 1, 9), '...') 
	                 ELSE c.f_test_nm END, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm
	        ,CONCAT('[', SUBSTRING(c.f_grade_cd, -1), '-', SUBSTRING(c.f_term_cd, -1), ' ', z.f_caption, 
	          CASE WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN '] '
	               ELSE CONCAT(' ', SUBSTRING(lsl.order_key, 1, 2), '] ')
	          END, 
	            CASE WHEN lsl.lesson_gbn = 10001 THEN CONCAT(lsl.sort, '.')
	                 WHEN (lsl.lesson_gbn = 10002 OR lsl.lesson_gbn = 10003) THEN ''
	                 ELSE CONCAT(lsl.sort, '장.') 
	            END, c.f_test_nm, 
	            CONCAT('(', c.f_no, '회차)')) AS f_test_nm_all
		    ,m.login_id
		    ,m.user_id
		    ,m.nm_kor user_nm
		    ,a.student_no
		    ,a.teacher_id
		    ,x.f_caption f_kind_cd_nm    /*평가구분*/
		    ,y.f_caption f_grade_cd_nm   /*학년구분*/
		    ,z.f_caption f_subject_cd_nm /*과목구분*/
		    ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = a.group_no), '미지정') AS group_nm 
		    ,c.f_problem_cnt
            ,SUM(IF(stp.f_result='0', 0, 1)) AS r_cnt
            ,SUM(IF(stp.f_result='0', 1, 0)) AS w_cnt
	    FROM (
	        SELECT st.*
	            ,ist.student_no
	            ,ist.student_id
	            ,ist.teacher_id
	            ,ist.group_no
	        FROM edubasestudydb.t_student_test st
	        INNER JOIN (
	            SELECT MAX(f_stu_test_id) AS f_stu_test_id, s.*
	            FROM edubasestudydb.t_student_test st
	            INNER JOIN ishomedb.tz_student s 
	            ON st.f_user_cd = s.student_no
	            WHERE s.teacher_id = 158437
                AND DATE_FORMAT(IFNULL(s.end_de, NOW()), '%Y-%m-%d') >= DATE_FORMAT(NOW(), '%Y-%m-%d')
	            GROUP BY f_test_id, f_user_cd
	        ) ist
	        ON st.f_stu_test_id = ist.f_stu_test_id
	    ) a
		INNER JOIN ishomedb.tz_purchase_student pch 
		ON a.student_no = pch.temp_student_no
		INNER JOIN ishomedb.tz_purchase pur
		ON pch.purchase_no = pur.purchase_no
		INNER JOIN ishomedb.tz_member m
		ON a.student_id = m.user_id    
		INNER JOIN edubasestudydb.t_test c
		ON a.f_test_id = c.f_test_id
        INNER JOIN ishomedb.tz_lcms_study_lesson lsl
        ON lsl.subj_lesson_no = c.f_chapter_cd
		INNER JOIN edubasestudydb.t_code_ref x
		ON c.f_kind_cd = CONCAT(x.f_group_id, x.f_detail_id) AND x.f_group_id = 'T1'
		INNER JOIN edubasestudydb.t_code_ref y 
		ON c.f_grade_cd = CONCAT(y.f_group_id, y.f_detail_id) AND y.f_group_id = 'GR'
		INNER JOIN edubasestudydb.t_code_ref z 
		ON c.f_subject_cd = CONCAT(z.f_group_id, z.f_detail_id) AND z.f_group_id = 'SB'
		LEFT OUTER JOIN edubasestudydb.t_student_test_problem stp
		ON stp.f_stu_test_id = a.f_stu_test_id
        WHERE IFNULL(pur.status_gbn, '') != 10010
         
           
            
              AND a.f_ischeckpoint = 'Y'
           
           
           
           
              AND c.f_kind_cd = 'T120'
           
            
            
       
        GROUP BY a.f_stu_test_id
        ORDER BY 
         
        f_ischeckpoint DESC, f_test_dt DESC, c.f_grade_cd, c.f_term_cd, c.f_subject_cd, c.f_kind_cd, c.f_no;
# Time: 150505 23:14:19
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.006215  Lock_time: 0.000155 Rows_sent: 3  Rows_examined: 42987010
SET timestamp=1430835259;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150505 23:15:06
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 29.025708  Lock_time: 0.000157 Rows_sent: 2  Rows_examined: 42987021
SET timestamp=1430835306;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150505 23:15:15
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 28.038213  Lock_time: 0.000145 Rows_sent: 2  Rows_examined: 42987023
SET timestamp=1430835315;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150505 23:15:48
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 26.936354  Lock_time: 0.000140 Rows_sent: 1  Rows_examined: 42987032
SET timestamp=1430835348;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150505 23:17:32
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 27.349734  Lock_time: 0.000161 Rows_sent: 2  Rows_examined: 42987055
SET timestamp=1430835452;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150506  2:31:50
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 303.174551  Lock_time: 0.000047 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430847110;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2001221j3134347';
# Time: 150506  2:33:19
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 422.954892  Lock_time: 0.001202 Rows_sent: 27236  Rows_examined: 254249
SET timestamp=1430847199;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.textbook_dic_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>교과서사전>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							          case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								,sd.dictionary_no
								,'교과서사전' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.textbook_dic_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 1
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 1
						AND sd.dictionary_no IS NOT NULL
						AND l.use_yn  = 'Y';
# Time: 150506  2:38:37
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 305.801381  Lock_time: 0.000045 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430847517;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5620824';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 130.349636  Lock_time: 0.000285 Rows_sent: 1  Rows_examined: 5
SET timestamp=1430847517;
SELECT  a.teacher_id
                ,par.nm_kor
                ,a.work_de
                ,a.attend_dt
                ,a.leave_dt
                ,if(substring(a.work_de,9,9)  <  10,substring(a.work_de,10,10),substring(a.work_de,9,9)) AS  attnd_day
                ,b.part_no
                ,c.part_nm
                ,d.team_nm
        FROM    ishomedb.tz_teacher_attend a
  
        LEFT    OUTER JOIN ishomedb.tz_member par
        ON      a.teacher_id = par.user_id
        
        LEFT    OUTER JOIN ishomedb.tz_teacher b
        ON      a.teacher_id = b.teacher_id
        
        LEFT    OUTER JOIN ishomedb.tz_teacher_team_part c
        ON      b.part_no = c.part_no
        
        LEFT    OUTER JOIN ishomedb.tz_teacher_team d
        ON      c.team_no = d.team_no
          
        ORDER BY a.teacher_id,a.work_de
        LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 124.229381  Lock_time: 0.000276 Rows_sent: 1  Rows_examined: 5
SET timestamp=1430847517;
SELECT  a.teacher_id
                ,par.nm_kor
                ,a.work_de
                ,a.attend_dt
                ,a.leave_dt
                ,if(substring(a.work_de,9,9)  <  10,substring(a.work_de,10,10),substring(a.work_de,9,9)) AS  attnd_day
                ,b.part_no
                ,c.part_nm
                ,d.team_nm
        FROM    ishomedb.tz_teacher_attend a
  
        LEFT    OUTER JOIN ishomedb.tz_member par
        ON      a.teacher_id = par.user_id
        
        LEFT    OUTER JOIN ishomedb.tz_teacher b
        ON      a.teacher_id = b.teacher_id
        
        LEFT    OUTER JOIN ishomedb.tz_teacher_team_part c
        ON      b.part_no = c.part_no
        
        LEFT    OUTER JOIN ishomedb.tz_teacher_team d
        ON      c.team_no = d.team_no
          
        ORDER BY a.teacher_id,a.work_de
        LIMIT 1;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 106.174824  Lock_time: 0.000156 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430847517;
SELECT COUNT(a.manager_id) AS cnt  
        FROM   ishomedb.tz_manager a
         
        INNER  JOIN ( SELECT  code_no
                             ,code_nm
                      FROM   ishomedb.tz_code
                      WHERE  code_gbn = 10001
                    ) b
        ON      b.code_no = a.auth_gbn
        
        WHERE   a.manager_id = 157
          AND   a.auth_gbn = 10010;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 55.104435  Lock_time: 0.000174 Rows_sent: 1  Rows_examined: 0
SET timestamp=1430847517;
SELECT COUNT(a.manager_id) AS cnt  
        FROM   ishomedb.tz_manager a
         
        INNER  JOIN ( SELECT  code_no
                             ,code_nm
                      FROM   ishomedb.tz_code
                      WHERE  code_gbn = 10001
                    ) b
        ON      b.code_no = a.auth_gbn
        
        WHERE   a.manager_id = 157
          AND   a.auth_gbn = 10010;
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 55.296147  Lock_time: 0.001164 Rows_sent: 362  Rows_examined: 8452
SET timestamp=1430847517;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 157
		AND    mag.auth_gbn = 10001

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'admin';
# Time: 150506  2:38:50
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 327.427010  Lock_time: 0.001275 Rows_sent: 4360  Rows_examined: 72265
SET timestamp=1430847530;
SELECT		sd.dictionary_no
                                ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                               ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
							   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
                               ,s.subj_gbn
                               ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
                               ,l.subj_lesson_nm
                               ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
                               ,l.subj_lesson_no
                               ,l.subj_lesson_nm
 							   ,l.subj_no
							   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
							   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
							   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
							   ,l.upper_no
							   ,l.lvl
							   ,l.reg_id
                               ,s.basic_ency_yn
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
 							   ,l.subj_no
                               ,l.subj_lesson_no
                               ,concat('학습사전>기본학습백과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							           case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
                               ,sd.dictionary_no
								,'기본학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_lesson l
						INNER  JOIN ishomedb.tz_lcms_subj s
						ON     l.subj_no = s.subj_no
						AND    s.basic_ency_yn IN ('C', 'U')
						LEFT   OUTER JOIN ishomedb.tz_lcms_study_dictionary sd
						ON     l.subj_lesson_no = sd.subj_lesson_no
						AND    sd.dictionary_type = 2
				WHERE  (lesson_gbn IS NULL
							OR  (l.lesson_gbn != 10002
							AND  l.lesson_gbn != 10003))
						AND s.textbook_dic_yn is not null
						AND sd.dictionary_type = 2
						AND l.use_yn  = 'Y';
# Time: 150506  2:43:59
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 303.808277  Lock_time: 0.000062 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430847839;
select objectname_kor
						,headline
						,origin_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2070316m5627309';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 51.444775  Lock_time: 0.000137 Rows_sent: 1  Rows_examined: 231
SET timestamp=1430847839;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 24057
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 97.126899  Lock_time: 0.000129 Rows_sent: 1  Rows_examined: 231
SET timestamp=1430847839;
SELECT count(*) as cnt    
		FROM ishomedb.tz_student
		WHERE teacher_id = 24057
		  AND manage_start_de is null
		  AND end_de >= now();
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 97.014623  Lock_time: 0.001135 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430847839;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 24057
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150506  2:44:00
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 97.044201  Lock_time: 0.001145 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430847840;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 24057
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 51.380629  Lock_time: 0.001172 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430847840;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 24057
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 51.388969  Lock_time: 0.001036 Rows_sent: 114  Rows_examined: 8164
SET timestamp=1430847840;
SELECT  a.menu_no   /* 메뉴 ID */
               ,a.upper_no  /* 부모 메뉴 ID */
               ,a.menu_nm   /* 메뉴 한글명  */
               ,mth.func_rw /* 메뉴 Read, Write */
               ,a.sort      /* 정렬 */
               ,ishomedb.uf_menu_connect_by_path(' > ', a.menu_no, 4) AS path  /* 메뉴한글 Path */
               ,IFNULL((CASE WHEN a.menu_url = '' THEN ''
                             ELSE CONCAT('/sigong', a.menu_url)
                        END), '') AS menu_url   /* 메뉴 URL */
                        
               ,(CASE WHEN (CASE  WHEN b.level >= @maxlevel THEN 1
                                  ELSE COALESCE( ( SELECT  0
                                                   FROM    ishomedb.tz_menu a
                                                   WHERE   a.upper_no = b.menu_no
                                                   LIMIT   1), 1)
                             END) = 1 THEN 'page'
                                      ELSE 'folder'
                END) AS leaf                    /* 마지막 노드 구분 */
        
        FROM   ishomedb.tz_menu a
        
        INNER  JOIN ( SELECT  ishomedb.uf_menu_connect_by(@maxlevel) AS menu_no
                             ,CAST(@level AS SIGNED) AS level 
                      FROM    ( SELECT  @start_with := -1, /* start upper_no code*/
                                        @id := @start_with, 
                                        @level := 0,
                                        @maxlevel := 10
                               ) vars,
                                 ishomedb.tz_menu
                      WHERE   @id IS NOT NULL
                     ) b
        ON     a.menu_no = b.menu_no
		
		INNER  JOIN ishomedb.tz_menu_auth mth
		ON     a.menu_no = mth.menu_no
		
		INNER  JOIN ishomedb.tz_manager mag
		ON     mth.auth_gbn = mag.auth_gbn
		AND    mag.manager_id = 24057
		AND    mag.auth_gbn = '10007'

        WHERE  a.use_yn = 'Y'
        AND    a.menu_sort = 'adminTeacher';
# Time: 150506  2:44:16
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 322.034098  Lock_time: 0.000625 Rows_sent: 6245  Rows_examined: 58961
SET timestamp=1430847856;
SELECT		sd.dictionary_no
								,date_format(sd.reg_dt,'%Y%m%d%H%i%s') as Date
                                ,'' as CATECODE2
                                ,'' as CATENAME2
                                ,'' as CATECODE3
								,'' as CATENAME3
							   ,'' as subj_lesson_nm
							   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no ) as porting_value
							   ,sd.subj_lesson_no
							   ,'' as subj_lesson_nm
							   ,'' as subj_no
 							   ,'' as  subj_nm
							   ,'' as local_nm
							   ,'' as approval_nm
							   ,'' as upper_no
							   ,'' as lvl
							   ,'' as reg_id
                               ,'U' as DATA_YN
							   ,lc.porting_value
                               ,'' as ACRO
                               ,concat('학습사전>',(select uf_lcms_theme_category_connect_by_path('>',category_no, 7) from tz_lcms_theme_category where category_no = sd.deep_category_no)) AS PATH
							   ,sd.dictionary_no
							   ,'심화학습백과' as CATENAME1
				FROM   ishomedb.tz_lcms_study_dictionary sd
						LEFT	OUTER JOIN tz_lcms_contents lc
						ON     lc.contents_no = sd.contents_no
						AND    sd.contents_no IS NOT NULL
				WHERE  sd.dictionary_type = 3
						AND sd.dictionary_no IS NOT NULL
						AND sd.deep_category_no IS NOT NULL;
# Time: 150506  2:45:00
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 38.089869  Lock_time: 0.000120 Rows_sent: 211580  Rows_examined: 211580
SET timestamp=1430847900;
SELECT		ed_id as DOCID
									,'' as Date
									,'' as CATECODE2
									,'' as CATENAME2
									,'' as CATECODE3
									,'' as CATENAME3
									,entryname as SUB_TITLE
									,'' as CONTENT_NO
									,'' as SUBJ_LESSON_NO
									,'' as SUBJ_LESSON_NM
									,'' as SUBJ_NO
									,'' as SUBJ_NM
									,pronoun1 as LOCAL_NM
									,'' as APPROVAL_NM
									,'' as UPPER_NO
									,'' as LEVEL
									,'' as REG_ID
									,'' as DATA_YN
									,searchword1 as TITLE
									,body as CONTENT
									,'' as SERVICE_PATH
									,'' as THUMB_PATH
									,'' as MEDIA_TIME
									,'' as MEDIA_TYPE
									,'' as ACRO
									,'' as CATE_LEVEL
									,ed_id as KEYVALUE
									,'영어사전' as CATENAME1
						FROM		tz_english_dictionary
						WHERE		ed_id is not null;
# Time: 150506  2:45:35
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 32.996795  Lock_time: 0.000146 Rows_sent: 234174  Rows_examined: 234174
SET timestamp=1430847935;
SELECT		id as DOCID
								,'' as Date
								,'' as CATECODE2
								,'' as CATENAME2
								,'' as CATECODE3
								,'' as CATENAME3
								,entryname as SUB_TITLE
								,'' as CONTENT_NO
								,'' as SUBJ_LESSON_NO
								,'' as SUBJ_LESSON_NM
								,'' as SUBJ_NO
								,hanja as SUBJ_NM
								,pronoun as LOCAL_NM
								,'' as APPROVAL_NM
								,'' as UPPER_NO
								,'' as LEVEL
								,'' as REG_ID
								,'' as DATA_YN
								,searchword as TITLE
								,body as CONTENT
								,'' as SERVICE_PATH
								,'' as THUMB_PATH
								,'' as MEDIA_TIME
								,'' as MEDIA_TYPE
								,'' as ACRO
								,'' as CATE_LEVEL
								,id as KEYVALUE
								,'국어사전' as CATENAME1
					FROM		tz_korea_dictionary
					WHERE		id is not null;
# Time: 150506  2:48:02
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 6.388353  Lock_time: 0.002525 Rows_sent: 2  Rows_examined: 9839272
SET timestamp=1430848082;
SELECT  concat(sh.homework_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'HOMEWORK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학교숙제해결>숙제자료>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '숙제자료' AS CATENAME1
									, cc2.org_vector AS URL
									, 'HOMEWORK' AS CATECODE1
						FROM    (
														SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															   ,CAST(@level	AS SIGNED) AS hlvl
														FROM   (
																SELECT	@start_with	:= 0,
																		@id			:= @start_with,
																		@level		:= 0,
																		@maxlevel	:= 5
															   ) vars, ishomedb.tz_lcms_study_lesson
														WHERE	@id	IS NOT NULL
													   ) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.homework_data_yn = 'U'
								INNER JOIN ishomedb.tz_lcms_subj_homework sh  
								ON    sh.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sh.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'TEXTBOOK' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>교과서사전>'
									, ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
									, s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
									, (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '교과서사전' AS CATENAME1
									, cc2.org_vector AS URL
									, 'TEXTBOOK' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 1
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT  concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(l.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'BASIC' AS SUBJECT
									, ishomedb.uf_code_subj_nm(s.subj_gbn) AS SUBJ_TITLE
									, cc2.contents_no
									, l.subj_no
									, l.subj_lesson_no
									, concat('학습사전>기본학습백과>'
										  , ishomedb.uf_code_subj_nm(s.subj_gbn), '>'
										  , s.grade_gbn, case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end
										  , (
												SELECT uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no,	1) as path
																  FROM	 tz_lcms_study_lesson
																  WHERE  subj_lesson_no	= l.subj_lesson_no
											)
									) AS CATE_LEVEL
									, '기본학습백과' AS CATENAME1
									, cc2.org_vector AS URL
									, 'BASIC' AS CATECODE1
						FROM    (
											  SELECT	ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel)	AS id
															  , CAST(@level	AS SIGNED) AS hlvl
												FROM    (
																	SELECT	@start_with	:= 0
														, @id	:= @start_with
														, @level := 0
														, @maxlevel	:= 5
															   ) vars
											 , ishomedb.tz_lcms_study_lesson
												WHERE	@id	IS NOT NULL
										) cb
								INNER JOIN ishomedb.tz_lcms_study_lesson l
								ON    l.subj_lesson_no = cb.id
								INNER JOIN ishomedb.tz_lcms_subj s
								ON    s.subj_no = l.subj_no
								AND   s.textbook_dic_yn IN ('C', 'U')
								INNER JOIN ishomedb.tz_lcms_study_dictionary sd
								ON    sd.subj_lesson_no = cb.id
								AND   sd.dictionary_type = 2
								INNER JOIN ishomedb.tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    cc.contents_no = lc.porting_value
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cct.contents_no = cc.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cc2.contents_no = cct.code
								AND   cc2.media_type = 'MOD'
						 WHERE  (lesson_gbn IS NULL OR (l.lesson_gbn != 10002 AND l.lesson_gbn != 10003)) 
										AND l.use_yn  = 'Y'
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL
						UNION ALL
						SELECT	concat(sd.dictionary_no, cc2.contents_no) AS DOCID
									, date_format(sd.reg_dt,'%Y%m%d%H%i%s') AS Date
									, 'DEEP' AS SUBJECT
									, '' AS SUBJ_TITLE
									, cc2.contents_no
									, '' AS subj_no
									, '' AS subj_lesson_no
									, (
											  select uf_lcms_theme_category_connect_by_path('>',category_no, 7) 
											  from tz_lcms_theme_category 
											  where category_no = sd.deep_category_no
									) AS CATE_LEVEL
									, '심화학습백과' AS CATENAME1
									, cc2.org_vector AS URL   
									, 'DEEP' AS CATECODE1
						FROM    ishomedb.tz_lcms_study_dictionary sd
								LEFT OUTER JOIN tz_lcms_contents lc
								ON    lc.contents_no = sd.contents_no
								AND   sd.contents_no IS NOT NULL
								INNER JOIN ishomedb.tz_cms_contents cc
								ON    lc.porting_value = cc.contents_no
								INNER JOIN ishomedb.tz_cms_contents_code cct
								ON    cc.contents_no = cct.contents_no
								AND   cct.contents_type = 5
								INNER JOIN ishomedb.tz_cms_contents cc2
								ON    cct.code = cc2.contents_no
								AND   cc2.media_type = 'MOD'
						WHERE   sd.dictionary_type = 3
								AND sd.deep_category_no IS NOT NULL
								AND lc.porting_value IS NOT NULL
								AND cc2.contents_no IS NOT NULL;
# Time: 150506  2:53:31
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 301.408733  Lock_time: 0.000054 Rows_sent: 1  Rows_examined: 1
SET timestamp=1430848411;
select objectname_kor
						,headline
						,org_vector as service_path
						,thumb_path
						,pic_mediatime
						,media_type
					from tz_cms_contents where contents_no = '2081103h4928267';
# Time: 150506  2:53:42
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 319.897524  Lock_time: 0.001305 Rows_sent: 3689  Rows_examined: 40613
SET timestamp=1430848422;
SELECT sh.homework_no
						   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
						   ,s.subj_gbn
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,sh.title
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_lesson_no
						   ,l.subj_lesson_nm
						   ,l.subj_no
						   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
						   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
						   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
						   ,l.upper_no
						   ,l.lvl
						   ,l.reg_id
						   ,s.homework_data_yn
						   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sh.contents_no) as porting_value
						   ,l.subj_no
						   ,l.subj_lesson_no
						   ,concat('학교숙제해결>숙제자료>',ishomedb.uf_code_subj_nm(s.subj_gbn),'>', s.grade_gbn, 
						       case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,  (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
								   from tz_lcms_study_lesson
								   where subj_lesson_no = l.subj_lesson_no)) as path
							,sh.homework_no
						   ,'' as placeCount
						   ,'숙제자료' as CATENAME1
					FROM   ishomedb.tz_lcms_study_lesson l
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.homework_data_yn = 'U'
					AND    l.lvl = 1
					LEFT   OUTER JOIN ishomedb.tz_lcms_subj_homework sh
					ON     l.subj_lesson_no = sh.subj_lesson_no
					 WHERE  (lesson_gbn IS NULL
						OR  (l.lesson_gbn != 10002
						AND  l.lesson_gbn != 10003))
						and sh.homework_no is not null
						and sh.use_yn  = 'Y';
# Time: 150506  2:54:46
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 60.064109  Lock_time: 0.001740 Rows_sent: 8202  Rows_examined: 1690425
SET timestamp=1430848486;
SELECT        sd.dictionary_no
								   ,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,concat(s.grade_gbn, '-', s.semester_gbn) as grade_semester_gbn
								   ,s.subj_gbn
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,l.subj_lesson_nm
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_lesson_no
								   ,l.subj_lesson_nm
								   ,l.subj_no
								   ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm
								   ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm
								   ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm
								   ,l.upper_no
								   ,l.lvl
								   ,l.reg_id
								   ,s.core_junkwa_yn
								   ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = sd.contents_no) as porting_value
								   ,l.subj_no
								   ,l.subj_lesson_no
								  ,concat('학교숙제해결>핵심전과>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
								         case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                                        (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                                       from tz_lcms_study_lesson
                                       where subj_lesson_no = l.subj_lesson_no)
                                    ) as path
								   ,l.subj_lesson_no
								   ,'' as placeCount
								   ,'핵심전과' as CATENAME1
					FROM			(
									SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
										   ,CAST(@level AS SIGNED) AS hlvl
									FROM   (
											SELECT  @start_with := 0,
													@id         := @start_with,
													@level      := 0,
													@maxlevel   := 5
										   ) vars, ishomedb.tz_lcms_study_lesson
									WHERE   @id IS NOT NULL
								   ) cb
									INNER  JOIN ishomedb.tz_lcms_study_lesson l
									ON     l.subj_lesson_no = cb.id
									INNER  JOIN ishomedb.tz_lcms_subj s
									ON     l.subj_no = s.subj_no
									AND    s.core_junkwa_yn IN('C', 'U')
                                                                        AND    s.use_yn = 'Y'
									LEFT   OUTER JOIN ishomedb.tz_code c
									ON     c.code_gbn = 10104
									AND    c.code_no  = l.lesson_gbn
									LEFT   OUTER JOIN ishomedb.tz_lcms_dic_essence sd
									ON     sd.subj_lesson_no = cb.id
					 WHERE			(lesson_gbn IS NULL
									OR  (l.lesson_gbn != 10002
									AND  l.lesson_gbn != 10003))
									AND sd.dictionary_no is not null
									AND sd.use_yn  = 'Y';
# Time: 150506  2:55:07
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.064739  Lock_time: 0.000217 Rows_sent: 9564  Rows_examined: 88408
SET timestamp=1430848507;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '692' OR c.parentid = '693')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:55:36
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.629834  Lock_time: 0.000222 Rows_sent: 8509  Rows_examined: 82991
SET timestamp=1430848536;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '698' OR c.parentid = '699')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:55:49
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 10.248477  Lock_time: 0.000292 Rows_sent: 6502  Rows_examined: 61378
SET timestamp=1430848549;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '700')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:56:00
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.952804  Lock_time: 0.000221 Rows_sent: 4792  Rows_examined: 47421
SET timestamp=1430848560;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '701')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:56:10
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.144012  Lock_time: 0.000283 Rows_sent: 4199  Rows_examined: 40112
SET timestamp=1430848570;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '702')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:56:27
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 14.528404  Lock_time: 0.000217 Rows_sent: 9736  Rows_examined: 96261
SET timestamp=1430848587;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '703')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:56:41
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.331780  Lock_time: 0.000249 Rows_sent: 7404  Rows_examined: 77769
SET timestamp=1430848601;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '704')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:56:52
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 8.246082  Lock_time: 0.000218 Rows_sent: 5178  Rows_examined: 50534
SET timestamp=1430848612;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '705')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:57:05
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 11.010777  Lock_time: 0.000221 Rows_sent: 7311  Rows_examined: 68447
SET timestamp=1430848625;
SELECT  c.codeid as DOCID
							,case b.reg_date when '' then '19710101000000' else  date_format(b.reg_date,'%Y%m%d%H%i%s') end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as name
							,'' as CATECODE3
							,'' as CATENAME3
							,'' as SUB_TITLE
							,b.contents_no
							,'' as SUBJ_LESSON_NO
							,'' as SUBJ_LESSON_NM
							,'' as SUBJ_NO
							,'' as SUBJ_NM
							,'' as LOCAL_NM
							,'' as APPROVAL_NM
							,'' as UPPER_NO
							,'' as LEVEL
							,b.reg_id
							,'' as DATA_YN
							,b.objectname_kor
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.pic_mediatime
							,b.media_type
							,'' as ACRO
							,'' as CATE_LEVEL
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1

					FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
					WHERE ( c.parentid = '706')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  2:57:29
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 5.400778  Lock_time: 0.000187 Rows_sent: 64476  Rows_examined: 211319
SET timestamp=1430848649;
select	a.subjectlistid
							,case  when c.reg_date is NULL OR c.reg_date = '' then '19710101000000' 
									else  date_format(c.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,a.subjectid as CATECODE2
							,'' as CATENAME2
							,b.subjectname
							,case when (a.subject = '' or a.subject is null) then c.objectname_kor else a.subject end as title
							,c.headline
							,c.service_path
							,c.thumb_path
							,a.contents_no
							,'' as PLACECNT
							,'주제별이미지묶음' as CATENAME1
						from	ishomedb.tz_cms_contents_subject_list  a
						LEFT OUTER JOIN ishomedb.tz_cms_contents_subject  b
						ON        a.subjectid= b.subjectid
						INNER JOIN ishomedb.tz_cms_contents c
						ON         c.contents_no = a.contents_no
						WHERE	c.media_type = 'JPG';
# Time: 150506  2:57:44
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 7.946105  Lock_time: 0.000168 Rows_sent: 101568  Rows_examined: 203139
SET timestamp=1430848664;
SELECT  
							a.contents_no
							, case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							, ''
							, '' 
							, a.keyword as subject
							, a.title as title
							, a.description as content
							, a.service_path 
							, a.thumb_path
							, a.contents_no
							, '' AS PLACECNT
							, '낱장이미지' as CATENAME1
						FROM 
							ishomedb.tz_cms_contents_nonclass a, ishomedb.tz_cms_contents b
						WHERE 
							a.contents_div = 'IMG_ETC'
							and a.contents_no = b.contents_no;
# Time: 150506  2:59:13
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 86.219718  Lock_time: 0.000240 Rows_sent: 67128  Rows_examined: 733745
SET timestamp=1430848753;
SELECT  distinct  b.contents_no as DOCID
							,case  when b.reg_date is NULL OR b.reg_date = '' then '19710101000000' 
									else  date_format(b.reg_date,'%Y%m%d%H%i%s') 
							end as Date
							,c.parentid
							,(select name from ishomedb.tz_cms_common_code where codeid = c.parentid) as CATENAME2
							,'' as SUBJECT
							,b.objectname_kor 
							,b.headline
							,b.service_path
							,b.thumb_path
							,b.contents_no
							,b.contents_no
							,b.contents_no
							,'우리지역사진' as CATENAME1
						FROM   ishomedb.tz_cms_contents_code a
						INNER  JOIN ishomedb.tz_cms_contents b
						ON     a.contents_no = b.contents_no
						INNER JOIN ishomedb.tz_cms_common_code c
						ON a.codeid = c.codeid
						WHERE  c.parentid in ( '692','693','694','695','696','697','698','699','700','701','702','703','704','705','706','707')
						AND b.pic_level = '1'
						AND a.contents_type = '1'
						AND b.status = '승인'
						AND b.media_type = 'JPG';
# Time: 150506  3:00:25
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 12.070076  Lock_time: 0.001848 Rows_sent: 1418  Rows_examined: 1629157
SET timestamp=1430848825;
SELECT	distinct 
							l.subj_lesson_no as docid
							,date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
							,CONCAT( s.grade_gbn, '-' ,s.semester_gbn) AS grade_semester_gbn  
							,l.contents_xml_type
							,subj_gbn
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,l.subj_lesson_nm
							,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							,l.subj_lesson_no
							,l.subj_lesson_nm
							,s.subj_no
							,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm  
							,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm  
							,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm 
							,l.upper_no      
							,cb.hlvl AS org_lvl
							,l.reg_id
							,s.school_study_yn
							 ,(select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) as porting_value
							 ,l.subj_no  
							,l.subj_lesson_no
							 ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
							 case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
							(select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
									from tz_lcms_study_lesson
									where subj_lesson_no = l.subj_lesson_no)
							) as path
							,l.subj_lesson_no
							, ''
					FROM   (
							SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
									 ,CAST(@level AS SIGNED) AS hlvl
							FROM   (
											SELECT  @start_with := 0,
														@id         := @start_with,
														@level      := 0,
												   @maxlevel   := 5
									 ) vars, ishomedb.tz_lcms_study_lesson
							WHERE   @id IS NOT NULL
						 ) cb
					INNER  JOIN ishomedb.tz_lcms_study_lesson l
					ON     l.subj_lesson_no = cb.id
					INNER  JOIN ishomedb.tz_lcms_subj s
					ON     l.subj_no = s.subj_no
					AND    s.school_study_yn IN ('C','U')
					AND    s.use_yn = 'Y'
					INNER JOIN    ishomedb.tz_lcms_study_lesson_element le
					ON     l.subj_lesson_no = le.subj_lesson_no
					where (l.lesson_gbn <> 10001) OR l.lesson_gbn IS NULL
					and ((select porting_value from ishomedb.tz_lcms_contents lc where contents_no = l.contents_no) is not null)
					and l.use_yn = 'Y';
# Time: 150506  3:01:17
# User@Host: ishome[ishome] @  [114.207.114.57]
# Query_time: 47.767379  Lock_time: 0.002476 Rows_sent: 5572  Rows_examined: 18899
SET timestamp=1430848877;
select 
		CONCAT(e.subj_lesson_no, '_', e.subj_lesson_element_no) as docid
	   , date_format(e.Date,'%Y%m%d%H%i%s')
	   , e.grade_semester_gbn
	   , e.contents_xml_type
	   , e.subj_gbn
	   , e.subj_nm
	   , e.subj_lesson_nm
	   , e.porting_value
	   , e.subj_lesson_no1
	   , e.subj_lesson_nm1
	   , e.subj_no
	   , e.subj_nm 
	   , e.local_nm
	   , e.approval_nm
	   , e.upper_no      
	   , e.org_lvl
	   , e.reg_id
	   , e.school_study_yn
	   , e.porting_value
	   , e.subj_no
	   , e.subj_lesson_no2
	   , e.path
	   , e.subj_lesson_element_no
	   , (case when e.sort = 1 then (select @rownum := 1) else @rownum := @rownum + 1 end )
from (select @rownum := 1) r, (
    SELECT   a.subj_lesson_no as docid
          , a.Date
          , CONCAT(a.grade_gbn, '-', a.semester_gbn) AS grade_semester_gbn
          , a.contents_xml_type
          , a.subj_gbn
          , a.subj_nm
          , a.subj_lesson_nm
          , b.porting_value
          , a.subj_lesson_no
          , a.subj_lesson_nm as subj_lesson_nm1
          , a.subj_gbn as subj_gbn1
          , a.subj_nm as subj_nm1
          , a.local_nm
          , a.approval_nm
          , a.upper_no      
          , a.org_lvl
          , a.reg_id
          , a.school_study_yn
          , b.porting_value as porting_value1
          , a.subj_no
          , a.subj_lesson_no as subj_lesson_no1
          , concat(a.path, '>', b.element_nm) as path
          , a.subj_lesson_no as subj_lesson_no2
          , b.subj_lesson_element_no
          , b.sort
    FROM (
    SELECT  ishomedb.uf_code_grade_nm(s.grade_gbn)       AS grade_nm    /* 년도 구분 */
                  ,ishomedb.uf_code_semester_nm(s.semester_gbn) AS semester_nm /* 학기 구분 */
                  ,ishomedb.uf_code_subj_nm(s.subj_gbn)         AS subj_nm     /* 과목 구분 */
                  ,ishomedb.uf_code_local_nm(s.local_gbn)       AS local_nm    /* 지역 구분 */
                  ,ishomedb.uf_code_approval_nm(s.approval_gbn) AS approval_nm /* 지역 구분 */
                  ,s.grade_gbn
                  ,s.semester_gbn
                  ,l.subj_lesson_nm
                  ,s.subj_gbn
                  ,s.local_gbn
                  ,s.approval_gbn
                  ,l.upper_no          /* 상위 목차 번호 */
                  ,cb.hlvl AS org_lvl
                  ,l.reg_id
                  , date_format(l.reg_dt,'%Y%m%d%H%i%s') as Date
                  ,s.school_study_yn
                  ,l.subj_no 
                  ,concat('학교공부예복습>', ishomedb.uf_code_subj_nm(s.subj_gbn), '>', s.grade_gbn, 
				      case when s.semester_gbn = 3 then '학년' else concat('-', s.semester_gbn) end,
                      (select uf_lcms_study_lesson_connect_by_path('>', l.subj_lesson_no, 1) as path
                      from tz_lcms_study_lesson
                      where subj_lesson_no = l.subj_lesson_no) 
                    ) as path
                  ,l.subj_lesson_no    /* 목차 번호 */
                  ,CASE WHEN cb.hlvl >= @maxlevel THEN 1
                        ELSE COALESCE(
                            (
                            SELECT  0
                            FROM    ishomedb.tz_lcms_study_lesson l
                            WHERE   l.upper_no = cb.id
                            LIMIT 1
                            ), 1)
                    END AS isleaf
                  ,l.contents_xml_type
            FROM   (
                    SELECT  ishomedb.uf_lcms_study_lesson_connect_by(@maxlevel) AS id
                          ,CAST(@level AS SIGNED) AS hlvl
                    FROM   (
                            SELECT  @start_with := 0,
                                    @id         := @start_with,
                                    @level      := 0,
                                    @maxlevel   := 5
                          ) vars, ishomedb.tz_lcms_study_lesson
                    WHERE   @id IS NOT NULL
                  ) cb
            INNER  JOIN ishomedb.tz_lcms_study_lesson l
            ON     l.subj_lesson_no = cb.id
            INNER  JOIN ishomedb.tz_lcms_subj s
            ON     l.subj_no = s.subj_no
            AND    s.use_yn = 'Y'
            WHERE s.school_study_yn IN ('C', 'U')
              and l.use_yn = 'Y'
    ) a
    INNER JOIN
    (
    SELECT  le.subj_lesson_element_no
                  ,le.subj_lesson_no 
                  ,le.element_no
                  ,lc.porting_value
                  ,le.contents_title
                  ,le.sort
                  ,CONCAT(el.code_nm, ' / ', es.code_nm) AS element_nm
            FROM   ishomedb.tz_lcms_study_lesson_element le
            INNER  JOIN ishomedb.tz_lcms_study_element se
            ON     le.element_no = se.element_no
            LEFT   OUTER JOIN ishomedb.tz_lcms_contents lc
            ON     le.contents_no = lc.contents_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10105
                  ) el
            ON     se.element_gbn = el.code_no
            LEFT   OUTER JOIN
                  (
                    SELECT  code_no
                          ,code_nm 
                    FROM   ishomedb.tz_code 
                    WHERE  code_gbn = 10106
                  ) es
            ON     se.sub_element_gbn = es.code_no
            WHERE  EXISTS (
                        SELECT  1
                        FROM   ishomedb.tz_lcms_study_lesson l
                        INNER  JOIN ishomedb.tz_lcms_subj s
                        ON     l.subj_no        = s.subj_no
                        AND    s.use_yn = 'Y'
                        WHERE  l.subj_lesson_no = le.subj_lesson_no
                          and l.use_yn = 'Y'
                  )
            AND    se.element_type = 1
            AND el.code_no <> '10006'
    ) b
    ON a.subj_lesson_no = b.subj_lesson_no
    WHERE a.isleaf = 1 
    order by a.subj_lesson_no, b.sort
) e where e.porting_value is not null;
# Time: 150506  8:46:21
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 22.185976  Lock_time: 0.000426 Rows_sent: 15221  Rows_examined: 69067374
SET timestamp=1430869581;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150506  8:46:45
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 22.110225  Lock_time: 0.000404 Rows_sent: 15221  Rows_examined: 69067374
SET timestamp=1430869605;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150506  8:50:39
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 27.071612  Lock_time: 0.000163 Rows_sent: 2  Rows_examined: 42995247
SET timestamp=1430869839;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150506  8:57:27
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 27.465483  Lock_time: 0.000661 Rows_sent: 1  Rows_examined: 42995565
SET timestamp=1430870247;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150506  9:04:32
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.924848  Lock_time: 0.000602 Rows_sent: 30  Rows_examined: 5936086
SET timestamp=1430870672;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150506  9:06:44
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 27.385933  Lock_time: 0.000487 Rows_sent: 0  Rows_examined: 42996048
SET timestamp=1430870804;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150506 10:48:47
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 24.211263  Lock_time: 0.000379 Rows_sent: 15272  Rows_examined: 69297614
SET timestamp=1430876927;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150506 10:49:06
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 25.988743  Lock_time: 0.000384 Rows_sent: 15272  Rows_examined: 69297614
SET timestamp=1430876946;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150506 10:58:21
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 19.384782  Lock_time: 0.001700 Rows_sent: 100  Rows_examined: 15661837
SET timestamp=1430877501;
SELECT A.student_no
              ,s_user_id
              ,s_user_id AS user_id /* 안드로이드 접속정보 조회용 */
              ,parent_id
              ,teacher_id
              ,s_nm_kor
              ,p_nm_kor
              ,group_nm
              ,team_nm
              ,part_nm
              ,grade_gbn
              ,gender               
              ,s_user_id
              ,s_login_id
              ,p_login_id
              ,s_tel
              ,s_mobile
              ,blacklist_yn
              ,manage_start_de
              ,start_de
              ,end_de
              ,last_dt
              ,STR_TO_DATE(SUBSTRING(student_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS student_consult_dt
              ,student_gbn_code.code_nm AS student_consult_gbn
              ,SUBSTRING(student_consult_info, 22) AS student_consult_content
              ,STR_TO_DATE(SUBSTRING(parent_consult_info, 1, 16), '%Y%m%d%H:%i:%s') AS parent_consult_dt
              ,parent_gbn_code.code_nm AS parent_consult_gbn
              ,SUBSTRING(parent_consult_info, 22) AS parent_consult_content
              ,status
              ,product_nm
              ,plan_cnt + math_plan_cnt + theme_plan_cnt AS plan_cnt
              ,act_cnt + math_act_cnt + theme_act_cnt AS act_cnt
              ,CASE WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = 0 THEN '' 
                    WHEN plan_cnt + math_plan_cnt + theme_plan_cnt = act_cnt + math_act_cnt + theme_act_cnt THEN 'O'
                    WHEN act_cnt + math_act_cnt + theme_act_cnt = 0 THEN 'X'
                    ELSE 'U'
               END AS study_status
              ,product_no
              ,web_start_de
              ,web_end_de
              ,first_login_dt        
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.30'
                    AND lpm.plan_de <= '2015.05.06'
                GROUP BY lpm.student_no
               ) AS act_rate_week  
              ,  (SELECT 100*(SUM(CASE WHEN act.clear_dt IS NULL THEN 0 ELSE 1 END)/COUNT(lpm.module_no))
                FROM ishomedb.tz_lms_plan_module lpm
                LEFT OUTER JOIN ishomedb.tz_lms_act_module act
                ON lpm.student_no = act.student_no
                AND lpm.plan_de = act.plan_de
                AND lpm.module_no = act.module_no
                WHERE lpm.student_no = A.student_no
                    AND lpm.plan_de >= '2015.04.07'
                    AND lpm.plan_de <= '2015.05.06'
                GROUP BY lpm.student_no
               ) AS act_rate_month  
               ,cp_reg_dt
         
        ,  
           (SELECT stat_day26 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day1
        ,  
           (SELECT stat_day27 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day2
        ,  
           (SELECT stat_day28 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day3
        ,  
           (SELECT stat_day29 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day4
        ,  
           (SELECT stat_day30 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-04')
            
        as stat_day5
        ,  
           (SELECT stat_day1 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day6
        ,  
           (SELECT stat_day2 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day7
        ,  
           (SELECT stat_day3 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day8
        ,  
           (SELECT stat_day4 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day9
        ,  
           (SELECT stat_day5 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day10
        ,  
           (SELECT stat_day6 FROM tz_stat_lms_study_complete_mgnt WHERE student_no = A.student_no AND plan_month = '2015-05')
            
        as stat_day11
        ,             
           '-' 
            
        as stat_day12
        ,             
           '-'
            
        as stat_day13
        ,  
           '-' 
            
        as stat_day14        
     
        
        FROM (
            SELECT s.user_id AS s_user_id
                ,s.nm_kor AS s_nm_kor
                ,s.parent_id
                ,s.login_id AS s_login_id
                ,p.user_id AS p_user_id
                ,p.nm_kor AS p_nm_kor
                ,p.login_id AS p_login_id
                ,s.blacklist_yn
                ,CONCAT(s.tel1, '-', s.tel2, '-', s.tel3) AS s_tel
                ,CONCAT(s.mobile1, '-', s.mobile2, '-', s.mobile3) AS s_mobile               
                ,CASE WHEN s.gender = 'M' THEN '남'
                      WHEN s.gender = 'F' THEN '여'
                      ELSE '-'
                 END AS gender               
                ,IFNULL((SELECT group_nm FROM ishomedb.tz_student_group WHERE group_no = stu.group_no), '미지정') AS group_nm
                ,stu.student_no
                ,stu.teacher_id
                ,ttt.team_nm
                ,ttp.part_nm
                ,stu.grade_gbn
                ,CASE WHEN s.user_gbn_cls = '10004' THEN   /* 안드로이드 사용자 접속 정보. 이영무 */
                            'Android'
                      WHEN COALESCE(cs.user_id, -1) > 0 THEN 'ON'
                      ELSE 'OFF'
                 END AS status
                ,s.user_gbn_cls /* 안드로이드 사용자 구분용. 이영무 */
                ,(SELECT MAX(login_dt) FROM ishomedb.tz_connect_log WHERE user_id = stu.student_id) AS last_dt
                , 
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult con
                     WHERE student_no = stu.student_no 
                        AND target_id=s.user_id
                        AND content IS NOT NULL
                ) AS student_consult_info
                ,
                (
                  SELECT
                   MAX(CONCAT(DATE_FORMAT(consult_org_dt, '%Y%m%d%H:%i:%s'), IFNULL(consult_gbn, 'ZZZZZ'), substring(content, 1, 30) ))
                   FROM ishomedb.tz_lms_consult 
                     WHERE student_no = stu.student_no 
                        AND target_id=p.user_id
                        AND content IS NOT NULL
                ) AS parent_consult_info
                ,IFNULL(stu.manage_start_de, '9999.99.99') AS manage_start_de
                ,DATE_FORMAT(stu.start_de, '%Y.%m.%d') AS start_de
                ,DATE_FORMAT(stu.end_de, '%Y.%m.%d') AS end_de
                ,ishomedb.uf_study_product_nm(stu.student_no) as product_nm
                ,COUNT(DISTINCT lpm.module_no) AS plan_cnt
                ,COUNT(DISTINCT lph.category_no) AS math_plan_cnt
                ,COUNT(DISTINCT lpt.material_no) AS theme_plan_cnt
                ,COUNT(DISTINCT lam.clear_dt) AS act_cnt
                ,COUNT(DISTINCT lph.clear_dt) AS math_act_cnt
                ,COUNT(DISTINCT lpt.clear_dt) AS theme_act_cnt
                ,pur.product_no
                ,DATE_FORMAT(stu.web_start_de, '%Y.%m.%d') AS web_start_de
                ,DATE_FORMAT(stu.web_end_de, '%Y.%m.%d') AS web_end_de
                ,(SELECT DATE_FORMAT(MIN(login_dt), '%Y.%m.%d %H:%i:%s') FROM tz_connect_log WHERE user_id = s.user_id) AS first_login_dt
                ,(SELECT reg_dt 
				 	FROM ishomedb.tz_complain 
					WHERE 
						student_id = stu.student_id 
						AND use_yn = 'Y' 
					ORDER BY idx DESC 
					LIMIT 1) AS cp_reg_dt
            FROM ishomedb.tz_student stu
            INNER JOIN ishomedb.tz_purchase_student pch
            ON pch.temp_student_no = stu.student_no
            INNER JOIN ishomedb.tz_purchase pur
            ON pur.purchase_no = pch.purchase_no
            INNER JOIN tz_product pd
            ON pur.product_no = pd.product_no
             
                AND pd.service_com_yn = 'Y'
                 
            INNER JOIN ishomedb.tz_member s
            ON stu.student_id = s.user_id
            INNER JOIN ishomedb.tz_member p
            ON p.user_id = s.parent_id
            INNER JOIN ishomedb.tz_teacher d
            ON d.teacher_id = stu.teacher_id
            LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
            ON ttp.part_no = d.part_no
            LEFT OUTER JOIN ishomedb.tz_teacher_team ttt
            ON ttt.team_no = ttp.team_no        
            LEFT OUTER JOIN ishomedb.tz_connect_session cs
            ON cs.user_id = s.user_id
            LEFT OUTER JOIN ishomedb.tz_lms_plan_module lpm
            ON lpm.student_no = stu.student_no
            AND DATE_FORMAT(DATE_ADD(NOW(), INTERVAL -1 DAY), '%Y%m%d') = DATE_FORMAT(lpm.plan_de, '%Y%m%d')
            LEFT OUTER JOIN ishomedb.tz_lms_module lm
            ON lm.module_no = lpm.module_no
            LEFT OUTER JOIN ishomedb.tz_lms_act_module lam
            ON lam.module_no = lm.module_no
            AND lpm.plan_de = lam.plan_de
            AND lpm.student_no = lam.student_no
            LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson lsl
            ON lsl.subj_lesson_no = lm.subj_lesson_no
            LEFT OUTER JOIN ishomedb.tz_lcms_plan_math lph
            ON lpm.student_no = lph.student_no
            AND lpm.plan_de = lph.plan_de
            LEFT OUTER JOIN ishomedb.tz_lms_plan_theme lpt
            ON lpm.student_no = lpt.student_no
            AND lpm.plan_de = lpt.plan_de
             
        
        WHERE 1=1
            AND IFNULL(s.user_gbn_cls, '10001') != '10002'
            AND IFNULL(p.user_gbn_cls, '10001') != '10002'
             
             
             
            AND IFNULL(stu.end_de, NOW())  <  DATE_FORMAT(NOW(), '%Y-%m-%d')
                         
             
             
             
             
            AND ttt.team_no = '43'
             
             
            AND ttp.part_no = '159'
             
             
            AND stu.teacher_id = '157'
             
             
             
             
             
             
     
            GROUP BY student_no
        ) A
        LEFT OUTER JOIN tz_code student_gbn_code ON student_gbn_code.code_gbn = '10130' AND student_gbn_code.code_no = SUBSTRING(student_consult_info, 17, 5)
        LEFT OUTER JOIN tz_code parent_gbn_code ON parent_gbn_code.code_gbn = '10130' AND parent_gbn_code.code_no = SUBSTRING(parent_consult_info, 17, 5)
        
          ORDER BY manage_start_de DESC 
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
         
        LIMIT   0, 100;
# Time: 150506 11:23:21
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.358055  Lock_time: 0.000532 Rows_sent: 25  Rows_examined: 18824123
SET timestamp=1430879001;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '83' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150506 11:23:37
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 12.029507  Lock_time: 0.000143 Rows_sent: 25  Rows_examined: 18824135
SET timestamp=1430879017;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '83' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150506 11:36:00
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.612788  Lock_time: 0.000558 Rows_sent: 13652  Rows_examined: 2688196
SET timestamp=1430879760;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.06', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.06', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150506 11:36:13
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 28.107920  Lock_time: 0.000154 Rows_sent: 2  Rows_examined: 43004606
SET timestamp=1430879773;
SELECT
            tph.history_no,
            tph.student_id,
            tph.point,
            uf_common_replaceHTML(tph.comment) AS comment,
            tph.reg_dt,
            tph.show_yn,
            tph.top_yn,
            tm.nm_kor,
            tm.login_id,
            DATE_FORMAT(tph.reg_dt,'%Y') AS reg_year
        FROM
            ishomedb.tz_point_history tph
                INNER JOIN
            ishomedb.tz_member tm ON tph.student_id = tm.user_id
         
         WHERE  tph.guide_no = '136'
            
            
            
            
                AND tph.top_yn = 'Y' 
     
        ORDER BY
          tph.history_no DESC
        LIMIT 0, 25;
# Time: 150506 11:36:26
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.094178  Lock_time: 0.000627 Rows_sent: 13652  Rows_examined: 2688201
SET timestamp=1430879786;
SELECT paid.split_paid_no
              ,pur.purchase_no
              ,pb.nm_kor AS paid_nm_kor
              ,p_mem.nm_kor AS p_mem_name
              ,p_mem.login_id AS p_mem_id
              ,s_mem.nm_kor AS s_mem_name
              ,s_mem.login_id AS s_mem_id
              ,mng_std.grade_gbn AS grade_gbn
              ,p_mem.zipcode AS zip_code
              ,CONCAT(p_mem.addr1, ' ', p_mem.addr2) AS addr
              ,CONCAT(p_mem.tel1, p_mem.tel2, p_mem.tel3) AS tel_no
              ,CONCAT(p_mem.mobile1, p_mem.mobile2, p_mem.mobile3) AS mobile_no
              ,prd.product_nm
              ,paid.batch_key
              ,paid.paid_day
              ,DATE_FORMAT(paid.reg_dt, '%Y-%m-%d') AS paid_reg_dt
              ,DATE_FORMAT(MIN(auth_ymd),'%Y-%m-%d') AS first_batch_dt
              ,DATE_FORMAT(MAX(pb.auth_ymd),'%Y-%m-%d') AS last_batch_dt
              ,SUM(IF(pb.progress = 'Y', 1, 0)) AS succ_cnt
              ,paid.split_month
              ,pb.error_cnt + 1 AS paid_request_cnt
              ,pb.result_msg AS last_paid_status
              ,purchase_code.code_nm AS status_gbn
              ,CASE WHEN paid.del_yn = 'Y' Then '삭제'
                    ELSE code.code_nm
               END AS code_nm
               ,tt.team_nm as team_nm /* 담당교사 팀 */
              ,upd_mem.nm_kor AS upd_nm_kor /* 담당선생님 */
              ,CONCAT(manage_mem.nm_kor, '(', manage_mem.login_id, ')') AS manage_info
              ,manage_dt
              ,ishomedb.uf_purchase_side_delivery_info(pur.purchase_no) as side_info
              ,(
                SELECT c.product_nm
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS prev_product_nm
                ,(
                SELECT concat(a.start_de,'~',a.end_de)
                FROM ishomedb.tz_purchase a
                INNER JOIN ishomedb.tz_product c ON c.product_no = a.product_no 
                AND c.use_yn = 'Y' AND c.service_experience_yn = 'Y'
                WHERE a.student_id = paid.student_id and a.start_de != '' and a.start_de IS NOT NULL
                ORDER BY a.purchase_no DESC
                LIMIT 1
              ) AS pre_study_de
        FROM ishomedb.tz_split_paid paid 
        LEFT OUTER JOIN ishomedb.tz_purchase pur 
        ON paid.purchase_no = pur.purchase_no
        LEFT OUTER JOIN ishomedb.tz_purchase_batch pb
        ON paid.split_paid_no = pb.split_paid_no
        /* 신청자정보 */
        LEFT JOIN ishomedb.tz_member p_mem
        ON paid.parent_id = p_mem.user_id
        /* 학습자정보 */
        LEFT JOIN ishomedb.tz_member s_mem
        ON paid.student_id = s_mem.user_id
        /* 담당자 - 담당선생  */
        LEFT JOIN ishomedb.tz_student mng_std
        ON paid.student_id = mng_std.student_id
        LEFT JOIN ishomedb.tz_member upd_mem
        ON mng_std.teacher_id = upd_mem.user_id
        /* 상품정보 */
        LEFT JOIN ishomedb.tz_product prd
        ON prd.product_no = paid.product_no
        /* 출하상태  10118 */
        LEFT JOIN ishomedb.tz_code purchase_code
        ON pur.status_gbn = purchase_code.code_no
        AND purchase_code.code_gbn = 10118
        /* 월결제상태  10177 */
        LEFT JOIN ishomedb.tz_code code
        ON paid.paid_status = code.code_no
        AND code.code_gbn = 10177        
        /* 담당자 - 담당선생  팀파트*/
        LEFT OUTER JOIN ishomedb.tz_teacher tec
        ON tec.teacher_id = upd_mem.user_id
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp
        ON ttp.part_no = tec.part_no
        LEFT JOIN ishomedb.tz_teacher_team tt
        ON ttp.team_no = tt.team_no
        /* 담당자 정보 */
        LEFT JOIN ishomedb.tz_member manage_mem
        ON paid.manage_id = manage_mem.user_id
         WHERE  paid.reg_dt  >=  CONCAT('2015.02.06', ' 00:00:00')
            
            
                AND paid.reg_dt  <=  CONCAT('2015.05.06', ' 23:59:59')  
        GROUP BY paid.split_paid_no
        ORDER BY paid.split_paid_no DESC;
# Time: 150506 11:47:16
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 17.113682  Lock_time: 0.000262 Rows_sent: 15  Rows_examined: 3093405
SET timestamp=1430880436;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 13:13:20
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 23.684210  Lock_time: 0.000375 Rows_sent: 15300  Rows_examined: 69441907
SET timestamp=1430885600;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-06-30 23:59:59'
    AND pur.purchase_dt >= '2015-04-01 00:00:00';
# Time: 150506 14:13:05
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 14.548138  Lock_time: 0.000779 Rows_sent: 30  Rows_examined: 5938508
SET timestamp=1430889185;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 14.697619  Lock_time: 0.000325 Rows_sent: 30  Rows_examined: 5938508
SET timestamp=1430889185;
SELECT
             a.f_errreport_id
            ,a.f_user_cd
            ,m.login_id
            ,m.nm_kor AS f_user_nm
            ,a.f_test_id
            ,a.f_problem_id
            ,a.f_cproblem_id
            ,edubasestudydb.tCodeRefNm(t.f_grade_cd) AS f_grade_nm
            ,edubasestudydb.tCodeRefNm(t.f_term_cd) AS f_term_nm
            ,edubasestudydb.tCodeRefNm(t.f_subject_cd) AS f_subject_nm
            ,a.f_kind_cd
            ,a.f_process_cd
            ,IF(LENGTH(a.f_content) > 60,  CONCAT(SUBSTRING(a.f_content, 1, 25), '...'), a.f_content) AS f_content
            ,DATE_FORMAT(a.f_reg_dt, '%Y.%m.%d') AS f_reg_dt
            ,a.f_isdelete
            ,CASE WHEN a.f_answer_state='Y' THEN '답변완료'
            ELSE '준비중'
            END AS f_answer_st
            ,edubasestudydb.tCodeRefNm(a.f_kind_cd) AS f_kind_nm
            ,edubasestudydb.tCodeRefNm(a.f_process_cd) AS f_process_nm
            ,edubasestudydb.tCodeRefNm(t.f_kind_cd) AS f_test_nm
            ,a.f_content AS f_content_all
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                  
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                  
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP03' 

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as mody_nm_kor
            ,IFNULL((
                SELECT sub_m.nm_kor 
                FROM ishomedb.tz_errreport_log e 
                
                LEFT JOIN ishomedb.tz_member sub_m 
                ON e.reg_id = sub_m.user_id 
                
                WHERE e.errreport_id = a.f_errreport_id 
                AND e.process_cd = 'EP10'

                ORDER BY e.reg_dt DESC 
                LIMIT 1
             ),'') as an_nm_kor
             ,IFNULL(stt.f_stu_test_id,'') as f_stu_test_id
             ,(select count(tp2.f_stu_test_id) from edubasestudydb.t_student_test2_problem tp2 where tp2.f_stu_test_id = stt.f_stu_test_id ) as problem2_cnt
             ,CONCAT(mt.nm_kor, ' <br /> (', mt.login_id, ')') as teacher_nm
             ,ttt.team_nm as team_nm /* 팀이름 */
             ,mt.nm_kor as teacher_nm2 /* 교사명 */
        FROM edubasestudydb.t_bank_errreport a
        INNER JOIN edubasestudydb.t_test_problem tp
        ON a.f_test_id = tp.f_test_id
        AND a.f_problem_id = tp.f_problem_id
        INNER JOIN edubasestudydb.t_test t
        ON t.f_test_id = tp.f_test_id AND t.f_isdelete = 'N'
        INNER JOIN ishomedb.tz_student s 
        ON a.f_user_cd = s.student_no
        INNER JOIN ishomedb.tz_member m 
        ON s.student_id = m.user_id
        LEFT  JOIN edubasestudydb.t_student_test stt
        ON stt.f_test_id = t.f_test_id
        AND stt.f_user_cd = s.student_no
        LEFT JOIN ishomedb.tz_member mt
        ON mt.user_id = s.teacher_id
        /* 선생님 정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher tt 
        ON tt.teacher_id = s.teacher_id
        /* 선생님 팀정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team_part ttp 
        ON ttp.part_no = tt.part_no
        /* 선생님 파트정보 */
        LEFT OUTER JOIN ishomedb.tz_teacher_team ttt 
        ON ttt.team_no = ttp.team_no       
                
         
          
     
            
        ORDER BY a.f_reg_dt DESC
         
            LIMIT 0, 30;
# Time: 150506 15:02:25
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.397340  Lock_time: 0.000208 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892145;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.420683  Lock_time: 0.000206 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892145;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:26
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.040739  Lock_time: 0.000223 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892146;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.262952  Lock_time: 0.000220 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892146;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:27
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.816105  Lock_time: 0.000218 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892147;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.125631  Lock_time: 0.000218 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892147;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:28
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.183340  Lock_time: 0.000197 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892148;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.289231  Lock_time: 0.000217 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892148;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.879847  Lock_time: 0.000236 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892148;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:29
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.708111  Lock_time: 0.000225 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892149;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.455756  Lock_time: 0.000324 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892149;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.128918  Lock_time: 0.000227 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892149;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.144107  Lock_time: 0.000320 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892149;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:30
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.477638  Lock_time: 0.000356 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892150;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:31
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.315360  Lock_time: 0.000354 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892151;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.088621  Lock_time: 0.000387 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892151;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.545773  Lock_time: 0.000366 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892151;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.074021  Lock_time: 0.000377 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892151;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.782951  Lock_time: 0.000378 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892151;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:32
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.461559  Lock_time: 0.000292 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892152;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:39
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.700116  Lock_time: 0.000238 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892159;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.004498  Lock_time: 0.000278 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892159;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.704532  Lock_time: 0.000395 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892159;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 13.115485  Lock_time: 0.000254 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892159;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.086581  Lock_time: 0.000273 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892159;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 13.319006  Lock_time: 0.000383 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892159;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:40
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.055410  Lock_time: 0.000258 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892160;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:41
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.297726  Lock_time: 0.000226 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892161;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.334582  Lock_time: 0.000265 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892161;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.806610  Lock_time: 0.000392 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892161;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.115188  Lock_time: 0.000380 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892161;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:42
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.972864  Lock_time: 0.000394 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892162;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.261753  Lock_time: 0.000261 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892162;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 13.379925  Lock_time: 0.000279 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892162;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.145950  Lock_time: 0.000241 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892162;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:43
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.580456  Lock_time: 0.000240 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892163;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.835115  Lock_time: 0.000363 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892163;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:44
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.820427  Lock_time: 0.000352 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892164;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.192618  Lock_time: 0.000337 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892164;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.264779  Lock_time: 0.000385 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892164;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:51
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.221355  Lock_time: 0.000265 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892171;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.426416  Lock_time: 0.000263 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892171;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.139684  Lock_time: 0.000355 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892171;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.119655  Lock_time: 0.000400 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892171;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:52
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.490846  Lock_time: 0.000229 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892172;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.861437  Lock_time: 0.000276 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892172;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.420076  Lock_time: 0.000273 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892172;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.982631  Lock_time: 0.000234 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892172;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:54
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.072836  Lock_time: 0.000274 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892174;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.780247  Lock_time: 0.000244 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892174;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.353594  Lock_time: 0.000279 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892174;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 12.208082  Lock_time: 0.000334 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892174;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.535899  Lock_time: 0.000430 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892174;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:55
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.977558  Lock_time: 0.000382 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892175;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.370514  Lock_time: 0.000342 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892175;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.492574  Lock_time: 0.000222 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892175;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.537675  Lock_time: 0.000252 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892175;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.989864  Lock_time: 0.000394 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892175;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:02:56
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 10.969176  Lock_time: 0.000289 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892176;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 11.500289  Lock_time: 0.000397 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892176;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:03:00
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.758926  Lock_time: 0.000388 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892180;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:03:02
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.400225  Lock_time: 0.000383 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892182;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:03:03
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.738516  Lock_time: 0.000358 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892183;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:03:04
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.637716  Lock_time: 0.000330 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892184;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.662918  Lock_time: 0.000237 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892184;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.449165  Lock_time: 0.000331 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892184;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.913379  Lock_time: 0.000370 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892184;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:03:05
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.416327  Lock_time: 0.000315 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892185;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.448384  Lock_time: 0.000304 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892185;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.472769  Lock_time: 0.000192 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892185;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.109929  Lock_time: 0.000210 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892185;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.322021  Lock_time: 0.000331 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892185;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.743539  Lock_time: 0.000178 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892185;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 15:03:06
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.051743  Lock_time: 0.000325 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892186;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.059791  Lock_time: 0.000296 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892186;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.496042  Lock_time: 0.000217 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892186;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.026786  Lock_time: 0.000319 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892186;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 8.672589  Lock_time: 0.000204 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892186;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.261094  Lock_time: 0.000318 Rows_sent: 0  Rows_examined: 997596
SET timestamp=1430892186;
SELECT cs.cs_seq_no
              ,cs.user_id
              ,CASE WHEN mb.nm_kor IS NOT NULL THEN mb.nm_kor ELSE nb.nm_kor END AS nm_kor
              ,CASE WHEN mb.login_id IS NOT NULL THEN mb.login_id ELSE '-' END AS login_id
              ,CASE WHEN mb.tel1 IS NOT NULL THEN CONCAT(mb.tel1, '-', mb.tel2, '-', mb.tel3)
                    ELSE CONCAT(nb.tel1, '-', nb.tel2, '-', nb.tel3)
               END AS tel
              ,CASE WHEN mb.mobile1 IS NOT NULL THEN CONCAT(mb.mobile1, '-', mb.mobile2, '-', mb.mobile3)
                    ELSE CONCAT(nb.mobile1, '-', nb.mobile2, '-', nb.mobile3)
               END AS mobile
              ,ishomedb.uf_code_nm(10002, cs.user_gbn) AS user_gbn
              ,mb.parent_id
              ,cs.mem_gbn /*회원/비회원 구분*/
              ,cs.question
              ,cs.answer
              ,cs.record_url /*녹취파일 경로*/
              ,CASE WHEN cs.progress=0 THEN '답변중'
                    WHEN cs.progress=1 THEN '접수완료'
	                WHEN cs.progress=2 THEN '접수취소'
	                WHEN cs.progress=3 THEN '자체처리'
	                WHEN cs.progress=4 THEN '수리완료'
	                WHEN cs.progress=5 THEN '처리완료'
	                WHEN cs.progress=9 THEN '답변완료'
                    ELSE '-' 
               END AS progress /*상담진행상태*/
              ,cs.as_no
              ,CASE WHEN cs.grp_opt1='10001' THEN '인입'
                    WHEN cs.grp_opt1='10002' THEN '아웃콜'
                    WHEN cs.grp_opt1='10003' THEN '화상상담'
                    WHEN cs.grp_opt1='10004' THEN '부재'
                    ELSE '-' 
               END AS grp_opt1 /*분류1*/
              ,ishomedb.uf_code_gbn_nm(cs.grp_opt2) AS grp_opt2  /*분류2*/
              ,ishomedb.uf_code_nm(cs.grp_opt2, cs.grp_opt3) AS grp_opt3  /*분류3*/
              ,CASE WHEN cs.grp_opt4='10001' THEN '일반상담'
                    WHEN cs.grp_opt4='10002' THEN '원격지원'
                    ELSE '-' 
               END AS grp_opt4 /*분류4*/
              ,cs.contact /*상담원명*/
              ,cs.contact_no /*상담원 내선번호*/
              ,cs.reg_id
              ,cs.reg_dt
              ,cs.reg_ip
              ,cs.upd_id
              ,cs.upd_dt
              ,cs.upd_ip
        FROM ishomedb.tz_callservice cs
		LEFT OUTER JOIN ishomedb.tz_member mb
		ON mb.user_id = cs.user_id
		AND mb.user_gbn = cs.user_gbn
		LEFT OUTER JOIN ishomedb.tz_non_member nb
		ON nb.user_id = cs.user_id
         
         WHERE  (mb.nm_kor LIKE CONCAT('송효순', '%') OR nb.nm_kor LIKE CONCAT('송효순', '%'))  
     
        ORDER BY cs_seq_no DESC
        LIMIT 10, 10;
# Time: 150506 16:48:54
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 46.362406  Lock_time: 0.000213 Rows_sent: 15  Rows_examined: 3093890
SET timestamp=1430898534;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 16:49:03
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 46.033866  Lock_time: 0.000141 Rows_sent: 15  Rows_examined: 3093890
SET timestamp=1430898543;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 19:55:05
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 18.267495  Lock_time: 0.000234 Rows_sent: 15  Rows_examined: 3094459
SET timestamp=1430909705;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 19:55:15
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 16.169122  Lock_time: 0.000175 Rows_sent: 15  Rows_examined: 3094464
SET timestamp=1430909715;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  (
            IFNULL(user_gbn_cls, '10001') IN ('10001','10003','10004','10006')
            or (IFNULL(user_gbn_cls, '10001') = '10005' and IFNULL(tempid_modify_gbn, '10001') != '10001')
            )  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 21:50:36
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 98.348946  Lock_time: 0.000442 Rows_sent: 49508  Rows_examined: 227075927
SET timestamp=1430916636;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
   ,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
   ,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-03-31 23:59:59'
    AND pur.purchase_dt >= '2015-01-01 00:00:00';
# Time: 150506 21:51:04
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 88.207072  Lock_time: 0.000214 Rows_sent: 49508  Rows_examined: 227075947
SET timestamp=1430916664;
SELECT 
	date_format(s_mem.reg_dt, '%Y-%m-%d') AS 가입일
    ,date_format(pur.purchase_dt, '%Y-%m-%d') AS 주문일시
    ,pur.purchase_no AS 주문번호
    ,'' AS 입금자
    ,p_mem.nm_kor AS 학부모명
    ,p_mem.login_id AS 학부모ID
    ,s_mem.nm_kor AS 학생명
    ,s_mem.login_id AS 학생ID
    ,t_mem.nm_kor AS 관리교사명
    ,IFNULL(stu.manage_start_de, '') AS 배정일
    ,sch.schoolname AS 학교
    ,s_mem.grade_gbn AS 학년
    ,s_mem.class_gbn AS 반
    ,s_mem.gender AS 성별
    ,pro.product_nm AS 상품
    ,code.code_nm AS 상태
    ,pur.start_de AS 학습시작일
    ,pur.end_de AS 학습종료일
    ,(SELECT MIN(date_format(login_dt, '%Y-%m-%d')) FROM tz_connect_log WHERE user_id = s_mem.user_id) AS 최초로그인
    ,p_mem.zipcode AS 우편번호
    ,p_mem.addr1 AS 지역
    ,p_mem.addr2 AS 상세주소
    ,CONCAT(p_mem.mobile1,'-',p_mem.mobile2,'-',p_mem.mobile3) as 학부모휴대전화
    ,p_mem.email as 학부모이메일
    ,CASE (SELECT COUNT(purchase_no) FROM tz_purchase WHERE purchase_id = p_mem.user_id AND product_no = '15') > 0 
    WHEN true THEN 'Y' ELSE 'N' END AS 웹체험여부
    ,CASE WHEN p_mem.join_gbn IS NOT NULL THEN
      uf_code_nm(10160,p_mem.join_gbn)
     ELSE
      p_mem.join_gbn_dir
     END as 유입경로
   ,CASE pro.service_homebook_yn WHEN 'Y' THEN 'B형' ELSE 'A형' END AS 기기구분값
   ,(SELECT tgb.title
	FROM ishomedb.tz_gift_log tgl
	INNER JOIN ishomedb.tz_gift_book tgb ON tgl.giftbook_no = tgb.giftbook_no
	WHERE tgl.product_no = pur.product_no and tgl.reg_id = pur.reg_id
	LIMIT 1) as 우대권명
FROM tz_purchase pur

LEFT JOIN tz_member p_mem
ON pur.purchase_id = p_mem.user_id
LEFT JOIN tz_member s_mem
ON pur.student_id = s_mem.user_id
LEFT JOIN tz_student stu
ON pur.student_id = stu.student_id
LEFT JOIN tz_member t_mem
ON stu.teacher_id = t_mem.user_id
LEFT JOIN tz_product pro
ON pur.product_no = pro.product_no
LEFT JOIN tz_code code
ON pur.status_gbn = code.code_no
AND code.code_gbn = '10118'
LEFT JOIN tz_school sch
ON s_mem.school_no = sch.school_no
WHERE pur.purchase_dt <= '2015-03-31 23:59:59'
    AND pur.purchase_dt >= '2015-01-01 00:00:00';
