# Time: 150427  7:00:16
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 14.355369  Lock_time: 0.000330 Rows_sent: 0  Rows_examined: 8797520
SET timestamp=1430085616;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150427  7:00:21
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 18.735473  Lock_time: 0.000279 Rows_sent: 541  Rows_examined: 12521533
SET timestamp=1430085621;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150427  7:00:23
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 10.226232  Lock_time: 0.000256 Rows_sent: 0  Rows_examined: 8797520
SET timestamp=1430085623;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150427  7:00:27
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.833380  Lock_time: 0.000269 Rows_sent: 540  Rows_examined: 12521532
SET timestamp=1430085627;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150427  7:10:11
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 9.336125  Lock_time: 0.000454 Rows_sent: 0  Rows_examined: 8158804
SET timestamp=1430086211;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150427  7:10:20
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.293770  Lock_time: 0.000248 Rows_sent: 0  Rows_examined: 8158804
SET timestamp=1430086220;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150427 16:49:12
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 7.377296  Lock_time: 0.000133 Rows_sent: 0  Rows_examined: 191
SET timestamp=1430120952;
delete from edubasestudydb.t_student_test where f_stu_test_id IN (822799692,822798764,822226318,822209482,819266698,819266119,817110716,817110595,816880961,816842481,813157501,813156992,810633862,810633515,809410927,809402346,806202733,806200733,803427385,803426971,802031294,802030333,798439952,798439697,795105114,795101386,793519174,793518397,786981463,786979724,785248304,785232397,782711067,779922511,778108038,777488609,777485889,774915584,774905854,774904514,771738714,771417082,768787473,768765075,766001732,765991554,763182411,763168581,760325375,760314934,760313679,756480052,756456906,754678973,753805372,752593356,751961781,748269967,748253813,745424091,745414352,740753752,740665277,738693893,737956823,737284606,737093637,732238103,731721883,731362737,729268226,726219318,724032698,717131841,712084815,710038931,704506353,700439129,700328906,698344514,698332488,695221458,695209069,691355506,691069764,688129537,688103037,685075081,685066327,684390173,682196546,679246254,679225388,676344269,676198605,672492609,672471139,670857296,669606366,667250467,666695714,663763474,663752206,659721244,659697299,657050336,657040241,654261124,654224442,651468889,651445562,649723921,648656995,645684492,645629633,642237301,642214126,639453201,636663628,633807831,632868542,632865933,631717378,631714684,629591269,626983007,624187148,621442966,621418534,619159311,618508535,617694579,616556433,614389127,614370817,613210433,613196289,611181148,610808946,607955173,607947916,605043242,603321114,603306738,603292098,600364092,600349437,597537806,597517544,594707249,594647552,592738857,591750634,587697351,587463715,585441315,584732967,583472646,581797764,579022341,578988816,576492105,576111945,572211983,572186809,569502679,569490828,566630967,566601339,564702051,563768974,562444463,560914134,556979466,556939844,554172073,554152392,552496326,552370263,548777134,548750423,546206103,546171776,543293617,543287928,540544035,540527749,538602833,537882487,534913051,534868229);
# Time: 150428  1:17:28
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.117468  Lock_time: 0.000077 Rows_sent: 518  Rows_examined: 518
use mysql;
SET timestamp=1430151448;
show table status from `ishomedb`;
# Time: 150428  3:18:31
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.323262  Lock_time: 0.000099 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430158711;
show table status from `ishomedb`;
# Time: 150428  3:23:33
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 6.108016  Lock_time: 0.000118 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430159013;
show table status from `ishomedb`;
# Time: 150428  3:33:35
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 6.358783  Lock_time: 0.000121 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430159615;
show table status from `ishomedb`;
# Time: 150428  3:38:38
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 6.115268  Lock_time: 0.000104 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430159918;
show table status from `ishomedb`;
# Time: 150428  3:53:49
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.950751  Lock_time: 0.000100 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430160829;
show table status from `ishomedb`;
# Time: 150428  4:08:54
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.039623  Lock_time: 0.000106 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430161734;
show table status from `ishomedb`;
# Time: 150428  4:44:14
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.502130  Lock_time: 0.000119 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430163854;
show table status from `ishomedb`;
# Time: 150428  7:00:16
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.690637  Lock_time: 0.000325 Rows_sent: 0  Rows_examined: 8816901
use ishomedb;
SET timestamp=1430172016;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150428  7:00:20
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 18.547398  Lock_time: 0.000296 Rows_sent: 541  Rows_examined: 12552606
SET timestamp=1430172020;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150428  7:00:24
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 10.807700  Lock_time: 0.000294 Rows_sent: 0  Rows_examined: 8816901
SET timestamp=1430172024;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150428  7:00:27
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 14.026067  Lock_time: 0.000278 Rows_sent: 541  Rows_examined: 12552606
SET timestamp=1430172027;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150428  7:10:11
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.910374  Lock_time: 0.000348 Rows_sent: 0  Rows_examined: 8177578
SET timestamp=1430172611;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150428  7:10:19
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.491362  Lock_time: 0.000390 Rows_sent: 0  Rows_examined: 8177578
SET timestamp=1430172619;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150428  8:56:21
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 5.568285  Lock_time: 0.000110 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430178981;
SHOW TABLE STATUS FROM `ishomedb`;
# Time: 150428  8:56:22
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.478693  Lock_time: 0.000121 Rows_sent: 518  Rows_examined: 518
use mysql;
SET timestamp=1430178982;
show table status from `ishomedb`;
# Time: 150428 14:09:06
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 8.326356  Lock_time: 0.000181 Rows_sent: 1  Rows_examined: 2354165
use ishomedb;
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4888';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 20.169776  Lock_time: 0.000088 Rows_sent: 1  Rows_examined: 2354167
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4898';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 5.130187  Lock_time: 0.000107 Rows_sent: 1  Rows_examined: 2354165
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4888';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 8.444190  Lock_time: 0.000160 Rows_sent: 1  Rows_examined: 2354165
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4899';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 15.373684  Lock_time: 0.000103 Rows_sent: 1  Rows_examined: 2354167
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4888';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 12.127624  Lock_time: 0.000078 Rows_sent: 1  Rows_examined: 2354165
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4888';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 18.482374  Lock_time: 0.000097 Rows_sent: 1  Rows_examined: 2354167
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4898';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 10.133035  Lock_time: 0.000063 Rows_sent: 1  Rows_examined: 2354165
SET timestamp=1430197746;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4898';
# Time: 150428 19:30:09
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 7.686973  Lock_time: 0.000114 Rows_sent: 518  Rows_examined: 518
use mysql;
SET timestamp=1430217009;
show table status from `ishomedb`;
# Time: 150429  3:08:28
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.046455  Lock_time: 0.000100 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430244508;
show table status from `ishomedb`;
# Time: 150429  3:13:29
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.591985  Lock_time: 0.000135 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430244809;
show table status from `ishomedb`;
# Time: 150429  3:18:30
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.610114  Lock_time: 0.000115 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430245110;
show table status from `ishomedb`;
# Time: 150429  3:33:37
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.985357  Lock_time: 0.000118 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430246017;
show table status from `ishomedb`;
# Time: 150429  3:38:38
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.482148  Lock_time: 0.000104 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430246318;
show table status from `ishomedb`;
# Time: 150429  7:00:15
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.239542  Lock_time: 0.000328 Rows_sent: 0  Rows_examined: 8815723
use ishomedb;
SET timestamp=1430258415;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150429  7:00:20
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 18.152283  Lock_time: 0.000307 Rows_sent: 541  Rows_examined: 12591950
SET timestamp=1430258420;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150429  7:00:23
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 10.317659  Lock_time: 0.000285 Rows_sent: 0  Rows_examined: 8815723
SET timestamp=1430258423;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150429  7:00:26
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.406252  Lock_time: 0.000298 Rows_sent: 541  Rows_examined: 12591950
SET timestamp=1430258426;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150429  7:10:11
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.859583  Lock_time: 0.000352 Rows_sent: 0  Rows_examined: 8204606
SET timestamp=1430259011;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150429  7:10:19
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.223377  Lock_time: 0.000350 Rows_sent: 0  Rows_examined: 8204606
SET timestamp=1430259019;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150429  9:04:31
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 9.540861  Lock_time: 0.000176 Rows_sent: 0  Rows_examined: 0
SET timestamp=1430265871;
SELECT  b.word
                ,b.word_level
                ,a.learning_date
                ,a.learning_know_check
                ,a.learning_word_voice
                ,a.learning_word_write
                ,a.learning_sentence_voice
                ,a.learning_day_test
                ,a.learning_twenty_test
                ,CONCAT('(', DATE_FORMAT(c.reg_dt, '%Y.%m.%d'), ')') as learning_twenty_test_date
        FROM   ishomedb.tz_ew_user_learning a
        INNER JOIN ishomedb.tz_ew_word b
        ON a.word_id = b.word_id
        LEFT OUTER JOIN ishomedb.tz_ew_twenty_test_result_question c
        ON a.word_id = c.word_id AND c.reg_id = '534817'
        ORDER BY a.learning_date desc, b.word asc;
# Time: 150429 10:26:02
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 50.854892  Lock_time: 0.000088 Rows_sent: 0  Rows_examined: 7634839
SET timestamp=1430270762;
select f_user_cd, f_test_id, f_test_dt, count(*) as num from edubasestudydb.t_student_test
 where f_test_dt > '2015-04-17 00:00:00'
group by f_user_cd, f_test_id having num > 1;
# Time: 150429 16:35:43
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 9.833949  Lock_time: 0.000127 Rows_sent: 15355  Rows_examined: 46065
SET timestamp=1430292943;
SELECT  l.connect_id     /* 접속 아이디 */
               ,l.login_id       /* 로그인 ID */
               ,l.user_id        /* 사용자 ID */
               ,l.user_gbn       /* 사용자 구분 코드 */
               ,l.connect_type   /* 접속 타입 (디바이스) */
               ,l.login_status   /* 로그인 상태 */
               ,l.login_dt       /* 로그인 일시 */
               ,l.logout_dt      /* 로그아웃 일시 */
               ,l.connect_ip     /* 접속 IP */
               ,l.user_agent     /* 사용자 Agent 정보 */                              
               ,CONCAT(m.nm_kor, ' (', CONVERT(l.user_id, CHAR(10)), ')') AS user_info /* 접속자 정보 */
        FROM   ishomedb.tz_connect_log l
        LEFT   OUTER JOIN ishomedb.tz_member m
        ON     l.user_id = m.user_id
        WHERE  l.user_id = '496001'

        ORDER  BY  l.login_dt DESC;
# Time: 150429 18:03:45
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.163631  Lock_time: 0.000094 Rows_sent: 0  Rows_examined: 114
SET timestamp=1430298225;
delete from edubasestudydb.t_student_test where f_stu_test_id IN (504525862,502189141,502097995,500500686,498796557,496868379,494942218,492293006,490947292,490807135,489090119,485244474,458124836,456112894,453713271,451437682,448680448,445026141,442892498,440430348,438483736,435255493,433520724,432556521,428625907,427288932,424832555,421842663,421679836,418807181,417056707,416712533,414088545,411685799,408307724,408250081,406243651,403695827,401493198,399323259,395170724,395029861,392869905,390738208,390590877,388527098,385816305,382161314,382038157,380048461,377815857,377659646,373698216,373550001,371286092,369271507,369092734,366965739,364185208,360225308,360044826,358060993,355849106,355607386,354023484,350860915,346983284,346834502,344448073,342513439,342153903,340579837,337700693,334835255,334110327,333753092,333270997,329153525,326799176,324045405,320485771,320326453,318770317,315538446,315477212,313427213,310339961,306430257,306362455,304351585,301845919,301711235,299773774,296284767,292846559,292761465,290202277,288348833,288015984,285918477,282662151,279200903,278996951,276642764,274476373,274061148,271840468,268998344,265428386,265312288,263531606,260982546,260654216,259368302);
# Time: 150430  0:39:05
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.201795  Lock_time: 0.000136 Rows_sent: 327643  Rows_examined: 1248324
SET timestamp=1430321945;
SELECT  @ROWNUM := @ROWNUM + 1 AS rnum 
              ,a.user_id
              ,a.user_gbn
              ,(SELECT b.code_nm FROM  ishomedb.tz_code b where b.code_gbn = 10002 AND b.code_no = a.user_gbn) AS user_gubun
              ,a.nm_kor
              ,a.del_yn   
       FROM ishomedb.tz_member a ,(SELECT @rownum := 0) rownum
          WHERE  del_yn = "N" 
            
                AND a.user_gbn = '10002'  
        ORDER  BY  a.nm_kor ASC;
# Time: 150430  3:08:41
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.336594  Lock_time: 0.000117 Rows_sent: 518  Rows_examined: 518
use mysql;
SET timestamp=1430330921;
show table status from `ishomedb`;
# Time: 150430  3:18:41
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.622579  Lock_time: 0.000102 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430331521;
show table status from `ishomedb`;
# Time: 150430  3:33:43
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.570955  Lock_time: 0.000067 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430332423;
show table status from `ishomedb`;
# Time: 150430  3:38:45
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.881472  Lock_time: 0.000093 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430332725;
show table status from `ishomedb`;
# Time: 150430  3:48:52
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.170519  Lock_time: 0.000126 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430333332;
show table status from `ishomedb`;
# Time: 150430  4:14:05
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.007290  Lock_time: 0.000132 Rows_sent: 518  Rows_examined: 518
SET timestamp=1430334845;
show table status from `ishomedb`;
# Time: 150430  7:00:15
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 12.719065  Lock_time: 0.000339 Rows_sent: 0  Rows_examined: 8805141
use ishomedb;
SET timestamp=1430344815;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150430  7:00:20
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 18.402178  Lock_time: 0.000260 Rows_sent: 541  Rows_examined: 12574462
SET timestamp=1430344820;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150430  7:00:23
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 10.396309  Lock_time: 0.000308 Rows_sent: 0  Rows_examined: 8805141
SET timestamp=1430344823;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150430  7:00:26
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.319310  Lock_time: 0.000286 Rows_sent: 541  Rows_examined: 12574462
SET timestamp=1430344826;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150430  7:10:11
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.981679  Lock_time: 0.000321 Rows_sent: 0  Rows_examined: 8204405
SET timestamp=1430345411;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150430  7:10:19
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.888430  Lock_time: 0.000314 Rows_sent: 0  Rows_examined: 8204405
SET timestamp=1430345419;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150430 11:07:13
# User@Host: ishome[ishome] @  [192.168.150.41]
# Query_time: 5.463024  Lock_time: 0.000197 Rows_sent: 519  Rows_examined: 519
SET timestamp=1430359633;
SHOW TABLE STATUS;
# Time: 150430 16:51:30
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 15.105244  Lock_time: 0.000071 Rows_sent: 1  Rows_examined: 2372066
SET timestamp=1430380290;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4898';
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.422832  Lock_time: 0.000081 Rows_sent: 1  Rows_examined: 2372066
SET timestamp=1430380290;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4899';
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 5.046559  Lock_time: 0.000173 Rows_sent: 1  Rows_examined: 2372068
SET timestamp=1430380290;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4900';
# Time: 150430 18:03:46
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 5.983745  Lock_time: 0.000060 Rows_sent: 100  Rows_examined: 4196400
SET timestamp=1430384626;
select * from ishomedb.tz_ew_level_test_result_question a where a.reg_id = '534817';
# Time: 150430 23:20:00
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 73.201483  Lock_time: 0.000095 Rows_sent: 0  Rows_examined: 59873065
SET timestamp=1430403600;
update tz_tmp_20150430 a, tz_purchase b
set a.purchase_no=b.purchase_no
where a.seq_no is null
and a.start_dt=b.start_de;
# Time: 150501  0:32:48
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 32.637619  Lock_time: 0.000075 Rows_sent: 0  Rows_examined: 7697711
SET timestamp=1430407968;
select f_user_cd, f_test_id, f_test_dt, count(*) as num from edubasestudydb.t_student_test
 where f_test_dt > '2015-04-29 00:00:00'
group by f_user_cd, f_test_id having num > 1;
# Time: 150501  3:19:07
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.207300  Lock_time: 0.000125 Rows_sent: 520  Rows_examined: 520
use mysql;
SET timestamp=1430417947;
show table status from `ishomedb`;
# Time: 150501  3:34:12
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 6.123848  Lock_time: 0.000121 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430418852;
show table status from `ishomedb`;
# Time: 150501  3:39:14
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.677102  Lock_time: 0.000097 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430419154;
show table status from `ishomedb`;
# Time: 150501  3:44:17
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.184441  Lock_time: 0.000124 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430419457;
show table status from `ishomedb`;
# Time: 150501  3:54:23
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.055234  Lock_time: 0.000119 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430420063;
show table status from `ishomedb`;
# Time: 150501  4:09:26
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.001659  Lock_time: 0.000102 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430420966;
show table status from `ishomedb`;
# Time: 150501  4:14:27
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.074603  Lock_time: 0.000096 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430421267;
show table status from `ishomedb`;
# Time: 150501  4:19:28
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.055572  Lock_time: 0.000127 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430421568;
show table status from `ishomedb`;
# Time: 150501  4:39:37
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.015016  Lock_time: 0.000120 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430422777;
show table status from `ishomedb`;
# Time: 150501  6:26:30
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 64.294693  Lock_time: 0.000109 Rows_sent: 222  Rows_examined: 222
SET timestamp=1430429190;
show table status from `ishomedb`;
# Time: 150501  6:34:54
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 108.779915  Lock_time: 0.000238 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430429694;
show table status from `ishomedb`;
# Time: 150501  6:39:39
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 90.266998  Lock_time: 0.000114 Rows_sent: 447  Rows_examined: 447
SET timestamp=1430429979;
show table status from `ishomedb`;
# Time: 150501  6:44:13
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 56.740042  Lock_time: 0.000128 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430430253;
show table status from `ishomedb`;
# Time: 150501  7:00:16
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.460509  Lock_time: 0.000331 Rows_sent: 0  Rows_examined: 8811688
use ishomedb;
SET timestamp=1430431216;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150501  7:00:21
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 19.099148  Lock_time: 0.000274 Rows_sent: 542  Rows_examined: 12568961
SET timestamp=1430431221;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150501  7:00:24
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 10.912202  Lock_time: 0.000234 Rows_sent: 0  Rows_examined: 8811688
SET timestamp=1430431224;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150501  7:00:27
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.869833  Lock_time: 0.000311 Rows_sent: 541  Rows_examined: 12568960
SET timestamp=1430431227;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150501  7:08:31
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 11.420202  Lock_time: 0.000138 Rows_sent: 520  Rows_examined: 520
use mysql;
SET timestamp=1430431711;
show table status from `ishomedb`;
# Time: 150501  7:10:11
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 9.018269  Lock_time: 0.000309 Rows_sent: 0  Rows_examined: 8212939
use ishomedb;
SET timestamp=1430431811;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150501  7:10:19
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.847592  Lock_time: 0.000331 Rows_sent: 0  Rows_examined: 8212939
SET timestamp=1430431819;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150502  3:17:44
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.067285  Lock_time: 0.000116 Rows_sent: 520  Rows_examined: 520
use mysql;
SET timestamp=1430504264;
show table status from `ishomedb`;
# Time: 150502  3:32:54
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.262788  Lock_time: 0.000117 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430505174;
show table status from `ishomedb`;
# Time: 150502  3:42:55
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.107460  Lock_time: 0.000090 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430505775;
show table status from `ishomedb`;
# Time: 150502  7:00:14
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 12.427915  Lock_time: 0.000328 Rows_sent: 0  Rows_examined: 8786989
use ishomedb;
SET timestamp=1430517614;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150502  7:00:20
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 18.050451  Lock_time: 0.000429 Rows_sent: 543  Rows_examined: 12559563
SET timestamp=1430517620;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150502  7:00:23
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 10.083410  Lock_time: 0.000319 Rows_sent: 0  Rows_examined: 8786989
SET timestamp=1430517623;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150502  7:00:26
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.156999  Lock_time: 0.000308 Rows_sent: 544  Rows_examined: 12559564
SET timestamp=1430517626;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150502  7:10:10
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.763302  Lock_time: 0.000330 Rows_sent: 0  Rows_examined: 8186012
SET timestamp=1430518210;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150502  7:10:18
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.316694  Lock_time: 0.000263 Rows_sent: 0  Rows_examined: 8186012
SET timestamp=1430518218;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150503  7:00:10
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.554981  Lock_time: 0.000365 Rows_sent: 0  Rows_examined: 8771536
SET timestamp=1430604010;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150503  7:00:14
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 12.685001  Lock_time: 0.000190 Rows_sent: 485  Rows_examined: 12540693
SET timestamp=1430604014;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150503  7:00:18
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.546915  Lock_time: 0.000314 Rows_sent: 0  Rows_examined: 8771536
SET timestamp=1430604018;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학부모 */
                        ,CONCAT(d.mobile1, d.mobile2, d.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학부모 */
                       ,d.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150503  7:00:24
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 11.885607  Lock_time: 0.000338 Rows_sent: 485  Rows_examined: 12540693
SET timestamp=1430604024;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150503  7:10:09
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.255401  Lock_time: 0.000433 Rows_sent: 0  Rows_examined: 8167670
SET timestamp=1430604609;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150503  7:10:16
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.195524  Lock_time: 0.000480 Rows_sent: 0  Rows_examined: 8167670
SET timestamp=1430604616;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150503 20:13:19
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 19.550992  Lock_time: 0.000092 Rows_sent: 1  Rows_examined: 2375862
SET timestamp=1430651599;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '7268';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 17.024744  Lock_time: 0.000082 Rows_sent: 1  Rows_examined: 2375860
SET timestamp=1430651599;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '7268';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 18.247161  Lock_time: 0.000094 Rows_sent: 1  Rows_examined: 2375860
SET timestamp=1430651599;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '7268';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 9.500344  Lock_time: 0.000093 Rows_sent: 1  Rows_examined: 2375859
SET timestamp=1430651599;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '7268';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 15.885714  Lock_time: 0.000098 Rows_sent: 1  Rows_examined: 2375860
SET timestamp=1430651599;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '7268';
# Time: 150504  7:00:20
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 17.782805  Lock_time: 0.000430 Rows_sent: 0  Rows_examined: 8773868
SET timestamp=1430690420;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150504  7:00:24
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 11.120126  Lock_time: 0.000264 Rows_sent: 0  Rows_examined: 8773868
SET timestamp=1430690424;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150504  7:00:27
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 25.145010  Lock_time: 0.000287 Rows_sent: 541  Rows_examined: 12544480
SET timestamp=1430690427;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 14.139058  Lock_time: 0.000197 Rows_sent: 541  Rows_examined: 12544480
SET timestamp=1430690427;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150504  7:10:13
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 10.605773  Lock_time: 0.000378 Rows_sent: 0  Rows_examined: 8167490
SET timestamp=1430691013;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150504  7:10:21
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.760030  Lock_time: 0.000464 Rows_sent: 0  Rows_examined: 8167490
SET timestamp=1430691021;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150504  7:10:30
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.349712  Lock_time: 0.000335 Rows_sent: 0  Rows_examined: 8167490
SET timestamp=1430691030;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150504 17:45:05
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 27.709063  Lock_time: 0.000261 Rows_sent: 164  Rows_examined: 159195
SET timestamp=1430729105;
SELECT  DISTINCT a.contents_no, b.objectname_kor, b.thumb_path
         FROM   ishomedb.tz_cms_contents_code a
         INNER  JOIN ishomedb.tz_cms_contents b
         ON     a.contents_no = b.contents_no
         INNER JOIN ishomedb.tz_cms_common_code c
         ON a.codeid = c.codeid
          
         INNER  JOIN(
     SELECT  a.contents_no
     FROM   ishomedb.tz_cms_contents_code a
     INNER  JOIN ishomedb.tz_cms_contents b
     ON     a.contents_no = b.contents_no
     INNER JOIN 
     (
      SELECT DISTINCT CODEID
     FROM (
     SELECT A.codeid, A.PARENTID FROM ishomedb.tz_cms_common_code A, (SELECT codeid FROM ishomedb.tz_cms_common_code WHERE parentid = '9288' OR codeid = '9288') B
      WHERE A.PARENTID = B.CODEID
      OR A.CODEID = B.CODEID
   ) DD  
     )
     c
     ON a.codeid = c.codeid                      
     WHERE b.pic_level = '1'
     AND a.contents_type = '9'
     


         ) cate
         ON a.contents_no = cate.contents_no
          
          WHERE (c.parentid ='870' OR c.codeid = '870')
        
        
          AND b.pic_level = '1' 
        
        AND a.contents_type = '1' /* 지역 */
        AND b.status = '승인'
        AND b.media_type = 'JPG'
        ORDER BY a.CONTENTS_CODE_NO ASC;
# Time: 150505  3:23:00
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.345110  Lock_time: 0.000116 Rows_sent: 520  Rows_examined: 520
use mysql;
SET timestamp=1430763780;
show table status from `ishomedb`;
# Time: 150505  3:28:01
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.230449  Lock_time: 0.000101 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430764081;
show table status from `ishomedb`;
# Time: 150505  3:33:04
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 6.133974  Lock_time: 0.000124 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430764384;
show table status from `ishomedb`;
# Time: 150505  3:38:06
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.660639  Lock_time: 0.000117 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430764686;
show table status from `ishomedb`;
# Time: 150505  3:43:09
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.895867  Lock_time: 0.000105 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430764989;
show table status from `ishomedb`;
# Time: 150505  3:53:16
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 6.519091  Lock_time: 0.000112 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430765596;
show table status from `ishomedb`;
# Time: 150505  4:08:21
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.026562  Lock_time: 0.000101 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430766501;
show table status from `ishomedb`;
# Time: 150505  4:18:23
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.110443  Lock_time: 0.000106 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430767103;
show table status from `ishomedb`;
# Time: 150505  4:33:30
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.002353  Lock_time: 0.000099 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430768010;
show table status from `ishomedb`;
# Time: 150505  5:54:27
# User@Host: root[root] @  [211.189.40.151]
# Query_time: 5.644125  Lock_time: 0.000101 Rows_sent: 520  Rows_examined: 520
SET timestamp=1430772867;
show table status from `ishomedb`;
# Time: 150505  7:00:13
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 11.100867  Lock_time: 0.000326 Rows_sent: 0  Rows_examined: 8755501
use ishomedb;
SET timestamp=1430776813;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150505  7:00:18
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 16.563203  Lock_time: 0.000300 Rows_sent: 544  Rows_examined: 12538604
SET timestamp=1430776818;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150505  7:00:22
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 9.674435  Lock_time: 0.000267 Rows_sent: 0  Rows_examined: 8755501
SET timestamp=1430776822;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150505  7:00:26
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.407197  Lock_time: 0.000229 Rows_sent: 545  Rows_examined: 12538647
SET timestamp=1430776826;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150505  7:00:31
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.257673  Lock_time: 0.000377 Rows_sent: 0  Rows_examined: 8755501
SET timestamp=1430776831;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학부모 */
                        ,CONCAT(d.mobile1, d.mobile2, d.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학부모 */
                       ,d.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150505  7:10:11
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.373023  Lock_time: 0.000389 Rows_sent: 0  Rows_examined: 8147497
SET timestamp=1430777411;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150505  7:10:18
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.297273  Lock_time: 0.000346 Rows_sent: 0  Rows_examined: 8147497
SET timestamp=1430777418;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150505 12:46:54
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 12.567451  Lock_time: 0.000083 Rows_sent: 1  Rows_examined: 2393258
SET timestamp=1430797614;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '4901';
# Time: 150506  7:00:11
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 9.518877  Lock_time: 0.000336 Rows_sent: 0  Rows_examined: 8752925
SET timestamp=1430863211;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학부모 */
                , CONCAT('batch4^', CONCAT(d.mobile1, d.mobile2, d.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')                
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150506  7:00:15
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 13.715911  Lock_time: 0.000310 Rows_sent: 541  Rows_examined: 12530830
SET timestamp=1430863215;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150506  7:00:21
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 9.990705  Lock_time: 0.000365 Rows_sent: 0  Rows_examined: 8752925
SET timestamp=1430863221;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학부모 */
                        ,CONCAT(d.mobile1, d.mobile2, d.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학부모 */
                       ,d.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학부모 */
                AND c.start_sms_yn IN ('Y', 'B')
                AND CONCAT(d.mobile1, d.mobile2, d.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150506  7:00:25
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 12.444033  Lock_time: 0.000210 Rows_sent: 541  Rows_examined: 12530830
SET timestamp=1430863225;
SELECT  
                 c.user_id
                ,c.nm_kor
                ,c.login_id
                ,c.parent_id
                ,gcm.app_gbn
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s') AS reserve_time
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 학부모앱 설치 정보 */        
        INNER   JOIN ishomedb.tz_android_gcm_parent gcm
        ON      c.parent_id = gcm.user_id
        /* 자녀 GCM 수신 옵션 정보 */
        LEFT OUTER JOIN ishomedb.tz_android_gcm_parent_child_option gcm_option
        ON      c.parent_id = gcm_option.user_id AND c.user_id = gcm_option.child_user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
        /* gcm이 활성, 등록키 존재 필수 */
        AND     gcm.gcm_status = 'Y'
        AND     IFNULL(gcm.gcm_reg_id, '') != ''
        /* 자녀 수신옵션 체크, 수신옵션이 없으면 발송하는 걸로... */
        AND     IFNULL(gcm_option.receive_learning_before, 'Y') = 'Y' 
         
        GROUP   BY a.student_no
        ORDER   BY a.plan_time;
# Time: 150506  7:10:09
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.967824  Lock_time: 0.000336 Rows_sent: 0  Rows_examined: 8145671
SET timestamp=1430863809;
INSERT INTO ishomedb.SDK_SMS_SEND (USER_ID, SCHEDULE_TYPE, SUBJECT, SMS_MSG, NOW_DATE, SEND_DATE, CALLBACK, DEST_COUNT, DEST_INFO)
        (SELECT 'sigong3439'
        , 1
        , '학습 시작 30분전 SMS'        
        , CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
        , DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
        , DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
        , '15440910'
        , 1
          /* 학생 */
                , CONCAT('batch5^', CONCAT(c.mobile1, c.mobile2, c.mobile3))
             
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150506  7:10:17
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.994163  Lock_time: 0.000344 Rows_sent: 0  Rows_examined: 8145671
SET timestamp=1430863817;
INSERT INTO ishomedb.tz_sms_send (sender, receiver, message, reg_id, reg_dt, reg_ip, recv_user_id)
        (SELECT '15440910'
                  /* 학생 */
                        ,CONCAT(c.mobile1, c.mobile2, c.mobile3)
                     
                ,CONCAT('[홈런]', c.nm_kor, '님의 홈런 학습 시작 30분 전 입니다. 준비해주세요~')
                ,0
                ,DATE_FORMAT(DATE_ADD(STR_TO_DATE(CONCAT(DATE_FORMAT(a.plan_de, '%Y%m%d'), TIME_FORMAT(MIN(a.plan_time), '%H%i%s')), '%Y%m%d%H%i%s'), INTERVAL -30 MINUTE), '%Y%m%d%H%i%s')
                ,'114.207.114.40'
                  /* 학생 */
                       ,c.user_id
                    
        FROM    ishomedb.tz_lms_plan_module a
        INNER   JOIN ishomedb.tz_student b
        ON      a.student_no = b.student_no
        /* 학생 정보 */
        LEFT    OUTER JOIN ishomedb.tz_member c
        ON      b.student_id = c.user_id
        /* 부모 정보 */
        INNER   JOIN ishomedb.tz_member d
        ON      c.parent_id = d.user_id
         
        WHERE   b.teacher_id IS NOT NULL
        AND     DATE_FORMAT(a.plan_de, '%Y%m%d') = DATE_FORMAT(NOW(), '%Y%m%d')
        AND     DATE_FORMAT(a.plan_time, '%H%i%s') >= DATE_FORMAT( DATE_ADD(NOW(), INTERVAL -30 MINUTE), '%H%i%s')          
        AND     DATE_FORMAT(NOW(), '%Y%m%d') >= DATE_FORMAT(b.start_de, '%Y%m%d') 
        AND     DATE_FORMAT(NOW(), '%Y%m%d') <= DATE_FORMAT(b.end_de, '%Y%m%d')
         
          /* 학생 */
                AND c.start_sms_yn IN ('S', 'B')
                AND CONCAT(c.mobile1, c.mobile2, c.mobile3) IS NOT NULL
             
        GROUP   BY a.student_no
        ORDER   BY a.plan_time);
# Time: 150506 11:15:34
# User@Host: root[root] @  [220.117.172.107]
# Query_time: 22.428112  Lock_time: 0.001121 Rows_sent: 6  Rows_examined: 18814993
SET timestamp=1430878534;
SELECT
            POINT
            , COMMENT
            , reg_dt
            , show_yn
            , top_yn
            , nm_kor
            , login_id
        FROM
            (
             
            (SELECT
                tph.point
                , uf_common_replaceHTML(tph.comment) AS COMMENT
                , DATE_FORMAT(tph.reg_dt,'%y.%m.%d') AS reg_dt
                , tph.show_yn
                , tph.top_yn
                , tm.nm_kor
                , tm.login_id
            FROM
                ishomedb.tz_point_history tph  
--                 use INDEX (ix_point_history_bulletin_board, Primary)
--                                  USE INDEX ( ix_point_history_bulletin_board)
--                                  FORCE INDEX ( Primary)
                	INNER JOIN 
                	ishomedb.tz_member tm ON tph.student_id = tm.user_id
                	                     
                WHERE tph.guide_no = '83'
                AND tph.comment IS NOT NULL
                AND tph.show_yn = 'Y'
             
            ORDER BY tph.history_no DESC
            LIMIT 0, 6
            ))
            history LIMIT 0, 1000;
# Time: 150506 11:15:51
# User@Host: root[root] @  [220.117.172.107]
# Query_time: 16.601845  Lock_time: 0.000176 Rows_sent: 3  Rows_examined: 18815008
SET timestamp=1430878551;
EXPLAIN 
SELECT
            POINT
            , COMMENT
            , reg_dt
            , show_yn
            , top_yn
            , nm_kor
            , login_id
        FROM
            (
             
            (SELECT
                tph.point
                , uf_common_replaceHTML(tph.comment) AS COMMENT
                , DATE_FORMAT(tph.reg_dt,'%y.%m.%d') AS reg_dt
                , tph.show_yn
                , tph.top_yn
                , tm.nm_kor
                , tm.login_id
            FROM
                ishomedb.tz_point_history tph  
--                 use INDEX (ix_point_history_bulletin_board, Primary)
--                                  USE INDEX ( ix_point_history_bulletin_board)
--                                  FORCE INDEX ( Primary)
                	INNER JOIN 
                	ishomedb.tz_member tm ON tph.student_id = tm.user_id
                	                     
                WHERE tph.guide_no = '83'
                AND tph.comment IS NOT NULL
                AND tph.show_yn = 'Y'
             
            ORDER BY tph.history_no DESC
            LIMIT 0, 6
            ))
            history LIMIT 0, 1000;
# Time: 150506 12:33:24
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 1381.153163  Lock_time: 0.000581 Rows_sent: 0  Rows_examined: 1
SET timestamp=1430883204;
SELECT ltm.material_no  /*  테마자료 번호 */
		  ,ltm.contents_no  /* lcms contents_no */
		  ,ltm.title  /* 제목 */
		  ,lc.porting_value /* cms contens_no */
		  ,lc.etc_value2  /* 상세설명 */
		  ,lc.etc_value3  /* 관련 단원 */
		  ,ltm.thumb_src  /* 썸네일 이미지 */
		  ,cc.objectname_kor  /* 영상제목 */
		  ,cc.pic_mediatime /* 영상시간 */
		  ,ishomedb.uf_lcms_theme_category_connect_by_path_with_start(' > ',ltm.category_no, 28) AS path
		FROM ishomedb.tz_lcms_theme_material ltm
		LEFT JOIN ishomedb.tz_lcms_contents lc
		ON ltm.contents_no = lc.contents_no
		LEFT JOIN ishomedb.tz_cms_contents cc
		ON lc.porting_value = cc.contents_no
		WHERE ltm.material_no = '6725';
# Time: 150506 15:06:24
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 11.249417  Lock_time: 0.000060 Rows_sent: 1  Rows_examined: 2392139
SET timestamp=1430892384;
SELECT CASE WHEN 0 = COUNT(useq) THEN 0
                    ELSE 1
               END  AS count
   		  FROM tz_lms_box
		 WHERE 1 = 1
		       AND menu_no1   = '284' 
		       AND menu_no2   = '310' 
		       AND menu_no3   = '0' 
		       
		    
			    
	            
	            
	            
	            
	            AND subj_lesson_no = '3588';
# Time: 150506 19:23:13
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 6.707239  Lock_time: 0.000289 Rows_sent: 6  Rows_examined: 102
SET timestamp=1430907793;
/*틀린문제 + 유사 문제*/
            SELECT 1 dvsn,
                   b.f_test_id, 
                   b.f_num,
                   a.f_problem_id problem_no, 
                   a.f_header_id header_no, 
                   a.f_ptype ptype, 
                   a.f_difficult difficult, 
                   IFNULL(a.f_pro_cml, '') question,
                   '' dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   0 cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , IFNULL(a.f_sol_cml, '') solution
                 
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b 
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d      
             WHERE 1=1
               AND a.f_problem_id   = b.f_problem_id
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640238'
               AND a.f_problem_id   = b.f_problem_id
               /*cast( mList as signed)*/ 
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id, '')
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id2, '')  
             UNION
            SELECT 2 dvsn,
                   b.f_test_id,
                   b.f_num,
                   a.f_problem_id problem_no,
                   a.f_header_id header_no,
                   a.f_ptype ptype,
                   a.f_difficult difficult,
                   IFNULL(a.f_pro_cml, '') question,
                   b.f_problem_id dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   (case when a.f_problem_id = b.f_cproblem_id then 1 else 2 end) cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , ifnull(a.f_sol_cml, '') solution
                
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d                
              WHERE 1=1
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640238'
               /* AND b.f_problem_id   = cast(mList as signed) */
               AND (a.f_problem_id  = b.f_cproblem_id or  a.f_problem_id = b.f_cproblem_id2)
             ORDER BY f_num, cSort;
# Time: 150506 19:23:20
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 5.154053  Lock_time: 0.000305 Rows_sent: 12  Rows_examined: 154
SET timestamp=1430907800;
/*틀린문제 + 유사 문제*/
            SELECT 1 dvsn,
                   b.f_test_id, 
                   b.f_num,
                   a.f_problem_id problem_no, 
                   a.f_header_id header_no, 
                   a.f_ptype ptype, 
                   a.f_difficult difficult, 
                   IFNULL(a.f_pro_cml, '') question,
                   '' dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   0 cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                 
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b 
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d      
             WHERE 1=1
               AND a.f_problem_id   = b.f_problem_id
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640300'
               AND a.f_problem_id   = b.f_problem_id
               /*cast( mList as signed)*/ 
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id, '')
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id2, '')  
             UNION
            SELECT 2 dvsn,
                   b.f_test_id,
                   b.f_num,
                   a.f_problem_id problem_no,
                   a.f_header_id header_no,
                   a.f_ptype ptype,
                   a.f_difficult difficult,
                   IFNULL(a.f_pro_cml, '') question,
                   b.f_problem_id dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   (case when a.f_problem_id = b.f_cproblem_id then 1 else 2 end) cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d                
              WHERE 1=1
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640300'
               /* AND b.f_problem_id   = cast(mList as signed) */
               AND (a.f_problem_id  = b.f_cproblem_id or  a.f_problem_id = b.f_cproblem_id2)
             ORDER BY f_num, cSort;
# Time: 150506 19:23:22
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 5.027002  Lock_time: 0.000654 Rows_sent: 10  Rows_examined: 300
SET timestamp=1430907802;
SELECT   les.subj_no
                ,les.sort
                ,les.subj_lesson_no
                ,les.subj_lesson_nm               
                ,CASE WHEN (SELECT count(subj_lesson_no) 
                           FROM ishomedb.tz_lcms_prepare_test 
                           WHERE subj_lesson_no = les.subj_lesson_no 
                           AND test_url_gbn = '10001') > 1 THEN 
                        CASE WHEN tst.useq = 1 THEN
                            '[단원중급]'
                        WHEN tst.useq = 2 THEN
                            '[단원상급]'
                        WHEN tst.useq = 3 THEN
                            '[단원기본]'
                        ELSE
                            ''
                        END
                     ELSE 
                        ''
                END AS tit_lesson_nm
                ,tst.useq
                ,tst.test_url_gbn
                ,tst.contents_no
                ,IFNULL(tst.count_short_answer, 0) AS count_short_answer
                ,IFNULL(tst.count_text_answer, 0) AS count_text_answer
                ,IFNULL(tst.limit_time, 0) AS limit_time
                ,IFNULL(stt.f_stu_test_id, '') as f_stu_test_id              /*평가 결과 ID*/
                ,IFNULL(stt.f_ischeckpoint, '') as f_ischeckpoint             /* 채점완료 */
                ,stt.f_isstatic                 /* 통계완료 */
                ,cms.porting_type               /* 시험보기 */
                ,CONCAT(cms.porting_value,  '&closeSave=TEST' ) as porting_value  /* esc 닫기 alter 메시지 처리로 인한 파라메터 추가  */
                ,cm2.porting_type  AS type2
                ,REPLACE(cm2.porting_value, 'testResult.do', 'testResultNew.do')   AS url2    /* 틀린문제 채점결과/풀이보기 */
                ,cm3.porting_type  AS type3
                ,REPLACE(cm3.porting_value, 'testResult.do', 'testResultNew.do')   AS url3    /* 채점결과/풀이보기 */ 
                ,cm4.porting_type   AS type4    /* 평가분석표 */   
                ,cm4.porting_value  AS url4
                ,cm5.porting_type   AS type5    /* 틀린문제 다시풀기 */  
                ,cm5.porting_value  AS url5
                ,cm2.porting_type   AS type6 
                ,REPLACE(REPLACE(cm2.porting_value, 'T202', 'T402'), 'testResult.do', 'testResultNew.do')  AS url6
                ,cm5.porting_type   AS type7 
                ,REPLACE(cm5.porting_value, 'T201', 'T401')  AS url7          
                ,IFNULL(st2.f_test_dt, '') as f_st2_dt      /* 틀린문제다시풀기응시일 */
                ,IFNULL(st3.f_test_dt, '') as f_st3_dt                               /* 보충문제 다시 풀기 응시일 */
                ,( SELECT COUNT(f_num) FROM edubasestudydb.t_student_test_problem 
                    WHERE f_stu_test_id = stt.f_stu_test_id AND f_result != '1'
                ) AS stp_cnt                    /* 틀린문제 수 */
                ,(SELECT COUNT(f_num) FROM edubasestudydb.t_student_test_problem 
                    WHERE f_stu_test_id = stt.f_stu_test_id AND f_result = '1'
                ) AS ok_cnt
                ,ets.f_supply_yn                  /* 보충문제(유사문제 여부) */
                ,ets.f_isopen
                ,ets.math_yn
                ,IFNULL(stt.f_point, 0) as f_point
                /* 통합교과의 경우에만 */
                 
                        ,'' as subj_knd_nm_img
                        ,'' as subj_gbn
                     
        FROM    ishomedb.tz_lcms_study_lesson les
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test tst
        ON      les.subj_lesson_no  = tst.subj_lesson_no
        AND     tst.test_url_gbn    = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cms
        ON      tst.contents_no = cms.contents_no
        
        LEFT    OUTER JOIN edubasestudydb.t_test ets
        ON      ets.f_chapter_cd    = les.subj_lesson_no
        AND     ets.f_no            = tst.useq
        AND     ets.f_kind_cd       = 'T120'
        AND     ets.f_isdelete      = 'N'       
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt2
        ON      pt2.subj_lesson_no  = les.subj_lesson_no
        AND     pt2.useq            = tst.useq
        AND     pt2.test_url_gbn    = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt3
        ON      pt3.subj_lesson_no  = les.subj_lesson_no
        AND     pt3.useq            = tst.useq
        AND     pt3.test_url_gbn    = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt4
        ON      pt4.subj_lesson_no  = les.subj_lesson_no
        AND     pt4.useq            = tst.useq
        AND     pt4.test_url_gbn    = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt5
        ON      pt5.subj_lesson_no  = les.subj_lesson_no
        AND     pt5.useq            = tst.useq
        AND     pt5.test_url_gbn    = '10005' 
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm2
        ON      cm2.contents_no = pt2.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm3
        ON      cm3.contents_no = pt3.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm4
        ON      cm4.contents_no = pt4.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm5
        ON      cm5.contents_no = pt5.contents_no
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test stt
        ON      stt.f_test_id = ets.f_test_id
        AND     stt.f_user_cd = 109038
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test2 st2
        ON      st2.f_kind_cd     = '01'
        AND     st2.f_stu_test_id = stt.f_stu_test_id
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test3 st3
        ON      st3.f_kind_cd     = '01'
        AND     st3.f_stu_test_id = stt.f_stu_test_id
        
        /* 통합교과의 경우에만 */
         
         WHERE  les.lvl = 1
            AND les.lesson_gbn = 10001
            /* AND (ets.f_isopen != 'N' OR ets.f_isopen = '' OR ets.f_isopen IS NULL) */ 
            
                AND les.subj_no = 204 
        ORDER   BY  les.order_key ASC, ets.order_no DESC, tst.useq DESC;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 5.627219  Lock_time: 0.000137 Rows_sent: 71  Rows_examined: 298
SET timestamp=1430907802;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_assets_resource asset
        WHERE xml_type = 'C'
        
        UNION ALL
        
        SELECT 
               skin_id AS file_no
              ,'' AS res_key
              ,'skin' AS file_type
              ,skin_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_skins_resource skin
        WHERE xml_type = 'C'
          AND skin_code = '23'
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_contents cont
        INNER JOIN ishomedb.tz_android_air_schoolstudy_resource res
        ON cont.subj_lesson_no = res.subj_lesson_no
        WHERE cont.use_yn = 'Y'
          AND res.subj_lesson_no = 7658;
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 5.993026  Lock_time: 0.449083 Rows_sent: 3  Rows_examined: 1252226
SET timestamp=1430907802;
SELECT  
                les.subj_no
                ,CONCAT(sbj.grade_gbn, '-', sbj.semester_gbn, ' ') AS grade_semester
                ,CASE WHEN sbj.subj_gbn = 10004 THEN '슬생' ELSE ishomedb.uf_code_subj_nm(sbj.subj_gbn) END AS subj_nm
                ,IFNULL(modu.head_gbn, '') AS head_gbn
                ,IF(10001 = modu.head_gbn, '학교공부예복습', ishomedb.uf_code_nm(10129, modu.head_gbn)) AS head_gbn_nm
                ,modu.module_no
                ,modu.subj_lesson_no
                ,modu.useq
                ,test.f_test_id
                ,CASE WHEN les.lesson_gbn IS NULL THEN
                        uf_lcms_study_lesson_get_most_subj_lesson_nm(modu.subj_lesson_no)
                      ELSE ''
                 END AS top_subj_lesson_nm
                ,CASE WHEN (SELECT count(subj_lesson_no) 
                           FROM ishomedb.tz_lcms_prepare_test 
                           WHERE subj_lesson_no = les.subj_lesson_no 
                           AND test_url_gbn = '10001') > 1 THEN 
	                        CASE WHEN ishomedb.uf_code_nm(10129, modu.head_gbn) = '실력평가' THEN 
	                                 CASE WHEN modu.useq = 1 THEN
	                                            '실력기본'
	                                        WHEN modu.useq = 2 THEN
	                                            '실력중급'
	                                        WHEN modu.useq = 3 THEN
	                                            '실력상급'
	                                        ELSE
	                                            ''
	                                        END
	                               ELSE
	                                    CASE WHEN modu.useq = 1 THEN
	                                        '단원중급'
	                                    WHEN modu.useq = 2 THEN
	                                        '단원상급'
	                                    WHEN modu.useq = 3 THEN
	                                        '단원기본'
	                                    ELSE
	                                        ''
	                                    END
	                                END
	                         ELSE 
	                            ''
                END AS tit_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 /* 10001:단원, 10002:중간고사, 10003:기말고사, 10004:실력 */
                      THEN CONCAT(les.sort, '단원. ', les.subj_lesson_nm)
                      WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) 
                      THEN CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)')
                      WHEN les.lesson_gbn IS NULL THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm)
                 END  AS subj_lesson_nm
                ,CASE WHEN act.clear_dt IS NOT NULL THEN 'Y'
                      ELSE (SELECT IF(COUNT(1) = 0, 'N', 'I')
                            FROM tz_lms_act_element 
                            WHERE student_no = act.student_no
                                AND plan_de = act.plan_de
                                AND module_no = modu.module_no
                           ) 
                 END AS is_finish
                ,DATE_FORMAT(pln.plan_de, '%Y-%m-%d') AS plan_de
                ,act.act_dt
                ,act.clear_dt
                ,pln.reg_dt
                ,'' AS category_no
                ,ste.f_ischeckpoint
                ,ste.f_stu_test_id
                ,les.use_yn
                ,ste.f_point
                ,test.f_problem_cnt
                , (SELECT count(f_result) FROM edubasestudydb.t_student_test_problem where f_stu_test_id = ste.f_stu_test_id AND f_result = 1) AS f_right_cnt
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no

        LEFT    OUTER JOIN (
            SELECT tst.f_test_id, tst.f_problem_cnt, ppe.subj_lesson_no, lm.module_no, ppe.useq
            FROM ishomedb.tz_lcms_prepare_test ppe 
            INNER JOIN edubasestudydb.t_test tst
            ON ppe.subj_lesson_no = tst.f_chapter_cd
            AND ppe.useq = tst.f_no
            AND tst.f_kind_cd IN ('T110', 'T120', 'T130', 'T135')
            AND tst.f_isopen = 'Y'
            INNER JOIN ishomedb.tz_lms_module lm
            ON ppe.subj_lesson_no = lm.subj_lesson_no
            AND lm.head_gbn != '10001'
            WHERE   ppe.test_url_gbn = '10001'
        ) test on test.subj_lesson_no = les.subj_lesson_no
        AND test.module_no = modu.module_no
        AND test.useq = modu.useq
        LEFT    OUTER   JOIN edubasestudydb.t_student_test ste
        ON      test.f_test_id = ste.f_test_id
        AND     ste.f_user_cd  =  '207230'
        WHERE   pln.student_no =  '207230'
        AND     pln.plan_de = CONVERT('20150504', DATE)

        UNION ALL
        
        SELECT  '' AS subj_no
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no1) AS grade_semester
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no2) AS subj_nm
               ,'' AS head_gbn
               ,'마쓰연산력' AS head_gbn_nm
               ,'' AS module_no
               ,'' AS subj_lesson_no
               ,'' AS useq
               ,'' AS f_test_id
               ,'' AS top_subj_lesson_nm
               ,'' AS tit_lesson_nm
               ,b.category_nm AS subj_lesson_nm 
               ,IF(a.act_dt IS NULL, 'N', 'Y') AS is_finish
               ,a.plan_de 
               ,a.act_dt
               ,a.clear_dt
               ,a.reg_dt
               ,a.category_no
               ,'' AS f_ischeckpoint
               ,'' AS f_stu_test_id
               ,'Y' AS use_yn
               ,0 AS f_point
               ,0 AS f_problem_cnt
               ,0 AS f_right_cnt
          FROM  tz_lcms_plan_math a
          INNER JOIN tz_lcms_theme_category b
          ON a.category_no = b.category_no
          INNER JOIN tz_lcms_theme_category ctg1
          ON b.upper_no = ctg1.category_no
          INNER JOIN tz_lcms_theme_category ctg2
          ON ctg1.upper_no = ctg2.category_no
          INNER JOIN tz_lcms_theme_category ctg3
          ON ctg2.upper_no = ctg3.category_no
         WHERE  a.student_no  = '207230'
           AND  a.plan_de = CONVERT('20150504', DATE)

        UNION ALL                                           
                
        SELECT '' AS subj_no
              
              ,'' AS grade_semester
              ,IF(ltc3.category_no = 18567
                  ,CONCAT(ltc3.category_nm,  CASE WHEN CHAR_LENGTH(ltc2.category_nm)   >   5 THEN CONCAT('\n', ltc2.category_nm) ELSE CONCAT(' ', ltc2.category_nm) END )
                  ,CONCAT(ltc2.category_nm,  CASE WHEN CHAR_LENGTH(ltc1.category_nm)   >   5 THEN CONCAT('\n', ltc1.category_nm) ELSE CONCAT(' ', ltc1.category_nm) END )
               ) AS subj_nm
              ,'' AS head_gbn
              ,IF(ltc3.category_no = 18567, ltc4.category_nm, ltc3.category_nm) AS head_gbn_nm
              ,'' AS module_no
              ,'' AS subj_lesson_no
              ,'' AS useq
              ,'' AS f_test_id
              ,'' AS top_subj_lesson_nm
              ,'' AS tit_lesson_nm
              ,ltm.title AS subj_lesson_nm 
              ,IF(lpt.act_dt IS NULL, 'N', 'Y') AS is_finish
              ,lpt.plan_de 
              ,lpt.act_dt
              ,lpt.clear_dt
              ,lpt.reg_dt
              ,lpt.material_no AS category_no
              ,'' AS f_ischeckpoint
              ,'' AS f_stu_test_id
              ,'Y' AS use_yn
              ,0 AS f_point
              ,0 AS f_problem_cnt
              ,0 AS f_right_cnt
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        INNER JOIN tz_lcms_theme_category ltc1
        ON ltm.category_no = ltc1.category_no
        INNER JOIN tz_lcms_theme_category ltc2
        ON ltc1.upper_no = ltc2.category_no
        INNER JOIN tz_lcms_theme_category ltc3
        ON ltc2.upper_no = ltc3.category_no
        INNER JOIN tz_lcms_theme_category ltc4
        ON ltc3.upper_no = ltc4.category_no
        WHERE lpt.student_no = '207230'
        	AND lpt.plan_de = CONVERT('20150504', DATE)

        ORDER BY reg_dt DESC;
# Time: 150506 19:23:23
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 8.357211  Lock_time: 0.000060 Rows_sent: 6  Rows_examined: 18
SET timestamp=1430907803;
SELECT 
            IFNULL(t2.f_advice,'') comment 
        FROM    edubasestudydb.t_student_test t1 
        LEFT JOIN   edubasestudydb.t_student_test_problem t2
        ON  t1.f_stu_test_id = t2.f_stu_test_id
        WHERE   t1.f_stu_test_id = '972640328' 
        ORDER BY t2.f_num;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 8.652874  Lock_time: 0.000452 Rows_sent: 4  Rows_examined: 34
SET timestamp=1430907803;
/*오답노트*/
             SELECT (CASE WHEN d.f_kind_cd = '01' THEN
                        1 
                    ELSE
                        2
                    END) dvsn,
                    b.f_test_id,
                    s.f_chapter_cd,
                    s.f_kind_cd,
                    s.f_no, 
                    b.f_num,
                    d.f_stu_test_id,
                    d.f_problem_id AS problem_id,
                    d.f_problem_test_id AS f_problem_id,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id)
                    ELSE
                        a.F_Header_ID
                    END) header_no, /* 국어의 경우 유사문제 지문 없음에 대비 */ 
                    a.f_ptype ptype,  
                    a.f_difficult difficult, 
                    IFNULL(a.f_pro_cml, '') question,
                    (CASE WHEN d.f_kind_cd = '01' THEN
                        '' 
                    ELSE
                        b.f_problem_id
                    END) dproblem_id,
                    etc.f_field2 dftproblem,
                    (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                    (case when a.f_problem_id = b.f_cproblem_id then 1 else 0 end) cSort,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT f_cml FROM edubasebankdb.T_Header where f_header_id = (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id))
                    ELSE
                        e.f_cml
                    END) header, /* 국어의 경우 유사문제 지문 없음에 대비 */
                    a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                    '1' AS teach_qna,
                    'N' AS errnote_yn    /* 오답노트 담기여부 */
                     
                    ,'' solution
                     
                    ,d.f_result1
                    ,d.f_input
                    ,d.f_ispen
                    ,d.f_input_path
                    ,(CASE WHEN s.f_kind_cd = 'T110' THEN
                        CONCAT(le.sort, '장. ', le.subj_lesson_nm , ' - ', '실력평가')
                      WHEN s.f_kind_cd = 'T120' THEN
                        CONCAT(le.sort, '단원. ', le.subj_lesson_nm , ' - ', '단원평가')
                      WHEN s.f_kind_cd = 'T130' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '중간고사')
                      WHEN s.f_kind_cd = 'T135' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '기말고사')
                      WHEN s.f_kind_cd = 'T150' THEN
                        CONCAT(le.sort, '단원 ', le.subj_lesson_nm , ' - ', '수학경시')
                      END) test_nm
	                        
             FROM edubasebankdb.T_Problem a
             LEFT OUTER JOIN edubasebankdb.T_Problem_Etc etc 
             ON a.f_problem_id = etc.f_problem_id 
             LEFT OUTER JOIN edubasebankdb.T_Header e 
             ON a.f_header_id = e.f_header_id
             ,edubasestudydb.t_test_problem b
             INNER JOIN edubasestudydb.t_test s 
             ON b.f_test_id = s.f_test_id
             LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson le
             ON s.f_chapter_cd = le.subj_lesson_no
             ,edubasestudydb.t_student_test c 
             ,edubasestudydb.t_student_test_errornote_problem d 
             WHERE 1=1
             AND a.f_problem_id   = d.f_problem_id
             AND b.f_test_id      = c.f_test_id
             AND c.f_stu_test_id  = d.f_stu_test_id
             AND b.f_num          = d.f_num
             AND d.f_stu_test_id IN (972640251)
             ORDER BY b.f_test_id, b.f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 8.972420  Lock_time: 0.000683 Rows_sent: 18  Rows_examined: 412
SET timestamp=1430907803;
SELECT   les.subj_no
                ,les.sort
                ,les.subj_lesson_no
                ,les.subj_lesson_nm               
                ,CASE WHEN (SELECT count(subj_lesson_no) 
                           FROM ishomedb.tz_lcms_prepare_test 
                           WHERE subj_lesson_no = les.subj_lesson_no 
                           AND test_url_gbn = '10001') > 1 THEN 
                        CASE WHEN tst.useq = 1 THEN
                            '[단원중급]'
                        WHEN tst.useq = 2 THEN
                            '[단원상급]'
                        WHEN tst.useq = 3 THEN
                            '[단원기본]'
                        ELSE
                            ''
                        END
                     ELSE 
                        ''
                END AS tit_lesson_nm
                ,tst.useq
                ,tst.test_url_gbn
                ,tst.contents_no
                ,IFNULL(tst.count_short_answer, 0) AS count_short_answer
                ,IFNULL(tst.count_text_answer, 0) AS count_text_answer
                ,IFNULL(tst.limit_time, 0) AS limit_time
                ,IFNULL(stt.f_stu_test_id, '') as f_stu_test_id              /*평가 결과 ID*/
                ,IFNULL(stt.f_ischeckpoint, '') as f_ischeckpoint             /* 채점완료 */
                ,stt.f_isstatic                 /* 통계완료 */
                ,cms.porting_type               /* 시험보기 */
                ,CONCAT(cms.porting_value,  '&closeSave=TEST' ) as porting_value  /* esc 닫기 alter 메시지 처리로 인한 파라메터 추가  */
                ,cm2.porting_type  AS type2
                ,REPLACE(cm2.porting_value, 'testResult.do', 'testResultNew.do')   AS url2    /* 틀린문제 채점결과/풀이보기 */
                ,cm3.porting_type  AS type3
                ,REPLACE(cm3.porting_value, 'testResult.do', 'testResultNew.do')   AS url3    /* 채점결과/풀이보기 */ 
                ,cm4.porting_type   AS type4    /* 평가분석표 */   
                ,cm4.porting_value  AS url4
                ,cm5.porting_type   AS type5    /* 틀린문제 다시풀기 */  
                ,cm5.porting_value  AS url5
                ,cm2.porting_type   AS type6 
                ,REPLACE(REPLACE(cm2.porting_value, 'T202', 'T402'), 'testResult.do', 'testResultNew.do')  AS url6
                ,cm5.porting_type   AS type7 
                ,REPLACE(cm5.porting_value, 'T201', 'T401')  AS url7          
                ,IFNULL(st2.f_test_dt, '') as f_st2_dt      /* 틀린문제다시풀기응시일 */
                ,IFNULL(st3.f_test_dt, '') as f_st3_dt                               /* 보충문제 다시 풀기 응시일 */
                ,( SELECT COUNT(f_num) FROM edubasestudydb.t_student_test_problem 
                    WHERE f_stu_test_id = stt.f_stu_test_id AND f_result != '1'
                ) AS stp_cnt                    /* 틀린문제 수 */
                ,(SELECT COUNT(f_num) FROM edubasestudydb.t_student_test_problem 
                    WHERE f_stu_test_id = stt.f_stu_test_id AND f_result = '1'
                ) AS ok_cnt
                ,ets.f_supply_yn                  /* 보충문제(유사문제 여부) */
                ,ets.f_isopen
                ,ets.math_yn
                ,IFNULL(stt.f_point, 0) as f_point
                /* 통합교과의 경우에만 */
                 
                        ,'' as subj_knd_nm_img
                        ,'' as subj_gbn
                     
        FROM    ishomedb.tz_lcms_study_lesson les
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test tst
        ON      les.subj_lesson_no  = tst.subj_lesson_no
        AND     tst.test_url_gbn    = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cms
        ON      tst.contents_no = cms.contents_no
        
        LEFT    OUTER JOIN edubasestudydb.t_test ets
        ON      ets.f_chapter_cd    = les.subj_lesson_no
        AND     ets.f_no            = tst.useq
        AND     ets.f_kind_cd       = 'T120'
        AND     ets.f_isdelete      = 'N'       
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt2
        ON      pt2.subj_lesson_no  = les.subj_lesson_no
        AND     pt2.useq            = tst.useq
        AND     pt2.test_url_gbn    = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt3
        ON      pt3.subj_lesson_no  = les.subj_lesson_no
        AND     pt3.useq            = tst.useq
        AND     pt3.test_url_gbn    = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt4
        ON      pt4.subj_lesson_no  = les.subj_lesson_no
        AND     pt4.useq            = tst.useq
        AND     pt4.test_url_gbn    = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt5
        ON      pt5.subj_lesson_no  = les.subj_lesson_no
        AND     pt5.useq            = tst.useq
        AND     pt5.test_url_gbn    = '10005' 
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm2
        ON      cm2.contents_no = pt2.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm3
        ON      cm3.contents_no = pt3.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm4
        ON      cm4.contents_no = pt4.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm5
        ON      cm5.contents_no = pt5.contents_no
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test stt
        ON      stt.f_test_id = ets.f_test_id
        AND     stt.f_user_cd = 51000
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test2 st2
        ON      st2.f_kind_cd     = '01'
        AND     st2.f_stu_test_id = stt.f_stu_test_id
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test3 st3
        ON      st3.f_kind_cd     = '01'
        AND     st3.f_stu_test_id = stt.f_stu_test_id
        
        /* 통합교과의 경우에만 */
         
         WHERE  les.lvl = 1
            AND les.lesson_gbn = 10001
            /* AND (ets.f_isopen != 'N' OR ets.f_isopen = '' OR ets.f_isopen IS NULL) */ 
            
                AND les.subj_no = 200 
        ORDER   BY  les.order_key ASC, ets.order_no DESC, tst.useq DESC;
# Time: 150506 19:23:24
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 8.218040  Lock_time: 0.000375 Rows_sent: 4  Rows_examined: 68
SET timestamp=1430907804;
/*틀린문제 + 유사 문제*/
            SELECT 1 dvsn,
                   b.f_test_id, 
                   b.f_num,
                   a.f_problem_id problem_no, 
                   a.f_header_id header_no, 
                   a.f_ptype ptype, 
                   a.f_difficult difficult, 
                   IFNULL(a.f_pro_cml, '') question,
                   '' dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   0 cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                 
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b 
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d      
             WHERE 1=1
               AND a.f_problem_id   = b.f_problem_id
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640319'
               AND a.f_problem_id   = b.f_problem_id
               /*cast( mList as signed)*/ 
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id, '')
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id2, '')  
             UNION
            SELECT 2 dvsn,
                   b.f_test_id,
                   b.f_num,
                   a.f_problem_id problem_no,
                   a.f_header_id header_no,
                   a.f_ptype ptype,
                   a.f_difficult difficult,
                   IFNULL(a.f_pro_cml, '') question,
                   b.f_problem_id dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   (case when a.f_problem_id = b.f_cproblem_id then 1 else 2 end) cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d                
              WHERE 1=1
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640319'
               /* AND b.f_problem_id   = cast(mList as signed) */
               AND (a.f_problem_id  = b.f_cproblem_id or  a.f_problem_id = b.f_cproblem_id2)
             ORDER BY f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.806717  Lock_time: 0.001587 Rows_sent: 3  Rows_examined: 460287
SET timestamp=1430907804;
SELECT  
                les.subj_no
                ,CONCAT(sbj.grade_gbn, '-', sbj.semester_gbn, ' ') AS grade_semester
                ,CASE WHEN sbj.subj_gbn = 10004 THEN '슬생' ELSE ishomedb.uf_code_subj_nm(sbj.subj_gbn) END AS subj_nm
                ,IFNULL(modu.head_gbn, '') AS head_gbn
                ,IF(10001 = modu.head_gbn, '학교공부예복습', ishomedb.uf_code_nm(10129, modu.head_gbn)) AS head_gbn_nm
                ,modu.module_no
                ,modu.subj_lesson_no
                ,modu.useq
                ,test.f_test_id
                ,CASE WHEN les.lesson_gbn IS NULL THEN
                        uf_lcms_study_lesson_get_most_subj_lesson_nm(modu.subj_lesson_no)
                      ELSE ''
                 END AS top_subj_lesson_nm
                ,CASE WHEN (SELECT count(subj_lesson_no) 
                           FROM ishomedb.tz_lcms_prepare_test 
                           WHERE subj_lesson_no = les.subj_lesson_no 
                           AND test_url_gbn = '10001') > 1 THEN 
	                        CASE WHEN ishomedb.uf_code_nm(10129, modu.head_gbn) = '실력평가' THEN 
	                                 CASE WHEN modu.useq = 1 THEN
	                                            '실력기본'
	                                        WHEN modu.useq = 2 THEN
	                                            '실력중급'
	                                        WHEN modu.useq = 3 THEN
	                                            '실력상급'
	                                        ELSE
	                                            ''
	                                        END
	                               ELSE
	                                    CASE WHEN modu.useq = 1 THEN
	                                        '단원중급'
	                                    WHEN modu.useq = 2 THEN
	                                        '단원상급'
	                                    WHEN modu.useq = 3 THEN
	                                        '단원기본'
	                                    ELSE
	                                        ''
	                                    END
	                                END
	                         ELSE 
	                            ''
                END AS tit_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 /* 10001:단원, 10002:중간고사, 10003:기말고사, 10004:실력 */
                      THEN CONCAT(les.sort, '단원. ', les.subj_lesson_nm)
                      WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) 
                      THEN CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)')
                      WHEN les.lesson_gbn IS NULL THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm)
                 END  AS subj_lesson_nm
                ,CASE WHEN act.clear_dt IS NOT NULL THEN 'Y'
                      ELSE (SELECT IF(COUNT(1) = 0, 'N', 'I')
                            FROM tz_lms_act_element 
                            WHERE student_no = act.student_no
                                AND plan_de = act.plan_de
                                AND module_no = modu.module_no
                           ) 
                 END AS is_finish
                ,DATE_FORMAT(pln.plan_de, '%Y-%m-%d') AS plan_de
                ,act.act_dt
                ,act.clear_dt
                ,pln.reg_dt
                ,'' AS category_no
                ,ste.f_ischeckpoint
                ,ste.f_stu_test_id
                ,les.use_yn
                ,ste.f_point
                ,test.f_problem_cnt
                , (SELECT count(f_result) FROM edubasestudydb.t_student_test_problem where f_stu_test_id = ste.f_stu_test_id AND f_result = 1) AS f_right_cnt
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no

        LEFT    OUTER JOIN (
            SELECT tst.f_test_id, tst.f_problem_cnt, ppe.subj_lesson_no, lm.module_no, ppe.useq
            FROM ishomedb.tz_lcms_prepare_test ppe 
            INNER JOIN edubasestudydb.t_test tst
            ON ppe.subj_lesson_no = tst.f_chapter_cd
            AND ppe.useq = tst.f_no
            AND tst.f_kind_cd IN ('T110', 'T120', 'T130', 'T135')
            AND tst.f_isopen = 'Y'
            INNER JOIN ishomedb.tz_lms_module lm
            ON ppe.subj_lesson_no = lm.subj_lesson_no
            AND lm.head_gbn != '10001'
            WHERE   ppe.test_url_gbn = '10001'
        ) test on test.subj_lesson_no = les.subj_lesson_no
        AND test.module_no = modu.module_no
        AND test.useq = modu.useq
        LEFT    OUTER   JOIN edubasestudydb.t_student_test ste
        ON      test.f_test_id = ste.f_test_id
        AND     ste.f_user_cd  =  '178681'
        WHERE   pln.student_no =  '178681'
        AND     pln.plan_de = CONVERT('20150505', DATE)

        UNION ALL
        
        SELECT  '' AS subj_no
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no1) AS grade_semester
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no2) AS subj_nm
               ,'' AS head_gbn
               ,'마쓰연산력' AS head_gbn_nm
               ,'' AS module_no
               ,'' AS subj_lesson_no
               ,'' AS useq
               ,'' AS f_test_id
               ,'' AS top_subj_lesson_nm
               ,'' AS tit_lesson_nm
               ,b.category_nm AS subj_lesson_nm 
               ,IF(a.act_dt IS NULL, 'N', 'Y') AS is_finish
               ,a.plan_de 
               ,a.act_dt
               ,a.clear_dt
               ,a.reg_dt
               ,a.category_no
               ,'' AS f_ischeckpoint
               ,'' AS f_stu_test_id
               ,'Y' AS use_yn
               ,0 AS f_point
               ,0 AS f_problem_cnt
               ,0 AS f_right_cnt
          FROM  tz_lcms_plan_math a
          INNER JOIN tz_lcms_theme_category b
          ON a.category_no = b.category_no
          INNER JOIN tz_lcms_theme_category ctg1
          ON b.upper_no = ctg1.category_no
          INNER JOIN tz_lcms_theme_category ctg2
          ON ctg1.upper_no = ctg2.category_no
          INNER JOIN tz_lcms_theme_category ctg3
          ON ctg2.upper_no = ctg3.category_no
         WHERE  a.student_no  = '178681'
           AND  a.plan_de = CONVERT('20150505', DATE)

        UNION ALL                                           
                
        SELECT '' AS subj_no
              
              ,'' AS grade_semester
              ,IF(ltc3.category_no = 18567
                  ,CONCAT(ltc3.category_nm,  CASE WHEN CHAR_LENGTH(ltc2.category_nm)   >   5 THEN CONCAT('\n', ltc2.category_nm) ELSE CONCAT(' ', ltc2.category_nm) END )
                  ,CONCAT(ltc2.category_nm,  CASE WHEN CHAR_LENGTH(ltc1.category_nm)   >   5 THEN CONCAT('\n', ltc1.category_nm) ELSE CONCAT(' ', ltc1.category_nm) END )
               ) AS subj_nm
              ,'' AS head_gbn
              ,IF(ltc3.category_no = 18567, ltc4.category_nm, ltc3.category_nm) AS head_gbn_nm
              ,'' AS module_no
              ,'' AS subj_lesson_no
              ,'' AS useq
              ,'' AS f_test_id
              ,'' AS top_subj_lesson_nm
              ,'' AS tit_lesson_nm
              ,ltm.title AS subj_lesson_nm 
              ,IF(lpt.act_dt IS NULL, 'N', 'Y') AS is_finish
              ,lpt.plan_de 
              ,lpt.act_dt
              ,lpt.clear_dt
              ,lpt.reg_dt
              ,lpt.material_no AS category_no
              ,'' AS f_ischeckpoint
              ,'' AS f_stu_test_id
              ,'Y' AS use_yn
              ,0 AS f_point
              ,0 AS f_problem_cnt
              ,0 AS f_right_cnt
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        INNER JOIN tz_lcms_theme_category ltc1
        ON ltm.category_no = ltc1.category_no
        INNER JOIN tz_lcms_theme_category ltc2
        ON ltc1.upper_no = ltc2.category_no
        INNER JOIN tz_lcms_theme_category ltc3
        ON ltc2.upper_no = ltc3.category_no
        INNER JOIN tz_lcms_theme_category ltc4
        ON ltc3.upper_no = ltc4.category_no
        WHERE lpt.student_no = '178681'
        	AND lpt.plan_de = CONVERT('20150505', DATE)

        ORDER BY reg_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 5.727469  Lock_time: 0.000302 Rows_sent: 2  Rows_examined: 74
SET timestamp=1430907804;
/*틀린문제 + 유사 문제*/
            SELECT 1 dvsn,
                   b.f_test_id, 
                   b.f_num,
                   a.f_problem_id problem_no, 
                   a.f_header_id header_no, 
                   a.f_ptype ptype, 
                   a.f_difficult difficult, 
                   IFNULL(a.f_pro_cml, '') question,
                   '' dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   0 cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                 
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b 
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d      
             WHERE 1=1
               AND a.f_problem_id   = b.f_problem_id
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640321'
               AND a.f_problem_id   = b.f_problem_id
               /*cast( mList as signed)*/ 
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id, '')
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id2, '')  
             UNION
            SELECT 2 dvsn,
                   b.f_test_id,
                   b.f_num,
                   a.f_problem_id problem_no,
                   a.f_header_id header_no,
                   a.f_ptype ptype,
                   a.f_difficult difficult,
                   IFNULL(a.f_pro_cml, '') question,
                   b.f_problem_id dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   (case when a.f_problem_id = b.f_cproblem_id then 1 else 2 end) cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d                
              WHERE 1=1
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640321'
               /* AND b.f_problem_id   = cast(mList as signed) */
               AND (a.f_problem_id  = b.f_cproblem_id or  a.f_problem_id = b.f_cproblem_id2)
             ORDER BY f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 5.666375  Lock_time: 0.000260 Rows_sent: 8  Rows_examined: 102
SET timestamp=1430907804;
/*틀린문제 + 유사 문제*/
            SELECT 1 dvsn,
                   b.f_test_id, 
                   b.f_num,
                   a.f_problem_id problem_no, 
                   a.f_header_id header_no, 
                   a.f_ptype ptype, 
                   a.f_difficult difficult, 
                   IFNULL(a.f_pro_cml, '') question,
                   '' dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   0 cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                 
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b 
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d      
             WHERE 1=1
               AND a.f_problem_id   = b.f_problem_id
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640318'
               AND a.f_problem_id   = b.f_problem_id
               /*cast( mList as signed)*/ 
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id, '')
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id2, '')  
             UNION
            SELECT 2 dvsn,
                   b.f_test_id,
                   b.f_num,
                   a.f_problem_id problem_no,
                   a.f_header_id header_no,
                   a.f_ptype ptype,
                   a.f_difficult difficult,
                   IFNULL(a.f_pro_cml, '') question,
                   b.f_problem_id dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   (case when a.f_problem_id = b.f_cproblem_id then 1 else 2 end) cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , '' solution
                
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d                
              WHERE 1=1
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972640318'
               /* AND b.f_problem_id   = cast(mList as signed) */
               AND (a.f_problem_id  = b.f_cproblem_id or  a.f_problem_id = b.f_cproblem_id2)
             ORDER BY f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.449912  Lock_time: 0.000463 Rows_sent: 2  Rows_examined: 14
SET timestamp=1430907804;
/*오답노트*/
             SELECT (CASE WHEN d.f_kind_cd = '01' THEN
                        1 
                    ELSE
                        2
                    END) dvsn,
                    b.f_test_id,
                    s.f_chapter_cd,
                    s.f_kind_cd,
                    s.f_no, 
                    b.f_num,
                    d.f_stu_test_id,
                    d.f_problem_id AS problem_id,
                    d.f_problem_test_id AS f_problem_id,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id)
                    ELSE
                        a.F_Header_ID
                    END) header_no, /* 국어의 경우 유사문제 지문 없음에 대비 */ 
                    a.f_ptype ptype,  
                    a.f_difficult difficult, 
                    IFNULL(a.f_pro_cml, '') question,
                    (CASE WHEN d.f_kind_cd = '01' THEN
                        '' 
                    ELSE
                        b.f_problem_id
                    END) dproblem_id,
                    etc.f_field2 dftproblem,
                    (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                    (case when a.f_problem_id = b.f_cproblem_id then 1 else 0 end) cSort,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT f_cml FROM edubasebankdb.T_Header where f_header_id = (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id))
                    ELSE
                        e.f_cml
                    END) header, /* 국어의 경우 유사문제 지문 없음에 대비 */
                    a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                    '1' AS teach_qna,
                    'N' AS errnote_yn    /* 오답노트 담기여부 */
                     
                    ,'' solution
                     
                    ,d.f_result1
                    ,d.f_input
                    ,d.f_ispen
                    ,d.f_input_path
                    ,(CASE WHEN s.f_kind_cd = 'T110' THEN
                        CONCAT(le.sort, '장. ', le.subj_lesson_nm , ' - ', '실력평가')
                      WHEN s.f_kind_cd = 'T120' THEN
                        CONCAT(le.sort, '단원. ', le.subj_lesson_nm , ' - ', '단원평가')
                      WHEN s.f_kind_cd = 'T130' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '중간고사')
                      WHEN s.f_kind_cd = 'T135' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '기말고사')
                      WHEN s.f_kind_cd = 'T150' THEN
                        CONCAT(le.sort, '단원 ', le.subj_lesson_nm , ' - ', '수학경시')
                      END) test_nm
	                        
             FROM edubasebankdb.T_Problem a
             LEFT OUTER JOIN edubasebankdb.T_Problem_Etc etc 
             ON a.f_problem_id = etc.f_problem_id 
             LEFT OUTER JOIN edubasebankdb.T_Header e 
             ON a.f_header_id = e.f_header_id
             ,edubasestudydb.t_test_problem b
             INNER JOIN edubasestudydb.t_test s 
             ON b.f_test_id = s.f_test_id
             LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson le
             ON s.f_chapter_cd = le.subj_lesson_no
             ,edubasestudydb.t_student_test c 
             ,edubasestudydb.t_student_test_errornote_problem d 
             WHERE 1=1
             AND a.f_problem_id   = d.f_problem_id
             AND b.f_test_id      = c.f_test_id
             AND c.f_stu_test_id  = d.f_stu_test_id
             AND b.f_num          = d.f_num
             AND d.f_stu_test_id IN (972513523)
             ORDER BY b.f_test_id, b.f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 7.385473  Lock_time: 0.000063 Rows_sent: 20  Rows_examined: 60
SET timestamp=1430907804;
SELECT 
            IFNULL(t2.f_advice,'') comment 
        FROM    edubasestudydb.t_student_test t1 
        LEFT JOIN   edubasestudydb.t_student_test_problem t2
        ON  t1.f_stu_test_id = t2.f_stu_test_id
        WHERE   t1.f_stu_test_id = '972640337' 
        ORDER BY t2.f_num;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 7.354272  Lock_time: 0.521870 Rows_sent: 4  Rows_examined: 88
SET timestamp=1430907804;
/*틀린문제 + 유사 문제*/
            SELECT 1 dvsn,
                   b.f_test_id, 
                   b.f_num,
                   a.f_problem_id problem_no, 
                   a.f_header_id header_no, 
                   a.f_ptype ptype, 
                   a.f_difficult difficult, 
                   IFNULL(a.f_pro_cml, '') question,
                   '' dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   0 cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , IFNULL(a.f_sol_cml, '') solution
                 
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b 
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d      
             WHERE 1=1
               AND a.f_problem_id   = b.f_problem_id
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972639981'
               AND a.f_problem_id   = b.f_problem_id
               /*cast( mList as signed)*/ 
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id, '')
               AND a.f_problem_id  != IFNULL(b.f_cproblem_id2, '')  
             UNION
            SELECT 2 dvsn,
                   b.f_test_id,
                   b.f_num,
                   a.f_problem_id problem_no,
                   a.f_header_id header_no,
                   a.f_ptype ptype,
                   a.f_difficult difficult,
                   IFNULL(a.f_pro_cml, '') question,
                   b.f_problem_id dproblem_id,
                   etc.f_field2            dftproblem,
                   (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                   (case when a.f_problem_id = b.f_cproblem_id then 1 else 2 end) cSort,
                   e.f_cml header,
                   a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                   '1' AS teach_qna,
                   'Y' AS errnote_yn    /* 오답노트 담기여부 */
             
                  , ifnull(a.f_sol_cml, '') solution
                
              FROM edubasebankdb.T_Problem a
                   left outer join edubasebankdb.T_Problem_Etc etc on a.f_problem_id = etc.f_problem_id
                   left outer join edubasebankdb.T_Header e on a.f_header_id = e.f_header_id               
                  ,edubasestudydb.t_test_problem b
                  ,edubasestudydb.t_student_test c
                  ,edubasestudydb.t_student_test_problem d                
              WHERE 1=1
               AND b.f_test_id      = c.f_test_id
               AND b.f_num          = d.f_num
               AND c.f_stu_test_id  = d.f_stu_test_id
               AND d.f_result      != '1'
               AND c.f_stu_test_id  = '972639981'
               /* AND b.f_problem_id   = cast(mList as signed) */
               AND (a.f_problem_id  = b.f_cproblem_id or  a.f_problem_id = b.f_cproblem_id2)
             ORDER BY f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 6.095660  Lock_time: 0.000132 Rows_sent: 64  Rows_examined: 278
SET timestamp=1430907804;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_assets_resource asset
        WHERE xml_type = 'A'
        
        UNION ALL
        
        SELECT 
               skin_id AS file_no
              ,'' AS res_key
              ,'skin' AS file_type
              ,skin_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_skins_resource skin
        WHERE xml_type = 'A'
          AND skin_code = '4'
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_contents cont
        INNER JOIN ishomedb.tz_android_air_schoolstudy_resource res
        ON cont.subj_lesson_no = res.subj_lesson_no
        WHERE cont.use_yn = 'Y'
          AND res.subj_lesson_no = 4932;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 5.512458  Lock_time: 0.240819 Rows_sent: 4  Rows_examined: 32
SET timestamp=1430907804;
/*보충문제 = 유사 문제*/            
            SELECT  1 dvsn,
			        b.f_test_id,
			        b.f_num,
			        a.F_Problem_ID AS problem_no,
                    (CASE WHEN a.F_Header_ID IS NOT NULL THEN
		                  a.F_Header_ID
		               ELSE
		                  f.F_Header_ID
		               END) AS header_no,
                    a.f_ptype ptype,
			        a.F_Difficult AS difficult,
			        IFNULL(a.f_pro_cml, '') question,
			        b.f_problem_id AS dproblem_id,
                    etc.f_field2            dftproblem,
			        (CASE WHEN trim(etc.f_field7) != '' THEN a.f_problem_id ELSE '' END) listen,
			        (CASE WHEN a.f_problem_id = b.f_cproblem_id THEN 1 ELSE 2 END) cSort,
			        (CASE WHEN a.F_Header_ID IS NOT NULL THEN
		                  c.F_CML
		               ELSE
		                  g.F_CML
		               END) AS header,
			        a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
			        '' AS teach_qna,      /* 보충문제의 경우 선생님께 질문하기 버튼 없음 */
			        'N' AS errnote_yn    /* 보충문제의 경우 오답노트 담기여부 버튼 없음 */
			         
		                  , ifnull(a.f_sol_cml, '') solution
		                
			FROM edubasebankdb.T_Problem a
			INNER JOIN edubasestudydb.t_test_problem b
			ON a.F_Problem_ID = b.f_cproblem_id
			OR a.F_Problem_ID = b.f_cproblem_id2
			LEFT OUTER JOIN edubasebankdb.T_Header c
			ON a.F_Header_ID=c.F_Header_ID
			LEFT OUTER JOIN edubasestudydb.t_student_test d
			ON b.f_test_id=d.f_test_id
			LEFT OUTER JOIN edubasestudydb.t_student_test_problem e
			ON d.f_stu_test_id=e.f_stu_test_id
			AND b.f_num=e.f_num
			LEFT OUTER JOIN edubasebankdb.T_Problem_Etc etc
			ON a.F_Problem_ID=etc.F_Problem_ID
		    LEFT OUTER JOIN edubasebankdb.T_Problem f
		    ON b.f_problem_id = f.F_Problem_ID
		    LEFT OUTER JOIN edubasebankdb.T_Header g
		    ON f.F_Header_ID = g.F_Header_ID
			WHERE d.f_stu_test_id  = '972640174'
			AND e.f_result = '1'
			ORDER BY e.f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.842890  Lock_time: 0.000415 Rows_sent: 18  Rows_examined: 410
SET timestamp=1430907804;
SELECT   les.subj_no
                ,les.sort
                ,les.subj_lesson_no
                ,les.subj_lesson_nm               
                ,CASE WHEN (SELECT count(subj_lesson_no) 
                           FROM ishomedb.tz_lcms_prepare_test 
                           WHERE subj_lesson_no = les.subj_lesson_no 
                           AND test_url_gbn = '10001') > 1 THEN 
                        CASE WHEN tst.useq = 1 THEN
                            '[단원중급]'
                        WHEN tst.useq = 2 THEN
                            '[단원상급]'
                        WHEN tst.useq = 3 THEN
                            '[단원기본]'
                        ELSE
                            ''
                        END
                     ELSE 
                        ''
                END AS tit_lesson_nm
                ,tst.useq
                ,tst.test_url_gbn
                ,tst.contents_no
                ,IFNULL(tst.count_short_answer, 0) AS count_short_answer
                ,IFNULL(tst.count_text_answer, 0) AS count_text_answer
                ,IFNULL(tst.limit_time, 0) AS limit_time
                ,IFNULL(stt.f_stu_test_id, '') as f_stu_test_id              /*평가 결과 ID*/
                ,IFNULL(stt.f_ischeckpoint, '') as f_ischeckpoint             /* 채점완료 */
                ,stt.f_isstatic                 /* 통계완료 */
                ,cms.porting_type               /* 시험보기 */
                ,CONCAT(cms.porting_value,  '&closeSave=TEST' ) as porting_value  /* esc 닫기 alter 메시지 처리로 인한 파라메터 추가  */
                ,cm2.porting_type  AS type2
                ,REPLACE(cm2.porting_value, 'testResult.do', 'testResultNew.do')   AS url2    /* 틀린문제 채점결과/풀이보기 */
                ,cm3.porting_type  AS type3
                ,REPLACE(cm3.porting_value, 'testResult.do', 'testResultNew.do')   AS url3    /* 채점결과/풀이보기 */ 
                ,cm4.porting_type   AS type4    /* 평가분석표 */   
                ,cm4.porting_value  AS url4
                ,cm5.porting_type   AS type5    /* 틀린문제 다시풀기 */  
                ,cm5.porting_value  AS url5
                ,cm2.porting_type   AS type6 
                ,REPLACE(REPLACE(cm2.porting_value, 'T202', 'T402'), 'testResult.do', 'testResultNew.do')  AS url6
                ,cm5.porting_type   AS type7 
                ,REPLACE(cm5.porting_value, 'T201', 'T401')  AS url7          
                ,IFNULL(st2.f_test_dt, '') as f_st2_dt      /* 틀린문제다시풀기응시일 */
                ,IFNULL(st3.f_test_dt, '') as f_st3_dt                               /* 보충문제 다시 풀기 응시일 */
                ,( SELECT COUNT(f_num) FROM edubasestudydb.t_student_test_problem 
                    WHERE f_stu_test_id = stt.f_stu_test_id AND f_result != '1'
                ) AS stp_cnt                    /* 틀린문제 수 */
                ,(SELECT COUNT(f_num) FROM edubasestudydb.t_student_test_problem 
                    WHERE f_stu_test_id = stt.f_stu_test_id AND f_result = '1'
                ) AS ok_cnt
                ,ets.f_supply_yn                  /* 보충문제(유사문제 여부) */
                ,ets.f_isopen
                ,ets.math_yn
                ,IFNULL(stt.f_point, 0) as f_point
                /* 통합교과의 경우에만 */
                 
                        ,'' as subj_knd_nm_img
                        ,'' as subj_gbn
                     
        FROM    ishomedb.tz_lcms_study_lesson les
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test tst
        ON      les.subj_lesson_no  = tst.subj_lesson_no
        AND     tst.test_url_gbn    = '10001'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cms
        ON      tst.contents_no = cms.contents_no
        
        LEFT    OUTER JOIN edubasestudydb.t_test ets
        ON      ets.f_chapter_cd    = les.subj_lesson_no
        AND     ets.f_no            = tst.useq
        AND     ets.f_kind_cd       = 'T120'
        AND     ets.f_isdelete      = 'N'       
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt2
        ON      pt2.subj_lesson_no  = les.subj_lesson_no
        AND     pt2.useq            = tst.useq
        AND     pt2.test_url_gbn    = '10002'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt3
        ON      pt3.subj_lesson_no  = les.subj_lesson_no
        AND     pt3.useq            = tst.useq
        AND     pt3.test_url_gbn    = '10003'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt4
        ON      pt4.subj_lesson_no  = les.subj_lesson_no
        AND     pt4.useq            = tst.useq
        AND     pt4.test_url_gbn    = '10004'
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_prepare_test  pt5
        ON      pt5.subj_lesson_no  = les.subj_lesson_no
        AND     pt5.useq            = tst.useq
        AND     pt5.test_url_gbn    = '10005' 
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm2
        ON      cm2.contents_no = pt2.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm3
        ON      cm3.contents_no = pt3.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm4
        ON      cm4.contents_no = pt4.contents_no
        
        LEFT    OUTER JOIN ishomedb.tz_lcms_contents cm5
        ON      cm5.contents_no = pt5.contents_no
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test stt
        ON      stt.f_test_id = ets.f_test_id
        AND     stt.f_user_cd = 283070
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test2 st2
        ON      st2.f_kind_cd     = '01'
        AND     st2.f_stu_test_id = stt.f_stu_test_id
        
        LEFT    OUTER JOIN edubasestudydb.t_student_test3 st3
        ON      st3.f_kind_cd     = '01'
        AND     st3.f_stu_test_id = stt.f_stu_test_id
        
        /* 통합교과의 경우에만 */
         
         WHERE  les.lvl = 1
            AND les.lesson_gbn = 10001
            /* AND (ets.f_isopen != 'N' OR ets.f_isopen = '' OR ets.f_isopen IS NULL) */ 
            
                AND les.subj_no = 201 
        ORDER   BY  les.order_key ASC, ets.order_no DESC, tst.useq DESC;
# Time: 150506 19:23:26
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 7.361399  Lock_time: 0.136965 Rows_sent: 71  Rows_examined: 299
SET timestamp=1430907806;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_assets_resource asset
        WHERE xml_type = 'A'
        
        UNION ALL
        
        SELECT 
               skin_id AS file_no
              ,'' AS res_key
              ,'skin' AS file_type
              ,skin_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_skins_resource skin
        WHERE xml_type = 'A'
          AND skin_code = '4'
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_contents cont
        INNER JOIN ishomedb.tz_android_air_schoolstudy_resource res
        ON cont.subj_lesson_no = res.subj_lesson_no
        WHERE cont.use_yn = 'Y'
          AND res.subj_lesson_no = 4964;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 7.117509  Lock_time: 0.000079 Rows_sent: 28  Rows_examined: 92
SET timestamp=1430907806;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_corelecture_assets_resource asset
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_corelecture_resource res
        WHERE subj_lesson_no = '7273';
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 6.433898  Lock_time: 0.000068 Rows_sent: 5  Rows_examined: 19
SET timestamp=1430907806;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_dicessence_assets_resource asset
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_dicessence_resource res
        WHERE subj_lesson_no = '7302';
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 6.481178  Lock_time: 0.000179 Rows_sent: 16  Rows_examined: 80
SET timestamp=1430907806;
SELECT   sd.dictionary_no
		        ,lc.contents_no
		        ,lc.porting_value
		        ,LEFT(SUBSTRING(cc.objectname_kor, LOCATE(']',cc.objectname_kor)+1), 10) AS objectname_kor
		        ,IF(LENGTH(cc.headline) > 10, CONCAT(LEFT(cc.headline,20),'...'), LEFT(cc.headline, LENGTH(cc.headline))) AS headline
		FROM    ishomedb.tz_lcms_study_dictionary sd
		INNER   JOIN ishomedb.tz_lcms_study_dictionary sd2
		ON      sd.subj_lesson_no = sd2.subj_lesson_no
		INNER   JOIN ishomedb.tz_lcms_contents lc
		ON      sd.contents_no = lc.contents_no
		INNER   JOIN ishomedb.tz_cms_contents cc
		ON      lc.porting_value = cc.contents_no
		WHERE   sd2.dictionary_no = '174132'
		AND     sd.dictionary_type = '1'
		ORDER   BY objectname_kor ASC;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 6.091639  Lock_time: 0.000066 Rows_sent: 1  Rows_examined: 3
SET timestamp=1430907806;
SELECT   t1.origin_path
                ,t1.pic_mediatime
                ,t1.contents_no
                ,t1.media_type
                ,t1.objectname_kor
                ,t1.tag1
                ,t1.x_size
                ,t1.y_size
                ,IF(t2.contents_type = 'GLOBAL','Y','N') AS global_movie
        FROM    ishomedb.tz_cms_contents t1
        LEFT JOIN tz_lcms_contents AS t2 ON t1.contents_no = t2.porting_value 
        WHERE    t1.contents_no =  '2010902m3723264' GROUP BY t2.porting_value;
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 6.960558  Lock_time: 0.196610 Rows_sent: 71  Rows_examined: 298
SET timestamp=1430907806;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_assets_resource asset
        WHERE xml_type = 'C'
        
        UNION ALL
        
        SELECT 
               skin_id AS file_no
              ,'' AS res_key
              ,'skin' AS file_type
              ,skin_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_skins_resource skin
        WHERE xml_type = 'C'
          AND skin_code = '23'
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_contents cont
        INNER JOIN ishomedb.tz_android_air_schoolstudy_resource res
        ON cont.subj_lesson_no = res.subj_lesson_no
        WHERE cont.use_yn = 'Y'
          AND res.subj_lesson_no = 7658;
# Time: 150506 19:23:27
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 9.005357  Lock_time: 0.000866 Rows_sent: 6  Rows_examined: 1633300
SET timestamp=1430907807;
SELECT  
                les.subj_no
                ,CONCAT(sbj.grade_gbn, '-', sbj.semester_gbn, ' ') AS grade_semester
                ,CASE WHEN sbj.subj_gbn = 10004 THEN '슬생' ELSE ishomedb.uf_code_subj_nm(sbj.subj_gbn) END AS subj_nm
                ,IFNULL(modu.head_gbn, '') AS head_gbn
                ,IF(10001 = modu.head_gbn, '학교공부예복습', ishomedb.uf_code_nm(10129, modu.head_gbn)) AS head_gbn_nm
                ,modu.module_no
                ,modu.subj_lesson_no
                ,modu.useq
                ,test.f_test_id
                ,CASE WHEN les.lesson_gbn IS NULL THEN
                        uf_lcms_study_lesson_get_most_subj_lesson_nm(modu.subj_lesson_no)
                      ELSE ''
                 END AS top_subj_lesson_nm
                ,CASE WHEN (SELECT count(subj_lesson_no) 
                           FROM ishomedb.tz_lcms_prepare_test 
                           WHERE subj_lesson_no = les.subj_lesson_no 
                           AND test_url_gbn = '10001') > 1 THEN 
	                        CASE WHEN ishomedb.uf_code_nm(10129, modu.head_gbn) = '실력평가' THEN 
	                                 CASE WHEN modu.useq = 1 THEN
	                                            '실력기본'
	                                        WHEN modu.useq = 2 THEN
	                                            '실력중급'
	                                        WHEN modu.useq = 3 THEN
	                                            '실력상급'
	                                        ELSE
	                                            ''
	                                        END
	                               ELSE
	                                    CASE WHEN modu.useq = 1 THEN
	                                        '단원중급'
	                                    WHEN modu.useq = 2 THEN
	                                        '단원상급'
	                                    WHEN modu.useq = 3 THEN
	                                        '단원기본'
	                                    ELSE
	                                        ''
	                                    END
	                                END
	                         ELSE 
	                            ''
                END AS tit_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 /* 10001:단원, 10002:중간고사, 10003:기말고사, 10004:실력 */
                      THEN CONCAT(les.sort, '단원. ', les.subj_lesson_nm)
                      WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) 
                      THEN CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)')
                      WHEN les.lesson_gbn IS NULL THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm)
                 END  AS subj_lesson_nm
                ,CASE WHEN act.clear_dt IS NOT NULL THEN 'Y'
                      ELSE (SELECT IF(COUNT(1) = 0, 'N', 'I')
                            FROM tz_lms_act_element 
                            WHERE student_no = act.student_no
                                AND plan_de = act.plan_de
                                AND module_no = modu.module_no
                           ) 
                 END AS is_finish
                ,DATE_FORMAT(pln.plan_de, '%Y-%m-%d') AS plan_de
                ,act.act_dt
                ,act.clear_dt
                ,pln.reg_dt
                ,'' AS category_no
                ,ste.f_ischeckpoint
                ,ste.f_stu_test_id
                ,les.use_yn
                ,ste.f_point
                ,test.f_problem_cnt
                , (SELECT count(f_result) FROM edubasestudydb.t_student_test_problem where f_stu_test_id = ste.f_stu_test_id AND f_result = 1) AS f_right_cnt
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no

        LEFT    OUTER JOIN (
            SELECT tst.f_test_id, tst.f_problem_cnt, ppe.subj_lesson_no, lm.module_no, ppe.useq
            FROM ishomedb.tz_lcms_prepare_test ppe 
            INNER JOIN edubasestudydb.t_test tst
            ON ppe.subj_lesson_no = tst.f_chapter_cd
            AND ppe.useq = tst.f_no
            AND tst.f_kind_cd IN ('T110', 'T120', 'T130', 'T135')
            AND tst.f_isopen = 'Y'
            INNER JOIN ishomedb.tz_lms_module lm
            ON ppe.subj_lesson_no = lm.subj_lesson_no
            AND lm.head_gbn != '10001'
            WHERE   ppe.test_url_gbn = '10001'
        ) test on test.subj_lesson_no = les.subj_lesson_no
        AND test.module_no = modu.module_no
        AND test.useq = modu.useq
        LEFT    OUTER   JOIN edubasestudydb.t_student_test ste
        ON      test.f_test_id = ste.f_test_id
        AND     ste.f_user_cd  =  '214318'
        WHERE   pln.student_no =  '214318'
        AND     pln.plan_de = CONVERT('20150506', DATE)

        UNION ALL
        
        SELECT  '' AS subj_no
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no1) AS grade_semester
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no2) AS subj_nm
               ,'' AS head_gbn
               ,'마쓰연산력' AS head_gbn_nm
               ,'' AS module_no
               ,'' AS subj_lesson_no
               ,'' AS useq
               ,'' AS f_test_id
               ,'' AS top_subj_lesson_nm
               ,'' AS tit_lesson_nm
               ,b.category_nm AS subj_lesson_nm 
               ,IF(a.act_dt IS NULL, 'N', 'Y') AS is_finish
               ,a.plan_de 
               ,a.act_dt
               ,a.clear_dt
               ,a.reg_dt
               ,a.category_no
               ,'' AS f_ischeckpoint
               ,'' AS f_stu_test_id
               ,'Y' AS use_yn
               ,0 AS f_point
               ,0 AS f_problem_cnt
               ,0 AS f_right_cnt
          FROM  tz_lcms_plan_math a
          INNER JOIN tz_lcms_theme_category b
          ON a.category_no = b.category_no
          INNER JOIN tz_lcms_theme_category ctg1
          ON b.upper_no = ctg1.category_no
          INNER JOIN tz_lcms_theme_category ctg2
          ON ctg1.upper_no = ctg2.category_no
          INNER JOIN tz_lcms_theme_category ctg3
          ON ctg2.upper_no = ctg3.category_no
         WHERE  a.student_no  = '214318'
           AND  a.plan_de = CONVERT('20150506', DATE)

        UNION ALL                                           
                
        SELECT '' AS subj_no
              
              ,'' AS grade_semester
              ,IF(ltc3.category_no = 18567
                  ,CONCAT(ltc3.category_nm,  CASE WHEN CHAR_LENGTH(ltc2.category_nm)   >   5 THEN CONCAT('\n', ltc2.category_nm) ELSE CONCAT(' ', ltc2.category_nm) END )
                  ,CONCAT(ltc2.category_nm,  CASE WHEN CHAR_LENGTH(ltc1.category_nm)   >   5 THEN CONCAT('\n', ltc1.category_nm) ELSE CONCAT(' ', ltc1.category_nm) END )
               ) AS subj_nm
              ,'' AS head_gbn
              ,IF(ltc3.category_no = 18567, ltc4.category_nm, ltc3.category_nm) AS head_gbn_nm
              ,'' AS module_no
              ,'' AS subj_lesson_no
              ,'' AS useq
              ,'' AS f_test_id
              ,'' AS top_subj_lesson_nm
              ,'' AS tit_lesson_nm
              ,ltm.title AS subj_lesson_nm 
              ,IF(lpt.act_dt IS NULL, 'N', 'Y') AS is_finish
              ,lpt.plan_de 
              ,lpt.act_dt
              ,lpt.clear_dt
              ,lpt.reg_dt
              ,lpt.material_no AS category_no
              ,'' AS f_ischeckpoint
              ,'' AS f_stu_test_id
              ,'Y' AS use_yn
              ,0 AS f_point
              ,0 AS f_problem_cnt
              ,0 AS f_right_cnt
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        INNER JOIN tz_lcms_theme_category ltc1
        ON ltm.category_no = ltc1.category_no
        INNER JOIN tz_lcms_theme_category ltc2
        ON ltc1.upper_no = ltc2.category_no
        INNER JOIN tz_lcms_theme_category ltc3
        ON ltc2.upper_no = ltc3.category_no
        INNER JOIN tz_lcms_theme_category ltc4
        ON ltc3.upper_no = ltc4.category_no
        WHERE lpt.student_no = '214318'
        	AND lpt.plan_de = CONVERT('20150506', DATE)

        ORDER BY reg_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 9.440990  Lock_time: 0.000150 Rows_sent: 56  Rows_examined: 251
SET timestamp=1430907807;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_assets_resource asset
        WHERE xml_type = 'C'
        
        UNION ALL
        
        SELECT 
               skin_id AS file_no
              ,'' AS res_key
              ,'skin' AS file_type
              ,skin_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_skins_resource skin
        WHERE xml_type = 'C'
          AND skin_code = '25'
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_contents cont
        INNER JOIN ishomedb.tz_android_air_schoolstudy_resource res
        ON cont.subj_lesson_no = res.subj_lesson_no
        WHERE cont.use_yn = 'Y'
          AND res.subj_lesson_no = 7323;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 7.525953  Lock_time: 0.183640 Rows_sent: 63  Rows_examined: 275
SET timestamp=1430907807;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_assets_resource asset
        WHERE xml_type = 'A'
        
        UNION ALL
        
        SELECT 
               skin_id AS file_no
              ,'' AS res_key
              ,'skin' AS file_type
              ,skin_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_skins_resource skin
        WHERE xml_type = 'A'
          AND skin_code = '4'
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_contents cont
        INNER JOIN ishomedb.tz_android_air_schoolstudy_resource res
        ON cont.subj_lesson_no = res.subj_lesson_no
        WHERE cont.use_yn = 'Y'
          AND res.subj_lesson_no = 4979;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 11.884206  Lock_time: 0.000336 Rows_sent: 2  Rows_examined: 17
SET timestamp=1430907807;
/*오답노트*/
             SELECT (CASE WHEN d.f_kind_cd = '01' THEN
                        1 
                    ELSE
                        2
                    END) dvsn,
                    b.f_test_id,
                    s.f_chapter_cd,
                    s.f_kind_cd,
                    s.f_no, 
                    b.f_num,
                    d.f_stu_test_id,
                    d.f_problem_id AS problem_id,
                    d.f_problem_test_id AS f_problem_id,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id)
                    ELSE
                        a.F_Header_ID
                    END) header_no, /* 국어의 경우 유사문제 지문 없음에 대비 */ 
                    a.f_ptype ptype,  
                    a.f_difficult difficult, 
                    IFNULL(a.f_pro_cml, '') question,
                    (CASE WHEN d.f_kind_cd = '01' THEN
                        '' 
                    ELSE
                        b.f_problem_id
                    END) dproblem_id,
                    etc.f_field2 dftproblem,
                    (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                    (case when a.f_problem_id = b.f_cproblem_id then 1 else 0 end) cSort,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT f_cml FROM edubasebankdb.T_Header where f_header_id = (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id))
                    ELSE
                        e.f_cml
                    END) header, /* 국어의 경우 유사문제 지문 없음에 대비 */
                    a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                    '1' AS teach_qna,
                    'N' AS errnote_yn    /* 오답노트 담기여부 */
                     
                    ,'' solution
                     
                    ,d.f_result1
                    ,d.f_input
                    ,d.f_ispen
                    ,d.f_input_path
                    ,(CASE WHEN s.f_kind_cd = 'T110' THEN
                        CONCAT(le.sort, '장. ', le.subj_lesson_nm , ' - ', '실력평가')
                      WHEN s.f_kind_cd = 'T120' THEN
                        CONCAT(le.sort, '단원. ', le.subj_lesson_nm , ' - ', '단원평가')
                      WHEN s.f_kind_cd = 'T130' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '중간고사')
                      WHEN s.f_kind_cd = 'T135' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '기말고사')
                      WHEN s.f_kind_cd = 'T150' THEN
                        CONCAT(le.sort, '단원 ', le.subj_lesson_nm , ' - ', '수학경시')
                      END) test_nm
	                        
             FROM edubasebankdb.T_Problem a
             LEFT OUTER JOIN edubasebankdb.T_Problem_Etc etc 
             ON a.f_problem_id = etc.f_problem_id 
             LEFT OUTER JOIN edubasebankdb.T_Header e 
             ON a.f_header_id = e.f_header_id
             ,edubasestudydb.t_test_problem b
             INNER JOIN edubasestudydb.t_test s 
             ON b.f_test_id = s.f_test_id
             LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson le
             ON s.f_chapter_cd = le.subj_lesson_no
             ,edubasestudydb.t_student_test c 
             ,edubasestudydb.t_student_test_errornote_problem d 
             WHERE 1=1
             AND a.f_problem_id   = d.f_problem_id
             AND b.f_test_id      = c.f_test_id
             AND c.f_stu_test_id  = d.f_stu_test_id
             AND b.f_num          = d.f_num
             AND d.f_stu_test_id IN (972640220)
             ORDER BY b.f_test_id, b.f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.75]
# Query_time: 7.542925  Lock_time: 0.191640 Rows_sent: 68  Rows_examined: 290
SET timestamp=1430907807;
SELECT 
               asset_id AS file_no
              ,'' AS res_key
              ,'asset' AS file_type
              ,asset_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_assets_resource asset
        WHERE xml_type = 'A'
        
        UNION ALL
        
        SELECT 
               skin_id AS file_no
              ,'' AS res_key
              ,'skin' AS file_type
              ,skin_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_skins_resource skin
        WHERE xml_type = 'A'
          AND skin_code = '7'
        
        UNION ALL
        
        SELECT 
               res.res_id AS file_no
              ,res.subj_lesson_no AS res_key
              ,'res' AS file_type
              ,res_path AS file_path
        FROM ishomedb.tz_android_air_schoolstudy_contents cont
        INNER JOIN ishomedb.tz_android_air_schoolstudy_resource res
        ON cont.subj_lesson_no = res.subj_lesson_no
        WHERE cont.use_yn = 'Y'
          AND res.subj_lesson_no = 5194;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.461353  Lock_time: 0.110002 Rows_sent: 6  Rows_examined: 51
SET timestamp=1430907807;
/*오답노트*/
             SELECT (CASE WHEN d.f_kind_cd = '01' THEN
                        1 
                    ELSE
                        2
                    END) dvsn,
                    b.f_test_id,
                    s.f_chapter_cd,
                    s.f_kind_cd,
                    s.f_no, 
                    b.f_num,
                    d.f_stu_test_id,
                    d.f_problem_id AS problem_id,
                    d.f_problem_test_id AS f_problem_id,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id)
                    ELSE
                        a.F_Header_ID
                    END) header_no, /* 국어의 경우 유사문제 지문 없음에 대비 */ 
                    a.f_ptype ptype,  
                    a.f_difficult difficult, 
                    IFNULL(a.f_pro_cml, '') question,
                    (CASE WHEN d.f_kind_cd = '01' THEN
                        '' 
                    ELSE
                        b.f_problem_id
                    END) dproblem_id,
                    etc.f_field2 dftproblem,
                    (case when trim(etc.f_field7) != '' then a.f_problem_id else '' end) listen,
                    (case when a.f_problem_id = b.f_cproblem_id then 1 else 0 end) cSort,
                    (CASE WHEN d.f_kind_cd = '02' AND a.F_Header_ID is null THEN
                        (SELECT f_cml FROM edubasebankdb.T_Header where f_header_id = (SELECT F_Header_ID FROM edubasebankdb.T_Problem WHERE F_Problem_ID=b.f_problem_id))
                    ELSE
                        e.f_cml
                    END) header, /* 국어의 경우 유사문제 지문 없음에 대비 */
                    a.f_viewanswer, a.f_checkanswer, a.f_inputformat,
                    '1' AS teach_qna,
                    'N' AS errnote_yn    /* 오답노트 담기여부 */
                     
                    ,IFNULL(a.f_sol_cml, '') solution
                     
                    ,d.f_result1
                    ,d.f_input
                    ,d.f_ispen
                    ,d.f_input_path
                    ,(CASE WHEN s.f_kind_cd = 'T110' THEN
                        CONCAT(le.sort, '장. ', le.subj_lesson_nm , ' - ', '실력평가')
                      WHEN s.f_kind_cd = 'T120' THEN
                        CONCAT(le.sort, '단원. ', le.subj_lesson_nm , ' - ', '단원평가')
                      WHEN s.f_kind_cd = 'T130' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '중간고사')
                      WHEN s.f_kind_cd = 'T135' THEN
                        CONCAT(le.sort, '회차 ', le.subj_lesson_nm , ' - ', '기말고사')
                      WHEN s.f_kind_cd = 'T150' THEN
                        CONCAT(le.sort, '단원 ', le.subj_lesson_nm , ' - ', '수학경시')
                      END) test_nm
	                        
             FROM edubasebankdb.T_Problem a
             LEFT OUTER JOIN edubasebankdb.T_Problem_Etc etc 
             ON a.f_problem_id = etc.f_problem_id 
             LEFT OUTER JOIN edubasebankdb.T_Header e 
             ON a.f_header_id = e.f_header_id
             ,edubasestudydb.t_test_problem b
             INNER JOIN edubasestudydb.t_test s 
             ON b.f_test_id = s.f_test_id
             LEFT OUTER JOIN ishomedb.tz_lcms_study_lesson le
             ON s.f_chapter_cd = le.subj_lesson_no
             ,edubasestudydb.t_student_test c 
             ,edubasestudydb.t_student_test_errornote_problem d 
             WHERE 1=1
             AND a.f_problem_id   = d.f_problem_id
             AND b.f_test_id      = c.f_test_id
             AND c.f_stu_test_id  = d.f_stu_test_id
             AND b.f_num          = d.f_num
             AND d.f_stu_test_id IN (972639813)
             ORDER BY b.f_test_id, b.f_num, cSort;
# User@Host: ishome[ishome] @  [192.168.150.76]
# Query_time: 12.668005  Lock_time: 0.000674 Rows_sent: 2  Rows_examined: 1046542
SET timestamp=1430907807;
SELECT  
                les.subj_no
                ,CONCAT(sbj.grade_gbn, '-', sbj.semester_gbn, ' ') AS grade_semester
                ,CASE WHEN sbj.subj_gbn = 10004 THEN '슬생' ELSE ishomedb.uf_code_subj_nm(sbj.subj_gbn) END AS subj_nm
                ,IFNULL(modu.head_gbn, '') AS head_gbn
                ,IF(10001 = modu.head_gbn, '학교공부예복습', ishomedb.uf_code_nm(10129, modu.head_gbn)) AS head_gbn_nm
                ,modu.module_no
                ,modu.subj_lesson_no
                ,modu.useq
                ,test.f_test_id
                ,CASE WHEN les.lesson_gbn IS NULL THEN
                        uf_lcms_study_lesson_get_most_subj_lesson_nm(modu.subj_lesson_no)
                      ELSE ''
                 END AS top_subj_lesson_nm
                ,CASE WHEN (SELECT count(subj_lesson_no) 
                           FROM ishomedb.tz_lcms_prepare_test 
                           WHERE subj_lesson_no = les.subj_lesson_no 
                           AND test_url_gbn = '10001') > 1 THEN 
	                        CASE WHEN ishomedb.uf_code_nm(10129, modu.head_gbn) = '실력평가' THEN 
	                                 CASE WHEN modu.useq = 1 THEN
	                                            '실력기본'
	                                        WHEN modu.useq = 2 THEN
	                                            '실력중급'
	                                        WHEN modu.useq = 3 THEN
	                                            '실력상급'
	                                        ELSE
	                                            ''
	                                        END
	                               ELSE
	                                    CASE WHEN modu.useq = 1 THEN
	                                        '단원중급'
	                                    WHEN modu.useq = 2 THEN
	                                        '단원상급'
	                                    WHEN modu.useq = 3 THEN
	                                        '단원기본'
	                                    ELSE
	                                        ''
	                                    END
	                                END
	                         ELSE 
	                            ''
                END AS tit_lesson_nm
                ,CASE WHEN les.lesson_gbn = 10001 /* 10001:단원, 10002:중간고사, 10003:기말고사, 10004:실력 */
                      THEN CONCAT(les.sort, '단원. ', les.subj_lesson_nm)
                      WHEN (les.lesson_gbn = 10002 OR les.lesson_gbn = 10003) 
                      THEN CONCAT(les.subj_lesson_nm, ' (', modu.useq, '회차)')
                      WHEN les.lesson_gbn IS NULL THEN CONCAT(IF(les.subj_no = 174 || les.subj_no = 175, les.chapter_key, les.sort), '장. ', les.subj_lesson_nm)
                 END  AS subj_lesson_nm
                ,CASE WHEN act.clear_dt IS NOT NULL THEN 'Y'
                      ELSE (SELECT IF(COUNT(1) = 0, 'N', 'I')
                            FROM tz_lms_act_element 
                            WHERE student_no = act.student_no
                                AND plan_de = act.plan_de
                                AND module_no = modu.module_no
                           ) 
                 END AS is_finish
                ,DATE_FORMAT(pln.plan_de, '%Y-%m-%d') AS plan_de
                ,act.act_dt
                ,act.clear_dt
                ,pln.reg_dt
                ,'' AS category_no
                ,ste.f_ischeckpoint
                ,ste.f_stu_test_id
                ,les.use_yn
                ,ste.f_point
                ,test.f_problem_cnt
                , (SELECT count(f_result) FROM edubasestudydb.t_student_test_problem where f_stu_test_id = ste.f_stu_test_id AND f_result = 1) AS f_right_cnt
        FROM    ishomedb.tz_lms_plan_module pln
        INNER   JOIN ishomedb.tz_lms_module modu
        ON      pln.module_no = modu.module_no
        LEFT    OUTER JOIN ishomedb.tz_lms_act_module act
        ON      pln.student_no = act.student_no
        AND     pln.plan_de = act.plan_de
        AND     pln.module_no = act.module_no
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      modu.subj_lesson_no = les.subj_lesson_no
        INNER   JOIN ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no

        LEFT    OUTER JOIN (
            SELECT tst.f_test_id, tst.f_problem_cnt, ppe.subj_lesson_no, lm.module_no, ppe.useq
            FROM ishomedb.tz_lcms_prepare_test ppe 
            INNER JOIN edubasestudydb.t_test tst
            ON ppe.subj_lesson_no = tst.f_chapter_cd
            AND ppe.useq = tst.f_no
            AND tst.f_kind_cd IN ('T110', 'T120', 'T130', 'T135')
            AND tst.f_isopen = 'Y'
            INNER JOIN ishomedb.tz_lms_module lm
            ON ppe.subj_lesson_no = lm.subj_lesson_no
            AND lm.head_gbn != '10001'
            WHERE   ppe.test_url_gbn = '10001'
        ) test on test.subj_lesson_no = les.subj_lesson_no
        AND test.module_no = modu.module_no
        AND test.useq = modu.useq
        LEFT    OUTER   JOIN edubasestudydb.t_student_test ste
        ON      test.f_test_id = ste.f_test_id
        AND     ste.f_user_cd  =  '126189'
        WHERE   pln.student_no =  '126189'
        AND     pln.plan_de = CONVERT('20150507', DATE)

        UNION ALL
        
        SELECT  '' AS subj_no
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no1) AS grade_semester
               ,(select category_nm from tz_lcms_theme_category where category_no = a.upper_no2) AS subj_nm
               ,'' AS head_gbn
               ,'마쓰연산력' AS head_gbn_nm
               ,'' AS module_no
               ,'' AS subj_lesson_no
               ,'' AS useq
               ,'' AS f_test_id
               ,'' AS top_subj_lesson_nm
               ,'' AS tit_lesson_nm
               ,b.category_nm AS subj_lesson_nm 
               ,IF(a.act_dt IS NULL, 'N', 'Y') AS is_finish
               ,a.plan_de 
               ,a.act_dt
               ,a.clear_dt
               ,a.reg_dt
               ,a.category_no
               ,'' AS f_ischeckpoint
               ,'' AS f_stu_test_id
               ,'Y' AS use_yn
               ,0 AS f_point
               ,0 AS f_problem_cnt
               ,0 AS f_right_cnt
          FROM  tz_lcms_plan_math a
          INNER JOIN tz_lcms_theme_category b
          ON a.category_no = b.category_no
          INNER JOIN tz_lcms_theme_category ctg1
          ON b.upper_no = ctg1.category_no
          INNER JOIN tz_lcms_theme_category ctg2
          ON ctg1.upper_no = ctg2.category_no
          INNER JOIN tz_lcms_theme_category ctg3
          ON ctg2.upper_no = ctg3.category_no
         WHERE  a.student_no  = '126189'
           AND  a.plan_de = CONVERT('20150507', DATE)

        UNION ALL                                           
                
        SELECT '' AS subj_no
              
              ,'' AS grade_semester
              ,IF(ltc3.category_no = 18567
                  ,CONCAT(ltc3.category_nm,  CASE WHEN CHAR_LENGTH(ltc2.category_nm)   >   5 THEN CONCAT('\n', ltc2.category_nm) ELSE CONCAT(' ', ltc2.category_nm) END )
                  ,CONCAT(ltc2.category_nm,  CASE WHEN CHAR_LENGTH(ltc1.category_nm)   >   5 THEN CONCAT('\n', ltc1.category_nm) ELSE CONCAT(' ', ltc1.category_nm) END )
               ) AS subj_nm
              ,'' AS head_gbn
              ,IF(ltc3.category_no = 18567, ltc4.category_nm, ltc3.category_nm) AS head_gbn_nm
              ,'' AS module_no
              ,'' AS subj_lesson_no
              ,'' AS useq
              ,'' AS f_test_id
              ,'' AS top_subj_lesson_nm
              ,'' AS tit_lesson_nm
              ,ltm.title AS subj_lesson_nm 
              ,IF(lpt.act_dt IS NULL, 'N', 'Y') AS is_finish
              ,lpt.plan_de 
              ,lpt.act_dt
              ,lpt.clear_dt
              ,lpt.reg_dt
              ,lpt.material_no AS category_no
              ,'' AS f_ischeckpoint
              ,'' AS f_stu_test_id
              ,'Y' AS use_yn
              ,0 AS f_point
              ,0 AS f_problem_cnt
              ,0 AS f_right_cnt
        FROM tz_lms_plan_theme lpt
        INNER JOIN tz_lcms_theme_material ltm
        ON lpt.material_no = ltm.material_no
        INNER JOIN tz_lcms_theme_category ltc1
        ON ltm.category_no = ltc1.category_no
        INNER JOIN tz_lcms_theme_category ltc2
        ON ltc1.upper_no = ltc2.category_no
        INNER JOIN tz_lcms_theme_category ltc3
        ON ltc2.upper_no = ltc3.category_no
        INNER JOIN tz_lcms_theme_category ltc4
        ON ltc3.upper_no = ltc4.category_no
        WHERE lpt.student_no = '126189'
        	AND lpt.plan_de = CONVERT('20150507', DATE)

        ORDER BY reg_dt DESC;
# User@Host: ishome[ishome] @  [192.168.150.40]
# Query_time: 7.352885  Lock_time: 0.000418 Rows_sent: 1  Rows_examined: 29139
SET timestamp=1430907807;
SELECT   sbj.grade_gbn
                ,sbj.semester_gbn
                ,sbj.subj_gbn
                ,ishomedb.uf_code_subj_nm(sbj.subj_gbn) AS subj_nm
                ,sbj.subj_no
                ,sbj.school_study_yn
                ,les.chapter_key
                 
                 
                    ,upp.subj_lesson_no AS unit_lesson_no
                    ,upp.subj_lesson_nm AS unit_lesson_nm
                    ,upp.sort AS unit_sort
                    ,les.subj_lesson_no AS chap_lesson_no
                    ,les.subj_lesson_nm AS chap_lesson_nm
                    ,CASE
                        WHEN les.use_chapter_key = 'Y' AND les.contents_xml_type >= 'C' AND (les.contents_xml_type != 'O' AND les.contents_xml_type != 'N') THEN les.chapter_key
                        ELSE les.sort
                    END AS chap_sort
                 
                 
                ,dic.dictionary_no
                ,dic.contents_no
                ,dic.subj_lesson_no
                ,les.contents_xml_type
        FROM    ishomedb.tz_lcms_dic_essence dic
        INNER   JOIN ishomedb.tz_lcms_study_lesson les
        ON      dic.subj_lesson_no = les.subj_lesson_no
        INNER   JOIN  ishomedb.tz_lcms_subj sbj
        ON      les.subj_no = sbj.subj_no
         
            LEFT    OUTER JOIN ishomedb.tz_lcms_study_lesson upp
            ON      upp.subj_lesson_no IN   (
                        SELECT _key_no
                        FROM   (
                               SELECT   @id AS _key_no 
                                       ,(SELECT @id := upper_no FROM ishomedb.tz_lcms_study_lesson WHERE subj_lesson_no = _key_no) AS upper_no 
                                       ,@level := @level + 1 AS counter_lvl 
                               FROM    (SELECT @id := 3612, @level :=0) vars, 
                                       ishomedb.tz_lcms_study_lesson h 
                               WHERE   @id != 0 
                               ORDER   BY counter_lvl DESC
                               ) a
                        WHERE  a.upper_no = 0
                        )
         
        WHERE   dic.dictionary_no = 10878;
# Time: 150506 19:23:30
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 82.996558  Lock_time: 0.000227 Rows_sent: 15  Rows_examined: 3126800
SET timestamp=1430907810;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  IFNULL(user_gbn_cls, 10001) != 10002  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 19:23:51
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 95.892332  Lock_time: 0.000240 Rows_sent: 15  Rows_examined: 3126800
SET timestamp=1430907831;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  IFNULL(user_gbn_cls, 10001) != 10002  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 19:24:10
# User@Host: ishome[ishome] @  [192.168.150.80]
# Query_time: 100.412855  Lock_time: 0.006097 Rows_sent: 15  Rows_examined: 3126800
SET timestamp=1430907850;
SELECT mem_gbn
            ,user_id
            ,CASE WHEN user_gbn = 10001 THEN '학생'
             WHEN user_gbn = 10002 THEN '학부모'
             WHEN user_gbn = 99999 THEN '비회원'
             ELSE '-' END as user_gbn
            ,nm_kor
            ,login_id
            ,CONCAT(tel1,'-',tel2,'-',tel3) tel
            ,tel1
            ,tel2
            ,tel3
            ,CONCAT(mobile1,'-',mobile2,'-',mobile3) mobile
            ,mobile1
            ,mobile2
            ,mobile3
            ,email
            ,zipcode
            ,addr1
            ,addr2
            ,parent_id
        FROM (
            SELECT 'M' as mem_gbn
                ,user_id
                ,user_gbn
                ,nm_kor
                ,login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,parent_id
            FROM tz_member
             
         WHERE  IFNULL(user_gbn_cls, 10001) != 10002  
     
            UNION
            SELECT 'G' as mem_gbn
                ,user_id
                ,'99999' as user_gbn
                ,nm_kor
                ,'' login_id
                ,tel1
                ,tel2
                ,tel3
                ,mobile1
                ,mobile2
                ,mobile3
                ,email
                ,zipcode
                ,addr1
                ,addr2
                ,'0' as parent_id
            FROM tz_non_member
             
           
                 
            ) mem
        ORDER BY mem.nm_kor ASC
        LIMIT 0, 15;
# Time: 150506 21:14:14
# User@Host: ishome[ishome] @  [220.117.172.107]
# Query_time: 27.716291  Lock_time: 0.000065 Rows_sent: 1  Rows_examined: 76594
SET timestamp=1430914454;
select * from tz_split_paid
where batch_key='150206146913890B';
